(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67458,(e,t,r)=>{"use strict";var s=e.r(71645).__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;r.c=function(e){return s.H.useMemoCache(e)}},932,(e,t,r)=>{"use strict";t.exports=e.r(67458)},67034,(e,t,r)=>{var s={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],s=t[1];return(r+s)*3/4-s},t.toByteArray=function(e){var t,r,i=l(e),a=i[0],o=i[1],c=new n((a+o)*3/4-o),d=0,u=o>0?a-4:a;for(r=0;r<u;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;return 2===o&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,c[d++]=255&t),1===o&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t),c},t.fromByteArray=function(e){for(var t,s=e.length,n=s%3,i=[],a=0,o=s-n;a<o;a+=16383)i.push(function(e,t,s){for(var n,i=[],a=t;a<s;a+=3)n=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(r[n>>18&63]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return i.join("")}(e,a,a+16383>o?o:a+16383));return 1===n?i.push(r[(t=e[s-1])>>2]+r[t<<4&63]+"=="):2===n&&i.push(r[(t=(e[s-2]<<8)+e[s-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),i.join("")};for(var r=[],s=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=i.length;a<o;++a)r[a]=i[a],s[i.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var s=r===t?0:4-r%4;return[r,s]}s[45]=62,s[95]=63},72:function(e,t,r){"use strict";var s=r(675),n=r(783),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return d(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var s=e,n=t;if(("string"!=typeof n||""===n)&&(n="utf8"),!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);var i=0|p(s,n),l=a(i),c=l.write(s,n);return c!==i&&(l=l.slice(0,c)),l}if(ArrayBuffer.isView(e))return u(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(I(e,ArrayBuffer)||e&&I(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(I(e,SharedArrayBuffer)||e&&I(e.buffer,SharedArrayBuffer)))return function(e,t,r){var s;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(s=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),s}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var d=e.valueOf&&e.valueOf();if(null!=d&&d!==e)return o.from(d,t,r);var f=function(e){if(o.isBuffer(e)){var t=0|h(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):u(e):"Buffer"===e.type&&Array.isArray(e.data)?u(e.data):void 0}(e);if(f)return f;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return c(e),a(e<0?0:0|h(e))}function u(e){for(var t=e.length<0?0:0|h(e.length),r=a(t),s=0;s<t;s+=1)r[s]=255&e[s];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(c(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return d(e)},o.allocUnsafeSlow=function(e){return d(e)};function h(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function p(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||I(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,s=arguments.length>2&&!0===arguments[2];if(!s&&0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return k(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return C(e).length;default:if(n)return s?-1:k(e).length;t=(""+t).toLowerCase(),n=!0}}function f(e,t,r){var n,i,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var s=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>s)&&(r=s);for(var n="",i=t;i<r;++i)n+=T[e[i]];return n}(this,t,r);case"utf8":case"utf-8":return b(this,t,r);case"ascii":return function(e,t,r){var s="";r=Math.min(e.length,r);for(var n=t;n<r;++n)s+=String.fromCharCode(127&e[n]);return s}(this,t,r);case"latin1":case"binary":return function(e,t,r){var s="";r=Math.min(e.length,r);for(var n=t;n<r;++n)s+=String.fromCharCode(e[n]);return s}(this,t,r);case"base64":return n=this,i=t,a=r,0===i&&a===n.length?s.fromByteArray(n):s.fromByteArray(n.slice(i,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var s=e.slice(t,r),n="",i=0;i<s.length;i+=2)n+=String.fromCharCode(s[i]+256*s[i+1]);return n}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function g(e,t,r,s,n){var i;if(0===e.length)return -1;if("string"==typeof r?(s=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(i=r*=1)!=i&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(n)return -1;else r=e.length-1;else if(r<0)if(!n)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,s)),o.isBuffer(t))return 0===t.length?-1:x(e,t,r,s,n);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(n)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return x(e,[t],r,s,n)}throw TypeError("val must be string, number or Buffer")}function x(e,t,r,s,n){var i,a=1,o=e.length,l=t.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n){var d=-1;for(i=r;i<o;i++)if(c(e,i)===c(t,-1===d?0:i-d)){if(-1===d&&(d=i),i-d+1===l)return d*a}else -1!==d&&(i-=i-d),d=-1}else for(r+l>o&&(r=o-l),i=r;i>=0;i--){for(var u=!0,h=0;h<l;h++)if(c(e,i+h)!==c(t,h)){u=!1;break}if(u)return i}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(I(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),I(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,s=t.length,n=0,i=Math.min(r,s);n<i;++n)if(e[n]!==t[n]){r=e[n],s=t[n];break}return r<s?-1:+(s<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,s=o.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var i=e[r];if(I(i,Uint8Array)&&(i=o.from(i)),!o.isBuffer(i))throw TypeError('"list" argument must be an Array of Buffers');i.copy(s,n),n+=i.length}return s},o.byteLength=p,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?b(this,0,e):f.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},i&&(o.prototype[i]=o.prototype.inspect),o.prototype.compare=function(e,t,r,s,n){if(I(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===s&&(s=0),void 0===n&&(n=this.length),t<0||r>e.length||s<0||n>this.length)throw RangeError("out of range index");if(s>=n&&t>=r)return 0;if(s>=n)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,s>>>=0,n>>>=0,this===e)return 0;for(var i=n-s,a=r-t,l=Math.min(i,a),c=this.slice(s,n),d=e.slice(t,r),u=0;u<l;++u)if(c[u]!==d[u]){i=c[u],a=d[u];break}return i<a?-1:+(a<i)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)};function b(e,t,r){r=Math.min(e.length,r);for(var s=[],n=t;n<r;){var i,a,o,l,c=e[n],d=null,u=c>239?4:c>223?3:c>191?2:1;if(n+u<=r)switch(u){case 1:c<128&&(d=c);break;case 2:(192&(i=e[n+1]))==128&&(l=(31&c)<<6|63&i)>127&&(d=l);break;case 3:i=e[n+1],a=e[n+2],(192&i)==128&&(192&a)==128&&(l=(15&c)<<12|(63&i)<<6|63&a)>2047&&(l<55296||l>57343)&&(d=l);break;case 4:i=e[n+1],a=e[n+2],o=e[n+3],(192&i)==128&&(192&a)==128&&(192&o)==128&&(l=(15&c)<<18|(63&i)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(d=l)}null===d?(d=65533,u=1):d>65535&&(d-=65536,s.push(d>>>10&1023|55296),d=56320|1023&d),s.push(d),n+=u}var h=s,p=h.length;if(p<=4096)return String.fromCharCode.apply(String,h);for(var f="",m=0;m<p;)f+=String.fromCharCode.apply(String,h.slice(m,m+=4096));return f}function y(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function v(e,t,r,s,n,i){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<i)throw RangeError('"value" argument is out of bounds');if(r+s>e.length)throw RangeError("Index out of range")}function w(e,t,r,s,n,i){if(r+s>e.length||r<0)throw RangeError("Index out of range")}function _(e,t,r,s,i){return t*=1,r>>>=0,i||w(e,t,r,4,34028234663852886e22,-34028234663852886e22),n.write(e,t,r,s,23,4),r+4}function N(e,t,r,s,i){return t*=1,r>>>=0,i||w(e,t,r,8,17976931348623157e292,-17976931348623157e292),n.write(e,t,r,s,52,8),r+8}o.prototype.write=function(e,t,r,s){if(void 0===t)s="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)s=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===s&&(s="utf8")):(s=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var n,i,a,o,l,c,d,u,h=this.length-t;if((void 0===r||r>h)&&(r=h),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var p=!1;;)switch(s){case"hex":return function(e,t,r,s){r=Number(r)||0;var n=e.length-r;s?(s=Number(s))>n&&(s=n):s=n;var i=t.length;s>i/2&&(s=i/2);for(var a=0;a<s;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return n=t,i=r,E(k(e,this.length-n),this,n,i);case"ascii":return a=t,o=r,E(S(e),this,a,o);case"latin1":case"binary":return function(e,t,r,s){return E(S(t),e,r,s)}(this,e,t,r);case"base64":return l=t,c=r,E(C(e),this,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return d=t,u=r,E(function(e,t){for(var r,s,n=[],i=0;i<e.length&&!((t-=2)<0);++i)s=(r=e.charCodeAt(i))>>8,n.push(r%256),n.push(s);return n}(e,this.length-d),this,d,u);default:if(p)throw TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),p=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var s=this.subarray(e,t);return Object.setPrototypeOf(s,o.prototype),s},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||y(e,t,this.length);for(var s=this[e],n=1,i=0;++i<t&&(n*=256);)s+=this[e+i]*n;return s},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||y(e,t,this.length);for(var s=this[e+--t],n=1;t>0&&(n*=256);)s+=this[e+--t]*n;return s},o.prototype.readUInt8=function(e,t){return e>>>=0,t||y(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||y(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||y(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||y(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||y(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||y(e,t,this.length);for(var s=this[e],n=1,i=0;++i<t&&(n*=256);)s+=this[e+i]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||y(e,t,this.length);for(var s=t,n=1,i=this[e+--s];s>0&&(n*=256);)i+=this[e+--s]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readInt8=function(e,t){return(e>>>=0,t||y(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||y(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||y(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||y(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||y(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||y(e,4,this.length),n.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||y(e,4,this.length),n.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||y(e,8,this.length),n.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||y(e,8,this.length),n.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,s){if(e*=1,t>>>=0,r>>>=0,!s){var n=Math.pow(2,8*r)-1;v(this,e,t,r,n,0)}var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,s){if(e*=1,t>>>=0,r>>>=0,!s){var n=Math.pow(2,8*r)-1;v(this,e,t,r,n,0)}var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,s){if(e*=1,t>>>=0,!s){var n=Math.pow(2,8*r-1);v(this,e,t,r,n-1,-n)}var i=0,a=1,o=0;for(this[t]=255&e;++i<r&&(a*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,s){if(e*=1,t>>>=0,!s){var n=Math.pow(2,8*r-1);v(this,e,t,r,n-1,-n)}var i=r-1,a=1,o=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return _(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return _(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return N(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return N(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,s){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<r&&(s=r),s===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(s<0)throw RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-r&&(s=e.length-t+r);var n=s-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,s);else if(this===e&&r<t&&t<s)for(var i=n-1;i>=0;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,s),t);return n},o.prototype.fill=function(e,t,r,s){if("string"==typeof e){if("string"==typeof t?(s=t,t=0,r=this.length):"string"==typeof r&&(s=r,r=this.length),void 0!==s&&"string"!=typeof s)throw TypeError("encoding must be a string");if("string"==typeof s&&!o.isEncoding(s))throw TypeError("Unknown encoding: "+s);if(1===e.length){var n,i=e.charCodeAt(0);("utf8"===s&&i<128||"latin1"===s)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(n=t;n<r;++n)this[n]=e;else{var a=o.isBuffer(e)?e:o.from(e,s),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(n=0;n<r-t;++n)this[n+t]=a[n%l]}return this};var j=/[^+/0-9A-Za-z-_]/g;function k(e,t){t=t||1/0;for(var r,s=e.length,n=null,i=[],a=0;a<s;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!n){if(r>56319||a+1===s){(t-=3)>-1&&i.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),n=r;continue}r=(n-55296<<10|r-56320)+65536}else n&&(t-=3)>-1&&i.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return i}function S(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function C(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function E(e,t,r,s){for(var n=0;n<s&&!(n+r>=t.length)&&!(n>=e.length);++n)t[n+r]=e[n];return n}function I(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var T=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var s=16*r,n=0;n<16;++n)t[s+n]=e[r]+e[n];return t}()},783:function(e,t){t.read=function(e,t,r,s,n){var i,a,o=8*n-s-1,l=(1<<o)-1,c=l>>1,d=-7,u=r?n-1:0,h=r?-1:1,p=e[t+u];for(u+=h,i=p&(1<<-d)-1,p>>=-d,d+=o;d>0;i=256*i+e[t+u],u+=h,d-=8);for(a=i&(1<<-d)-1,i>>=-d,d+=s;d>0;a=256*a+e[t+u],u+=h,d-=8);if(0===i)i=1-c;else{if(i===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,s),i-=c}return(p?-1:1)*a*Math.pow(2,i-s)},t.write=function(e,t,r,s,n,i){var a,o,l,c=8*i-n-1,d=(1<<c)-1,u=d>>1,h=5960464477539062e-23*(23===n),p=s?0:i-1,f=s?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=d):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+u>=1?t+=h/l:t+=h*Math.pow(2,1-u),t*l>=2&&(a++,l/=2),a+u>=d?(o=0,a=d):a+u>=1?(o=(t*l-1)*Math.pow(2,n),a+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,n),a=0));n>=8;e[r+p]=255&o,p+=f,o/=256,n-=8);for(a=a<<n|o,c+=n;c>0;e[r+p]=255&a,p+=f,a/=256,c-=8);e[r+p-f]|=128*m}}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}},a=!0;try{s[e](r,r.exports,i),a=!1}finally{a&&delete n[e]}return r.exports}i.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=i(72)},74647,e=>{"use strict";let t,r,s;var n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,w=e.i(43476),_=e.i(932),N=e.i(71645),j=e.i(47167);let k=function(e){let t=[],r=0;for(let s=0;s<e.length;s++){let n=e.charCodeAt(s);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&s+1<e.length&&(64512&e.charCodeAt(s+1))==56320?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++s)),t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128)}return t},S=function(e){let t=[],r=0,s=0;for(;r<e.length;){let n=e[r++];if(n<128)t[s++]=String.fromCharCode(n);else if(n>191&&n<224){let i=e[r++];t[s++]=String.fromCharCode((31&n)<<6|63&i)}else if(n>239&&n<365){let i=((7&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[s++]=String.fromCharCode(55296+(i>>10)),t[s++]=String.fromCharCode(56320+(1023&i))}else{let i=e[r++],a=e[r++];t[s++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a)}}return t.join("")},C={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let t=0;t<e.length;t+=3){let n=e[t],i=t+1<e.length,a=i?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,c=n>>2,d=(3&n)<<4|a>>4,u=(15&a)<<2|l>>6,h=63&l;!o&&(h=64,i||(u=64)),s.push(r[c],r[d],r[u],r[h])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(k(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):S(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let t=0;t<e.length;){let n=r[e.charAt(t++)],i=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==n||null==i||null==a||null==o)throw new E;let l=n<<2|i>>4;if(s.push(l),64!==a){let e=i<<4&240|a>>2;if(s.push(e),64!==o){let e=a<<6&192|o;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class E extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let I=function(e){let t=k(e);return C.encodeByteArray(t,!0)},T=function(e){return I(e).replace(/\./g,"")},A=function(e){try{return C.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},M=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===j.default||void 0===j.default.env)return;let e=j.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&A(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},R=e=>M()?.emulatorHosts?.[e],P=()=>M()?.config,D=e=>M()?.[`_${e}`];class O{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function L(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function F(e){return(await fetch(e,{credentials:"include"})).ok}let U={},z=!1;function V(e,t){if("undefined"==typeof window||"undefined"==typeof document||!L(window.location.host)||U[e]===t||U[e]||z)return;function r(e){return`__firebase__banner__${e}`}U[e]=t;let s="__firebase__banner",n=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(U))U[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){let e,t,i=(e=document.getElementById(s),t=!1,e||((e=document.createElement("div")).setAttribute("id",s),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),c=document.getElementById(l)||document.createElement("a"),d=r("preprendIcon"),u=document.getElementById(d)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(i.created){let e,t=i.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",c.setAttribute("id",l),c.innerText="Learn more",c.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",c.setAttribute("target","__blank"),c.style.paddingLeft="5px",c.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;z=!0,(e=document.getElementById(s))&&e.remove()},e);u.setAttribute("width","24"),u.setAttribute("id",d),u.setAttribute("height","24"),u.setAttribute("viewBox","0 0 24 24"),u.setAttribute("fill","none"),u.style.marginLeft="-6px",t.append(u,o,c,r),document.body.appendChild(t)}n?(o.innerText="Preview backend disconnected.",u.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(u.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function $(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function q(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}class B extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,B.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,H.prototype.create)}}class H{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,s;let n=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,s=n,r.replace(G,(e,t)=>{let r=s[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new B(i,l,n)}}let G=/\{\$([^}]+)}/g;function W(e,t){if(e===t)return!0;let r=Object.keys(e),s=Object.keys(t);for(let n of r){if(!s.includes(n))return!1;let r=e[n],i=t[n];if(K(r)&&K(i)){if(!W(r,i))return!1}else if(r!==i)return!1}for(let e of s)if(!r.includes(e))return!1;return!0}function K(e){return null!==e&&"object"==typeof e}function X(e){let t=[];for(let[r,s]of Object.entries(e))Array.isArray(s)?s.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function Y(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,s]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(s)}}),t}function Q(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class J{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(s=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(s.next=Z),void 0===s.error&&(s.error=Z),void 0===s.complete&&(s.complete=Z);let n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch(e){}}),this.observers.push(s),n}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Z(){}function ee(e){return e&&e._delegate?e._delegate:e}class et{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let er="[DEFAULT]";class es{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new O;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:er})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=er){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=er){return this.instances.has(e)}getOptions(e=er){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(s);return s}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);let n=this.instances.get(r);return n&&e(n,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===er?void 0:r,options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=er){return this.component?this.component.multipleInstances?e:er:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class en{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new es(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let ei=[];(n=a||(a={}))[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT";let ea={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},eo=a.INFO,el={[a.DEBUG]:"log",[a.VERBOSE]:"log",[a.INFO]:"info",[a.WARN]:"warn",[a.ERROR]:"error"},ec=(e,t,...r)=>{if(t<e.logLevel)return;let s=new Date().toISOString(),n=el[t];if(n)console[n](`[${s}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ed{constructor(e){this.name=e,this._logLevel=eo,this._logHandler=ec,this._userLogHandler=null,ei.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in a))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ea[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,a.DEBUG,...e),this._logHandler(this,a.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,a.VERBOSE,...e),this._logHandler(this,a.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,a.INFO,...e),this._logHandler(this,a.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,a.WARN,...e),this._logHandler(this,a.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,a.ERROR,...e),this._logHandler(this,a.ERROR,...e)}}let eu=new WeakMap,eh=new WeakMap,ep=new WeakMap,ef=new WeakMap,em=new WeakMap,eg={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return eh.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ep.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ex(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ex(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let s=()=>{e.removeEventListener("success",n),e.removeEventListener("error",i)},n=()=>{t(ex(e.result)),s()},i=()=>{r(e.error),s()};e.addEventListener("success",n),e.addEventListener("error",i)})).then(t=>{t instanceof IDBCursor&&eu.set(t,e)}).catch(()=>{}),em.set(t,e),t}if(ef.has(e))return ef.get(e);let s=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eb(this),t),ex(eu.get(this))}:function(...t){return ex(e.apply(eb(this),t))}:function(t,...r){let s=e.call(eb(this),t,...r);return ep.set(s,t.sort?t.sort():[t]),ex(s)};return e instanceof IDBTransaction&&function(e){if(eh.has(e))return;let t=new Promise((t,r)=>{let s=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",i),e.removeEventListener("abort",i)},n=()=>{t(),s()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",n),e.addEventListener("error",i),e.addEventListener("abort",i)});eh.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eg):e}(e);return s!==e&&(ef.set(e,s),em.set(s,e)),s}let eb=e=>em.get(e),ey=["get","getKey","getAll","getAllKeys","count"],ev=["put","add","delete","clear"],ew=new Map;function e_(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(ew.get(t))return ew.get(t);let r=t.replace(/FromIndex$/,""),s=t!==r,n=ev.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(n||ey.includes(r)))return;let i=async function(e,...t){let i=this.transaction(e,n?"readwrite":"readonly"),a=i.store;return s&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),n&&i.done]))[0]};return ew.set(t,i),i}eg={...s=eg,get:(e,t,r)=>e_(e,t)||s.get(e,t,r),has:(e,t)=>!!e_(e,t)||s.has(e,t)};class eN{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let ej="@firebase/app",ek="0.14.6",eS=new ed("@firebase/app"),eC="[DEFAULT]",eE={[ej]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eI=new Map,eT=new Map,eA=new Map;function eM(e,t){try{e.container.addComponent(t)}catch(r){eS.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function eR(e,t){e.container.addOrOverwriteComponent(t)}function eP(e){let t=e.name;if(eA.has(t))return eS.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(eA.set(t,e),eI.values()))eM(r,e);for(let t of eT.values())eM(t,e);return!0}function eD(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eO(e,t,r=eC){eD(e,t).clearInstance(r)}function eL(e){return void 0!==e.options}function eF(e){return!eL(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function eU(e){return null!=e&&void 0!==e.settings}function ez(){eA.clear()}let eV=new H("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class e${constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new et("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eV.create("app-deleted",{appName:this._name})}}function eq(e,t){let r=A(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class eB extends e${constructor(e,t,r,s){const n=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,i={name:r,automaticDataCollectionEnabled:n};void 0!==e.apiKey?super(e,i,s):super(e.options,i,s),this._serverConfig={automaticDataCollectionEnabled:n,...t},this._serverConfig.authIdToken&&eq(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&eq(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,eQ(ej,ek,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){eY(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw eV.create("server-app-deleted")}}let eH="12.6.0";function eG(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let s={name:eC,automaticDataCollectionEnabled:!0,...t},n=s.name;if("string"!=typeof n||!n)throw eV.create("bad-app-name",{appName:String(n)});if(r||(r=P()),!r)throw eV.create("no-options");let i=eI.get(n);if(i)if(W(r,i.options)&&W(s,i.config))return i;else throw eV.create("duplicate-app",{appName:n});let a=new en(n);for(let e of eA.values())a.addComponent(e);let o=new e$(r,s,a);return eI.set(n,o),o}function eW(e,t={}){let r;if(("undefined"!=typeof window||q())&&!q())throw eV.create("invalid-server-app-environment");let s=t||{};if(e&&(eL(e)?r=e.options:eF(e)?s=e:r=e),void 0===s.automaticDataCollectionEnabled&&(s.automaticDataCollectionEnabled=!0),r||(r=P()),!r)throw eV.create("no-options");let n={...s,...r};if(void 0!==n.releaseOnDeref&&delete n.releaseOnDeref,void 0!==s.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw eV.create("finalization-registry-not-supported",{});let i=""+[...JSON.stringify(n)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=eT.get(i);if(a)return a.incRefCount(s.releaseOnDeref),a;let o=new en(i);for(let e of eA.values())o.addComponent(e);let l=new eB(r,s,i,o);return eT.set(i,l),l}function eK(e=eC){let t=eI.get(e);if(!t&&e===eC&&P())return eG();if(!t)throw eV.create("no-app",{appName:e});return t}function eX(){return Array.from(eI.values())}async function eY(e){let t=!1,r=e.name;eI.has(r)?(t=!0,eI.delete(r)):eT.has(r)&&0>=e.decRefCount()&&(eT.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function eQ(e,t,r){let s=eE[e]??e;r&&(s+=`-${r}`);let n=s.match(/\s|\//),i=t.match(/\s|\//);if(n||i){let e=[`Unable to register library "${s}" with version "${t}":`];n&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),n&&i&&e.push("and"),i&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eS.warn(e.join(" "));return}eP(new et(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}function eJ(e,t){if(null!==e&&"function"!=typeof e)throw eV.create("invalid-log-argument");for(let r of ei){let s=null;t&&t.level&&(s=ea[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...n)=>{let i=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(s??t.logLevel)&&e({level:a[r].toLowerCase(),message:i,args:n,type:t.name})}}}function eZ(e){ei.forEach(t=>{t.setLogLevel(e)})}let e0="firebase-heartbeat-store",e1=null;function e2(){return e1||(e1=(function(e,t,{blocked:r,upgrade:s,blocking:n,terminated:i}={}){let a=indexedDB.open(e,1),o=ex(a);return s&&a.addEventListener("upgradeneeded",e=>{s(ex(a.result),e.oldVersion,e.newVersion,ex(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(e0)}catch(e){console.warn(e)}}}).catch(e=>{throw eV.create("idb-open",{originalErrorMessage:e.message})})),e1}async function e5(e){try{let t=(await e2()).transaction(e0),r=await t.objectStore(e0).get(e3(e));return await t.done,r}catch(e){if(e instanceof B)eS.warn(e.message);else{let t=eV.create("idb-get",{originalErrorMessage:e?.message});eS.warn(t.message)}}}async function e4(e,t){try{let r=(await e2()).transaction(e0,"readwrite"),s=r.objectStore(e0);await s.put(t,e3(e)),await r.done}catch(e){if(e instanceof B)eS.warn(e.message);else{let t=eV.create("idb-set",{originalErrorMessage:e?.message});eS.warn(t.message)}}}function e3(e){return`${e.name}!${e.options.appId}`}class e6{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new e9(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=e8();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let s=1;s<e.length;s++)e[s].date<r&&(r=e[s].date,t=s);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eS.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=e8(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],s=e.slice();for(let n of e){let e=r.find(e=>e.agent===n.agent);if(e){if(e.dates.push(n.date),e7(r)>t){e.dates.pop();break}}else if(r.push({agent:n.agent,dates:[n.date]}),e7(r)>t){r.pop();break}s=s.slice(1)}return{heartbeatsToSend:r,unsentEntries:s}}(this._heartbeatsCache.heartbeats),s=T(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return eS.warn(e),""}}}function e8(){return new Date().toISOString().substring(0,10)}class e9{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let r=!0,s="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(s);n.onsuccess=()=>{n.result.close(),r||self.indexedDB.deleteDatabase(s),e(!0)},n.onupgradeneeded=()=>{r=!1},n.onerror=()=>{t(n.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await e5(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return e4(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return e4(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function e7(e){return T(JSON.stringify({version:2,heartbeats:e})).length}eP(new et("platform-logger",e=>new eN(e),"PRIVATE")),eP(new et("heartbeat",e=>new e6(e),"PRIVATE")),eQ(ej,ek,""),eQ(ej,ek,"esm2020"),eQ("fire-js",""),e.s(["SDK_VERSION",()=>eH,"_DEFAULT_ENTRY_NAME",()=>eC,"_addComponent",()=>eM,"_addOrOverwriteComponent",()=>eR,"_apps",()=>eI,"_clearComponents",()=>ez,"_components",()=>eA,"_getProvider",()=>eD,"_isFirebaseApp",()=>eL,"_isFirebaseServerApp",()=>eU,"_isFirebaseServerAppSettings",()=>eF,"_registerComponent",()=>eP,"_removeServiceInstance",()=>eO,"_serverApps",()=>eT,"deleteApp",()=>eY,"getApp",()=>eK,"getApps",()=>eX,"initializeApp",()=>eG,"initializeServerApp",()=>eW,"onLog",()=>eJ,"registerVersion",()=>eQ,"setLogLevel",()=>eZ],92953),eQ("firebase","12.7.0","app"),e.i(92953);var te=e.i(67034),tt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,tr={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function s(e,t,r){r||(r=0);let s=Array(16);if("string"==typeof t)for(var n=0;n<16;++n)s[n]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(n=0;n<16;++n)s[n]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],n=e.g[2];let i=e.g[3],a;a=t+(i^r&(n^i))+s[0]+0xd76aa478|0,a=i+(n^(t=r+(a<<7|a>>>25))&(r^n))+s[1]+0xe8c7b756|0,a=n+(r^(i=t+(a<<12|a>>>20))&(t^r))+s[2]+0x242070db|0,a=r+(t^(n=i+(a<<17|a>>>15))&(i^t))+s[3]+0xc1bdceee|0,a=t+(i^(r=n+(a<<22|a>>>10))&(n^i))+s[4]+0xf57c0faf|0,a=i+(n^(t=r+(a<<7|a>>>25))&(r^n))+s[5]+0x4787c62a|0,a=n+(r^(i=t+(a<<12|a>>>20))&(t^r))+s[6]+0xa8304613|0,a=r+(t^(n=i+(a<<17|a>>>15))&(i^t))+s[7]+0xfd469501|0,a=t+(i^(r=n+(a<<22|a>>>10))&(n^i))+s[8]+0x698098d8|0,a=i+(n^(t=r+(a<<7|a>>>25))&(r^n))+s[9]+0x8b44f7af|0,a=n+(r^(i=t+(a<<12|a>>>20))&(t^r))+s[10]+0xffff5bb1|0,a=r+(t^(n=i+(a<<17|a>>>15))&(i^t))+s[11]+0x895cd7be|0,a=t+(i^(r=n+(a<<22|a>>>10))&(n^i))+s[12]+0x6b901122|0,a=i+(n^(t=r+(a<<7|a>>>25))&(r^n))+s[13]+0xfd987193|0,a=n+(r^(i=t+(a<<12|a>>>20))&(t^r))+s[14]+0xa679438e|0,a=r+(t^(n=i+(a<<17|a>>>15))&(i^t))+s[15]+0x49b40821|0,r=n+(a<<22|a>>>10),a=t+(n^i&(r^n))+s[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=i+(r^n&(t^r))+s[6]+0xc040b340|0,i=t+(a<<9|a>>>23),a=n+(t^r&(i^t))+s[11]+0x265e5a51|0,n=i+(a<<14|a>>>18),a=r+(i^t&(n^i))+s[0]+0xe9b6c7aa|0,r=n+(a<<20|a>>>12),a=t+(n^i&(r^n))+s[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=i+(r^n&(t^r))+s[10]+0x2441453|0,i=t+(a<<9|a>>>23),a=n+(t^r&(i^t))+s[15]+0xd8a1e681|0,n=i+(a<<14|a>>>18),a=r+(i^t&(n^i))+s[4]+0xe7d3fbc8|0,r=n+(a<<20|a>>>12),a=t+(n^i&(r^n))+s[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=i+(r^n&(t^r))+s[14]+0xc33707d6|0,i=t+(a<<9|a>>>23),a=n+(t^r&(i^t))+s[3]+0xf4d50d87|0,n=i+(a<<14|a>>>18),a=r+(i^t&(n^i))+s[8]+0x455a14ed|0,r=n+(a<<20|a>>>12),a=t+(n^i&(r^n))+s[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=i+(r^n&(t^r))+s[2]+0xfcefa3f8|0,i=t+(a<<9|a>>>23),a=n+(t^r&(i^t))+s[7]+0x676f02d9|0,n=i+(a<<14|a>>>18),a=r+(i^t&(n^i))+s[12]+0x8d2a4c8a|0,a=t+((r=n+(a<<20|a>>>12))^n^i)+s[5]+0xfffa3942|0,a=i+((t=r+(a<<4|a>>>28))^r^n)+s[8]+0x8771f681|0,a=n+((i=t+(a<<11|a>>>21))^t^r)+s[11]+0x6d9d6122|0,a=r+((n=i+(a<<16|a>>>16))^i^t)+s[14]+0xfde5380c|0,a=t+((r=n+(a<<23|a>>>9))^n^i)+s[1]+0xa4beea44|0,a=i+((t=r+(a<<4|a>>>28))^r^n)+s[4]+0x4bdecfa9|0,a=n+((i=t+(a<<11|a>>>21))^t^r)+s[7]+0xf6bb4b60|0,a=r+((n=i+(a<<16|a>>>16))^i^t)+s[10]+0xbebfbc70|0,a=t+((r=n+(a<<23|a>>>9))^n^i)+s[13]+0x289b7ec6|0,a=i+((t=r+(a<<4|a>>>28))^r^n)+s[0]+0xeaa127fa|0,a=n+((i=t+(a<<11|a>>>21))^t^r)+s[3]+0xd4ef3085|0,a=r+((n=i+(a<<16|a>>>16))^i^t)+s[6]+0x4881d05|0,a=t+((r=n+(a<<23|a>>>9))^n^i)+s[9]+0xd9d4d039|0,a=i+((t=r+(a<<4|a>>>28))^r^n)+s[12]+0xe6db99e5|0,a=n+((i=t+(a<<11|a>>>21))^t^r)+s[15]+0x1fa27cf8|0,a=r+((n=i+(a<<16|a>>>16))^i^t)+s[2]+0xc4ac5665|0,r=n+(a<<23|a>>>9),a=t+(n^(r|~i))+s[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~n))+s[7]+0x432aff97|0,i=t+(a<<10|a>>>22),a=n+(t^(i|~r))+s[14]+0xab9423a7|0,n=i+(a<<15|a>>>17),a=r+(i^(n|~t))+s[5]+0xfc93a039|0,r=n+(a<<21|a>>>11),a=t+(n^(r|~i))+s[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~n))+s[3]+0x8f0ccc92|0,i=t+(a<<10|a>>>22),a=n+(t^(i|~r))+s[10]+0xffeff47d|0,n=i+(a<<15|a>>>17),a=r+(i^(n|~t))+s[1]+0x85845dd1|0,r=n+(a<<21|a>>>11),a=t+(n^(r|~i))+s[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~n))+s[15]+0xfe2ce6e0|0,i=t+(a<<10|a>>>22),a=n+(t^(i|~r))+s[6]+0xa3014314|0,n=i+(a<<15|a>>>17),a=r+(i^(n|~t))+s[13]+0x4e0811a1|0,r=n+(a<<21|a>>>11),a=t+(n^(r|~i))+s[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~n))+s[11]+0xbd3af235|0,i=t+(a<<10|a>>>22),a=n+(t^(i|~r))+s[2]+0x2ad7d2bb|0,n=i+(a<<15|a>>>17),a=r+(i^(n|~t))+s[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(n+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+n|0,e.g[3]=e.g[3]+i|0}function n(e,t){this.h=t;let r=[],s=!0;for(let n=e.length-1;n>=0;n--){let i=0|e[n];s&&i==t||(r[n]=i,s=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,s){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[r].apply(e,n)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,n=this.C,i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=r;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(n[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,n),i=0;break}}else for(;a<t;)if(n[i++]=e[a++],i==this.blockSize){s(this,n),i=0;break}}this.h=i,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let s=0;s<32;s+=8)e[t++]=this.g[r]>>>s&255;return e};var i,a={};function c(e){var t;return -128<=e&&e<128?(t=function(e){return new n([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new n([0|e],e<0?-1:0)}function d(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return g(d(-e));let t=[],r=1;for(let s=0;e>=r;s++)t[s]=e/r|0,r*=0x100000000;return new n(t,0)}var u=c(0),h=c(1),p=c(0x1000000);function f(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){let t=e.g.length,r=[];for(let s=0;s<t;s++)r[s]=~e.g[s];return new n(r,~e.h).add(h)}function x(e,t){return e.add(g(t))}function b(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function v(e,t){if(f(t))throw Error("division by zero");if(f(e))return new y(u,u);if(m(e))return t=v(g(e),t),new y(g(t.g),g(t.h));if(m(t))return t=v(e,g(t)),new y(g(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=h,s=t;0>=s.l(e);)r=w(r),s=w(s);var n=_(r,1),i=_(s,1);for(s=_(s,2),r=_(r,2);!f(s);){var a=i.add(s);0>=a.l(e)&&(n=n.add(r),i=a),s=_(s,1),r=_(r,1)}return t=x(e,n.j(t)),new y(n,t)}for(n=u;e.l(t)>=0;){for(s=(s=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,s-48),a=(i=d(r)).j(t);m(a)||a.l(e)>0;)r-=s,a=(i=d(r)).j(t);f(i)&&(i=h),n=n.add(i),e=x(e,a)}return new y(n,e)}function w(e){let t=e.g.length+1,r=[];for(let s=0;s<t;s++)r[s]=e.i(s)<<1|e.i(s-1)>>>31;return new n(r,e.h)}function _(e,t){let r=t>>5;t%=32;let s=e.g.length-r,i=[];for(let n=0;n<s;n++)i[n]=t>0?e.i(n+r)>>>t|e.i(n+r+1)<<32-t:e.i(n+r);return new n(i,e.h)}(i=n.prototype).m=function(){if(m(this))return-g(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let s=this.i(r);e+=(s>=0?s:0x100000000+s)*t,t*=0x100000000}return e},i.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(m(this))return"-"+g(this).toString(e);let t=d(Math.pow(e,6));var r=this;let s="";for(;;){let n=v(r,t).g,i=(((r=x(r,n.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(f(r=n))return i+s;for(;i.length<6;)i="0"+i;s=i+s}},i.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return m(e=x(this,e))?-1:+!f(e)},i.abs=function(){return m(this)?g(this):this},i.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],s=0;for(let n=0;n<=t;n++){let t=s+(65535&this.i(n))+(65535&e.i(n)),i=(t>>>16)+(this.i(n)>>>16)+(e.i(n)>>>16);s=i>>>16,t&=65535,i&=65535,r[n]=i<<16|t}return new n(r,-0x80000000&r[r.length-1]?-1:0)},i.j=function(e){if(f(this)||f(e))return u;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(p)&&0>e.l(p))return d(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var s=0;s<2*t;s++)r[s]=0;for(s=0;s<this.g.length;s++)for(let t=0;t<e.g.length;t++){let n=this.i(s)>>>16,i=65535&this.i(s),a=e.i(t)>>>16,o=65535&e.i(t);r[2*s+2*t]+=i*o,b(r,2*s+2*t),r[2*s+2*t+1]+=n*o,b(r,2*s+2*t+1),r[2*s+2*t+1]+=i*a,b(r,2*s+2*t+1),r[2*s+2*t+2]+=n*a,b(r,2*s+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new n(r,0)},i.B=function(e){return v(this,e).h},i.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let s=0;s<t;s++)r[s]=this.i(s)&e.i(s);return new n(r,this.h&e.h)},i.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let s=0;s<t;s++)r[s]=this.i(s)|e.i(s);return new n(r,this.h|e.h)},i.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let s=0;s<t;s++)r[s]=this.i(s)^e.i(s);return new n(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,l=tr.Md5=e,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.B,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=d,n.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let s=d(Math.pow(r,8)),n=u;for(let e=0;e<t.length;e+=8){var i=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+i),r);i<8?(i=d(Math.pow(r,i)),n=n.j(i).add(d(a))):n=(n=n.j(s)).add(d(a))}return n},o=tr.Integer=n}).apply(void 0!==tt?tt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ts="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,tn={};(function(){var e,t,r=Object.defineProperty,s=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof ts&&ts];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function n(e,t){if(t)e:{var n=s;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in n))break e;n=n[a]}(t=t(i=n[e=e[e.length-1]]))!=i&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}n("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),n("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),n("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var i=i||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,r){return e.call.apply(e.bind,arguments)}function x(e,t,r){return(x=l).apply(null,arguments)}function b(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function y(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,s){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[r].apply(e,n)}}var v="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function w(e){let t=e.length;if(t>0){let r=Array(t);for(let s=0;s<t;s++)r[s]=e[s];return r}return[]}function _(e,t){for(let t=1;t<arguments.length;t++){let s=arguments[t];var r=typeof s;if("array"==(r="object"!=r?r:s?Array.isArray(s)?"array":r:"null")||"object"==r&&"number"==typeof s.length){r=e.length||0;let t=s.length||0;e.length=r+t;for(let n=0;n<t;n++)e[r+n]=s[n]}else e.push(s)}}var N=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new j,e=>e.reset());class j{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let k,S=!1,C=new class{constructor(){this.h=this.g=null}add(e,t){let r=N.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},E=()=>{let e=Promise.resolve(void 0);k=()=>{e.then(I)}};function I(){let e;for(var t;e=null,C.g&&(e=C.g,C.g=C.g.next,C.g||(C.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}N.j(t),N.h<100&&(N.h++,t.next=N.g,N.g=t)}S=!1}function T(){this.u=this.u,this.C=this.C}function A(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},A.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function R(e){return/^[\s\xa0]*$/.test(e)}function P(e,t){A.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}y(P,A),P.prototype.init=function(e,t){let r=this.type=e.type,s=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&P.Z.h.call(this)},P.prototype.h=function(){P.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var D="closure_listenable_"+(1e6*Math.random()|0),O=0;function L(e,t,r,s,n){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!s,this.ha=n,this.key=++O,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function U(e,t,r){for(let s in e)t.call(r,e[s],s,e)}function z(e){let t={};for(let r in e)t[r]=e[r];return t}let V="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(e,t){let r,s;for(let t=1;t<arguments.length;t++){for(r in s=arguments[t])e[r]=s[r];for(let t=0;t<V.length;t++)r=V[t],Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}}function q(e){this.src=e,this.g={},this.h=0}function B(e,t){let r=t.type;if(r in e.g){var s,n=e.g[r],i=Array.prototype.indexOf.call(n,t,void 0);(s=i>=0)&&Array.prototype.splice.call(n,i,1),s&&(F(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function H(e,t,r,s){for(let n=0;n<e.length;++n){let i=e[n];if(!i.da&&i.listener==t&&!!r==i.capture&&i.ha==s)return n}return -1}q.prototype.add=function(e,t,r,s,n){let i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);let a=H(e,t,s,n);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new L(t,this.src,i,!!s,n)).fa=r,e.push(t)),t};var G="closure_lm_"+(1e6*Math.random()|0),W={};function K(e,t,r,s,n,i){if(!t)throw Error("Invalid event type");let a=o(n)?!!n.capture:!!n,l=J(e);if(l||(e[G]=l=new q(e)),(r=l.add(t,r,s,a,i)).proxy)return r;if(s=function e(t){return Q.call(e.src,e.listener,t)},r.proxy=s,s.src=e,s.listener=r,e.addEventListener)M||(n=a),void 0===n&&(n=!1),e.addEventListener(t.toString(),s,n);else if(e.attachEvent)e.attachEvent(Y(t.toString()),s);else if(e.addListener&&e.removeListener)e.addListener(s);else throw Error("addEventListener and attachEvent are unavailable.");return r}function X(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[D])B(t.i,e);else{var r=e.type,s=e.proxy;t.removeEventListener?t.removeEventListener(r,s,e.capture):t.detachEvent?t.detachEvent(Y(r),s):t.addListener&&t.removeListener&&t.removeListener(s),(r=J(t))?(B(r,e),0==r.h&&(r.src=null,t[G]=null)):F(e)}}}function Y(e){return e in W?W[e]:W[e]="on"+e}function Q(e,t){if(e.da)e=!0;else{t=new P(t,this);let r=e.listener,s=e.ha||e.src;e.fa&&X(e),e=r.call(s,t)}return e}function J(e){return(e=e[G])instanceof q?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){T.call(this),this.i=new q(this),this.M=this,this.G=null}function er(e,t){let r,s;var n,i=e.G;if(i)for(n=[];i;i=i.G)n.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new A(t,e);else if(t instanceof A)t.target=t.target||e;else{var a=t;$(t=new A(i,e),a)}if(a=!0,n)for(s=n.length-1;s>=0;s--)a=es(r=t.g=n[s],i,!0,t)&&a;if(a=es(r=t.g=e,i,!0,t)&&a,a=es(r,i,!1,t)&&a,n)for(s=0;s<n.length;s++)a=es(r=t.g=n[s],i,!1,t)&&a}function es(e,t,r,s){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let n=!0;for(let i=0;i<t.length;++i){let a=t[i];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&B(e.i,a),n=!1!==t.call(r,s)&&n}}return n&&!s.defaultPrevented}y(et,T),et.prototype[D]=!0,et.prototype.removeEventListener=function(e,t,r,s){!function e(t,r,s,n,i){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],s,n,i);else(n=o(n)?!!n.capture:!!n,s=ee(s),t&&t[D])?(t=t.i,(a=String(r).toString())in t.g&&(s=H(r=t.g[a],s,n,i))>-1&&(F(r[s]),Array.prototype.splice.call(r,s,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=J(t))&&(r=t.g[r.toString()],t=-1,r&&(t=H(r,s,n,i)),(s=t>-1?r[t]:null)&&X(s))}(this,e,t,r,s)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)F(r[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,r,s){return this.i.add(String(e),t,!1,r,s)},et.prototype.K=function(e,t,r,s){return this.i.add(String(e),t,!0,r,s)};class en extends T{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=x(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ei(e){T.call(this),this.h=e,this.g={}}y(ei,T);var ea=[];function eo(e){U(e.g,function(e,t){this.g.hasOwnProperty(t)&&X(e)},e),e.g={}}ei.prototype.N=function(){ei.Z.N.call(this),eo(this)},ei.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,ec=a.JSON.parse,ed=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function eu(){}function eh(){}var ep={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ef(){A.call(this,"d")}function em(){A.call(this,"c")}y(ef,A),y(em,A);var eg={},ex=null;function eb(){return ex=ex||new et}function ey(e){A.call(this,eg.Ia,e)}function ev(e){let t=eb();er(t,new ey(t))}function ew(e,t){A.call(this,eg.STAT_EVENT,e),this.stat=t}function e_(e){let t=eb();er(t,new ew(t,e))}function eN(e,t){A.call(this,eg.Ja,e),this.size=t}function ej(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function ek(){this.g=!0}function eS(e,t,r,s){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let i=JSON.parse(t);if(i){for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var r=i[e];if(!(r.length<2)){var s=r[1];if(Array.isArray(s)&&!(s.length<1)){var n=s[0];if("noop"!=n&&"stop"!=n&&"close"!=n)for(let e=1;e<s.length;e++)s[e]=""}}}}return el(i)}catch(e){return t}}(e,r)+(s?" "+s:"")})}eg.Ia="serverreachability",y(ey,A),eg.STAT_EVENT="statevent",y(ew,A),eg.Ja="timingevent",y(eN,A),ek.prototype.ua=function(){this.g=!1},ek.prototype.info=function(){};var eC={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eE={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eI(){}function eT(e){return encodeURIComponent(String(e))}function eA(e,t,r,s){this.j=e,this.i=t,this.l=r,this.S=s||1,this.V=new ei(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eM}function eM(){this.i=null,this.g="",this.h=!1}y(eI,eu),eI.prototype.g=function(){return new XMLHttpRequest},e=new eI;var eR={},eP={};function eD(e,t,r){e.M=1,e.A=e3(e0(t)),e.u=r,e.R=!0,eO(e,null)}function eO(e,t){e.F=Date.now(),eF(e),e.B=e0(e.A);var r,s,n,i,a,l,c=e.B,d=e.S;Array.isArray(d)||(d=[String(d)]),tu(c.i,"t",d),e.C=0,c=e.j.L,e.h=new eM,e.g=tQ(e.j,c?t:null,!e.u),e.P>0&&(e.O=new en(x(e.Y,e,e.g),e.P)),t=e.V,c=e.g,d=e.ba;var u="readystatechange";Array.isArray(u)||(u&&(ea[0]=u.toString()),u=ea);for(let e=0;e<u.length;e++){let r=function e(t,r,s,n,i){if(n&&n.once)return function e(t,r,s,n,i){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],s,n,i);return null}return s=ee(s),t&&t[D]?t.K(r,s,o(n)?!!n.capture:!!n,i):K(t,r,s,!0,n,i)}(t,r,s,n,i);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],s,n,i);return null}return s=ee(s),t&&t[D]?t.J(r,s,o(n)?!!n.capture:!!n,i):K(t,r,s,!1,n,i)}(c,u[e],d||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?z(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ev(),r=e.i,s=e.v,n=e.B,i=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+i+") [attempt "+a+"]: "+s+"\n"+n+"\n"+e})}function eL(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eF(e){e.T=Date.now()+e.H,eU(e,e.H)}function eU(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=ej(x(e.aa,e),t)}function ez(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function eV(e){0==e.j.I||e.K||tG(e.j,e)}function e$(e){ez(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eq(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eK(r.h,e))){if(!e.L&&eK(r.h,e)&&3==r.I){try{var s=r.Ba.g.parse(t)}catch(e){s=null}if(Array.isArray(s)&&3==s.length){var n=s;if(0==n[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tH(r),tD(r);else break e;t$(r),e_(18)}}else r.xa=n[1],0<r.xa-r.K&&n[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=ej(x(r.Va,r),6e3));1>=eW(r.h)&&r.ta&&(r.ta=void 0)}else tK(r,11)}else if((e.L||r.g==e)&&tH(r),!R(t))for(n=r.Ba.g.parse(t),t=0;t<n.length;t++){let o=n[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let n=o[4];null!=n&&(r.za=n,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=s=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+s)),s=r;let c=e.g;if(c){let e=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=s.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(eX(i,i.h),i.h=null))}if(s.G){let e=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(s.wa=e,e4(s.J,s.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(s=r).na=tY(s,s.L?s.ba:null,s.W),e.L){eY(s.h,e);var a=s.O;a&&(e.H=a),e.D&&(ez(e),eF(e)),s.g=e}else tV(s);r.i.length>0&&tL(r)}else"stop"!=o[0]&&"close"!=o[0]||tK(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tK(r,7):tP(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}ev(4)}catch(e){}}eA.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tT(e)?t.j():this.Y(e)},eA.prototype.Y=function(e){try{if(e==this.g)e:{let p=tT(this.g),f=this.g.ya(),m=this.g.ca();if(!(p<3)&&(3!=p||this.g&&(this.h.h||this.g.la()||tA(this.g)))){this.K||4!=p||7==f||(8==f||m<=0?ev(3):ev(2)),ez(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eL(e))return e.g.la();let t=tA(e.g);if(""===t)return"";let r="",s=t.length,n=4==tT(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return e$(e),eV(e),"";e.h.i=new a.TextDecoder}for(let i=0;i<s;i++)e.h.h=!0,r+=e.h.i.decode(t[i],{stream:!(n&&i==s-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,s=this.i,n=this.v,i=this.B,o=this.l,l=this.S,s.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+n+"\n"+i+"\n"+p+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var s,n,i,o,l,c,d=this.g;if((c=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!R(c)){var u=c;break t}}u=null}if(e=u)eS(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eq(this,e);else{this.o=!1,this.m=3,e_(12),e$(this),eV(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,s=t.indexOf("\n",r);return -1==s?eP:isNaN(r=Number(t.substring(r,s)))?eR:(s+=1)+r>t.length?eP:(t=t.slice(s,s+r),e.C=s+r,t)}(this,r))==eP){4==p&&(this.m=4,e_(14),e=!1),eS(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eR){this.m=4,e_(15),eS(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else eS(this.i,this.l,t,null),eq(this,t);if(eL(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=p||0!=r.length||this.h.h||(this.m=1,e_(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.aa&&!h.P&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tq(h),h.P=!0,e_(11))}}else eS(this.i,this.l,r,"[Invalid Chunked Response]"),e$(this),eV(this)}else eS(this.i,this.l,r,null),eq(this,r);4==p&&e$(this),this.o&&!this.K&&(4==p?tG(this.j,this):(this.o=!1,eF(this)))}else(function(e){let t={};e=(e.g&&tT(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<e.length;s++){if(R(e[s]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[s]);let n=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let i=t[n]||[];t[n]=i,i.push(r)}var s=function(e){return e.join(", ")};for(let e in t)s.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,e_(12)):(this.m=0,e_(13)),e$(this),eV(this)}}}catch(e){}finally{}},eA.prototype.cancel=function(){this.K=!0,e$(this)},eA.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(ev(),e_(17)),e$(this),this.m=2,eV(this)):eU(this,this.T-r)};var eB=class{constructor(e,t){this.g=e,this.map=t}};function eH(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eG(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eW(e){return e.h?1:e.g?e.g.size:0}function eK(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eX(e,t){e.g?e.g.add(t):e.h=t}function eY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eQ(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return w(e.i)}eH.prototype.cancel=function(){if(this.i=eQ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eJ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e5(this,th(e.i)),this.m=e.m):e&&(t=String(e).match(eJ))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e6(t[2]||""),this.g=e6(t[3]||"",!0),e2(this,t[4]),this.h=e6(t[5]||"",!0),e5(this,t[6]||"",!0),this.m=e6(t[7]||"")):(this.l=!1,this.i=new ta(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,r){e.j=r?e6(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e5(e,t,r){var s,n;t instanceof ta?(e.i=t,s=e.i,(n=e.l)&&!s.j&&(to(s),s.i=null,s.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(tl(this,t),tu(this,r,e))},s)),s.j=n):(r||(t=e8(t,tr)),e.i=new ta(t,e.l))}function e4(e,t,r){e.i.set(t,r)}function e3(e){return e4(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e6(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,e9),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e9(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e7,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e7,!0),"@"),e.push(eT(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e8(r,"/"==r.charAt(0)?tt:te,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e8(r,ti)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),r=!!e.j;r?e1(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var s=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=s.charAt(0))if(this.g&&!this.h)s="/"+s;else{var n=t.h.lastIndexOf("/");-1!=n&&(s=t.h.slice(0,n+1)+s)}if(".."==(n=s)||"."==n)s="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){s=0==n.lastIndexOf("/",0),n=n.split("/");let e=[];for(let t=0;t<n.length;){let r=n[t++];"."==r?s&&t==n.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),s&&t==n.length&&e.push("")):(e.push(r),s=!0)}s=e.join("/")}else s=n}return r?t.h=s:r=""!==e.i.toString(),r?e5(t,th(e.i)):r=!!e.m,r&&(t.m=e.m),t};var e7=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tr=/[#\?@]/g,ti=/#/g;function ta(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function to(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let s=e[r].indexOf("="),n,i=null;s>=0?(n=e[r].substring(0,s),i=e[r].substring(s+1)):n=e[r],t(n,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function tl(e,t){to(e),t=tp(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tc(e,t){return to(e),t=tp(e,t),e.g.has(t)}function td(e,t){to(e);let r=[];if("string"==typeof t)tc(e,t)&&(r=r.concat(e.g.get(tp(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tu(e,t,r){tl(e,t),r.length>0&&(e.i=null,e.g.set(tp(e,t),w(r)),e.h+=r.length)}function th(e){let t=new ta;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tp(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tf(e,t,r,s,n){try{n&&(n.onload=null,n.onerror=null,n.onabort=null,n.ontimeout=null),s(r)}catch(e){}}function tm(){this.g=new ed}function tg(e){this.i=e.Sb||null,this.h=e.ab||!1}function tx(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tb(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tv(e)}function tv(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tw(e){let t="";return U(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function t_(e,t,r){e:{for(s in r){var s=!1;break e}s=!0}s||(r=tw(r),"string"==typeof e?null!=r&&eT(r):e4(e,t,r))}function tN(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ta.prototype).add=function(e,t){to(this),this.i=null,e=tp(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){to(this),this.g.forEach(function(r,s){r.forEach(function(r){e.call(t,r,s,this)},this)},this)},t.set=function(e,t){return to(this),this.i=null,tc(this,e=tp(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=td(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let s=0;s<t.length;s++){var r=t[s];let n=eT(r);r=td(this,r);for(let t=0;t<r.length;t++){let s=n;""!==r[t]&&(s+="="+eT(r[t])),e.push(s)}}return this.i=e.join("&")},y(tg,eu),tg.prototype.g=function(){return new tx(this.i,this.h)},y(tx,et),(t=tx.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tv(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tv(this)),this.g&&(this.readyState=3,tv(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tb(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):tv(this),3==this.readyState&&tb(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tx.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),y(tN,et);var tj=/^https?$/i,tk=["POST","PUT"];function tS(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tC(e),tI(e)}function tC(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function tE(e){if(e.h&&void 0!==i){if(e.v&&4==tT(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tT(e)){e.h=!1;try{let i=e.ca();switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,s=!0;break;default:s=!1}if(!(t=s)){if(r=0===i){let t=String(e.D).match(eJ)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!tj.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var n=tT(e)>2?e.g.statusText:""}catch(e){n=""}e.l=n+" ["+e.ca()+"]",tC(e)}}finally{tI(e)}}}}function tI(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tT(e){return e.g?e.g.readyState:0}function tA(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tM(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tR(e){this.za=0,this.i=[],this.j=new ek,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tM("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tM("baseRetryDelayMs",5e3,e),this.Za=tM("retryDelaySeedMs",1e4,e),this.Ta=tM("forwardChannelMaxRetries",2,e),this.va=tM("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eH(e&&e.concurrentRequestLimit),this.Ba=new tm,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tP(e){if(tO(e),3==e.I){var t=e.V++,r=e0(e.J);if(e4(r,"SID",e.M),e4(r,"RID",t),e4(r,"TYPE","terminate"),tU(e,r),(t=new eA(e,e.j,t)).M=2,t.A=e3(e0(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tQ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eF(t)}tX(e)}function tD(e){e.g&&(tq(e),e.g.cancel(),e.g=null)}function tO(e){tD(e),e.v&&(a.clearTimeout(e.v),e.v=null),tH(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tL(e){if(!eG(e.h)&&!e.m){e.m=!0;var t=e.Ea;k||E(),S||(k(),S=!0),C.add(t,e),e.D=0}}function tF(e,t){var r;r=t?t.l:e.V++;let s=e0(e.J);e4(s,"SID",e.M),e4(s,"RID",r),e4(s,"AID",e.K),tU(e,s),e.u&&e.o&&t_(s,e.u,e.o),r=new eA(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tz(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eX(e.h,r),eD(r,s,t)}function tU(e,t){e.H&&U(e.H,function(e,r){e4(t,r,e)}),e.l&&U({},function(e,r){e4(t,r,e)})}function tz(e,t,r){r=Math.min(e.i.length,r);let s=e.l?x(e.l.Ka,e.l,e):null;e:{var n=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=n[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let c=0;c<r;c++){var i=n[c].g;let r=n[c].map;if((i-=t)<0)t=Math.max(0,n[c].g-100),l=!1;else try{i="req"+i+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let s=r;o(r)&&(s=el(r)),e.push(i+t+"="+encodeURIComponent(s))}}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}catch(e){s&&s(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tV(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;k||E(),S||(k(),S=!0),C.add(t,e),e.A=0}}function t$(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=ej(x(e.Da,e),tW(e,e.A)),e.A++,!0)}function tq(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function tB(e){e.g=new eA(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e4(t,"RID","rpc"),e4(t,"SID",e.M),e4(t,"AID",e.K),e4(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e4(t,"TO",e.ia),e4(t,"TYPE","xmlhttp"),tU(e,t),e.u&&e.o&&t_(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e3(e0(t)),r.u=null,r.R=!0,eO(r,e)}function tH(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tG(e,t){var r,s=null;if(e.g==t){tH(e),tq(e),e.g=null;var n=2}else{if(!eK(e.h,t))return;s=t.G,eY(e.h,t),n=1}if(0!=e.I){if(t.o)if(1==n){s=t.u?t.u.length:0,t=Date.now()-t.F;var i=e.D;er(n=eb(),new eN(n,s)),tL(e)}else tV(e);else if(3==(i=t.m)||0==i&&t.X>0||!(1==n&&(r=t,!(eW(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=ej(x(e.Ea,e,r),tW(e,e.D)),e.D++,!0)))||2==n&&t$(e)))switch(s&&s.length>0&&((t=e.h).i=t.i.concat(s)),i){case 1:tK(e,5);break;case 4:tK(e,10);break;case 3:tK(e,6);break;default:tK(e,2)}}}function tW(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tK(e,t){if(e.j.info("Error code "+t),2==t){let t,i,o;var r,s=x(e.bb,e),n=e.Ua;let l=!n;n=new eZ(n||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(n,"https"),e3(n),l?function(e,t){let r=new ek;if(a.Image){let s=new Image;s.onload=b(tf,r,"TestLoadImage: loaded",!0,t,s),s.onerror=b(tf,r,"TestLoadImage: error",!1,t,s),s.onabort=b(tf,r,"TestLoadImage: abort",!1,t,s),s.ontimeout=b(tf,r,"TestLoadImage: timeout",!1,t,s),a.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=e}else t(!1)}(n.toString(),s):(r=n.toString(),t=new ek,i=new AbortController,o=setTimeout(()=>{i.abort(),tf(t,"TestPingServer: timeout",!1,s)},1e4),fetch(r,{signal:i.signal}).then(e=>{clearTimeout(o),e.ok?tf(t,"TestPingServer: ok",!0,s):tf(t,"TestPingServer: server error",!1,s)}).catch(()=>{clearTimeout(o),tf(t,"TestPingServer: error",!1,s)}))}else e_(2);e.I=0,e.l&&e.l.pa(t),tX(e),tO(e)}function tX(e){if(e.I=0,e.ja=[],e.l){let t=eQ(e.h);(0!=t.length||0!=e.i.length)&&(_(e.ja,t),_(e.ja,e.i),e.h.i.length=0,w(e.i),e.i.length=0),e.l.oa()}}function tY(e,t,r){var s=r instanceof eZ?e0(r):new eZ(r);if(""!=s.g)t&&(s.g=t+"."+s.g),e2(s,s.u);else{var n=a.location;s=n.protocol,t=t?t+"."+n.hostname:n.hostname,n=+n.port;let e=new eZ(null);s&&e1(e,s),t&&(e.g=t),n&&e2(e,n),r&&(e.h=r),s=e}return r=e.G,t=e.wa,r&&t&&e4(s,r,t),e4(s,"VER",e.ka),tU(e,s),s}function tQ(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tN(e.Aa&&!e.ma?new tg({ab:r}):e.ma)).Fa(e.L),t}function tJ(){}function tZ(){}function t0(e,t){et.call(this),this.g=new tR(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!R(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!R(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t5(this)}function t1(e){ef.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){em.call(this),this.status=1}function t5(e){this.g=e}(t=tN.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,s,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=v(x(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tS(this,e);return}if(t=s||"",s=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var i in n)s.set(i,n[i]);else if("function"==typeof n.keys&&"function"==typeof n.get)for(let e of n.keys())s.set(e,n.get(e));else throw Error("Unknown input type for opt_headers: "+String(n));for(let[e,o]of(n=Array.from(s.keys()).find(e=>"content-type"==e.toLowerCase()),i=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(tk,r,void 0)>=0)||n||i||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tS(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tI(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tI(this,!0)),tN.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tE(this):this.Xa())},t.Xa=function(){tE(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tT(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ec(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tR.prototype).ka=8,t.I=1,t.connect=function(e,t,r,s){e_(0),this.W=e,this.H=t||{},r&&void 0!==s&&(this.H.OSID=r,this.H.OAID=s),this.F=this.X,this.J=tY(this,null,this.W),tL(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let n=new eA(this,this.j,e),i=this.o;if(this.U&&(i?$(i=z(i),this.U):i=this.U),null!==this.u||this.R||(n.J=i,i=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var s=this.i[r];if("__data__"in s.map&&"string"==typeof(s=s.map.__data__)){s=s.length;break t}s=void 0}if(void 0===s)break;if((t+=s)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tz(this,n,t),e4(r=e0(this.J),"RID",e),e4(r,"CVER",22),this.G&&e4(r,"X-HTTP-Session-Id",this.G),tU(this,r),i&&(this.R?t="headers="+eT(tw(i))+"&"+t:this.u&&t_(r,this.u,i)),eX(this.h,n),this.Ra&&e4(r,"TYPE","init"),this.S?(e4(r,"$req",t),e4(r,"SID","null"),n.U=!0,eD(n,r,null)):eD(n,r,t),this.I=2}}else 3==this.I&&(e?tF(this,e):0==this.i.length||eG(this.h)||tF(this))},t.Da=function(){if(this.v=null,tB(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=ej(x(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,e_(10),tD(this),tB(this))},t.Va=function(){null!=this.C&&(this.C=null,tD(this),t$(this),e_(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),e_(2)):(this.j.info("Failed to ping google.com"),e_(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tJ.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},y(t0,et),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tP(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new eB(t.Ya++,e)),3==t.I&&tL(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tP(this.g),delete this.g,t0.Z.N.call(this)},y(t1,ef),y(t2,em),y(t5,tJ),t5.prototype.ra=function(){er(this.g,"a")},t5.prototype.qa=function(e){er(this.g,new t1(e))},t5.prototype.pa=function(e){er(this.g,new t2)},t5.prototype.oa=function(){er(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,g=tn.createWebChannelTransport=function(){return new tZ},m=tn.getStatEventTarget=function(){return eb()},f=tn.Event=eg,p=tn.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eC.NO_ERROR=0,eC.TIMEOUT=8,eC.HTTP_ERROR=6,h=tn.ErrorCode=eC,eE.COMPLETE="complete",u=tn.EventType=eE,eh.EventType=ep,ep.OPEN="a",ep.CLOSE="b",ep.ERROR="c",ep.MESSAGE="d",et.prototype.listen=et.prototype.J,d=tn.WebChannel=eh,tn.FetchXmlHttpFactory=tg,tN.prototype.listenOnce=tN.prototype.K,tN.prototype.getLastError=tN.prototype.Ha,tN.prototype.getLastErrorCode=tN.prototype.ya,tN.prototype.getStatus=tN.prototype.ca,tN.prototype.getResponseJson=tN.prototype.La,tN.prototype.getResponseText=tN.prototype.la,tN.prototype.send=tN.prototype.ea,tN.prototype.setWithCredentials=tN.prototype.Fa,c=tn.XhrIo=tN}).apply(void 0!==ts?ts:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let ti="@firebase/firestore",ta="4.9.3";class to{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}to.UNAUTHENTICATED=new to(null),to.GOOGLE_CREDENTIALS=new to("google-credentials-uid"),to.FIRST_PARTY=new to("first-party-uid"),to.MOCK_USER=new to("mock-user");let tl="12.7.0",tc=new ed("@firebase/firestore");function td(){return tc.logLevel}function tu(e,...t){if(tc.logLevel<=a.DEBUG){let r=t.map(tf);tc.debug(`Firestore (${tl}): ${e}`,...r)}}function th(e,...t){if(tc.logLevel<=a.ERROR){let r=t.map(tf);tc.error(`Firestore (${tl}): ${e}`,...r)}}function tp(e,...t){if(tc.logLevel<=a.WARN){let r=t.map(tf);tc.warn(`Firestore (${tl}): ${e}`,...r)}}function tf(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function tm(e,t,r){let s="Unexpected state";"string"==typeof t?s=t:r=t,tg(e,s,r)}function tg(e,t,r){let s=`FIRESTORE (${tl}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{s+=" CONTEXT: "+JSON.stringify(r)}catch(e){s+=" CONTEXT: "+r}throw th(s),Error(s)}function tx(e,t,r,s){let n="Unexpected state";"string"==typeof r?n=r:s=r,e||tg(t,n,s)}let tb={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ty extends B{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tv{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tw{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class t_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(to.UNAUTHENTICATED))}shutdown(){}}class tN{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tj{constructor(e){this.t=e,this.currentUser=to.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){tx(void 0===this.o,42304);let r=this.i,s=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),n=new tv;this.o=()=>{this.i++,this.currentUser=this.u(),n.resolve(),n=new tv,e.enqueueRetryable(()=>s(this.currentUser))};let i=()=>{let t=n;e.enqueueRetryable(async()=>{await t.promise,await s(this.currentUser)})},a=e=>{tu("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(tu("FirebaseAuthCredentialsProvider","Auth not yet detected"),n.resolve(),n=new tv)}},0),i()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tu("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tx("string"==typeof t.accessToken,31837,{l:t}),new tw(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tx(null===e||"string"==typeof e,2055,{h:e}),new to(e)}}class tk{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=to.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class tS{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new tk(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(to.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class tC{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tE{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,eU(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){tx(void 0===this.o,3512);let r=e=>{null!=e.error&&tu("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,tu("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let s=e=>{tu("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>s(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?s(e):tu("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new tC(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tx("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new tC(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class tI{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let s=0;s<r.length;++s)t.length<20&&r[s]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[s]%62))}return t}}function tT(e,t){return e<t?-1:+(e>t)}function tA(e,t){let r=Math.min(e.length,t.length);for(let s=0;s<r;s++){let r=e.charAt(s),n=t.charAt(s);if(r!==n)return tM(r)===tM(n)?tT(r,n):tM(r)?1:-1}return tT(e.length,t.length)}function tM(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function tR(e,t,r){return e.length===t.length&&e.every((e,s)=>r(e,t[s]))}let tP="__name__";class tD{constructor(e,t,r){void 0===t?t=0:t>e.length&&tm(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&tm(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===tD.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof tD?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let s=0;s<r;s++){let r=tD.compareSegments(e.get(s),t.get(s));if(0!==r)return r}return tT(e.length,t.length)}static compareSegments(e,t){let r=tD.isNumericId(e),s=tD.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?tD.extractNumericId(e).compare(tD.extractNumericId(t)):tA(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return o.fromString(e.substring(4,e.length-2))}}class tO extends tD{construct(e,t,r){return new tO(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new ty(tb.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new tO(t)}static emptyPath(){return new tO([])}}let tL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tF extends tD{construct(e,t,r){return new tF(e,t,r)}static isValidIdentifier(e){return tL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tF.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===tP}static keyField(){return new tF([tP])}static fromServerFormat(e){let t=[],r="",s=0,n=()=>{if(0===r.length)throw new ty(tb.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},i=!1;for(;s<e.length;){let t=e[s];if("\\"===t){if(s+1===e.length)throw new ty(tb.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ty(tb.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,s+=2}else"`"===t?i=!i:"."!==t||i?r+=t:n(),s++}if(n(),i)throw new ty(tb.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tF(t)}static emptyPath(){return new tF([])}}class tU{constructor(e){this.path=e}static fromPath(e){return new tU(tO.fromString(e))}static fromName(e){return new tU(tO.fromString(e).popFirst(5))}static empty(){return new tU(tO.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===tO.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return tO.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new tU(new tO(e.slice()))}}function tz(e,t,r){if(!r)throw new ty(tb.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function tV(e){if(!tU.isDocumentKey(e))throw new ty(tb.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function t$(e){if(tU.isDocumentKey(e))throw new ty(tb.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function tq(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function tB(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":tm(12329,{type:typeof e})}function tH(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ty(tb.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=tB(e);throw new ty(tb.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function tG(e,t){let r={typeString:e};return t&&(r.value=t),r}function tW(e,t){let r;if(!tq(e))throw new ty(tb.INVALID_ARGUMENT,"JSON must be an object");for(let s in t)if(t[s]){let n=t[s].typeString,i="value"in t[s]?{value:t[s].value}:void 0;if(!(s in e)){r=`JSON missing required field: '${s}'`;break}let a=e[s];if(n&&typeof a!==n){r=`JSON field '${s}' must be a ${n}.`;break}if(void 0!==i&&a!==i.value){r=`Expected '${s}' field to equal '${i.value}'`;break}}if(r)throw new ty(tb.INVALID_ARGUMENT,r);return!0}class tK{static now(){return tK.fromMillis(Date.now())}static fromDate(e){return tK.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new tK(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new ty(tb.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new ty(tb.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tT(this.nanoseconds,e.nanoseconds):tT(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:tK._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(tW(e,tK._jsonSchema))return new tK(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}tK._jsonSchemaVersion="firestore/timestamp/1.0",tK._jsonSchema={type:tG("string",tK._jsonSchemaVersion),seconds:tG("number"),nanoseconds:tG("number")};class tX{static fromTimestamp(e){return new tX(e)}static min(){return new tX(new tK(0,0))}static max(){return new tX(new tK(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class tY{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new tY(tX.min(),tU.empty(),-1)}static max(){return new tY(tX.max(),tU.empty(),-1)}}class tQ{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function tJ(e){if(e.code!==tb.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;tu("LocalStore","Unexpectedly lost primary lease")}class tZ{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tm(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new tZ((r,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof tZ?t:tZ.resolve(t)}catch(e){return tZ.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):tZ.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):tZ.reject(t)}static resolve(e){return new tZ((t,r)=>{t(e)})}static reject(e){return new tZ((t,r)=>{r(e)})}static waitFor(e){return new tZ((t,r)=>{let s=0,n=0,i=!1;e.forEach(e=>{++s,e.next(()=>{++n,i&&n===s&&t()},e=>r(e))}),i=!0,n===s&&t()})}static or(e){let t=tZ.resolve(!1);for(let r of e)t=t.next(e=>e?tZ.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,s)=>{r.push(t.call(this,e,s))}),this.waitFor(r)}static mapArray(e,t){return new tZ((r,s)=>{let n=e.length,i=Array(n),a=0;for(let o=0;o<n;o++){let l=o;t(e[l]).next(e=>{i[l]=e,++a===n&&r(i)},e=>s(e))}})}static doWhile(e,t){return new tZ((r,s)=>{let n=()=>{!0===e()?t().next(()=>{n()},s):r()};n()})}}function t0(e){return"IndexedDbTransactionError"===e.name}class t1{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}t1.ce=-1;function t2(e){return 0===e&&1/e==-1/0}function t5(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function t4(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function t3(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class t6{constructor(e,t){this.comparator=e,this.root=t||t9.EMPTY}insert(e,t){return new t6(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,t9.BLACK,null,null))}remove(e){return new t6(this.comparator,this.root.remove(e,this.comparator).copy(null,null,t9.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new t8(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new t8(this.root,e,this.comparator,!1)}getReverseIterator(){return new t8(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new t8(this.root,e,this.comparator,!0)}}class t8{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let n=1;for(;!e.isEmpty();)if(n=t?r(e.key,t):1,t&&s&&(n*=-1),n<0)e=this.isReverse?e.left:e.right;else{if(0===n){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class t9{constructor(e,t,r,s,n){this.key=e,this.value=t,this.color=null!=r?r:t9.RED,this.left=null!=s?s:t9.EMPTY,this.right=null!=n?n:t9.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,n){return new t9(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=s?s:this.left,null!=n?n:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this,n=r(e,s.key);return(s=n<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===n?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return t9.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,s=this;if(0>t(e,s.key))s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return t9.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,t9.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,t9.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tm(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tm(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw tm(27949);return e+ +!this.isRed()}}t9.EMPTY=null,t9.RED=!0,t9.BLACK=!1,t9.EMPTY=new class{constructor(){this.size=0}get key(){throw tm(57766)}get value(){throw tm(16141)}get color(){throw tm(16727)}get left(){throw tm(29726)}get right(){throw tm(36894)}copy(e,t,r,s,n){return this}insert(e,t,r){return new t9(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class t7{constructor(e){this.comparator=e,this.data=new t6(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new re(this.data.getIterator())}getIteratorFrom(e){return new re(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof t7)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new t7(this.comparator);return t.data=e,t}}class re{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class rt{constructor(e){this.fields=e,e.sort(tF.comparator)}static empty(){return new rt([])}unionWith(e){let t=new t7(tF.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new rt(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tR(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class rr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class rs{constructor(e){this.binaryString=e}static fromBase64String(e){return new rs(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new rr("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new rs(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tT(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}rs.EMPTY_BYTE_STRING=new rs("");let rn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ri(e){if(tx(!!e,39018),"string"==typeof e){let t=0,r=rn.exec(e);if(tx(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:ra(e.seconds),nanos:ra(e.nanos)}}function ra(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ro(e){return"string"==typeof e?rs.fromBase64String(e):rs.fromUint8Array(e)}let rl="server_timestamp",rc="__type__",rd="__previous_value__",ru="__local_write_time__";function rh(e){return(e?.mapValue?.fields||{})[rc]?.stringValue===rl}function rp(e){let t=e.mapValue.fields[rd];return rh(t)?rp(t):t}function rf(e){let t=ri(e.mapValue.fields[ru].timestampValue);return new tK(t.seconds,t.nanos)}class rm{constructor(e,t,r,s,n,i,a,o,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=n,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c}}let rg="(default)";class rx{constructor(e,t){this.projectId=e,this.database=t||rg}static empty(){return new rx("","")}get isDefaultDatabase(){return this.database===rg}isEqual(e){return e instanceof rx&&e.projectId===this.projectId&&e.database===this.database}}let rb="__type__",ry="__max__",rv={},rw="__vector__",r_="value";function rN(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rh(e)?4:rF(e)?0x1fffffffffffff:rO(e)?10:11:tm(28295,{value:e})}function rj(e,t){if(e===t)return!0;let r=rN(e);if(r!==rN(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return rf(e).isEqual(rf(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let s=ri(e.timestampValue),n=ri(t.timestampValue);return s.seconds===n.seconds&&s.nanos===n.nanos;case 5:return e.stringValue===t.stringValue;case 6:return ro(e.bytesValue).isEqual(ro(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return ra(e.geoPointValue.latitude)===ra(t.geoPointValue.latitude)&&ra(e.geoPointValue.longitude)===ra(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return ra(e.integerValue)===ra(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=ra(e.doubleValue),s=ra(t.doubleValue);return r===s?t2(r)===t2(s):isNaN(r)&&isNaN(s)}return!1;case 9:return tR(e.arrayValue.values||[],t.arrayValue.values||[],rj);case 10:case 11:let i=e.mapValue.fields||{},a=t.mapValue.fields||{};if(t5(i)!==t5(a))return!1;for(let e in i)if(i.hasOwnProperty(e)&&(void 0===a[e]||!rj(i[e],a[e])))return!1;return!0;default:return tm(52216,{left:e})}}function rk(e,t){return void 0!==(e.values||[]).find(e=>rj(e,t))}function rS(e,t){var r,s,n,i,a,o;if(e===t)return 0;let l=rN(e),c=rN(t);if(l!==c)return tT(l,c);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return tT(e.booleanValue,t.booleanValue);case 2:let d,u;return d=ra(e.integerValue||e.doubleValue),d<(u=ra(t.integerValue||t.doubleValue))?-1:d>u?1:d===u?0:isNaN(d)?isNaN(u)?0:-1:1;case 3:return rC(e.timestampValue,t.timestampValue);case 4:return rC(rf(e),rf(t));case 5:return tA(e.stringValue,t.stringValue);case 6:let h,p;return r=e.bytesValue,s=t.bytesValue,h=ro(r),p=ro(s),h.compareTo(p);case 7:return function(e,t){let r=e.split("/"),s=t.split("/");for(let e=0;e<r.length&&e<s.length;e++){let t=tT(r[e],s[e]);if(0!==t)return t}return tT(r.length,s.length)}(e.referenceValue,t.referenceValue);case 8:let f;return n=e.geoPointValue,i=t.geoPointValue,0!==(f=tT(ra(n.latitude),ra(i.latitude)))?f:tT(ra(n.longitude),ra(i.longitude));case 9:return rE(e.arrayValue,t.arrayValue);case 10:let m,g,x,b,y;return a=e.mapValue,o=t.mapValue,m=a.fields||{},g=o.fields||{},x=m[r_]?.arrayValue,b=g[r_]?.arrayValue,0!==(y=tT(x?.values?.length||0,b?.values?.length||0))?y:rE(x,b);case 11:return function(e,t){if(e===rv&&t===rv)return 0;if(e===rv)return 1;if(t===rv)return -1;let r=e.fields||{},s=Object.keys(r),n=t.fields||{},i=Object.keys(n);s.sort(),i.sort();for(let e=0;e<s.length&&e<i.length;++e){let t=tA(s[e],i[e]);if(0!==t)return t;let a=rS(r[s[e]],n[i[e]]);if(0!==a)return a}return tT(s.length,i.length)}(e.mapValue,t.mapValue);default:throw tm(23264,{he:l})}}function rC(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return tT(e,t);let r=ri(e),s=ri(t),n=tT(r.seconds,s.seconds);return 0!==n?n:tT(r.nanos,s.nanos)}function rE(e,t){let r=e.values||[],s=t.values||[];for(let e=0;e<r.length&&e<s.length;++e){let t=rS(r[e],s[e]);if(t)return t}return tT(r.length,s.length)}function rI(e){var t,r;let s;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(s=ri(e.timestampValue),`time(${s.seconds},${s.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?ro(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,tU.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let s of e.values||[])r?r=!1:t+=",",t+=rI(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",s=!0;for(let n of t)s?s=!1:r+=",",r+=`${n}:${rI(e.fields[n])}`;return r+"}"}(e.mapValue):tm(61005,{value:e})}function rT(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rA(e){return!!e&&"integerValue"in e}function rM(e){return!!e&&"arrayValue"in e}function rR(e){return!!e&&"nullValue"in e}function rP(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function rD(e){return!!e&&"mapValue"in e}function rO(e){return(e?.mapValue?.fields||{})[rb]?.stringValue===rw}function rL(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return t4(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=rL(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=rL(e.arrayValue.values[r]);return t}return{...e}}function rF(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===ry}class rU{constructor(e){this.value=e}static empty(){return new rU({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!rD(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rL(t)}setAll(e){let t=tF.emptyPath(),r={},s=[];e.forEach((e,n)=>{if(!t.isImmediateParentOf(n)){let e=this.getFieldsMap(t);this.applyChanges(e,r,s),r={},s=[],t=n.popLast()}e?r[n.lastSegment()]=rL(e):s.push(n.lastSegment())});let n=this.getFieldsMap(t);this.applyChanges(n,r,s)}delete(e){let t=this.field(e.popLast());rD(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rj(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];rD(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){for(let s of(t4(t,(t,r)=>e[t]=r),r))delete e[s]}clone(){return new rU(rL(this.value))}}class rz{constructor(e,t,r,s,n,i,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=n,this.data=i,this.documentState=a}static newInvalidDocument(e){return new rz(e,0,tX.min(),tX.min(),tX.min(),rU.empty(),0)}static newFoundDocument(e,t,r,s){return new rz(e,1,t,tX.min(),r,s,0)}static newNoDocument(e,t){return new rz(e,2,t,tX.min(),tX.min(),rU.empty(),0)}static newUnknownDocument(e,t){return new rz(e,3,t,tX.min(),tX.min(),rU.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(tX.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rU.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rU.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tX.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof rz&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rz(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rV{constructor(e,t){this.position=e,this.inclusive=t}}function r$(e,t,r){let s=0;for(let n=0;n<e.position.length;n++){let i=t[n],a=e.position[n];if(s=i.field.isKeyField()?tU.comparator(tU.fromName(a.referenceValue),r.key):rS(a,r.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function rq(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!rj(e.position[r],t.position[r]))return!1;return!0}class rB{constructor(e,t="asc"){this.field=e,this.dir=t}}class rH{}class rG extends rH{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new rY(e,t,r):"array-contains"===t?new r0(e,r):"in"===t?new r1(e,r):"not-in"===t?new r2(e,r):"array-contains-any"===t?new r5(e,r):new rG(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new rQ(e,r):new rJ(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(rS(t,this.value)):null!==t&&rN(this.value)===rN(t)&&this.matchesComparison(rS(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tm(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rW extends rH{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new rW(e,t)}matches(e){return rK(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function rK(e){return"and"===e.op}function rX(e){for(let t of e.filters)if(t instanceof rW)return!1;return!0}class rY extends rG{constructor(e,t,r){super(e,t,r),this.key=tU.fromName(r.referenceValue)}matches(e){let t=tU.comparator(e.key,this.key);return this.matchesComparison(t)}}class rQ extends rG{constructor(e,t){super(e,"in",t),this.keys=rZ("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rJ extends rG{constructor(e,t){super(e,"not-in",t),this.keys=rZ("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rZ(e,t){return(t.arrayValue?.values||[]).map(e=>tU.fromName(e.referenceValue))}class r0 extends rG{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return rM(t)&&rk(t.arrayValue,this.value)}}class r1 extends rG{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&rk(this.value.arrayValue,t)}}class r2 extends rG{constructor(e,t){super(e,"not-in",t)}matches(e){if(rk(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!rk(this.value.arrayValue,t)}}class r5 extends rG{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!rM(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>rk(this.value.arrayValue,e))}}class r4{constructor(e,t=null,r=[],s=[],n=null,i=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=n,this.startAt=i,this.endAt=a,this.Te=null}}function r3(e,t=null,r=[],s=[],n=null,i=null,a=null){return new r4(e,t,r,s,n,i,a)}function r6(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof rG)return t.field.canonicalString()+t.op.toString()+rI(t.value);if(rX(t)&&rK(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>rI(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>rI(e)).join(",")),e.Te=t}return e.Te}function r8(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++){var r,s;if(r=e.orderBy[n],s=t.orderBy[n],!(r.dir===s.dir&&r.field.isEqual(s.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof rG?r instanceof rG&&t.op===r.op&&t.field.isEqual(r.field)&&rj(t.value,r.value):t instanceof rW?r instanceof rW&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,s,n)=>t&&e(s,r.filters[n]),!0):void tm(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rq(e.startAt,t.startAt)&&rq(e.endAt,t.endAt)}function r9(e){return tU.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class r7{constructor(e,t=null,r=[],s=[],n=null,i="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=n,this.limitType=i,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function se(e){return new r7(e)}function st(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function sr(e){return null!==e.collectionGroup}function ss(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new t7(tF.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new rB(t,s))}),r.has(tF.keyField().canonicalString())||e.Ie.push(new rB(tF.keyField(),s))}return e.Ie}function sn(e){return e.Ee||(e.Ee=function(e,t){if("F"===e.limitType)return r3(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new rB(e.field,t)});let r=e.endAt?new rV(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new rV(e.startAt.position,e.startAt.inclusive):null;return r3(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}}(e,ss(e))),e.Ee}function si(e,t){let r=e.filters.concat([t]);return new r7(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function sa(e,t,r){return new r7(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function so(e,t){return r8(sn(e),sn(t))&&e.limitType===t.limitType}function sl(e){return`${r6(sn(e))}|lt:${e.limitType}`}function sc(e){var t;let r;return`Query(target=${r=(t=sn(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof rG?`${t.field.canonicalString()} ${t.op} ${rI(t.value)}`:t instanceof rW?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>rI(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>rI(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function sd(e,t){var r,s,n,i;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):tU.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of ss(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,s=t,(!r.startAt||(n=r.startAt,o=r$(n,ss(r),s),n.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(i=r.endAt,l=r$(i,ss(r),s),i.inclusive?!!(l>=0):!!(l>0))))}function su(e){return(t,r)=>{let s=!1;for(let n of ss(e)){let e=function(e,t,r){var s;let n,i,a=e.field.isKeyField()?tU.comparator(t.key,r.key):(s=e.field,n=t.data.field(s),i=r.data.field(s),null!==n&&null!==i?rS(n,i):tm(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return tm(19790,{direction:e.dir})}}(n,t,r);if(0!==e)return e;s=s||n.field.isKeyField()}return 0}}class sh{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,s]of r)if(this.equalsFn(t,e))return s}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),s=this.inner[r];if(void 0===s)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){t4(this.inner,(t,r)=>{for(let[t,s]of r)e(t,s)})}isEmpty(){return t3(this.inner)}size(){return this.innerSize}}let sp=new t6(tU.comparator),sf=new t6(tU.comparator);function sm(...e){let t=sf;for(let r of e)t=t.insert(r.key,r);return t}function sg(e){let t=sf;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function sx(){return new sh(e=>e.toString(),(e,t)=>e.isEqual(t))}let sb=new t6(tU.comparator),sy=new t7(tU.comparator);function sv(...e){let t=sy;for(let r of e)t=t.add(r);return t}let sw=new t7(tT);function s_(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t2(t)?"-0":t}}function sN(e){return{integerValue:""+e}}function sj(e,t){return"number"==typeof t&&Number.isInteger(t)&&!t2(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER?sN(t):s_(e,t)}class sk{constructor(){this._=void 0}}function sS(e,t){return e instanceof sM?rA(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class sC extends sk{}class sE extends sk{constructor(e){super(),this.elements=e}}function sI(e,t){let r=sP(t);for(let t of e.elements)r.some(e=>rj(e,t))||r.push(t);return{arrayValue:{values:r}}}class sT extends sk{constructor(e){super(),this.elements=e}}function sA(e,t){let r=sP(t);for(let t of e.elements)r=r.filter(e=>!rj(e,t));return{arrayValue:{values:r}}}class sM extends sk{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function sR(e){return ra(e.integerValue||e.doubleValue)}function sP(e){return rM(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sD{constructor(e,t){this.field=e,this.transform=t}}class sO{constructor(e,t){this.version=e,this.transformResults=t}}class sL{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sL}static exists(e){return new sL(void 0,e)}static updateTime(e){return new sL(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function sF(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class sU{}function sz(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new sK(e.key,sL.none()):new sq(e.key,e.data,sL.none());{let r=e.data,s=rU.empty(),n=new t7(tF.comparator);for(let e of t.fields)if(!n.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?s.delete(e):s.set(e,t),n=n.add(e)}return new sB(e.key,s,new rt(n.toArray()),sL.none())}}function sV(e,t,r,s){return e instanceof sq?function(e,t,r,s){if(!sF(e.precondition,t))return r;let n=e.value.clone(),i=sW(e.fieldTransforms,s,t);return n.setAll(i),t.convertToFoundDocument(t.version,n).setHasLocalMutations(),null}(e,t,r,s):e instanceof sB?function(e,t,r,s){if(!sF(e.precondition,t))return r;let n=sW(e.fieldTransforms,s,t),i=t.data;return(i.setAll(sH(e)),i.setAll(n),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,s):sF(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function s$(e,t){var r,s;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,s=t.fieldTransforms,!!(void 0===r&&void 0===s||!(!r||!s)&&tR(r,s,(e,t)=>{var r,s;return e.field.isEqual(t.field)&&(r=e.transform,s=t.transform,r instanceof sE&&s instanceof sE||r instanceof sT&&s instanceof sT?tR(r.elements,s.elements,rj):r instanceof sM&&s instanceof sM?rj(r.Ae,s.Ae):r instanceof sC&&s instanceof sC)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class sq extends sU{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class sB extends sU{constructor(e,t,r,s,n=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=n,this.type=1}getFieldMask(){return this.fieldMask}}function sH(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let s=e.data.field(r);t.set(r,s)}}),t}function sG(e,t,r){let s=new Map;tx(e.length===r.length,32656,{Re:r.length,Ve:e.length});for(let i=0;i<r.length;i++){var n;let a=e[i],o=a.transform,l=t.data.field(a.field);s.set(a.field,(n=r[i],o instanceof sE?sI(o,l):o instanceof sT?sA(o,l):n))}return s}function sW(e,t,r){let s=new Map;for(let n of e){let e=n.transform,i=r.data.field(n.field);s.set(n.field,function(e,t,r){var s;let n,i,a;return e instanceof sC?(s=t,n={fields:{[rc]:{stringValue:rl},[ru]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},s&&rh(s)&&(s=rp(s)),s&&(n.fields[rd]=s),{mapValue:n}):e instanceof sE?sI(e,t):e instanceof sT?sA(e,t):(a=sR(i=sS(e,t))+sR(e.Ae),rA(i)&&rA(e.Ae)?sN(a):s_(e.serializer,a))}(e,i,t))}return s}class sK extends sU{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sX extends sU{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sY{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let s=this.mutations[t];s.key.isEqual(e.key)&&function(e,t,r){let s,n;e instanceof sq?(s=e.value.clone(),n=sG(e.fieldTransforms,t,r.transformResults),s.setAll(n),t.convertToFoundDocument(r.version,s).setHasCommittedMutations()):e instanceof sB?function(e,t,r){if(!sF(e.precondition,t))return t.convertToUnknownDocument(r.version);let s=sG(e.fieldTransforms,t,r.transformResults),n=t.data;n.setAll(sH(e)),n.setAll(s),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(s,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=sV(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=sV(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=sx();return this.mutations.forEach(s=>{let n=e.get(s.key),i=n.overlayedDocument,a=this.applyToLocalView(i,n.mutatedFields),o=sz(i,a=t.has(s.key)?null:a);null!==o&&r.set(s.key,o),i.isValidDocument()||i.convertToNoDocument(tX.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),sv())}isEqual(e){return this.batchId===e.batchId&&tR(this.mutations,e.mutations,(e,t)=>s$(e,t))&&tR(this.baseMutations,e.baseMutations,(e,t)=>s$(e,t))}}class sQ{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){tx(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=sb,n=e.mutations;for(let e=0;e<n.length;e++)s=s.insert(n[e].key,r[e].version);return new sQ(e,t,r,s)}}class sJ{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class sZ{constructor(e,t){this.count=e,this.unchangedNames=t}}function s0(e){if(void 0===e)return th("GRPC error has no .code"),tb.UNKNOWN;switch(e){case x.OK:return tb.OK;case x.CANCELLED:return tb.CANCELLED;case x.UNKNOWN:return tb.UNKNOWN;case x.DEADLINE_EXCEEDED:return tb.DEADLINE_EXCEEDED;case x.RESOURCE_EXHAUSTED:return tb.RESOURCE_EXHAUSTED;case x.INTERNAL:return tb.INTERNAL;case x.UNAVAILABLE:return tb.UNAVAILABLE;case x.UNAUTHENTICATED:return tb.UNAUTHENTICATED;case x.INVALID_ARGUMENT:return tb.INVALID_ARGUMENT;case x.NOT_FOUND:return tb.NOT_FOUND;case x.ALREADY_EXISTS:return tb.ALREADY_EXISTS;case x.PERMISSION_DENIED:return tb.PERMISSION_DENIED;case x.FAILED_PRECONDITION:return tb.FAILED_PRECONDITION;case x.ABORTED:return tb.ABORTED;case x.OUT_OF_RANGE:return tb.OUT_OF_RANGE;case x.UNIMPLEMENTED:return tb.UNIMPLEMENTED;case x.DATA_LOSS:return tb.DATA_LOSS;default:return tm(39323,{code:e})}}(b=x||(x={}))[b.OK=0]="OK",b[b.CANCELLED=1]="CANCELLED",b[b.UNKNOWN=2]="UNKNOWN",b[b.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",b[b.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",b[b.NOT_FOUND=5]="NOT_FOUND",b[b.ALREADY_EXISTS=6]="ALREADY_EXISTS",b[b.PERMISSION_DENIED=7]="PERMISSION_DENIED",b[b.UNAUTHENTICATED=16]="UNAUTHENTICATED",b[b.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",b[b.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",b[b.ABORTED=10]="ABORTED",b[b.OUT_OF_RANGE=11]="OUT_OF_RANGE",b[b.UNIMPLEMENTED=12]="UNIMPLEMENTED",b[b.INTERNAL=13]="INTERNAL",b[b.UNAVAILABLE=14]="UNAVAILABLE",b[b.DATA_LOSS=15]="DATA_LOSS";let s1=new o([0xffffffff,0xffffffff],0);function s2(e){let t=(new TextEncoder).encode(e),r=new l;return r.update(t),new Uint8Array(r.digest())}function s5(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),s=t.getUint32(4,!0),n=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new o([r,s],0),new o([n,i],0)]}class s4{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new s3(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new s3(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new s3(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=o.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(o.fromNumber(r)));return 1===s.compare(s1)&&(s=new o([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=s5(s2(e));for(let e=0;e<this.hashCount;e++){let s=this.ye(t,r,e);if(!this.we(s))return!1}return!0}static create(e,t,r){let s=new s4(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>s.insert(e)),s}insert(e){if(0===this.ge)return;let[t,r]=s5(s2(e));for(let e=0;e<this.hashCount;e++){let s=this.ye(t,r,e);this.Se(s)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class s3 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class s6{constructor(e,t,r,s,n){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=n}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let s=new Map;return s.set(e,s8.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new s6(tX.min(),s,new t6(tT),sp,sv())}}class s8{constructor(e,t,r,s,n){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=n}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new s8(r,t,sv(),sv(),sv())}}class s9{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class s7{constructor(e,t){this.targetId=e,this.Ce=t}}class ne{constructor(e,t,r=rs.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class nt{constructor(){this.ve=0,this.Fe=nn(),this.Me=rs.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=sv(),t=sv(),r=sv();return this.Fe.forEach((s,n)=>{switch(n){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:tm(38017,{changeType:n})}}),new s8(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=nn()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,tx(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class nr{constructor(e){this.Ge=e,this.ze=new Map,this.je=sp,this.Je=ns(),this.He=ns(),this.Ye=new t6(tT)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:tm(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){let n=s.target;if(r9(n))if(0===r){let e=new tU(n.path);this.et(t,e,rz.newNoDocument(e,tX.min()))}else tx(1===r,20013,{expectedCount:r});else{let s=this._t(t);if(s!==r){let r=this.ut(e),n=r?this.ct(r,e,s):1;0!==n&&(this.it(t),this.Ye=this.Ye.insert(t,2===n?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){let t,r,s=e.Ce.unchangedNames;if(!s||!s.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:a=0}=s;try{t=ro(n).toUint8Array()}catch(e){if(e instanceof rr)return tp("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new s4(t,i,a)}catch(e){return tp(e instanceof s3?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),s=0;return r.forEach(r=>{let n=this.Ge.ht(),i=`projects/${n.projectId}/databases/${n.database}/documents/${r.path.canonicalString()}`;e.mightContain(i)||(this.et(t,r,null),s++)}),s}Tt(e){let t=new Map;this.ze.forEach((r,s)=>{let n=this.ot(s);if(n){if(r.current&&r9(n.target)){let t=new tU(n.target.path);this.It(t).has(s)||this.Et(s,t)||this.et(s,t,rz.newNoDocument(t,e))}r.Be&&(t.set(s,r.ke()),r.qe())}});let r=sv();this.He.forEach((e,t)=>{let s=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(s=!1,!1)}),s&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let s=new s6(e,t,this.Ye,this.je,r);return this.je=sp,this.Je=ns(),this.He=ns(),this.Ye=new t6(tT),s}Xe(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new nt,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new t7(tT),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new t7(tT),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||tu("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new nt),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ns(){return new t6(tU.comparator)}function nn(){return new t6(tU.comparator)}let ni={asc:"ASCENDING",desc:"DESCENDING"},na={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},no={and:"AND",or:"OR"};class nl{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function nc(e,t){return e.useProto3Json||null==t?t:{value:t}}function nd(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function nu(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function nh(e){let t;return tx(!!e,49232),tX.fromTimestamp(new tK((t=ri(e)).seconds,t.nanos))}function np(e,t){return nf(e,t).canonicalString()}function nf(e,t){let r=new tO(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function nm(e){let t=tO.fromString(e);return tx(nj(t),10190,{key:t.toString()}),t}function ng(e,t){return np(e.databaseId,t.path)}function nx(e,t){let r=nm(t);if(r.get(1)!==e.databaseId.projectId)throw new ty(tb.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new ty(tb.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new tU(nv(r))}function nb(e,t){return np(e.databaseId,t)}function ny(e){return new tO(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function nv(e){return tx(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function nw(e,t,r){return{name:ng(e,t),fields:r.value.mapValue.fields}}function n_(e){return{fieldPath:e.canonicalString()}}function nN(e){return tF.fromServerFormat(e.fieldPath)}function nj(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class nk{constructor(e,t,r,s,n=tX.min(),i=tX.min(),a=rs.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=n,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new nk(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nk(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nk(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nk(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class nS{constructor(e){this.yt=e}}class nC{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(ra(e.integerValue));else if("doubleValue"in e){let r=ra(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),t2(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=ri(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(ro(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?rF(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):rO(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):tm(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let s=r[r_].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(ra(s)),this.Ot(r_,t),this.Ct(r[r_],t)}Qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),tU.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}nC.Kt=new nC;class nE{constructor(){this.Cn=new nI}addToCollectionParentIndex(e,t){return this.Cn.add(t),tZ.resolve()}getCollectionParents(e,t){return tZ.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return tZ.resolve()}deleteFieldIndex(e,t){return tZ.resolve()}deleteAllFieldIndexes(e){return tZ.resolve()}createTargetIndexes(e,t){return tZ.resolve()}getDocumentsMatchingTarget(e,t){return tZ.resolve(null)}getIndexType(e,t){return tZ.resolve(0)}getFieldIndexes(e,t){return tZ.resolve([])}getNextCollectionGroupToUpdate(e){return tZ.resolve(null)}getMinOffset(e,t){return tZ.resolve(tY.min())}getMinOffsetFromCollectionGroup(e,t){return tZ.resolve(tY.min())}updateCollectionGroup(e,t,r){return tZ.resolve()}updateIndexEntries(e,t){return tZ.resolve()}}class nI{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new t7(tO.comparator),n=!s.has(r);return this.index[t]=s.add(r),n}has(e){let t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new t7(tO.comparator)).toArray()}}new Uint8Array(0);let nT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class nA{static withCacheSize(e){return new nA(e,nA.DEFAULT_COLLECTION_PERCENTILE,nA.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}nA.DEFAULT_COLLECTION_PERCENTILE=10,nA.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nA.DEFAULT=new nA(0x2800000,nA.DEFAULT_COLLECTION_PERCENTILE,nA.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nA.DISABLED=new nA(-1,0,0);class nM{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new nM(0)}static cr(){return new nM(-1)}}let nR="LruGarbageCollector";function nP([e,t],[r,s]){let n=tT(e,r);return 0===n?tT(t,s):n}class nD{constructor(e){this.Ir=e,this.buffer=new t7(nP),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>nP(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class nO{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){tu(nR,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){t0(e)?tu(nR,"Ignoring IndexedDB error during garbage collection: ",e):await tJ(e)}await this.Vr(3e5)})}}class nL{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return tZ.resolve(t1.ce);let r=new nD(t);return this.mr.forEachTarget(e,e=>r.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>r.Ar(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(tu("LruGarbageCollector","Garbage collection skipped; disabled"),tZ.resolve(nT)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tu("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nT):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,n,i,o,l,c,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tu("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),s=this.params.maximumSequenceNumbersToCollect):s=t,i=Date.now(),this.nthSequenceNumber(e,s))).next(s=>(r=s,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(n=t,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(c=Date.now(),td()<=a.DEBUG&&tu("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${i-d}ms
	Determined least recently used ${s} in `+(o-i)+"ms\n"+`	Removed ${n} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(c-l)+"ms\n"+`Total Duration: ${c-d}ms`),tZ.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:n,documentsRemoved:e})))}}class nF{constructor(){this.changes=new sh(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rz.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?tZ.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class nU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class nz{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&sV(r.mutation,e,rt.empty(),tK.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,sv()).next(()=>t))}getLocalViewOfDocuments(e,t,r=sv()){let s=sx();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(e=>{let t=sm();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=sx();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,sv()))}populateOverlays(e,t,r){let s=[];return r.forEach(e=>{t.has(e)||s.push(e)}),this.documentOverlayCache.getOverlays(e,s).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,s){let n=sp,i=sx(),a=sx();return t.forEach((e,t)=>{let a=r.get(t.key);s.has(t.key)&&(void 0===a||a.mutation instanceof sB)?n=n.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),sV(a.mutation,t,a.mutation.getFieldMask(),tK.now())):i.set(t.key,rt.empty())}),this.recalculateAndSaveOverlays(e,n).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>a.set(e,new nU(t,i.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=sx(),s=new t6((e,t)=>e-t),n=sv();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let n of e)n.keys().forEach(e=>{let i=t.get(e);if(null===i)return;let a=r.get(e)||rt.empty();a=n.applyToLocalView(i,a),r.set(e,a);let o=(s.get(n.batchId)||sv()).add(e);s=s.insert(n.batchId,o)})}).next(()=>{let i=[],a=s.getReverseIterator();for(;a.hasNext();){let s=a.getNext(),o=s.key,l=s.value,c=sx();l.forEach(e=>{if(!n.has(e)){let s=sz(t.get(e),r.get(e));null!==s&&c.set(e,s),n=n.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,o,c))}return tZ.waitFor(i)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,s){return tU.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):sr(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(n=>{let i=s-n.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-n.size):tZ.resolve(sx()),a=-1,o=n;return i.next(t=>tZ.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),n.get(t)?tZ.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,n)).next(()=>this.computeViews(e,o,t,sv())).next(e=>({batchId:a,changes:sg(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new tU(t)).next(e=>{let t=sm();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){let n=t.collectionGroup,i=sm();return this.indexManager.getCollectionParents(e,n).next(a=>tZ.forEach(a,a=>{let o=new r7(a.child(n),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,s).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r,s){let n;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(i=>(n=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,n,s))).next(e=>{n.forEach((t,r)=>{let s=r.getKey();null===e.get(s)&&(e=e.insert(s,rz.newInvalidDocument(s)))});let r=sm();return e.forEach((e,s)=>{let i=n.get(e);void 0!==i&&sV(i.mutation,s,rt.empty(),tK.now()),sd(t,s)&&(r=r.insert(e,s))}),r})}}class nV{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return tZ.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:nh(t.createTime)}),tZ.resolve()}getNamedQuery(e,t){return tZ.resolve(this.kr.get(t))}saveNamedQuery(e,t){var r;let s;return this.kr.set(t.name,{name:t.name,query:(s=function(e){var t,r,s,n;let i,a,o,l,c,d=4===(i=nm(e.parent)).length?tO.emptyPath():nv(i),u=e.structuredQuery,h=u.from?u.from.length:0,p=null;if(h>0){tx(1===h,65062);let e=u.from[0];e.allDescendants?p=e.collectionId:d=d.child(e.collectionId)}let f=[];u.where&&(f=(a=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=nN(e.unaryFilter.field);return rG.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=nN(e.unaryFilter.field);return rG.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=nN(e.unaryFilter.field);return rG.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let n=nN(e.unaryFilter.field);return rG.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tm(61313);default:return tm(60726)}}(t):void 0!==t.fieldFilter?rG.create(nN(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tm(58110);default:return tm(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?rW.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tm(1026)}}(t.compositeFilter.op)):tm(30097,{filter:t})}(u.where))instanceof rW&&rX(t=a)&&rK(t)?a.getFilters():[a]);let m=[];u.orderBy&&(m=u.orderBy.map(e=>new rB(nN(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;u.limit&&(g=null==(o="object"==typeof(r=u.limit)?r.value:r)?null:o);let x=null;u.startAt&&(l=!!(s=u.startAt).before,x=new rV(s.values||[],l));let b=null;return u.endAt&&(c=!(n=u.endAt).before,b=new rV(n.values||[],c)),new r7(d,p,m,f,g,"F",x,b)}({parent:(r=t.bundledQuery).parent,structuredQuery:r.structuredQuery}),"LAST"===r.limitType?sa(s,s.limit,"L"):s),readTime:nh(t.readTime)}),tZ.resolve()}}class n${constructor(){this.overlays=new t6(tU.comparator),this.qr=new Map}getOverlay(e,t){return tZ.resolve(this.overlays.get(t))}getOverlays(e,t){let r=sx();return tZ.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,s)=>{this.St(e,t,s)}),tZ.resolve()}removeOverlaysForBatchId(e,t,r){let s=this.qr.get(r);return void 0!==s&&(s.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(r)),tZ.resolve()}getOverlaysForCollection(e,t,r){let s=sx(),n=t.length+1,i=new tU(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){let e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===n&&e.largestBatchId>r&&s.set(e.getKey(),e)}return tZ.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let n=new t6((e,t)=>e-t),i=this.overlays.getIterator();for(;i.hasNext();){let e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=n.get(e.largestBatchId);null===t&&(t=sx(),n=n.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=sx(),o=n.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=s)););return tZ.resolve(a)}St(e,t,r){let s=this.overlays.get(r.key);if(null!==s){let e=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new sJ(t,r));let n=this.qr.get(t);void 0===n&&(n=sv(),this.qr.set(t,n)),this.qr.set(t,n.add(r.key))}}class nq{constructor(){this.sessionToken=rs.EMPTY_BYTE_STRING}getSessionToken(e){return tZ.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,tZ.resolve()}}class nB{constructor(){this.Qr=new t7(nH.$r),this.Ur=new t7(nH.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new nH(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new nH(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new tU(new tO([])),r=new nH(t,e),s=new nH(t,e+1),n=[];return this.Ur.forEachInRange([r,s],e=>{this.Gr(e),n.push(e.key)}),n}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new tU(new tO([])),r=new nH(t,e),s=new nH(t,e+1),n=sv();return this.Ur.forEachInRange([r,s],e=>{n=n.add(e.key)}),n}containsKey(e){let t=new nH(e,0),r=this.Qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class nH{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return tU.comparator(e.key,t.key)||tT(e.Yr,t.Yr)}static Kr(e,t){return tT(e.Yr,t.Yr)||tU.comparator(e.key,t.key)}}class nG{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new t7(nH.$r)}checkEmpty(e){return tZ.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,s){let n=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let i=new sY(n,t,r,s);for(let t of(this.mutationQueue.push(i),s))this.Zr=this.Zr.add(new nH(t.key,n)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return tZ.resolve(i)}lookupMutationBatch(e,t){return tZ.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.ei(t+1),s=r<0?0:r;return tZ.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return tZ.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return tZ.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new nH(t,0),s=new nH(t,1/0),n=[];return this.Zr.forEachInRange([r,s],e=>{let t=this.Xr(e.Yr);n.push(t)}),tZ.resolve(n)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new t7(tT);return t.forEach(e=>{let t=new nH(e,0),s=new nH(e,1/0);this.Zr.forEachInRange([t,s],e=>{r=r.add(e.Yr)})}),tZ.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,s=r.length+1,n=r;tU.isDocumentKey(n)||(n=n.child(""));let i=new nH(new tU(n),0),a=new t7(tT);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===s&&(a=a.add(e.Yr)),!0)},i),tZ.resolve(this.ti(a))}ti(e){let t=[];return e.forEach(e=>{let r=this.Xr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){tx(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Zr;return tZ.forEach(t.mutations,s=>{let n=new nH(s.key,t.batchId);return r=r.delete(n),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){let r=new nH(t,0),s=this.Zr.firstAfterOrEqual(r);return tZ.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,tZ.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class nW{constructor(e){this.ri=e,this.docs=new t6(tU.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,s=this.docs.get(r),n=s?s.size:0,i=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:i}),this.size+=i-n,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return tZ.resolve(r?r.document.mutableCopy():rz.newInvalidDocument(t))}getEntries(e,t){let r=sp;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():rz.newInvalidDocument(e))}),tZ.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let n=sp,i=t.path,a=new tU(i.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||0>=function(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=tU.comparator(e.documentKey,t.documentKey))?r:tT(e.largestBatchId,t.largestBatchId)}(new tY(a.readTime,a.key,-1),r)||(s.has(a.key)||sd(t,a))&&(n=n.insert(a.key,a.mutableCopy()))}return tZ.resolve(n)}getAllFromCollectionGroup(e,t,r,s){tm(9500)}ii(e,t){return tZ.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new nK(this)}getSize(e){return tZ.resolve(this.size)}}class nK extends nF{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),tZ.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class nX{constructor(e){this.persistence=e,this.si=new sh(e=>r6(e),r8),this.lastRemoteSnapshotVersion=tX.min(),this.highestTargetId=0,this.oi=0,this._i=new nB,this.targetCount=0,this.ai=nM.ur()}forEachTarget(e,t){return this.si.forEach((e,r)=>t(r)),tZ.resolve()}getLastRemoteSnapshotVersion(e){return tZ.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return tZ.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),tZ.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),tZ.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new nM(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,tZ.resolve()}updateTargetData(e,t){return this.Pr(t),tZ.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,tZ.resolve()}removeTargets(e,t,r){let s=0,n=[];return this.si.forEach((i,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.si.delete(i),n.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),tZ.waitFor(n).next(()=>s)}getTargetCount(e){return tZ.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return tZ.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),tZ.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let s=this.persistence.referenceDelegate,n=[];return s&&t.forEach(t=>{n.push(s.markPotentiallyOrphaned(e,t))}),tZ.waitFor(n)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),tZ.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return tZ.resolve(r)}containsKey(e,t){return tZ.resolve(this._i.containsKey(t))}}class nY{constructor(e,t){this.ui={},this.overlays={},this.ci=new t1(0),this.li=!1,this.li=!0,this.hi=new nq,this.referenceDelegate=e(this),this.Pi=new nX(this),this.indexManager=new nE,this.remoteDocumentCache=new nW(e=>this.referenceDelegate.Ti(e)),this.serializer=new nS(t),this.Ii=new nV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new n$,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new nG(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){tu("MemoryPersistence","Starting transaction:",e);let s=new nQ(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(e=>this.referenceDelegate.di(s).next(()=>e)).toPromise().then(e=>(s.raiseOnCommittedEvent(),e))}Ai(e,t){return tZ.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class nQ extends tQ{constructor(e){super(),this.currentSequenceNumber=e}}class nJ{constructor(e){this.persistence=e,this.Ri=new nB,this.Vi=null}static mi(e){return new nJ(e)}get fi(){if(this.Vi)return this.Vi;throw tm(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),tZ.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),tZ.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),tZ.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return tZ.forEach(this.fi,r=>{let s=tU.fromPath(r);return this.gi(e,s).next(e=>{e||t.removeEntry(s,tX.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return tZ.or([()=>tZ.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class nZ{constructor(e,t){this.persistence=e,this.pi=new sh(e=>(function(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,s=e.length;for(let t=0;t<s;t++){let s=e.charAt(t);switch(s){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=s}}return r}(e.get(r),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new nL(this,t)}static mi(e,t){return new nZ(e,t)}Ei(){}di(e){return tZ.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return tZ.forEach(this.pi,(r,s)=>this.br(e,r,s).next(e=>e?tZ.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,s=this.persistence.getRemoteDocumentCache(),n=s.newChangeBuffer();return s.ii(e,s=>this.br(e,s,t).next(e=>{e||(r++,n.removeEntry(s,tX.min()))})).next(()=>n.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),tZ.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),tZ.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),tZ.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),tZ.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(rN(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=rp(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return ro(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var s;let n;return s=t.mapValue,n=0,t4(s.fields,(t,r)=>{n+=t.length+e(r)}),n;default:throw tm(13486,{value:t})}}(e.data.value)),t}br(e,t,r){return tZ.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return tZ.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class n0{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=sv(),s=sv();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:s=s.add(e.doc.key)}return new n0(e,t.fromCache,r,s)}}class n1{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class n2{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){let t;return!function(){let t=M()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Number((t=$().match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1")>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){let n={result:null};return this.ys(e,t).next(e=>{n.result=e}).next(()=>{if(!n.result)return this.ws(e,t,s,r).next(e=>{n.result=e})}).next(()=>{if(n.result)return;let r=new n1;return this.Ss(e,t,r).next(s=>{if(n.result=s,this.Vs)return this.bs(e,t,r,s.size)})}).next(()=>n.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(td()<=a.DEBUG&&tu("QueryEngine","SDK will not create cache indexes for query:",sc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),tZ.resolve()):(td()<=a.DEBUG&&tu("QueryEngine","Query:",sc(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(td()<=a.DEBUG&&tu("QueryEngine","The SDK decides to create cache indexes for query:",sc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,sn(t))):tZ.resolve())}ys(e,t){if(st(t))return tZ.resolve(null);let r=sn(t);return this.indexManager.getIndexType(e,r).next(s=>0===s?null:(null!==t.limit&&1===s&&(r=sn(t=sa(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let n=sv(...s);return this.ps.getDocuments(e,n).next(s=>this.indexManager.getMinOffset(e,r).next(r=>{let i=this.Ds(t,s);return this.Cs(t,i,n,r.readTime)?this.ys(e,sa(t,null,"F")):this.vs(e,i,t,r)}))})))}ws(e,t,r,s){return st(t)||s.isEqual(tX.min())?tZ.resolve(null):this.ps.getDocuments(e,r).next(n=>{let i,o,l=this.Ds(t,n);return this.Cs(t,l,r,s)?tZ.resolve(null):(td()<=a.DEBUG&&tu("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),sc(t)),this.vs(e,l,t,(i=s.toTimestamp().seconds,o=s.toTimestamp().nanoseconds+1,new tY(tX.fromTimestamp(1e9===o?new tK(i+1,0):new tK(i,o)),tU.empty(),-1))).next(e=>e))})}Ds(e,t){let r=new t7(su(e));return t.forEach((t,s)=>{sd(e,s)&&(r=r.add(s))}),r}Cs(e,t,r,s){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let n="F"===e.limitType?t.last():t.first();return!!n&&(n.hasPendingWrites||n.version.compareTo(s)>0)}Ss(e,t,r){return td()<=a.DEBUG&&tu("QueryEngine","Using full collection scan to execute query:",sc(t)),this.ps.getDocumentsMatchingQuery(e,t,tY.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let n5="LocalStore";class n4{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new t6(tT),this.xs=new sh(e=>r6(e),r8),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new nz(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function n3(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(n=>(s=n,e.Bs(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let n=[],i=[],a=sv();for(let e of s)for(let t of(n.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ls:e,removedBatchIds:n,addedBatchIds:i}))})})}function n6(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function n8(e,t,r){let s=e.Ms.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,s))}catch(e){if(!t0(e))throw e;tu(n5,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(s.target)}function n9(e,t,r){let s=tX.min(),n=sv();return e.persistence.runTransaction("Execute query","readwrite",i=>{var a;let o;return(a=sn(t),void 0!==(o=e.xs.get(a))?tZ.resolve(e.Ms.get(o)):e.Pi.getTargetData(i,a)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(i,t.targetId).next(e=>{n=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(i,t,r?s:tX.min(),r?n:sv())).next(r=>{var s,i,a;let o;return s=e,i=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),a=r,o=s.Os.get(i)||tX.min(),a.forEach((e,t)=>{t.readTime.compareTo(o)>0&&(o=t.readTime)}),s.Os.set(i,o),{documents:r,Qs:n}})})}class n7{constructor(){this.activeTargetIds=sw}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class ie{constructor(){this.Mo=new n7,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new n7,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class it{Oo(e){}shutdown(){}}let ir="ConnectivityMonitor";class is{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(tu(ir,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(tu(ir,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ii=null;function ia(){return null===ii?ii=0x10000000+Math.round(0x80000000*Math.random()):ii++,"0x"+ii.toString(16)}let io="RestConnection",il={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ic{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===rg?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,n){let i=ia(),a=this.zo(e,t.toUriEncodedString());tu(io,`Sending RPC '${e}' ${i}:`,a,r);let o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,s,n);let{host:l}=new URL(a),c=L(l);return this.Jo(e,a,o,r,c).then(t=>(tu(io,`Received RPC '${e}' ${i}: `,t),t),t=>{throw tp(io,`RPC '${e}' ${i} failed with error: `,t,"url: ",a,"request:",r),t})}Ho(e,t,r,s,n,i){return this.Go(e,t,r,s,n)}jo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+tl,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}zo(e,t){let r=il[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class id{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let iu="WebChannelConnection";class ih extends ic{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,n){let i=ia();return new Promise((n,a)=>{let o=new c;o.setWithCredentials(!0),o.listenOnce(u.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case h.NO_ERROR:let t=o.getResponseJson();tu(iu,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),n(t);break;case h.TIMEOUT:tu(iu,`RPC '${e}' ${i} timed out`),a(new ty(tb.DEADLINE_EXCEEDED,"Request time out"));break;case h.HTTP_ERROR:let r=o.getStatus();if(tu(iu,`RPC '${e}' ${i} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(tb).indexOf(e)>=0?e:tb.UNKNOWN);a(new ty(r,t.message))}else a(new ty(tb.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new ty(tb.UNAVAILABLE,"Connection failed."));break;default:tm(9055,{l_:e,streamId:i,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{tu(iu,`RPC '${e}' ${i} completed.`)}});let l=JSON.stringify(s);tu(iu,`RPC '${e}' ${i} sending request:`,s),o.send(t,"POST",l,r,15)})}T_(e,t,r){let s=ia(),n=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=g(),a=m(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;let c=n.join("");tu(iu,`Creating RPC '${e}' stream ${s}: ${c}`,o);let u=i.createWebChannel(c,o);this.I_(u);let h=!1,b=!1,y=new id({Yo:t=>{b?tu(iu,`Not sending because RPC '${e}' stream ${s} is closed:`,t):(h||(tu(iu,`Opening RPC '${e}' stream ${s} transport.`),u.open(),h=!0),tu(iu,`RPC '${e}' stream ${s} sending:`,t),u.send(t))},Zo:()=>u.close()}),v=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return v(u,d.EventType.OPEN,()=>{b||(tu(iu,`RPC '${e}' stream ${s} transport opened.`),y.o_())}),v(u,d.EventType.CLOSE,()=>{b||(b=!0,tu(iu,`RPC '${e}' stream ${s} transport closed`),y.a_(),this.E_(u))}),v(u,d.EventType.ERROR,t=>{b||(b=!0,tp(iu,`RPC '${e}' stream ${s} transport errored. Name:`,t.name,"Message:",t.message),y.a_(new ty(tb.UNAVAILABLE,"The operation could not be completed")))}),v(u,d.EventType.MESSAGE,t=>{if(!b){let r=t.data[0];tx(!!r,16349);let n=r?.error||r[0]?.error;if(n){tu(iu,`RPC '${e}' stream ${s} received error:`,n);let t=n.status,r=function(e){let t=x[e];if(void 0!==t)return s0(t)}(t),i=n.message;void 0===r&&(r=tb.INTERNAL,i="Unknown error status: "+t+" with message "+n.message),b=!0,y.a_(new ty(r,i)),u.close()}else tu(iu,`RPC '${e}' stream ${s} received:`,r),y.u_(r)}}),v(a,f.STAT_EVENT,t=>{t.stat===p.PROXY?tu(iu,`RPC '${e}' stream ${s} detected buffering proxy`):t.stat===p.NOPROXY&&tu(iu,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{y.__()},0),y}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function ip(){return"undefined"!=typeof document?document:null}function im(e){return new nl(e,!0)}class ig{constructor(e,t,r=1e3,s=1.5,n=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=n,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&tu("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let ix="PersistentStream";class ib{constructor(e,t,r,s,n,i,a,o){this.Mi=e,this.S_=r,this.b_=s,this.connection=n,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ig(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===tb.RESOURCE_EXHAUSTED?(th(t.toString()),th("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===tb.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new ty(tb.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return tu(ix,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(tu(ix,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class iy extends ib{constructor(e,t,r,s,n,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,i),this.serializer=n}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var s,n;t.targetChange;let i="NO_CHANGE"===(s=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===s?1:"REMOVE"===s?2:"CURRENT"===s?3:"RESET"===s?4:tm(39313,{state:s}),a=t.targetChange.targetIds||[],o=(n=t.targetChange.resumeToken,e.useProto3Json?(tx(void 0===n||"string"==typeof n,58123),rs.fromBase64String(n||"")):(tx(void 0===n||n instanceof te.Buffer||n instanceof Uint8Array,16193),rs.fromUint8Array(n||new Uint8Array))),l=t.targetChange.cause;r=new ne(i,a,o,l&&new ty(void 0===l.code?tb.UNKNOWN:s0(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let s=t.documentChange;s.document,s.document.name,s.document.updateTime;let n=nx(e,s.document.name),i=nh(s.document.updateTime),a=s.document.createTime?nh(s.document.createTime):tX.min(),o=new rU({mapValue:{fields:s.document.fields}}),l=rz.newFoundDocument(n,i,a,o);r=new s9(s.targetIds||[],s.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let s=t.documentDelete;s.document;let n=nx(e,s.document),i=s.readTime?nh(s.readTime):tX.min(),a=rz.newNoDocument(n,i);r=new s9([],s.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let s=t.documentRemove;s.document;let n=nx(e,s.document);r=new s9([],s.removedTargetIds||[],n,null)}else{if(!("filter"in t))return tm(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:s=0,unchangedNames:n}=e,i=new sZ(s,n);r=new s7(e.targetId,i)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return tX.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?tX.min():t.readTime?nh(t.readTime):tX.min()}(e);return this.listener.H_(t,r)}Y_(e){let t,r={};r.database=ny(this.serializer),r.addTarget=function(e,t){var r,s;let n,i,a,o,l,c,d,u=t.target;if((n=r9(u)?{documents:{documents:[nb(e,u.path)]}}:{query:(a={structuredQuery:{}},o=u.path,null!==u.collectionGroup?(i=o,a.structuredQuery.from=[{collectionId:u.collectionGroup,allDescendants:!0}]):(i=o.popLast(),a.structuredQuery.from=[{collectionId:o.lastSegment()}]),a.parent=nb(e,i),(l=function(e){if(0!==e.length)return function e(t){var r;let s;return t instanceof rG?function(e){if("=="===e.op){if(rP(e.value))return{unaryFilter:{field:n_(e.field),op:"IS_NAN"}};if(rR(e.value))return{unaryFilter:{field:n_(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(rP(e.value))return{unaryFilter:{field:n_(e.field),op:"IS_NOT_NAN"}};if(rR(e.value))return{unaryFilter:{field:n_(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:n_(e.field),op:na[e.op],value:e.value}}}(t):t instanceof rW?1===(s=(r=t).getFilters().map(t=>e(t))).length?s[0]:{compositeFilter:{op:no[r.op],filters:s}}:tm(54877,{filter:t})}(rW.create(e,"and"))}(u.filters))&&(a.structuredQuery.where=l),(c=function(e){if(0!==e.length)return e.map(e=>({field:n_(e.field),direction:ni[e.dir]}))}(u.orderBy))&&(a.structuredQuery.orderBy=c),null!==(d=nc(e,u.limit))&&(a.structuredQuery.limit=d),u.startAt&&(a.structuredQuery.startAt={before:(r=u.startAt).inclusive,values:r.position}),u.endAt&&(a.structuredQuery.endAt={before:!(s=u.endAt).inclusive,values:s.position}),{ft:a,parent:i}).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=nu(e,t.resumeToken);let r=nc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(tX.min())>0){n.readTime=nd(e,t.snapshotVersion.toTimestamp());let r=nc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let s=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tm(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});s&&(r.labels=s),this.q_(r)}Z_(e){let t={};t.database=ny(this.serializer),t.removeTarget=e,this.q_(t)}}class iv extends ib{constructor(e,t,r,s,n,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,i),this.serializer=n}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return tx(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tx(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;tx(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let s=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(tx(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?nh(e.updateTime):nh(r)).isEqual(tX.min())&&(t=nh(r)),new sO(t,e.transformResults||[])})):[]),n=nh(e.commitTime);return this.listener.na(n,s)}ra(){let e={};e.database=ny(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var r,s;let n;if(t instanceof sq)n={update:nw(e,t.key,t.value)};else if(t instanceof sK)n={delete:ng(e,t.key)};else if(t instanceof sB){let r;n={update:nw(e,t.key,t.data),updateMask:(s=t.fieldMask,r=[],s.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof sX))return tm(16599,{Vt:t.type});n={verify:ng(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof sC)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof sE)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof sT)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof sM)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw tm(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:nd(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:tm(27497)),n})(this.serializer,e))};this.q_(t)}}class iw{}class i_ extends iw{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new ty(tb.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([n,i])=>this.connection.Go(e,nf(t,r),s,n,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tb.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ty(tb.UNKNOWN,e.toString())})}Ho(e,t,r,s,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Ho(e,nf(t,r),s,i,a,n)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tb.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ty(tb.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class iN{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(th(t),this.aa=!1):tu("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let ij="RemoteStore";class ik{constructor(e,t,r,s,n){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=n,this.Aa.Oo(e=>{r.enqueueAndForget(async()=>{iP(this)&&(tu(ij,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await iC(e),e.Ra.set("Unknown"),e.Ea.delete(4),await iS(e)}(this))})}),this.Ra=new iN(r,s)}}async function iS(e){if(iP(e))for(let t of e.da)await t(!0)}async function iC(e){for(let t of e.da)await t(!1)}function iE(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),iR(e)?iM(e):iY(e).O_()&&iT(e,t))}function iI(e,t){let r=iY(e);e.Ia.delete(t),r.O_()&&iA(e,t),0===e.Ia.size&&(r.O_()?r.L_():iP(e)&&e.Ra.set("Unknown"))}function iT(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(tX.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}iY(e).Y_(t)}function iA(e,t){e.Va.Ue(t),iY(e).Z_(t)}function iM(e){e.Va=new nr({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),iY(e).start(),e.Ra.ua()}function iR(e){return iP(e)&&!iY(e).x_()&&e.Ia.size>0}function iP(e){return 0===e.Ea.size}async function iD(e){e.Ra.set("Online")}async function iO(e){e.Ia.forEach((t,r)=>{iT(e,t)})}async function iL(e,t){e.Va=void 0,iR(e)?(e.Ra.ha(t),iM(e)):e.Ra.set("Unknown")}async function iF(e,t,r){if(e.Ra.set("Online"),t instanceof ne&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let s of t.targetIds)e.Ia.has(s)&&(await e.remoteSyncer.rejectListen(s,r),e.Ia.delete(s),e.Va.removeTarget(s))}(e,t)}catch(r){tu(ij,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await iU(e,r)}else if(t instanceof s9?e.Va.Ze(t):t instanceof s7?e.Va.st(t):e.Va.tt(t),!r.isEqual(tX.min()))try{let t,s=await n6(e.localStore);r.compareTo(s)>=0&&await ((t=e.Va.Tt(r)).targetChanges.forEach((t,s)=>{if(t.resumeToken.approximateByteSize()>0){let n=e.Ia.get(s);n&&e.Ia.set(s,n.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let s=e.Ia.get(t);if(!s)return;e.Ia.set(t,s.withResumeToken(rs.EMPTY_BYTE_STRING,s.snapshotVersion)),iA(e,t);let n=new nk(s.target,t,r,s.sequenceNumber);iT(e,n)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){tu(ij,"Failed to raise snapshot:",t),await iU(e,t)}}async function iU(e,t,r){if(!t0(t))throw t;e.Ea.add(1),await iC(e),e.Ra.set("Offline"),r||(r=()=>n6(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tu(ij,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await iS(e)})}function iz(e,t){return t().catch(r=>iU(e,r,t))}async function iV(e){var t;let r=iQ(e),s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;iP(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,s);if(null===t){0===e.Ta.length&&r.L_();break}s=t.batchId,function(e,t){e.Ta.push(t);let r=iQ(e);r.O_()&&r.X_&&r.ea(t.mutations)}(e,t)}catch(t){await iU(e,t)}i$(e)&&iq(e)}function i$(e){return iP(e)&&!iQ(e).x_()&&e.Ta.length>0}function iq(e){iQ(e).start()}async function iB(e){iQ(e).ra()}async function iH(e){let t=iQ(e);for(let r of e.Ta)t.ea(r.mutations)}async function iG(e,t,r){let s=e.Ta.shift(),n=sQ.from(s,t,r);await iz(e,()=>e.remoteSyncer.applySuccessfulWrite(n)),await iV(e)}async function iW(e,t){t&&iQ(e).X_&&await async function(e,t){var r;if(function(e){switch(e){case tb.OK:return tm(64938);case tb.CANCELLED:case tb.UNKNOWN:case tb.DEADLINE_EXCEEDED:case tb.RESOURCE_EXHAUSTED:case tb.INTERNAL:case tb.UNAVAILABLE:case tb.UNAUTHENTICATED:return!1;case tb.INVALID_ARGUMENT:case tb.NOT_FOUND:case tb.ALREADY_EXISTS:case tb.PERMISSION_DENIED:case tb.FAILED_PRECONDITION:case tb.ABORTED:case tb.OUT_OF_RANGE:case tb.UNIMPLEMENTED:case tb.DATA_LOSS:return!0;default:return tm(15467,{code:e})}}(r=t.code)&&r!==tb.ABORTED){let r=e.Ta.shift();iQ(e).B_(),await iz(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await iV(e)}}(e,t),i$(e)&&iq(e)}async function iK(e,t){e.asyncQueue.verifyOperationInProgress(),tu(ij,"RemoteStore received new credentials");let r=iP(e);e.Ea.add(3),await iC(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await iS(e)}async function iX(e,t){t?(e.Ea.delete(2),await iS(e)):t||(e.Ea.add(2),await iC(e),e.Ra.set("Unknown"))}function iY(e){var t,r,s;return e.ma||(t=e.datastore,r=e.asyncQueue,s={Xo:iD.bind(null,e),t_:iO.bind(null,e),r_:iL.bind(null,e),H_:iF.bind(null,e)},t.sa(),e.ma=new iy(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,s),e.da.push(async t=>{t?(e.ma.B_(),iR(e)?iM(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function iQ(e){var t,r,s;return e.fa||(t=e.datastore,r=e.asyncQueue,s={Xo:()=>Promise.resolve(),t_:iB.bind(null,e),r_:iW.bind(null,e),ta:iH.bind(null,e),na:iG.bind(null,e)},t.sa(),e.fa=new iv(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,s),e.da.push(async t=>{t?(e.fa.B_(),await iV(e)):(await e.fa.stop(),e.Ta.length>0&&(tu(ij,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class iJ{constructor(e,t,r,s,n){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=n,this.deferred=new tv,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,n){let i=new iJ(e,t,Date.now()+r,s,n);return i.start(r),i}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ty(tb.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function iZ(e,t){if(th("AsyncQueue",`${t}: ${e}`),t0(e))return new ty(tb.UNAVAILABLE,`${t}: ${e}`);throw e}class i0{static emptySet(e){return new i0(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||tU.comparator(t.key,r.key):(e,t)=>tU.comparator(e.key,t.key),this.keyedMap=sm(),this.sortedSet=new t6(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof i0)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,s=r.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new i0;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class i1{constructor(){this.ga=new t6(tU.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):tm(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class i2{constructor(e,t,r,s,n,i,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=n,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,s,n){let i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new i2(e,t,i0.emptySet(t),i,r,s,!0,!1,n)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&so(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class i5{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class i4{constructor(){this.queries=i3(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new ty(tb.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=i3(),t.forEach((t,r)=>{for(let t of r.Sa)t.onError(e)})}}function i3(){return new sh(e=>sl(e),so)}async function i6(e,t){let r=3,s=t.query,n=e.queries.get(s);n?!n.ba()&&t.Da()&&(r=2):(n=new i5,r=+!t.Da());try{switch(r){case 0:n.wa=await e.onListen(s,!0);break;case 1:n.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(r){let e=iZ(r,`Initialization of query '${sc(t.query)}' failed`);return void t.onError(e)}e.queries.set(s,n),n.Sa.push(t),t.va(e.onlineState),n.wa&&t.Fa(n.wa)&&ae(e)}async function i8(e,t){let r=t.query,s=3,n=e.queries.get(r);if(n){let e=n.Sa.indexOf(t);e>=0&&(n.Sa.splice(e,1),0===n.Sa.length?s=+!t.Da():!n.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function i9(e,t){let r=!1;for(let s of t){let t=s.query,n=e.queries.get(t);if(n){for(let e of n.Sa)e.Fa(s)&&(r=!0);n.wa=s}}r&&ae(e)}function i7(e,t,r){let s=e.queries.get(t);if(s)for(let e of s.Sa)e.onError(r);e.queries.delete(t)}function ae(e){e.Ca.forEach(e=>{e.next()})}(v=y||(y={})).Ma="default",v.Cache="cache";class at{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new i2(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=i2.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==y.Cache}}class ar{constructor(e){this.key=e}}class as{constructor(e){this.key=e}}class an{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=sv(),this.mutatedKeys=sv(),this.eu=su(e),this.tu=new i0(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new i1,s=t?t.tu:this.tu,n=t?t.mutatedKeys:this.mutatedKeys,i=s,a=!1,o="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,l="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((e,t)=>{let c=s.get(e),d=sd(this.query,t)?t:null,u=!!c&&this.mutatedKeys.has(c.key),h=!!d&&(d.hasLocalMutations||this.mutatedKeys.has(d.key)&&d.hasCommittedMutations),p=!1;c&&d?c.data.isEqual(d.data)?u!==h&&(r.track({type:3,doc:d}),p=!0):this.su(c,d)||(r.track({type:2,doc:d}),p=!0,(o&&this.eu(d,o)>0||l&&0>this.eu(d,l))&&(a=!0)):!c&&d?(r.track({type:0,doc:d}),p=!0):c&&!d&&(r.track({type:1,doc:c}),p=!0,(o||l)&&(a=!0)),p&&(d?(i=i.add(d),n=h?n.add(e):n.delete(e)):(i=i.delete(e),n=n.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){let e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),n=n.delete(e.key),r.track({type:1,doc:e})}return{tu:i,iu:r,Cs:a,mutatedKeys:n}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){let n=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let i=e.iu.ya();i.sort((e,t)=>{var r,s;let n;return r=e.type,s=t.type,(n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tm(20277,{Rt:e})}})(r)-n(s)||this.eu(e.doc,t.doc)}),this.ou(r),s=s??!1;let a=t&&!s?this._u():[],o=0===this.Xa.size&&this.current&&!s?1:0,l=o!==this.Za;return(this.Za=o,0!==i.length||l)?{snapshot:new i2(this.query,e.tu,n,i,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new i1,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=sv(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new as(e))}),this.Xa.forEach(r=>{e.has(r)||t.push(new ar(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=sv();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return i2.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let ai="SyncEngine";class aa{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class ao{constructor(e){this.key=e,this.hu=!1}}class al{constructor(e,t,r,s,n,i){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=n,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new sh(e=>sl(e),so),this.Iu=new Map,this.Eu=new Set,this.du=new t6(tU.comparator),this.Au=new Map,this.Ru=new nB,this.Vu={},this.mu=new Map,this.fu=nM.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function ac(e,t,r=!0){let s,n=aT(e),i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await au(n,t,r,!0),s}async function ad(e,t){let r=aT(e);await au(r,t,!0,!1)}async function au(e,t,r,s){var n,i;let a,o=await (n=e.localStore,i=sn(t),n.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return n.Pi.getTargetData(e,i).next(r=>r?(t=r,tZ.resolve(t)):n.Pi.allocateTargetId(e).next(r=>(t=new nk(i,r,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=n.Ms.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(i,e.targetId)),e})),l=o.targetId,c=e.sharedClientState.addLocalQueryTarget(l,r);return s&&(a=await ah(e,t,l,"current"===c,o.resumeToken)),e.isPrimaryClient&&r&&iE(e.remoteStore,o),a}async function ah(e,t,r,s,n){e.pu=(t,r,s)=>(async function(e,t,r,s){let n=t.view.ru(r);n.Cs&&(n=await n9(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,n)));let i=s&&s.targetChanges.get(t.targetId),a=s&&null!=s.targetMismatches.get(t.targetId),o=t.view.applyChanges(n,e.isPrimaryClient,i,a);return ak(e,t.targetId,o.au),o.snapshot})(e,t,r,s);let i=await n9(e.localStore,t,!0),a=new an(t,i.Qs),o=a.ru(i.documents),l=s8.createSynthesizedTargetChangeForCurrentChange(r,s&&"Offline"!==e.onlineState,n),c=a.applyChanges(o,e.isPrimaryClient,l);ak(e,r,c.au);let d=new aa(t,r,a);return e.Tu.set(t,d),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),c.snapshot}async function ap(e,t,r){let s=e.Tu.get(t),n=e.Iu.get(s.targetId);n.length>1?(e.Iu.set(s.targetId,n.filter(e=>!so(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(s.targetId),e.sharedClientState.isActiveQueryTarget(s.targetId)||await n8(e.localStore,s.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(s.targetId),r&&iI(e.remoteStore,s.targetId),aN(e,s.targetId)}).catch(tJ)):(aN(e,s.targetId),await n8(e.localStore,s.targetId,!0))}async function af(e,t){let r=e.Tu.get(t),s=e.Iu.get(r.targetId);e.isPrimaryClient&&1===s.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),iI(e.remoteStore,r.targetId))}async function am(e,t,r){var s,n,i;let a=((s=e).remoteStore.remoteSyncer.applySuccessfulWrite=ay.bind(null,s),s.remoteStore.remoteSyncer.rejectFailedWrite=av.bind(null,s),s);try{let e,s,o,l,c,d=await (n=a.localStore,o=tK.now(),l=t.reduce((e,t)=>e.add(t.key),sv()),n.persistence.runTransaction("Locally write mutations","readwrite",r=>{let i=sp,a=sv();return n.Ns.getEntries(r,l).next(e=>{(i=e).forEach((e,t)=>{t.isValidDocument()||(a=a.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(r,i)).next(s=>{e=s;let i=[];for(let r of t){let t=function(e,t){let r=null;for(let s of e.fieldTransforms){let e=t.data.field(s.field),n=sS(s.transform,e||null);null!=n&&(null===r&&(r=rU.empty()),r.set(s.field,n))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&i.push(new sB(r.key,t,function e(t){let r=[];return t4(t.fields,(t,s)=>{let n=new tF([t]);if(rD(s)){let t=e(s.mapValue).fields;if(0===t.length)r.push(n);else for(let e of t)r.push(n.child(e))}else r.push(n)}),new rt(r)}(t.value.mapValue),sL.exists(!0)))}return n.mutationQueue.addMutationBatch(r,o,i,t)}).next(t=>{s=t;let i=t.applyToLocalDocumentSet(e,a);return n.documentOverlayCache.saveOverlays(r,t.batchId,i)})}).then(()=>({batchId:s.batchId,changes:sg(e)})));a.sharedClientState.addPendingMutation(d.batchId),i=d.batchId,(c=a.Vu[a.currentUser.toKey()])||(c=new t6(tT)),c=c.insert(i,r),a.Vu[a.currentUser.toKey()]=c,await aC(a,d.changes),await iV(a.remoteStore)}catch(t){let e=iZ(t,"Failed to persist write");r.reject(e)}}async function ag(e,t){var r;try{let s,n,i=await (r=e.localStore,s=t.snapshotVersion,n=r.Ms,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{var i,a,o;let l,c,d=r.Ns.newChangeBuffer({trackRemovals:!0});n=r.Ms;let u=[];t.targetChanges.forEach((i,a)=>{var o;let l=n.get(a);if(!l)return;u.push(r.Pi.removeMatchingKeys(e,i.removedDocuments,a).next(()=>r.Pi.addMatchingKeys(e,i.addedDocuments,a)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?c=c.withResumeToken(rs.EMPTY_BYTE_STRING,tX.min()).withLastLimboFreeSnapshotVersion(tX.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,s)),n=n.insert(a,c),o=c,(0===l.resumeToken.approximateByteSize()||o.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size>0)&&u.push(r.Pi.updateTargetData(e,c))});let h=sp,p=sv();if(t.documentUpdates.forEach(s=>{t.resolvedLimboDocuments.has(s)&&u.push(r.persistence.referenceDelegate.updateLimboDocument(e,s))}),u.push((i=e,a=d,o=t.documentUpdates,l=sv(),c=sv(),o.forEach(e=>l=l.add(e)),a.getEntries(i,l).next(e=>{let t=sp;return o.forEach((r,s)=>{let n=e.get(r);s.isFoundDocument()!==n.isFoundDocument()&&(c=c.add(r)),s.isNoDocument()&&s.version.isEqual(tX.min())?(a.removeEntry(r,s.readTime),t=t.insert(r,s)):!n.isValidDocument()||s.version.compareTo(n.version)>0||0===s.version.compareTo(n.version)&&n.hasPendingWrites?(a.addEntry(s),t=t.insert(r,s)):tu(n5,"Ignoring outdated watch update for ",r,". Current version:",n.version," Watch version:",s.version)}),{ks:t,qs:c}})).next(e=>{h=e.ks,p=e.qs})),!s.isEqual(tX.min())){let t=r.Pi.getLastRemoteSnapshotVersion(e).next(t=>r.Pi.setTargetsMetadata(e,e.currentSequenceNumber,s));u.push(t)}return tZ.waitFor(u).next(()=>d.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,h,p)).next(()=>h)}).then(e=>(r.Ms=n,e)));t.targetChanges.forEach((t,r)=>{let s=e.Au.get(r);s&&(tx(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?s.hu=!0:t.modifiedDocuments.size>0?tx(s.hu,14607):t.removedDocuments.size>0&&(tx(s.hu,42227),s.hu=!1))}),await aC(e,i,t)}catch(e){await tJ(e)}}function ax(e,t,r){var s;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,n=[];e.Tu.forEach((e,r)=>{let s=r.view.va(t);s.snapshot&&n.push(s.snapshot)}),(s=e.eventManager).onlineState=t,r=!1,s.queries.forEach((e,s)=>{for(let e of s.Sa)e.va(t)&&(r=!0)}),r&&ae(s),n.length&&e.Pu.H_(n),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function ab(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let s=e.Au.get(t),n=s&&s.key;if(n){let r=new t6(tU.comparator);r=r.insert(n,rz.newNoDocument(n,tX.min()));let s=sv().add(n),i=new s6(tX.min(),new Map,new t6(tT),r,s);await ag(e,i),e.du=e.du.remove(n),e.Au.delete(t),aS(e)}else await n8(e.localStore,t,!1).then(()=>aN(e,t,r)).catch(tJ)}async function ay(e,t){var r;let s=t.batch.batchId;try{let n=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let s,n,i,a=t.batch.keys(),o=r.Ns.newChangeBuffer({trackRemovals:!0});return(n=(s=t.batch).keys(),i=tZ.resolve(),n.forEach(r=>{i=i.next(()=>o.getEntry(e,r)).next(e=>{let n=t.docVersions.get(r);tx(null!==n,48541),0>e.version.compareTo(n)&&(s.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),i.next(()=>r.mutationQueue.removeMutationBatch(e,s))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=sv();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));a_(e,s,null),aw(e,s),e.sharedClientState.updateMutationState(s,"acknowledged"),await aC(e,n)}catch(e){await tJ(e)}}async function av(e,t,r){var s;try{let n=await (s=e.localStore,s.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return s.mutationQueue.lookupMutationBatch(e,t).next(t=>(tx(null!==t,37113),r=t.keys(),s.mutationQueue.removeMutationBatch(e,t))).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>s.localDocuments.getDocuments(e,r))}));a_(e,t,r),aw(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await aC(e,n)}catch(e){await tJ(e)}}function aw(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function a_(e,t,r){let s=e.Vu[e.currentUser.toKey()];if(s){let n=s.get(t);n&&(r?n.reject(r):n.resolve(),s=s.remove(t)),e.Vu[e.currentUser.toKey()]=s}}function aN(e,t,r=null){for(let s of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(s),r&&e.Pu.yu(s,r);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||aj(e,t)})}function aj(e,t){e.Eu.delete(t.path.canonicalString());let r=e.du.get(t);null!==r&&(iI(e.remoteStore,r),e.du=e.du.remove(t),e.Au.delete(r),aS(e))}function ak(e,t,r){for(let s of r)s instanceof ar?(e.Ru.addReference(s.key,t),function(e,t){let r=t.key,s=r.path.canonicalString();e.du.get(r)||e.Eu.has(s)||(tu(ai,"New document in limbo: "+r),e.Eu.add(s),aS(e))}(e,s)):s instanceof as?(tu(ai,"Document no longer in limbo: "+s.key),e.Ru.removeReference(s.key,t),e.Ru.containsKey(s.key)||aj(e,s.key)):tm(19791,{wu:s})}function aS(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new tU(tO.fromString(t)),s=e.fu.next();e.Au.set(s,new ao(r)),e.du=e.du.insert(r,s),iE(e.remoteStore,new nk(sn(se(r.path)),s,"TargetPurposeLimboResolution",t1.ce))}}async function aC(e,t,r){let s=[],n=[],i=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{i.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let s=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,s?"current":"not-current")}if(t){s.push(t);let e=n0.As(o.targetId,t);n.push(e)}}))}),await Promise.all(i),e.Pu.H_(s),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>tZ.forEach(t,t=>tZ.forEach(t.Es,s=>e.persistence.referenceDelegate.addReference(r,t.targetId,s)).next(()=>tZ.forEach(t.ds,s=>e.persistence.referenceDelegate.removeReference(r,t.targetId,s)))))}catch(e){if(!t0(e))throw e;tu(n5,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.Ms.get(t),s=r.snapshotVersion,n=r.withLastLimboFreeSnapshotVersion(s);e.Ms=e.Ms.insert(t,n)}}}(e.localStore,n))}async function aE(e,t){if(!e.currentUser.isEqual(t)){tu(ai,"User change. New user:",t.toKey());let r=await n3(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new ty(tb.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await aC(e,r.Ls)}}function aI(e,t){let r=e.Au.get(t);if(r&&r.hu)return sv().add(r.key);{let r=sv(),s=e.Iu.get(t);if(!s)return r;for(let t of s){let s=e.Tu.get(t);r=r.unionWith(s.view.nu)}return r}}function aT(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=ag.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=aI.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ab.bind(null,e),e.Pu.H_=i9.bind(null,e.eventManager),e.Pu.yu=i7.bind(null,e.eventManager),e}class aA{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=im(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new n2,new n4(t,r,e.initialUser,this.serializer)}Cu(e){return new nY(nJ.mi,this.serializer)}Du(e){return new ie}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}aA.provider={build:()=>new aA};class aM extends aA{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return tx(this.persistence.referenceDelegate instanceof nZ,46915),new nO(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?nA.withCacheSize(this.cacheSizeBytes):nA.DEFAULT;return new nY(e=>nZ.mi(e,t),this.serializer)}}class aR{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ax(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=aE.bind(null,this.syncEngine),await iX(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new i4}createDatastore(e){var t;let r=im(e.databaseInfo.databaseId),s=new ih(e.databaseInfo);return t=e.authCredentials,new i_(t,e.appCheckCredentials,s,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new ik(t,r,e.asyncQueue,e=>ax(this.syncEngine,e,0),is.v()?new is:new it)}createSyncEngine(e,t){var r,s,n,i,a,o;let l;return r=this.localStore,s=this.remoteStore,n=this.eventManager,i=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new al(r,s,n,i,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){tu(ij,"RemoteStore shutting down."),e.Ea.add(5),await iC(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}aR.provider={build:()=>new aR};class aP{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):th("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}let aD="FirestoreClient";class aO{constructor(e,t,r,s,n){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=to.UNAUTHENTICATED,this.clientId=tI.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=n,this.authCredentials.start(r,async e=>{tu(aD,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(tu(aD,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tv;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=iZ(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function aL(e,t){e.asyncQueue.verifyOperationInProgress(),tu(aD,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let s=r.initialUser;e.setCredentialChangeListener(async e=>{s.isEqual(e)||(await n3(t.localStore,e),s=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function aF(e,t){e.asyncQueue.verifyOperationInProgress();let r=await aU(e);tu(aD,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>iK(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>iK(t.remoteStore,r)),e._onlineComponents=t}async function aU(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tu(aD,"Using user provided OfflineComponentProvider");try{await aL(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tb.FAILED_PRECONDITION||t.code===tb.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;tp("Error using user provided cache. Falling back to memory cache: "+t),await aL(e,new aA)}}else tu(aD,"Using default OfflineComponentProvider"),await aL(e,new aM(void 0));return e._offlineComponents}async function az(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tu(aD,"Using user provided OnlineComponentProvider"),await aF(e,e._uninitializedComponentsProvider._online)):(tu(aD,"Using default OnlineComponentProvider"),await aF(e,new aR))),e._onlineComponents}async function aV(e){let t=await az(e),r=t.eventManager;return r.onListen=ac.bind(null,t.syncEngine),r.onUnlisten=ap.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=ad.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=af.bind(null,t.syncEngine),r}function a$(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let aq=new Map,aB="firestore.googleapis.com";class aH{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new ty(tb.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=aB,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ty(tb.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,s){if(!0===t&&!0===s)throw new ty(tb.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=a$(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ty(tb.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ty(tb.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ty(tb.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class aG{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new aH({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ty(tb.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ty(tb.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new aH(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new t_;switch(e.type){case"firstParty":return new tS(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ty(tb.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=aq.get(this))&&(tu("ComponentProvider","Removing Datastore"),aq.delete(this),e.terminate()),Promise.resolve()}}class aW{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new aW(this.firestore,e,this._query)}}class aK{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new aX(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new aK(this.firestore,e,this._key)}toJSON(){return{type:aK._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(tW(t,aK._jsonSchema))return new aK(e,r||null,new tU(tO.fromString(t.referencePath)))}}aK._jsonSchemaVersion="firestore/documentReference/1.0",aK._jsonSchema={type:tG("string",aK._jsonSchemaVersion),referencePath:tG("string")};class aX extends aW{constructor(e,t,r){super(e,t,se(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new aK(this.firestore,null,new tU(e))}withConverter(e){return new aX(this.firestore,e,this._path)}}function aY(e,t,...r){if(e=ee(e),tz("collection","path",t),e instanceof aG){let s=tO.fromString(t,...r);return t$(s),new aX(e,null,s)}{if(!(e instanceof aK||e instanceof aX))throw new ty(tb.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let s=e._path.child(tO.fromString(t,...r));return t$(s),new aX(e.firestore,null,s)}}function aQ(e,t){if(e=tH(e,aG),tz("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new ty(tb.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new aW(e,null,new r7(tO.emptyPath(),t))}function aJ(e,t,...r){if(e=ee(e),1==arguments.length&&(t=tI.newId()),tz("doc","path",t),e instanceof aG){let s=tO.fromString(t,...r);return tV(s),new aK(e,null,new tU(s))}{if(!(e instanceof aK||e instanceof aX))throw new ty(tb.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let s=e._path.child(tO.fromString(t,...r));return tV(s),new aK(e.firestore,e instanceof aX?e.converter:null,new tU(s))}}let aZ="AsyncQueue";class a0{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ig(this,"async_queue_retry"),this._c=()=>{let e=ip();e&&tu(aZ,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=ip();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=ip();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new tv;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!t0(e))throw e;tu(aZ,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,th("INTERNAL UNHANDLED ERROR: ",a1(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let s=iJ.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(s),s}uc(){this.nc&&tm(47125,{Pc:a1(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function a1(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function a2(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class a5 extends aG{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new a0,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new a0(e),this._firestoreClient=void 0,await e}}}function a4(e){if(e._terminated)throw new ty(tb.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,s;let n,i=e._freezeSettings(),a=(t=e._databaseId,r=e._app?.options.appId||"",new rm(t,r,e._persistenceKey,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,a$(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator));e._componentsProvider||i.localCache?._offlineComponentProvider&&i.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new aO(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&(s=e._componentsProvider,n=s?._online.build(),{_offline:s?._offline.build(n),_online:n}))}(e),e._firestoreClient}class a3{constructor(e){this._byteString=e}static fromBase64String(e){try{return new a3(rs.fromBase64String(e))}catch(e){throw new ty(tb.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new a3(rs.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:a3._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(tW(e,a3._jsonSchema))return a3.fromBase64String(e.bytes)}}a3._jsonSchemaVersion="firestore/bytes/1.0",a3._jsonSchema={type:tG("string",a3._jsonSchemaVersion),bytes:tG("string")};class a6{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ty(tb.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tF(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class a8{constructor(e){this._methodName=e}}class a9{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ty(tb.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ty(tb.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return tT(this._lat,e._lat)||tT(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:a9._jsonSchemaVersion}}static fromJSON(e){if(tW(e,a9._jsonSchema))return new a9(e.latitude,e.longitude)}}a9._jsonSchemaVersion="firestore/geoPoint/1.0",a9._jsonSchema={type:tG("string",a9._jsonSchemaVersion),latitude:tG("number"),longitude:tG("number")};class a7{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:a7._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(tW(e,a7._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new a7(e.vectorValues);throw new ty(tb.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}a7._jsonSchemaVersion="firestore/vectorValue/1.0",a7._jsonSchema={type:tG("string",a7._jsonSchemaVersion),vectorValues:tG("object")};let oe=/^__.*__$/;class ot{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new sB(e,this.data,this.fieldMask,t,this.fieldTransforms):new sq(e,this.data,t,this.fieldTransforms)}}class or{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new sB(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function os(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tm(40011,{Ac:e})}}class on{constructor(e,t,r,s,n,i){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,void 0===n&&this.Rc(),this.fieldTransforms=n||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new on({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return o_(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(os(this.Ac)&&oe.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class oi{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||im(e)}Cc(e,t,r,s=!1){return new on({Ac:e,methodName:t,Dc:r,path:tF.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function oa(e){let t=e._freezeSettings(),r=im(e._databaseId);return new oi(e._databaseId,!!t.ignoreUndefinedProperties,r)}function oo(e,t,r,s,n,i={}){let a,o,l=e.Cc(i.merge||i.mergeFields?2:0,t,r,n);ob("Data must be an object, but it was:",l,s);let c=og(s,l);if(i.merge)a=new rt(l.fieldMask),o=l.fieldTransforms;else if(i.mergeFields){let e=[];for(let s of i.mergeFields){let n=oy(t,s,r);if(!l.contains(n))throw new ty(tb.INVALID_ARGUMENT,`Field '${n}' is specified in your field mask but missing from your input data.`);oN(e,n)||e.push(n)}a=new rt(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new ot(new rU(c),a,o)}class ol extends a8{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ol}}function oc(e,t,r){return new on({Ac:3,Dc:t.settings.Dc,methodName:e._methodName,fc:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class od extends a8{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=oc(this,e,!0),r=new sE(this.vc.map(e=>om(e,t)));return new sD(e.path,r)}isEqual(e){return e instanceof od&&W(this.vc,e.vc)}}class ou extends a8{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=oc(this,e,!0),r=new sT(this.vc.map(e=>om(e,t)));return new sD(e.path,r)}isEqual(e){return e instanceof ou&&W(this.vc,e.vc)}}class oh extends a8{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){let t=new sM(e.serializer,sj(e.serializer,this.Fc));return new sD(e.path,t)}isEqual(e){return e instanceof oh&&this.Fc===e.Fc}}function op(e,t,r,s){let n=e.Cc(1,t,r);ob("Data must be an object, but it was:",n,s);let i=[],a=rU.empty();return t4(s,(e,s)=>{let o=ow(t,e,r);s=ee(s);let l=n.yc(o);if(s instanceof ol)i.push(o);else{let e=om(s,l);null!=e&&(i.push(o),a.set(o,e))}}),new or(a,new rt(i),n.fieldTransforms)}function of(e,t,r,s,n,i){let a=e.Cc(1,t,r),o=[oy(t,s,r)],l=[n];if(i.length%2!=0)throw new ty(tb.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)o.push(oy(t,i[e])),l.push(i[e+1]);let c=[],d=rU.empty();for(let e=o.length-1;e>=0;--e)if(!oN(c,o[e])){let t=o[e],r=l[e];r=ee(r);let s=a.yc(t);if(r instanceof ol)c.push(t);else{let e=om(r,s);null!=e&&(c.push(t),d.set(t,e))}}return new or(d,new rt(c),a.fieldTransforms)}function om(e,t){if(ox(e=ee(e)))return ob("Unsupported field value:",t,e),og(e,t);if(e instanceof a8)return function(e,t){if(!os(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let r=[],s=0;for(let n of e){let e=om(n,t.wc(s));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),s++}return{arrayValue:{values:r}}}return function(e,t){if(null===(e=ee(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return sj(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=tK.fromDate(e);return{timestampValue:nd(t.serializer,r)}}if(e instanceof tK){let r=new tK(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:nd(t.serializer,r)}}if(e instanceof a9)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof a3)return{bytesValue:nu(t.serializer,e._byteString)};if(e instanceof aK){let r=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(r))throw t.Sc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:np(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof a7)return{mapValue:{fields:{[rb]:{stringValue:rw},[r_]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return s_(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${tB(e)}`)}(e,t)}function og(e,t){let r={};return t3(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):t4(e,(e,s)=>{let n=om(s,t.mc(e));null!=n&&(r[e]=n)}),{mapValue:{fields:r}}}function ox(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof tK||e instanceof a9||e instanceof a3||e instanceof aK||e instanceof a8||e instanceof a7)}function ob(e,t,r){if(!ox(r)||!tq(r)){let s=tB(r);throw"an object"===s?t.Sc(e+" a custom object"):t.Sc(e+" "+s)}}function oy(e,t,r){if((t=ee(t))instanceof a6)return t._internalPath;if("string"==typeof t)return ow(e,t);throw o_("Field path arguments must be of type string or ",e,!1,void 0,r)}let ov=RegExp("[~\\*/\\[\\]]");function ow(e,t,r){if(t.search(ov)>=0)throw o_(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new a6(...t.split("."))._internalPath}catch(s){throw o_(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function o_(e,t,r,s,n){let i=s&&!s.isEmpty(),a=void 0!==n,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${s}`),a&&(l+=` in document ${n}`),l+=")"),new ty(tb.INVALID_ARGUMENT,o+e+l)}function oN(e,t){return e.some(e=>e.isEqual(t))}class oj{constructor(e,t,r,s,n){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=n}get id(){return this._key.path.lastSegment()}get ref(){return new aK(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new ok(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(oS("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ok extends oj{data(){return super.data()}}function oS(e,t){return"string"==typeof t?ow(e,t):t instanceof a6?t._internalPath:t._delegate._internalPath}function oC(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ty(tb.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class oE{}class oI extends oE{}function oT(e,t,...r){let s=[];for(let n of(t instanceof oE&&s.push(t),function(e){let t=e.filter(e=>e instanceof oR).length,r=e.filter(e=>e instanceof oA).length;if(t>1||t>0&&r>0)throw new ty(tb.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s=s.concat(r)),s))e=n._apply(e);return e}class oA extends oI{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new oA(e,t,r)}_apply(e){let t=this._parse(e);return oL(e._query,t),new aW(e.firestore,e.converter,si(e._query,t))}_parse(e){let t=oa(e.firestore);return function(e,t,r,s,n,i,a){let o;if(n.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new ty(tb.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){oO(a,i);let t=[];for(let r of a)t.push(oD(s,e,r));o={arrayValue:{values:t}}}else o=oD(s,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||oO(a,i),o=function(e,t,r,s=!1){return om(r,e.Cc(s?4:3,t))}(r,t,a,"in"===i||"not-in"===i);return rG.create(n,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function oM(e,t,r){let s=oS("where",e);return oA._create(s,t,r)}class oR extends oE{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new oR(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:rW.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())oL(r,e),r=si(r,e)}(e._query,t),new aW(e.firestore,e.converter,si(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class oP extends oI{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new oP(e,t)}_apply(e){var t;let r,s=function(e,t,r){if(null!==e.startAt)throw new ty(tb.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ty(tb.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rB(t,r)}(e._query,this._field,this._direction);return new aW(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([s]),new r7(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function oD(e,t,r){if("string"==typeof(r=ee(r))){if(""===r)throw new ty(tb.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sr(t)&&-1!==r.indexOf("/"))throw new ty(tb.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let s=t.path.child(tO.fromString(r));if(!tU.isDocumentKey(s))throw new ty(tb.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return rT(e,new tU(s))}if(r instanceof aK)return rT(e,r._key);throw new ty(tb.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tB(r)}.`)}function oO(e,t){if(!Array.isArray(e)||0===e.length)throw new ty(tb.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function oL(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new ty(tb.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ty(tb.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}class oF{convertValue(e,t="none"){switch(rN(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ra(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ro(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tm(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return t4(e,(e,s)=>{r[e]=this.convertValue(s,t)}),r}convertVectorValue(e){return new a7(e.fields?.[r_].arrayValue?.values?.map(e=>ra(e.doubleValue)))}convertGeoPoint(e){return new a9(ra(e.latitude),ra(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=rp(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(rf(e));default:return null}}convertTimestamp(e){let t=ri(e);return new tK(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=tO.fromString(e);tx(nj(r),9688,{name:e});let s=new rx(r.get(1),r.get(3)),n=new tU(r.popFirst(5));return s.isEqual(t)||th(`Document ${n} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),n}}function oU(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class oz{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class oV extends oj{constructor(e,t,r,s,n,i){super(e,t,r,s,i),this._firestore=e,this._firestoreImpl=e,this.metadata=n}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new o$(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(oS("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ty(tb.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=oV._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}oV._jsonSchemaVersion="firestore/documentSnapshot/1.0",oV._jsonSchema={type:tG("string",oV._jsonSchemaVersion),bundleSource:tG("string","DocumentSnapshot"),bundleName:tG("string"),bundle:tG("string")};class o$ extends oV{data(e={}){return super.data(e)}}class oq{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new oz(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new o$(this._firestore,this._userDataWriter,r.key,r,new oz(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ty(tb.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let s=new o$(e._firestore,e._userDataWriter,r.doc.key,r.doc,new oz(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let s=new o$(e._firestore,e._userDataWriter,t.doc.key,t.doc,new oz(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),n=-1,i=-1;return 0!==t.type&&(n=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(i=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tm(61501,{type:e})}}(t.type),doc:s,oldIndex:n,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ty(tb.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=oq._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=tI.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],s=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),s.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function oB(e){e=tH(e,aK);let t=tH(e.firestore,a5);return(function(e,t,r={}){let s=new tv;return e.asyncQueue.enqueueAndForget(async()=>{var n,i;let a,o;return n=await aV(e),i=e.asyncQueue,a=new aP({next:e=>{a.Nu(),i.enqueueAndForget(()=>i8(n,o));let l=e.docs.has(t);!l&&e.fromCache?s.reject(new ty(tb.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?s.reject(new ty(tb.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(e)},error:e=>s.reject(e)}),i6(n,o=new at(se(t.path),a,{includeMetadataChanges:!0,qa:!0}))}),s.promise})(a4(t),e._key).then(r=>oZ(t,e,r))}oq._jsonSchemaVersion="firestore/querySnapshot/1.0",oq._jsonSchema={type:tG("string",oq._jsonSchemaVersion),bundleSource:tG("string","QuerySnapshot"),bundleName:tG("string"),bundle:tG("string")};class oH extends oF{constructor(e){super(),this.firestore=e}convertBytes(e){return new a3(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new aK(this.firestore,null,t)}}function oG(e){e=tH(e,aW);let t=tH(e.firestore,a5),r=a4(t),s=new oH(t);return oC(e._query),(function(e,t,r={}){let s=new tv;return e.asyncQueue.enqueueAndForget(async()=>{var n,i;let a,o;return n=await aV(e),i=e.asyncQueue,o=new at(t,a=new aP({next:e=>{a.Nu(),i.enqueueAndForget(()=>i8(n,o)),e.fromCache&&"server"===r.source?s.reject(new ty(tb.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(e)},error:e=>s.reject(e)}),{includeMetadataChanges:!0,qa:!0}),i6(n,o)}),s.promise})(r,e._query).then(r=>new oq(t,s,e,r))}function oW(e,t,r){e=tH(e,aK);let s=tH(e.firestore,a5),n=oU(e.converter,t,r);return oJ(s,[oo(oa(s),"setDoc",e._key,n,null!==e.converter,r).toMutation(e._key,sL.none())])}function oK(e,t,r,...s){e=tH(e,aK);let n=tH(e.firestore,a5),i=oa(n);return oJ(n,[("string"==typeof(t=ee(t))||t instanceof a6?of(i,"updateDoc",e._key,t,r,s):op(i,"updateDoc",e._key,t)).toMutation(e._key,sL.exists(!0))])}function oX(e){return oJ(tH(e.firestore,a5),[new sK(e._key,sL.none())])}function oY(e,t){let r=tH(e.firestore,a5),s=aJ(e),n=oU(e.converter,t);return oJ(r,[oo(oa(e.firestore),"addDoc",s._key,n,null!==e.converter,{}).toMutation(s._key,sL.exists(!1))]).then(()=>s)}function oQ(e,...t){var r;let s,n,i,a,o;e=ee(e);let l={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof t[0]||a2(t[c])||(l=t[c++]);let d={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(a2(t[c])){let e=t[c];t[c]=e.next?.bind(e),t[c+1]=e.error?.bind(e),t[c+2]=e.complete?.bind(e)}if(e instanceof aK)n=tH(e.firestore,a5),i=se(e._key.path),s={next:r=>{t[c]&&t[c](oZ(n,e,r))},error:t[c+1],complete:t[c+2]};else{let r=tH(e,aW);n=tH(r.firestore,a5),i=r._query;let a=new oH(n);s={next:e=>{t[c]&&t[c](new oq(n,a,r,e))},error:t[c+1],complete:t[c+2]},oC(e._query)}return r=a4(n),o=new at(i,a=new aP(s),d),r.asyncQueue.enqueueAndForget(async()=>i6(await aV(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>i8(await aV(r),o))}}function oJ(e,t){var r;let s;return r=a4(e),s=new tv,r.asyncQueue.enqueueAndForget(async()=>am(await az(r).then(e=>e.syncEngine),t,s)),s.promise}function oZ(e,t,r){let s=r.docs.get(t._key),n=new oH(e);return new oV(e,n,t._key,s,new oz(r.hasPendingWrites,r.fromCache),t.converter)}class o0{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=oa(e)}set(e,t,r){this._verifyNotCommitted();let s=o1(e,this._firestore),n=oU(s.converter,t,r),i=oo(this._dataReader,"WriteBatch.set",s._key,n,null!==s.converter,r);return this._mutations.push(i.toMutation(s._key,sL.none())),this}update(e,t,r,...s){let n;this._verifyNotCommitted();let i=o1(e,this._firestore);return n="string"==typeof(t=ee(t))||t instanceof a6?of(this._dataReader,"WriteBatch.update",i._key,t,r,s):op(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(n.toMutation(i._key,sL.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=o1(e,this._firestore);return this._mutations=this._mutations.concat(new sK(t._key,sL.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ty(tb.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function o1(e,t){if((e=ee(e)).firestore!==t)throw new ty(tb.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function o2(...e){return new od("arrayUnion",e)}function o5(...e){return new ou("arrayRemove",e)}function o4(e){return new oh("increment",e)}function o3(e){return a4(e=tH(e,a5)),new o0(e,t=>oJ(e,t))}function o6(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}new WeakMap,function(e=!0){tl=eH,eP(new et("firestore",(t,{instanceIdentifier:r,options:s})=>{let n=t.getProvider("app").getImmediate(),i=new a5(new tj(t.getProvider("auth-internal")),new tE(n,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ty(tb.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rx(e.options.projectId,t)}(n,r),n);return s={useFetchStreams:e,...s},i._setSettings(s),i},"PUBLIC").setMultipleInstances(!0)),eQ(ti,ta,void 0),eQ(ti,ta,"esm2020")}();let o8=new H("auth","Firebase",o6()),o9=new ed("@firebase/auth");function o7(e,...t){o9.logLevel<=a.ERROR&&o9.error(`Auth (${eH}): ${e}`,...t)}function le(e,...t){throw ln(e,...t)}function lt(e,...t){return ln(e,...t)}function lr(e,t,r){return new H("auth","Firebase",{...o6(),[t]:r}).create(t,{appName:e.name})}function ls(e){return lr(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ln(e,...t){if("string"!=typeof e){let r=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(r,...s)}return o8.create(e,...t)}function li(e,t,...r){if(!e)throw ln(t,...r)}function la(e){let t="INTERNAL ASSERTION FAILED: "+e;throw o7(t),Error(t)}function lo(){return"undefined"!=typeof self&&self.location?.href||""}function ll(){return"undefined"!=typeof self&&self.location?.protocol||null}class lc{constructor(e,t){var r;this.shortDelay=e,this.longDelay=t,r="Short delay should be less than long delay!",t>e||la(r),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){let e;return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===ll()||"https:"===ll()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ld(e,t){var r,s;r=e.emulator,s="Emulator should always be set here",r||la(s);let{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class lu{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void la("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void la("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void la("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let lh={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},lp=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],lf=new lc(3e4,6e4);function lm(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function lg(e,t,r,s,n={}){return lx(e,n,async()=>{let n={},i={};s&&("GET"===t?i=s:n={body:JSON.stringify(s)});let a=X({key:e.config.apiKey,...i}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:o,...n};return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&L(e.emulatorConfig.host)&&(l.credentials="include"),lu.fetch()(await ly(e,e.config.apiHost,r,a),l)})}async function lx(e,t,r){e._canInitEmulator=!1;let s={...lh,...t};try{let t=new lv(e),n=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let i=await n.json();if("needConfirmation"in i)throw lw(e,"account-exists-with-different-credential",i);if(n.ok&&!("errorMessage"in i))return i;{let[t,r]=(n.ok?i.errorMessage:i.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw lw(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===t)throw lw(e,"email-already-in-use",i);if("USER_DISABLED"===t)throw lw(e,"user-disabled",i);let a=s[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw lr(e,a,r);le(e,a)}}catch(t){if(t instanceof B)throw t;le(e,"network-request-failed",{message:String(t)})}}async function lb(e,t,r,s,n={}){let i=await lg(e,t,r,s,n);return"mfaPendingCredential"in i&&le(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function ly(e,t,r,s){let n=`${t}${r}?${s}`,i=e.config.emulator?ld(e.config,n):`${e.config.apiScheme}://${n}`;return lp.includes(r)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(i).toString():i}class lv{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(lt(this.auth,"network-request-failed")),lf.get())})}}function lw(e,t,r){let s={appName:e.name};r.email&&(s.email=r.email),r.phoneNumber&&(s.phoneNumber=r.phoneNumber);let n=lt(e,t,s);return n.customData._tokenResponse=r,n}function l_(e){return void 0!==e&&void 0!==e.enterprise}class lN{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function lj(e,t){return lg(e,"GET","/v2/recaptchaConfig",lm(e,t))}async function lk(e,t){return lg(e,"POST","/v1/accounts:delete",t)}async function lS(e,t){return lg(e,"POST","/v1/accounts:lookup",t)}function lC(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function lE(e,t=!1){let r=ee(e),s=await r.getIdToken(t),n=lT(s);li(n&&n.exp&&n.auth_time&&n.iat,r.auth,"internal-error");let i="object"==typeof n.firebase?n.firebase:void 0,a=i?.sign_in_provider;return{claims:n,token:s,authTime:lC(lI(n.auth_time)),issuedAtTime:lC(lI(n.iat)),expirationTime:lC(lI(n.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function lI(e){return 1e3*Number(e)}function lT(e){let[t,r,s]=e.split(".");if(void 0===t||void 0===r||void 0===s)return o7("JWT malformed, contained fewer than 3 sections"),null;try{let e=A(r);if(!e)return o7("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return o7("Caught error parsing JWT payload as JSON",e?.toString()),null}}function lA(e){let t=lT(e);return li(t,"internal-error"),li(void 0!==t.exp,"internal-error"),li(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function lM(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof B&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class lR{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class lP{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=lC(this.lastLoginAt),this.creationTime=lC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function lD(e){var t,r;let s=e.auth,n=await e.getIdToken(),i=await lM(e,lS(s,{idToken:n}));li(i?.users.length,s,"internal-error");let a=i.users[0];e._notifyReloadListener(a);let o=a.providerUserInfo?.length?lL(a.providerUserInfo):[],l=(t=e.providerData,r=o,[...t.filter(e=>!r.some(t=>t.providerId===e.providerId)),...r]),c=e.isAnonymous,d=!(e.email&&a.passwordHash)&&!l?.length;Object.assign(e,{uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new lP(a.createdAt,a.lastLoginAt),isAnonymous:!!c&&d})}async function lO(e){let t=ee(e);await lD(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function lL(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function lF(e,t){let r=await lx(e,{},async()=>{let r=X({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:n}=e.config,i=await ly(e,s,"/v1/token",`key=${n}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&L(e.emulatorConfig.host)&&(o.credentials="include"),lu.fetch()(i,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function lU(e,t){return lg(e,"POST","/v2/accounts:revokeToken",lm(e,t))}class lz{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){li(e.idToken,"internal-error"),li(void 0!==e.idToken,"internal-error"),li(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):lA(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){li(0!==e.length,"internal-error");let t=lA(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(li(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:s,expiresIn:n}=await lF(e,t);this.updateTokensAndExpiration(r,s,Number(n))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:s,expirationTime:n}=t,i=new lz;return r&&(li("string"==typeof r,"internal-error",{appName:e}),i.refreshToken=r),s&&(li("string"==typeof s,"internal-error",{appName:e}),i.accessToken=s),n&&(li("number"==typeof n,"internal-error",{appName:e}),i.expirationTime=n),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new lz,this.toJSON())}_performRefresh(){return la("not implemented")}}function lV(e,t){li("string"==typeof e||void 0===e,"internal-error",{appName:t})}class l${constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new lR(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new lP(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){let t=await lM(this,this.stsTokenManager.getToken(this.auth,e));return li(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return lE(this,e)}reload(){return lO(this)}_assign(e){this!==e&&(li(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new l$({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){li(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await lD(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(eU(this.auth.app))return Promise.reject(ls(this.auth));let e=await this.getIdToken();return await lM(this,lk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,s=t.email??void 0,n=t.phoneNumber??void 0,i=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:d,emailVerified:u,isAnonymous:h,providerData:p,stsTokenManager:f}=t;li(d&&f,e,"internal-error");let m=lz.fromJSON(this.name,f);li("string"==typeof d,e,"internal-error"),lV(r,e.name),lV(s,e.name),li("boolean"==typeof u,e,"internal-error"),li("boolean"==typeof h,e,"internal-error"),lV(n,e.name),lV(i,e.name),lV(a,e.name),lV(o,e.name),lV(l,e.name),lV(c,e.name);let g=new l$({uid:d,auth:e,email:s,emailVerified:u,displayName:r,isAnonymous:h,photoURL:i,phoneNumber:n,tenantId:a,stsTokenManager:m,createdAt:l,lastLoginAt:c});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,r=!1){let s=new lz;s.updateFromServerResponse(t);let n=new l$({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await lD(n),n}static async _fromGetAccountInfoResponse(e,t,r){let s=t.users[0];li(void 0!==s.localId,"internal-error");let n=void 0!==s.providerUserInfo?lL(s.providerUserInfo):[],i=!(s.email&&s.passwordHash)&&!n?.length,a=new lz;a.updateFromIdToken(r);let o=new l$({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:i});return Object.assign(o,{uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:n,metadata:new lP(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!n?.length}),o}}let lq=new Map;function lB(e){var t,r;t="Expected a class definition",e instanceof Function||la(t);let s=lq.get(e);return s?(r="Instance stored in cache mismatched with class",s instanceof e||la(r)):(s=new e,lq.set(e,s)),s}class lH{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function lG(e,t,r){return`firebase:${e}:${t}:${r}`}lH.type="NONE";class lW{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:n}=this.auth;this.fullUserKey=lG(this.userKey,s.apiKey,n),this.fullPersistenceKey=lG("persistence",s.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await lS(this.auth,{idToken:e}).catch(()=>void 0);return t?l$._fromGetAccountInfoResponse(this.auth,t,e):null}return l$._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new lW(lB(lH),e,r);let s=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),n=s[0]||lB(lH),i=lG(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(i);if(t){let s;if("string"==typeof t){let r=await lS(e,{idToken:t}).catch(()=>void 0);if(!r)break;s=await l$._fromGetAccountInfoResponse(e,r,t)}else s=l$._fromJSON(e,t);r!==n&&(a=s),n=r;break}}catch{}let o=s.filter(e=>e._shouldAllowMigration);return n._shouldAllowMigration&&o.length&&(n=o[0],a&&await n._set(i,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==n)try{await e._remove(i)}catch{}}))),new lW(n,e,r)}}function lK(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(lJ(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(lX(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(l0(t))return"Blackberry";if(l1(t))return"Webos";if(lY(t))return"Safari";if((t.includes("chrome/")||lQ(t))&&!t.includes("edge/"))return"Chrome";if(lZ(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(r?.length===2)return r[1]}return"Other"}function lX(e=$()){return/firefox\//i.test(e)}function lY(e=$()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function lQ(e=$()){return/crios\//i.test(e)}function lJ(e=$()){return/iemobile/i.test(e)}function lZ(e=$()){return/android/i.test(e)}function l0(e=$()){return/blackberry/i.test(e)}function l1(e=$()){return/webos/i.test(e)}function l2(e=$()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function l5(e=$()){return l2(e)||lZ(e)||l1(e)||l0(e)||/windows phone/i.test(e)||lJ(e)}function l4(e,t=[]){let r;switch(e){case"Browser":r=lK($());break;case"Worker":r=`${lK($())}-${e}`;break;default:r=e}let s=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${eH}/${s}`}class l3{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,s)=>{try{let s=e(t);r(s)}catch(e){s(e)}});r.onAbort=t,this.queue.push(r);let s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function l6(e,t={}){return lg(e,"GET","/v2/passwordPolicy",lm(e,t))}class l8{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,n){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=n))}}class l9{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new l7(this),this.idTokenSubscription=new l7(this),this.beforeStateQueue=new l3(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=o8,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=lB(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await lW.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await lS(this,{idToken:e}),r=await l$._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(eU(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,n=r?._redirectEventId,i=await this.tryRedirectSignIn(e);(!t||t===n)&&i?.user&&(r=i.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(li(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await lD(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(eU(this.app))return Promise.reject(ls(this));let t=e?ee(e):null;return t&&li(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&li(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return eU(this.app)?Promise.reject(ls(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return eU(this.app)?Promise.reject(ls(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(lB(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new l8(await l6(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new H("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await lU(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&lB(e)||this._popupRedirectResolver;li(t,this,"argument-error"),this.redirectPersistenceManager=await lW.create(this,[lB(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};let n="function"==typeof t?t:t.next.bind(t),i=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(li(a,this,"internal-error"),a.then(()=>{i||n(this.currentUser)}),"function"==typeof t){let n=e.addObserver(t,r,s);return()=>{i=!0,n()}}{let r=e.addObserver(t);return()=>{i=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return li(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=l4(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(eU(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){o9.logLevel<=a.WARN&&o9.warn(`Auth (${eH}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class l7{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let r=new J(e,void 0);return r.subscribe.bind(r)}(e=>this.observer=e)}get next(){return li(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ce={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ct(e){return`__${e}${Math.floor(1e6*Math.random())}`}class cr{constructor(){this.enterprise=new cs}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class cs{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let cn="NO_RECAPTCHA";class ci{constructor(e){this.type="recaptcha-enterprise",this.auth=ee(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{lj(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(s=>{if(void 0===s.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new lN(s);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function s(t,r,s){let n=window.grecaptcha;l_(n)?n.enterprise.ready(()=>{n.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(cn)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new cr().execute("siteKey",{action:"verify"}):new Promise((e,n)=>{r(this.auth).then(r=>{if(!t&&l_(window.grecaptcha))s(r,e,n);else{var i;if("undefined"==typeof window)return void n(Error("RecaptchaVerifier is only supported in browser"));let t=ce.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(i=t,ce.loadJS(i)).then(()=>{s(r,e,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})}}async function ca(e,t,r,s=!1,n=!1){let i,a=new ci(e);if(n)i=cn;else try{i=await a.verify(r)}catch(e){i=await a.verify(r,!0)}let o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:i,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:i,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return s?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function co(e,t,r,s,n){if("EMAIL_PASSWORD_PROVIDER"===n)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return s(e,t).catch(async n=>{if("auth/missing-recaptcha-token"!==n.code)return Promise.reject(n);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let n=await ca(e,t,r,"getOobCode"===r);return s(e,n)}});else{let n=await ca(e,t,r,"getOobCode"===r);return s(e,n)}if("PHONE_PROVIDER"!==n)return Promise.reject(n+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let n=await ca(e,t,r);return s(e,n).catch(async n=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===n.code||"auth/invalid-app-credential"===n.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let n=await ca(e,t,r,!1,!0);return s(e,n)}return Promise.reject(n)})}{let n=await ca(e,t,r,!1,!0);return s(e,n)}}async function cl(e){let t=ee(e),r=new lN(await lj(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new ci(t).verify()}function cc(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function cd(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class cu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return la("not implemented")}_getIdTokenResponse(e){return la("not implemented")}_linkToIdToken(e,t){return la("not implemented")}_getReauthenticationResolver(e){return la("not implemented")}}async function ch(e,t){return lg(e,"POST","/v1/accounts:signUp",t)}async function cp(e,t){return lb(e,"POST","/v1/accounts:signInWithPassword",lm(e,t))}async function cf(e,t){return lb(e,"POST","/v1/accounts:signInWithEmailLink",lm(e,t))}async function cm(e,t){return lb(e,"POST","/v1/accounts:signInWithEmailLink",lm(e,t))}class cg extends cu{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new cg(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new cg(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return co(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",cp,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return cf(e,{email:this._email,oobCode:this._password});default:le(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return co(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ch,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return cm(e,{idToken:t,email:this._email,oobCode:this._password});default:le(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function cx(e,t){return lb(e,"POST","/v1/accounts:signInWithIdp",lm(e,t))}class cb extends cu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new cb(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):le("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:r,...s}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;let n=new cb(t,r);return n.idToken=s.idToken||void 0,n.accessToken=s.accessToken||void 0,n.secret=s.secret,n.nonce=s.nonce,n.pendingToken=s.pendingToken||null,n}_getIdTokenResponse(e){return cx(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,cx(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,cx(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=X(t)}return e}}async function cy(e,t){return lg(e,"POST","/v1/accounts:sendVerificationCode",lm(e,t))}async function cv(e,t){return lb(e,"POST","/v1/accounts:signInWithPhoneNumber",lm(e,t))}async function cw(e,t){let r=await lb(e,"POST","/v1/accounts:signInWithPhoneNumber",lm(e,t));if(r.temporaryProof)throw lw(e,"account-exists-with-different-credential",r);return r}let c_={USER_NOT_FOUND:"user-not-found"};async function cN(e,t){return lb(e,"POST","/v1/accounts:signInWithPhoneNumber",lm(e,{...t,operation:"REAUTH"}),c_)}class cj extends cu{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new cj({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new cj({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return cv(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return cw(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return cN(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:n}=e;return r||t||s||n?new cj({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:n}):null}}class ck{constructor(e){const t=Y(Q(e)),r=t.apiKey??null,s=t.oobCode??null,n=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);li(r&&s&&n,"argument-error"),this.apiKey=r,this.operation=n,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,r,s,n=(r=(t=Y(Q(e)).link)?Y(Q(t)).deep_link_id:null,((s=Y(Q(e)).deep_link_id)?Y(Q(s)).link:null)||s||r||t||e);try{return new ck(n)}catch{return null}}}class cS{constructor(){this.providerId=cS.PROVIDER_ID}static credential(e,t){return cg._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=ck.parseLink(t);return li(r,"argument-error"),cg._fromEmailAndCode(e,r.code,r.tenantId)}}cS.PROVIDER_ID="password",cS.EMAIL_PASSWORD_SIGN_IN_METHOD="password",cS.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class cC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class cE extends cC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class cI extends cE{constructor(){super("facebook.com")}static credential(e){return cb._fromParams({providerId:cI.PROVIDER_ID,signInMethod:cI.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cI.credentialFromTaggedObject(e)}static credentialFromError(e){return cI.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return cI.credential(e.oauthAccessToken)}catch{return null}}}cI.FACEBOOK_SIGN_IN_METHOD="facebook.com",cI.PROVIDER_ID="facebook.com";class cT extends cE{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return cb._fromParams({providerId:cT.PROVIDER_ID,signInMethod:cT.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return cT.credentialFromTaggedObject(e)}static credentialFromError(e){return cT.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return cT.credential(t,r)}catch{return null}}}cT.GOOGLE_SIGN_IN_METHOD="google.com",cT.PROVIDER_ID="google.com";class cA extends cE{constructor(){super("github.com")}static credential(e){return cb._fromParams({providerId:cA.PROVIDER_ID,signInMethod:cA.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cA.credentialFromTaggedObject(e)}static credentialFromError(e){return cA.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return cA.credential(e.oauthAccessToken)}catch{return null}}}cA.GITHUB_SIGN_IN_METHOD="github.com",cA.PROVIDER_ID="github.com";class cM extends cE{constructor(){super("twitter.com")}static credential(e,t){return cb._fromParams({providerId:cM.PROVIDER_ID,signInMethod:cM.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return cM.credentialFromTaggedObject(e)}static credentialFromError(e){return cM.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return cM.credential(t,r)}catch{return null}}}async function cR(e,t){return lb(e,"POST","/v1/accounts:signUp",lm(e,t))}cM.TWITTER_SIGN_IN_METHOD="twitter.com",cM.PROVIDER_ID="twitter.com";class cP{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){return new cP({user:await l$._fromIdTokenResponse(e,r,s),providerId:cD(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new cP({user:e,providerId:cD(r),_tokenResponse:r,operationType:t})}}function cD(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class cO extends B{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,cO.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new cO(e,t,r,s)}}function cL(e,t,r,s){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw cO._fromErrorAndOperation(e,r,t,s);throw r})}async function cF(e,t,r=!1){let s=await lM(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return cP._forOperation(e,"link",s)}async function cU(e,t,r=!1){let{auth:s}=e;if(eU(s.app))return Promise.reject(ls(s));let n="reauthenticate";try{let i=await lM(e,cL(s,n,t,e),r);li(i.idToken,s,"internal-error");let a=lT(i.idToken);li(a,s,"internal-error");let{sub:o}=a;return li(e.uid===o,s,"user-mismatch"),cP._forOperation(e,n,i)}catch(e){throw e?.code==="auth/user-not-found"&&le(s,"user-mismatch"),e}}async function cz(e,t,r=!1){if(eU(e.app))return Promise.reject(ls(e));let s="signIn",n=await cL(e,s,t),i=await cP._fromIdTokenResponse(e,s,n);return r||await e._updateCurrentUser(i.user),i}async function cV(e,t){return cz(ee(e),t)}class c${constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?cq._fromServerResponse(e,t):"totpInfo"in t?cB._fromServerResponse(e,t):le(e,"internal-error")}}class cq extends c${constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new cq(t)}}class cB extends c${constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new cB(t)}}async function cH(e){let t=ee(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function cG(e,t,r){if(eU(e.app))return Promise.reject(ls(e));let s=ee(e),n=co(s,{returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",cR,"EMAIL_PASSWORD_PROVIDER"),i=await n.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&cH(e),t}),a=await cP._fromIdTokenResponse(s,"signIn",i);return await s._updateCurrentUser(a.user),a}async function cW(e,t){return lg(e,"POST","/v1/accounts:update",t)}async function cK(e,{displayName:t,photoURL:r}){if(void 0===t&&void 0===r)return;let s=ee(e),n=await s.getIdToken(),i=await lM(s,cW(s.auth,{idToken:n,displayName:t,photoUrl:r,returnSecureToken:!0}));s.displayName=i.displayName||null,s.photoURL=i.photoUrl||null;let a=s.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=s.displayName,a.photoURL=s.photoURL),await s._updateTokensIfNecessary(i)}function cX(e,t){return lg(e,"POST","/v2/accounts/mfaEnrollment:start",lm(e,t))}new WeakMap;let cY="__sak";class cQ{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(cY,"1"),this.storage.removeItem(cY),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class cJ extends cQ{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=l5(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){let r;if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});let s=e.key;t?this.detachListener():this.stopPolling();let n=()=>{let e=this.storage.getItem(s);(t||this.localCache[s]!==e)&&this.notifyListeners(s,e)},i=this.storage.getItem(s);((r=$()).indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0)&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}cJ.type="LOCAL";class cZ extends cQ{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}cZ.type="SESSION";class c0{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new c0(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:s}=e.data,n=this.handlersMap[r];if(!n?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let i=Array.from(n).map(async t=>t(e.origin,s)),a=await Promise.all(i.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function c1(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}c0.receivers=[];class c2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let s,n,i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=c1("",20);i.port1.start();let c=setTimeout(()=>{o(Error("unsupported_event"))},r);n={messageChannel:i,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(e.data.response);break;default:clearTimeout(c),clearTimeout(s),o(Error("invalid_response"))}}},this.handlers.add(n),i.port1.addEventListener("message",n.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{n&&this.removeMessageHandler(n)})}}function c5(){return window}function c4(){return void 0!==c5().WorkerGlobalScope&&"function"==typeof c5().importScripts}async function c3(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let c6="firebaseLocalStorageDb",c8="firebaseLocalStorage",c9="fbase_key";class c7{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function de(e,t){return e.transaction([c8],t?"readwrite":"readonly").objectStore(c8)}function dt(){let e=indexedDB.open(c6,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(c8,{keyPath:c9})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(c8)?t(r):(r.close(),await new c7(indexedDB.deleteDatabase(c6)).toPromise(),t(await dt()))})})}async function dr(e,t,r){return new c7(de(e,!0).put({[c9]:t,value:r})).toPromise()}async function ds(e,t){let r=de(e,!1).get(t),s=await new c7(r).toPromise();return void 0===s?null:s.value}function dn(e,t){return new c7(de(e,!0).delete(t)).toPromise()}class di{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await dt()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return c4()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=c0._getInstance(c4()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await c3(),!this.activeServiceWorker)return;this.sender=new c2(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await dt();return await dr(e,cY,"1"),await dn(e,cY),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>dr(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>ds(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>dn(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new c7(de(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:s,value:n}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(n)&&(this.notifyListeners(s,n),t.push(s));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function da(e,t){return lg(e,"POST","/v2/accounts/mfaSignIn:start",lm(e,t))}di.type="LOCAL",ct("rcb"),new lc(3e4,6e4);let dl="recaptcha";async function dc(e,t,r){if(!e._getRecaptchaConfig())try{await cl(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(s="string"==typeof t?{phoneNumber:t}:t,"session"in s){let t=s.session;if("phoneNumber"in s){li("enroll"===t.type,e,"internal-error");let n={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},i=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===cn){li(r?.type===dl,e,"argument-error");let s=await dd(e,t,r);return cX(e,s)}return cX(e,t)},a=co(e,n,"mfaSmsEnrollment",i,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{li("signin"===t.type,e,"internal-error");let n=s.multiFactorHint?.uid||s.multiFactorUid;li(n,e,"missing-multi-factor-info");let i={mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===cn){li(r?.type===dl,e,"argument-error");let s=await dd(e,t,r);return da(e,s)}return da(e,t)},o=co(e,i,"mfaSmsSignIn",a,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"},n=async(e,t)=>{if(t.captchaResponse===cn){li(r?.type===dl,e,"argument-error");let s=await dd(e,t,r);return cy(e,s)}return cy(e,t)},i=co(e,t,"sendVerificationCode",n,"PHONE_PROVIDER");return(await i.catch(e=>Promise.reject(e))).sessionInfo}}finally{r?._reset()}}async function dd(e,t,r){li(r.type===dl,e,"argument-error");let s=await r.verify();li("string"==typeof s,e,"argument-error");let n={...t};if("phoneEnrollmentInfo"in n){let e=n.phoneEnrollmentInfo.phoneNumber,t=n.phoneEnrollmentInfo.captchaResponse,r=n.phoneEnrollmentInfo.clientType,i=n.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(n,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:s,captchaResponse:t,clientType:r,recaptchaVersion:i}}),n}if(!("phoneSignInInfo"in n))return Object.assign(n,{recaptchaToken:s}),n;{let e=n.phoneSignInInfo.captchaResponse,t=n.phoneSignInInfo.clientType,r=n.phoneSignInInfo.recaptchaVersion;return Object.assign(n,{phoneSignInInfo:{recaptchaToken:s,captchaResponse:e,clientType:t,recaptchaVersion:r}}),n}}class du{constructor(e){this.providerId=du.PROVIDER_ID,this.auth=ee(e)}verifyPhoneNumber(e,t){return dc(this.auth,e,ee(t))}static credential(e,t){return cj._fromVerification(e,t)}static credentialFromResult(e){return du.credentialFromTaggedObject(e)}static credentialFromError(e){return du.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?cj._fromTokenResponse(t,r):null}}du.PROVIDER_ID="phone",du.PHONE_SIGN_IN_METHOD="phone";class dh extends cu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return cx(e,this._buildIdpRequest())}_linkToIdToken(e,t){return cx(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return cx(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function dp(e){return cz(e.auth,new dh(e),e.bypassAuthState)}function df(e){let{auth:t,user:r}=e;return li(r,t,"internal-error"),cU(r,new dh(e),e.bypassAuthState)}async function dm(e){let{auth:t,user:r}=e;return li(r,t,"internal-error"),cF(r,new dh(e),e.bypassAuthState)}class dg{constructor(e,t,r,s,n=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=n,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:s,tenantId:n,error:i,type:a}=e;if(i)return void this.reject(i);let o={auth:this.auth,requestUri:t,sessionId:r,tenantId:n||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return dp;case"linkViaPopup":case"linkViaRedirect":return dm;case"reauthViaPopup":case"reauthViaRedirect":return df;default:le(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||la(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||la(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let dx=new lc(2e3,1e4);class db extends dg{constructor(e,t,r,s,n){super(e,t,s,n),this.provider=r,this.authWindow=null,this.pollId=null,db.currentPopupAction&&db.currentPopupAction.cancel(),db.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return li(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||la(t);let r=c1();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(lt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(lt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,db.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(lt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,dx.get())};e()}}db.currentPopupAction=null;let dy=new Map;class dv extends dg{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=dy.get(this.auth._key());if(!e){try{let t=await dw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}dy.set(this.auth._key(),e)}return this.bypassAuthState||dy.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function dw(e,t){var r;let s=lG("pendingRedirect",(r=t).config.apiKey,r.name),n=lB(e._redirectPersistence);if(!await n._isAvailable())return!1;let i=await n._get(s)==="true";return await n._remove(s),i}function d_(e,t){dy.set(e._key(),t)}async function dN(e,t,r=!1){if(eU(e.app))return Promise.reject(ls(e));let s=ee(e),n=t?lB(t):(li(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver),i=new dv(s,n,r),a=await i.execute();return a&&!r&&(delete a.user._redirectEventId,await s._persistUserIfCurrent(a.user),await s._setRedirectUser(null,t)),a}class dj{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return dS(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!dS(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(lt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(dk(e))}saveEventToCache(e){this.cachedEventUids.add(dk(e)),this.lastProcessedEventTime=Date.now()}}function dk(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function dS({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function dC(e,t={}){return lg(e,"GET","/v1/projects",t)}let dE=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,dI=/^https?/;async function dT(e){if(e.config.emulator)return;let{authorizedDomains:t}=await dC(e);for(let e of t)try{if(function(e){let t=lo(),{protocol:r,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){let n=new URL(e);return""===n.hostname&&""===s?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&n.hostname===s}if(!dI.test(r))return!1;if(dE.test(e))return s===e;let n=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+n+"|"+n+")$","i").test(s)}(e))return}catch{}le(e,"unauthorized-domain")}let dA=new lc(3e4,6e4);function dM(){let e=c5().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let dR=null,dP=new lc(5e3,15e3),dD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},dO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function dL(e){let t,r,s,n,i,a=await (dR=dR||new Promise((t,r)=>{function s(){dM(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{dM(),r(lt(e,"network-request-failed"))},timeout:dA.get()})}if(c5().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(c5().gapi?.load)s();else{var n;let t=ct("iframefcb");return c5()[t]=()=>{gapi.load?s():r(lt(e,"network-request-failed"))},(n=`${ce.gapiScript}?onload=${t}`,ce.loadJS(n)).catch(e=>r(e))}}).catch(e=>{throw dR=null,e})),o=c5().gapi;return li(o,e,"internal-error"),a.open({where:document.body,url:(li((t=e.config).authDomain,e,"auth-domain-config-required"),r=t.emulator?ld(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:eH},(n=dO.get(e.config.apiHost))&&(s.eid=n),(i=e._getFrameworks()).length&&(s.fw=i.join(",")),`${r}?${X(s).slice(1)}`),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dD,dontclear:!0},t=>new Promise(async(r,s)=>{await t.restyle({setHideOnLeave:!1});let n=lt(e,"network-request-failed"),i=c5().setTimeout(()=>{s(n)},dP.get());function a(){c5().clearTimeout(i),r(t)}t.ping(a).then(a,()=>{s(n)})}))}let dF={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class dU{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let dz=encodeURIComponent("fac");async function dV(e,t,r,s,n,i){li(e.config.authDomain,e,"auth-domain-config-required"),li(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:s,v:eH,eventId:n};if(t instanceof cC)for(let[r,s]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(i||{})))a[r]=s;if(t instanceof cE){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${dz}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?ld(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${X(a).slice(1)}${l}`}let d$="webStorageSupport",dq=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=cZ,this._completeRedirectFn=dN,this._overrideRedirectResult=d_}async _openPopup(e,t,r,s){var n,i;n=this.eventManagers[e._key()]?.manager,i="_initialize() not called before _openPopup()",n||la(i);let a=await dV(e,t,r,lo(),s);return function(e,t,r,s=500,n=600){let i=Math.max((window.screen.availHeight-n)/2,0).toString(),a=Math.max((window.screen.availWidth-s)/2,0).toString(),o="",l={...dF,width:s.toString(),height:n.toString(),top:i,left:a},c=$().toLowerCase();r&&(o=lQ(c)?"_blank":r),lX(c)&&(t=t||"http://localhost",l.scrollbars="yes");let d=Object.entries(l).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=$()){return l2(e)&&!!window.navigator?.standalone}(c)&&"_self"!==o){var u,h;let e,r;return u=t||"",h=o,(e=document.createElement("a")).href=u,e.target=h,(r=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(r),new dU(null)}let p=window.open(t||"",o,d);li(p,e,"popup-blocked");try{p.focus()}catch(e){}return new dU(p)}(e,a,c1())}async _openRedirect(e,t,r,s){var n;return await this._originValidation(e),n=await dV(e,t,r,lo(),s),c5().location.href=n,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:s}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",s||la(r),s)}let s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){let t=await dL(e),r=new dj(e);return t.register("authEvent",t=>(li(t?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(d$,{type:d$},r=>{let s=r?.[0]?.[d$];void 0!==s&&t(!!s),le(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=dT(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return l5()||lY()||l2()}};var dB="@firebase/auth",dH="1.12.0";class dG{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){li(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let dW=D("authIdTokenMaxAge")||300,dK=null;ce={loadJS:e=>new Promise((t,r)=>{let s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{let t=lt("internal-error");t.customData=e,r(t)},s.type="text/javascript",s.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(s)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},i="Browser",eP(new et("auth",(e,{options:t})=>{let r,s,n=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:c}=n.options;li(l&&!l.includes(":"),"invalid-api-key",{appName:n.name});let d=new l9(n,a,o,{apiKey:l,authDomain:c,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:l4(i)});return s=(Array.isArray(r=t?.persistence||[])?r:[r]).map(lB),t?.errorMap&&d._updateErrorMap(t.errorMap),d._initializeWithPersistence(s,t?.popupRedirectResolver),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),eP(new et("auth-internal",e=>new dG(ee(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),eQ(dB,dH,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(i)),eQ(dB,dH,"esm2020"),e.s([],58556),e.i(58556);let dX=eG({apiKey:"AIzaSyAev7tjPU3bdWlLYLwG8o3Day4az_8CPxc",authDomain:"swtor-map.firebaseapp.com",projectId:"swtor-map",storageBucket:"swtor-map.firebasestorage.app",messagingSenderId:"12987942242",appId:"1:12987942242:web:56b1154bb962404cf1983b"}),dY=function(e,t){let r=eD("object"==typeof e?e:eK(),"firestore").getImmediate({identifier:"string"==typeof e?e:rg});if(!r._initialized){let e=(e=>{let t=R(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let s=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),s]:[t.substring(0,r),s]})("firestore");e&&function(e,t,r,s={}){e=tH(e,aG);let n=L(t),i=e._getSettings(),a={...i,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;n&&(F(`https://${o}`),V("Firestore",!0)),i.host!==aB&&i.host!==o&&tp("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...i,host:o,ssl:n,emulatorOptions:s};if(!W(l,a)&&(e._setSettings(l),s.mockUserToken)){let t,r;if("string"==typeof s.mockUserToken)t=s.mockUserToken,r=to.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",s=e.iat||0,n=e.sub||e.user_id;if(!n)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let i={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:n,user_id:n,firebase:{sign_in_provider:"custom",identities:{}},...e};return[T(JSON.stringify({alg:"none",type:"JWT"})),T(JSON.stringify(i)),""].join(".")}(s.mockUserToken,e._app?.options.projectId);let n=s.mockUserToken.sub||s.mockUserToken.user_id;if(!n)throw new ty(tb.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new to(n)}e._authCredentials=new tN(new tw(t,r))}}(r,...e)}return r}(dX),dQ=function(e=eK()){let t=eD(e,"auth");if(t.isInitialized())return t.getImmediate();let r=function(e,t){let r=eD(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(W(r.getOptions(),t??{}))return e;le(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:dq,persistence:[di,cJ,cZ]}),s=D("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(s,location.origin);if(location.origin===e.origin){let t,s=(t=e.toString(),async e=>{let r=e&&await e.getIdTokenResult(),s=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(s&&s>dW)return;let n=r?.token;dK!==n&&(dK=n,await fetch(t,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))});ee(r).beforeAuthStateChanged(s,()=>s(r.currentUser)),ee(r).onIdTokenChanged(e=>s(e),void 0,void 0)}}let n=R("auth");return n&&function(e,t,r){let s=ee(e);li(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");let n=cc(t),{host:i,port:a}=function(e){let t=cc(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let s=r[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(s);if(n){let e=n[1];return{host:e,port:cd(s.substr(e.length+1))}}{let[e,t]=s.split(":");return{host:e,port:cd(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${n}//${i}${o}/`},c=Object.freeze({host:i,port:a,protocol:n.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!s._canInitEmulator){li(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),li(W(l,s.config.emulator)&&W(c,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=l,s.emulatorConfig=c,s.settings.appVerificationDisabledForTesting=!0,L(i)?(F(`${n}//${i}${o}`),V("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${n}`),r}(dX);function dJ({userFaction:e,onClose:t}){let[r,s]=(0,N.useState)("list"),[n,i]=(0,N.useState)([]),[a,o]=(0,N.useState)(null),[l,c]=(0,N.useState)({}),[d,u]=(0,N.useState)(null),[h,p]=(0,N.useState)([]),[f,m]=(0,N.useState)([]),[g,x]=(0,N.useState)(!1);(0,N.useEffect)(()=>{e&&(async()=>{try{let t=(await oG(aY(dY,"factions"))).docs.map(e=>({id:e.id,...e.data()}));t.sort((e,t)=>(t.credits||0)+(t.manpower||0)-((e.credits||0)+(e.manpower||0)));let r=t.map((e,t)=>({...e,rank:t+1}));u(r.find(t=>t.id===e)||{}),i(r.filter(t=>t.id!==e&&"neutral"!==t.id));let s=oQ(aY(dY,`factions/${e}/diplomacy`),e=>{let t={};e.forEach(e=>t[e.id]=e.data()),c(t)}),n=oT(aY(dY,"diplomacy_requests"),oM("targetId","==",e)),a=oQ(n,e=>p(e.docs.map(e=>({id:e.id,...e.data()})))),o=oT(aY(dY,"diplomacy_requests"),oM("senderId","==",e)),l=oQ(o,e=>m(e.docs.map(e=>({id:e.id,...e.data()}))));return()=>{s(),a(),l()}}catch(e){console.error(e)}})()},[e]);let b=e=>l[e]?.score||0,y=e=>l[e]?.status||"neutral",v=async(t,r,s=null)=>{if(!t)return;let n=b(t),i=y(t),a=Math.max(-100,Math.min(100,n+r)),o=s||i;!s&&a<=-100&&(o="war");let l={score:a,status:o};try{await oW(aJ(dY,`factions/${e}/diplomacy`,t),l),await oW(aJ(dY,`factions/${t}/diplomacy`,e),l)}catch(e){console.error(e)}},_=async t=>{if(a?.id){if(f.find(e=>e.targetId===a.id&&e.type===t))return alert("Une demande similaire est dj en attente.");if(confirm("peace"===t?`Proposer un TRAIT\xc9 DE PAIX ?`:`Envoyer une proposition de ${"trade"===t?"Commerce":"Alliance"} ?`)){x(!0);try{await oY(aY(dY,"diplomacy_requests"),{senderId:e,senderName:d.name,targetId:a.id,type:t,createdAt:new Date}),alert("Proposition envoye.")}catch(e){console.error(e)}x(!1)}}},j=async(t,r)=>{if(confirm(r?"Accepter la proposition ?":"Refuser la proposition ?"))try{r&&("peace"===t.type?(await oW(aJ(dY,`factions/${e}/diplomacy`,t.senderId),{score:-40,status:"neutral"}),await oW(aJ(dY,`factions/${t.senderId}/diplomacy`,e),{score:-40,status:"neutral"}),alert("La paix est signe !")):(await v(t.senderId,15,t.type),alert(`Accord accept\xe9 !`))),await oX(aJ(dY,"diplomacy_requests",t.id))}catch(e){console.error(e)}},k=async t=>{if(a?.id){x(!0);try{"gift"===t?500>(d?.credits||0)?alert("Pas assez de crdits."):(await oK(aJ(dY,"factions",e),{credits:o4(-500)}),await oK(aJ(dY,"factions",a.id),{credits:o4(500)}),await v(a.id,15)):"war"===t?confirm("DCLARATION DE GUERRE : tes-vous sr ?")&&await v(a.id,-100,"war"):"break_treaty"===t&&confirm("Rompre cet accord entachera notre rputation. Continuer ?")&&await v(a.id,-50,"neutral")}catch(e){console.error(e)}x(!1)}},S=e=>e>=50?"text-green-400":e>=0?"text-yellow-400":"text-red-500",C=({faction:e,isMe:t})=>{if(!e)return(0,w.jsx)("div",{className:"w-80 opacity-0"});let r=t?0:b(e.id),s=t?"neutral":y(e.id),n=e.color||"#cba660",i=((e,t,r,s)=>{if(r)return"Notre glorieuse faction domine la galaxie.";let n=s?.diplomatic_phrases||{};return"war"===t?n.war?`"${n.war}"`:e<-80?'"Votre destruction est invitable."':'"Nos flottes sont en route."':"alliance"===t?n.alliance?`"${n.alliance}"`:'"Nos destins sont lis par le sang et l\'acier."':"trade"===t?'"Le commerce est florissant entre nos peuples."':e>=50?n.neutral_good?`"${n.neutral_good}"`:'"Vos vaisseaux sont toujours les bienvenus dans notre secteur."':e<=-50?n.neutral_bad?`"${n.neutral_bad}"`:'"La mfiance est de mise. Gardez vos distances."':"\"Nous n'avons aucune querelle avec vous... pour l'instant.\""})(r,s,t,e),a="war"===s||r<-20?"text-red-400":"alliance"===s||r>=50?"text-green-400":r>=20?"text-[#cba660]":"text-gray-400";return(0,w.jsxs)("div",{className:`w-80 flex flex-col ${t?"items-start":"items-end"} pointer-events-auto transition-all`,children:[(0,w.jsxs)("div",{className:"relative z-10 mb-[-20px] mx-4",children:[(0,w.jsxs)("div",{className:"w-40 h-40 rounded-full border-4 bg-gray-900 shadow-[0_0_20px_black] flex items-center justify-center relative overflow-hidden group",style:{borderColor:n},children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-white/10 to-transparent pointer-events-none z-20"}),e.image?(0,w.jsx)("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}):(0,w.jsx)("div",{className:"text-6xl",style:{color:e.color},children:""})]}),(0,w.jsx)("div",{className:"absolute -bottom-4 left-1/2 -translate-x-1/2 bg-black/90 border border-[#cba660] px-4 py-1 whitespace-nowrap min-w-[120px] text-center shadow-lg z-30",children:(0,w.jsx)("div",{className:"text-[#cba660] font-serif font-bold uppercase text-sm tracking-widest",children:e.name})})]}),(0,w.jsxs)("div",{className:"w-full bg-[#0f1115] border-2 border-[#cba660] pt-10 pb-4 px-4 shadow-2xl relative mt-4",children:[(0,w.jsx)("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#cba660]"}),(0,w.jsx)("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#cba660]"}),(0,w.jsxs)("div",{className:"space-y-3 font-serif text-gray-300",children:[(0,w.jsxs)("div",{className:"flex justify-between border-b border-gray-700 pb-1",children:[(0,w.jsx)("span",{className:"text-xs uppercase text-[#8a6d3b]",children:"Rang de force"}),(0,w.jsx)("span",{className:"font-bold text-white",children:e.rank})]}),t&&(0,w.jsxs)("div",{className:"flex justify-between border-b border-gray-700 pb-1",children:[(0,w.jsx)("span",{className:"text-xs uppercase text-[#8a6d3b]",children:"Trsorerie"}),(0,w.jsxs)("span",{className:"font-bold text-yellow-500",children:[e.credits?.toLocaleString()," CR"]})]}),(0,w.jsx)("div",{className:"pt-2 text-center border-t border-gray-800 mt-2 min-h-[30px] flex items-center justify-center",children:(0,w.jsx)("p",{className:`text-[11px] italic font-serif leading-tight ${t?"text-gray-500":a}`,children:i})})]})]})]})};return(0,w.jsxs)("div",{className:"fixed inset-0 z-[100] flex flex-col justify-between p-6 pointer-events-none font-sans",children:[(0,w.jsxs)("div",{className:"pointer-events-auto self-center bg-[#0f1115] border-x-2 border-b-2 border-[#cba660] px-12 py-2 shadow-lg relative flex gap-4",children:[(0,w.jsx)("button",{onClick:()=>s("list"),className:`text-[#cba660] font-serif text-xl font-bold uppercase tracking-[0.1em] hover:text-white ${"list"===r?"underline decoration-2 underline-offset-4":"opacity-70"}`,children:"Diplomatie"}),(0,w.jsx)("div",{className:"w-px bg-[#cba660]/50 h-6 self-center"}),(0,w.jsxs)("button",{onClick:()=>s("requests"),className:`text-[#cba660] font-serif text-xl font-bold uppercase tracking-[0.1em] hover:text-white relative ${"requests"===r?"underline decoration-2 underline-offset-4":"opacity-70"}`,children:["Requtes",h.length>0&&(0,w.jsx)("span",{className:"absolute -top-2 -right-3 bg-red-600 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full animate-pulse",children:h.length})]}),(0,w.jsx)("button",{onClick:t,className:"absolute right-[-40px] top-0 bg-red-900 text-white w-8 h-8 flex items-center justify-center border border-red-500 hover:bg-red-700 font-sans",children:"X"})]}),(0,w.jsx)("div",{className:"flex-grow flex justify-between items-center px-10 mt-10",children:"list"===r?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(C,{faction:d,isMe:!0}),(0,w.jsx)("div",{className:"flex-grow"}),(0,w.jsx)(C,{faction:a,isMe:!1})]}):(0,w.jsxs)("div",{className:"w-full max-w-2xl mx-auto h-[60vh] bg-[#0f1115] border-2 border-[#cba660] p-6 pointer-events-auto overflow-y-auto relative shadow-2xl",children:[(0,w.jsx)("h2",{className:"text-[#cba660] font-serif text-2xl font-bold uppercase text-center mb-6 border-b border-[#cba660]/30 pb-4",children:"Missives Diplomatiques"}),0===h.length?(0,w.jsx)("div",{className:"text-center text-gray-500 italic",children:"Aucune requte en attente."}):(0,w.jsx)("div",{className:"space-y-4",children:h.map(e=>(0,w.jsxs)("div",{className:"bg-[#1a1d23] border border-gray-600 p-4 flex justify-between items-center hover:border-[#cba660] transition",children:[(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[(0,w.jsx)("div",{className:"text-3xl",children:"war"===e.type?"":"peace"===e.type?"":""}),(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{className:"text-[#cba660] font-bold uppercase text-sm",children:"trade"===e.type?"Accord Commercial":"alliance"===e.type?"Alliance Militaire":"peace"===e.type?"Trait de Paix":"Proposition"}),(0,w.jsxs)("div",{className:"text-gray-400 text-xs",children:["missaire : ",(0,w.jsx)("span",{className:"text-white font-bold",children:e.senderName})]})]})]}),(0,w.jsxs)("div",{className:"flex gap-2",children:[(0,w.jsx)("button",{onClick:()=>j(e,!0),className:"bg-green-900/50 border border-green-600 hover:bg-green-800 text-green-100 px-4 py-1 text-xs uppercase font-bold rounded",children:"Accepter"}),(0,w.jsx)("button",{onClick:()=>j(e,!1),className:"bg-red-900/50 border border-red-600 hover:bg-red-800 text-red-100 px-4 py-1 text-xs uppercase font-bold rounded",children:"Refuser"})]})]},e.id))})]})}),"list"===r&&(0,w.jsxs)("div",{className:"pointer-events-auto self-center w-3/4 h-1/3 bg-[#0f1115] border-2 border-[#cba660] flex shadow-[0_-10px_40px_black] relative mt-4",children:[(0,w.jsxs)("div",{className:`${a?"w-1/2":"w-full"} flex flex-col border-r border-[#cba660]/30 transition-all duration-300`,children:[(0,w.jsxs)("div",{className:"flex items-center bg-[#1a1d23] border-b border-[#cba660] px-4 py-2 text-[#cba660] text-[10px] font-bold uppercase tracking-widest",children:[(0,w.jsx)("div",{className:"w-12 text-center",children:"Rang"}),(0,w.jsx)("div",{className:"flex-grow pl-4",children:"Faction"}),(0,w.jsx)("div",{className:"w-24 text-center",children:"Attitude"}),(0,w.jsx)("div",{className:"w-16 text-center",children:"Statut"})]}),(0,w.jsx)("div",{className:"overflow-y-auto custom-scrollbar flex-grow p-1",children:n.map(e=>{let t=b(e.id),r=y(e.id),s=a?.id===e.id;return(0,w.jsxs)("div",{onClick:()=>o(e),className:`flex items-center p-2 border-b border-gray-800 cursor-pointer transition-colors hover:bg-white/5 ${s?"bg-[#cba660]/20 border-[#cba660]":""}`,children:[(0,w.jsx)("div",{className:"w-12 text-center font-mono text-gray-500 text-xs",children:e.rank}),(0,w.jsxs)("div",{className:"flex-grow pl-4 flex items-center gap-3",children:[e.image?(0,w.jsx)("img",{src:e.image,alt:e.name,className:"w-6 h-6 rounded-full border border-gray-500 object-cover bg-black"}):(0,w.jsx)("div",{className:"w-6 h-6 rounded-full border border-gray-500",style:{backgroundColor:e.color}}),(0,w.jsx)("span",{className:`text-sm font-serif font-bold ${s?"text-[#cba660]":"text-gray-300"}`,children:e.name})]}),(0,w.jsx)("div",{className:`w-24 text-center text-xs font-bold ${S(t)}`,children:t}),(0,w.jsx)("div",{className:"w-16 text-center text-lg",children:(e=>{switch(e){case"war":return"";case"alliance":return"";case"trade":return"";default:return""}})(r)})]},e.id)})})]}),a&&(0,w.jsxs)("div",{className:"w-1/2 flex flex-col bg-[#15171c] animate-in fade-in slide-in-from-right-10 duration-300",children:[(0,w.jsxs)("div",{className:"bg-[#1f2229] p-2 border-b border-[#cba660] flex items-center justify-between px-4",children:[(0,w.jsxs)("span",{className:"text-[#cba660] text-xs uppercase font-bold tracking-widest",children:["Ngociations avec ",a.name]}),(0,w.jsxs)("div",{className:"text-xs text-gray-400",children:["Relation: ",(0,w.jsx)("span",{className:S(b(a.id)),children:b(a.id)})]})]}),(0,w.jsxs)("div",{className:"flex-grow p-4 grid grid-cols-2 gap-3 overflow-y-auto content-start",children:["trade"===y(a.id)?(0,w.jsx)(dZ,{label:"Rompre Commerce",sub:"Pnalit relation",icon:"",onClick:()=>k("break_treaty"),isDestructive:!0,disabled:g}):(0,w.jsx)(dZ,{label:"Accord Commercial",sub:"Proposition",icon:"",onClick:()=>_("trade"),disabled:g||"war"===y(a.id)||20>b(a.id)||f.some(e=>e.targetId===a.id&&"trade"===e.type),pending:f.some(e=>e.targetId===a.id&&"trade"===e.type)}),"alliance"===y(a.id)?(0,w.jsx)(dZ,{label:"Rompre Alliance",sub:"Grosse pnalit",icon:"",onClick:()=>k("break_treaty"),isDestructive:!0,disabled:g}):(0,w.jsx)(dZ,{label:"Alliance Militaire",sub:"Proposition",icon:"",onClick:()=>_("alliance"),disabled:g||"war"===y(a.id)||80>b(a.id)||f.some(e=>e.targetId===a.id&&"alliance"===e.type),pending:f.some(e=>e.targetId===a.id&&"alliance"===e.type)}),(0,w.jsx)(dZ,{label:"Cadeau d'tat",sub:"500 Crdits (+15)",icon:"",onClick:()=>k("gift"),disabled:g||"war"===y(a.id)}),"war"===y(a.id)?(0,w.jsx)(dZ,{label:"Ngocier Paix",sub:"Proposition d'arrt",icon:"",onClick:()=>_("peace"),disabled:g||f.some(e=>e.targetId===a.id&&"peace"===e.type),pending:f.some(e=>e.targetId===a.id&&"peace"===e.type)}):(0,w.jsx)(dZ,{label:"Dclarer Guerre",sub:"Romp tout accord",icon:"",isDestructive:!0,onClick:()=>k("war"),disabled:g})]})]})]})]})}function dZ(e){let t,r,s,n,i,a,o=(0,_.c)(19),{label:l,sub:c,icon:d,onClick:u,disabled:h,isDestructive:p,pending:f}=e,m=`flex flex-col justify-center p-3 border border-l-4 transition-all h-20 text-left relative overflow-hidden group
                ${p?"border-red-900 bg-red-950/20 border-l-red-600 hover:bg-red-900/40":f?"border-yellow-600 bg-yellow-900/10 border-l-yellow-600 opacity-80 cursor-wait":"border-gray-700 bg-[#1f2229] border-l-gray-500 hover:border-[#cba660] hover:border-l-[#cba660] hover:bg-[#2a2d35]"}
                ${h&&!f?"opacity-40 cursor-not-allowed grayscale":""}
            `;o[0]!==d?(t=(0,w.jsx)("span",{className:"text-xl",children:d}),o[0]=d,o[1]=t):t=o[1];let g=`font-bold uppercase text-xs ${p?"text-red-400":"text-gray-200 group-hover:text-white"}`;return o[2]!==l||o[3]!==g?(r=(0,w.jsx)("span",{className:g,children:l}),o[2]=l,o[3]=g,o[4]=r):r=o[4],o[5]!==t||o[6]!==r?(s=(0,w.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[t,r]}),o[5]=t,o[6]=r,o[7]=s):s=o[7],o[8]!==c?(n=(0,w.jsx)("div",{className:"text-[9px] text-gray-500 pl-7",children:c}),o[8]=c,o[9]=n):n=o[9],o[10]!==f?(i=f&&(0,w.jsx)("div",{className:"absolute top-1 right-2 text-[8px] text-yellow-500 font-bold uppercase tracking-wider animate-pulse",children:"EN ATTENTE..."}),o[10]=f,o[11]=i):i=o[11],o[12]!==h||o[13]!==u||o[14]!==m||o[15]!==s||o[16]!==n||o[17]!==i?(a=(0,w.jsxs)("button",{onClick:u,disabled:h,className:m,children:[s,n,i]}),o[12]=h,o[13]=u,o[14]=m,o[15]=s,o[16]=n,o[17]=i,o[18]=a):a=o[18],a}function d0(e){let t,r,s,n,i,a,o,l,c,d=(0,_.c)(18),{userID:u}=e;d[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],d[0]=t):t=d[0];let[h,p]=(0,N.useState)(t),[f,m]=(0,N.useState)(!1),[g,x]=(0,N.useState)(0);return d[1]!==u?(r=()=>{if(!u)return;let e=oQ(oT(aY(dY,"notifications"),oM("targetId","==",u),function(e,t="asc"){let r=oS("orderBy",e);return oP._create(r,t)}("createdAt","desc")),e=>{let t=e.docs.map(d4);p(t),x(t.filter(d5).length)});return()=>e()},s=[u],d[1]=u,d[2]=r,d[3]=s):(r=d[2],s=d[3]),(0,N.useEffect)(r,s),d[4]!==f?(n=()=>m(!f),d[4]=f,d[5]=n):n=d[5],d[6]===Symbol.for("react.memo_cache_sentinel")?(i=(0,w.jsx)("span",{className:"text-xl",children:""}),d[6]=i):i=d[6],d[7]!==g?(a=g>0&&(0,w.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-600 text-white text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full animate-bounce border border-black",children:g}),d[7]=g,d[8]=a):a=d[8],d[9]!==n||d[10]!==a?(o=(0,w.jsxs)("button",{onClick:n,className:"relative bg-gray-900 border border-[#cba660] text-[#cba660] w-10 h-10 flex items-center justify-center rounded hover:bg-[#cba660] hover:text-black transition shadow-lg",children:[i,a]}),d[9]=n,d[10]=a,d[11]=o):o=d[11],d[12]!==f||d[13]!==h?(l=f&&(0,w.jsxs)("div",{className:"absolute top-12 right-0 w-80 max-h-96 bg-[#0f1115] border-2 border-[#cba660] shadow-[0_0_30px_black] flex flex-col rounded-sm overflow-hidden animate-in fade-in slide-in-from-top-2",children:[(0,w.jsxs)("div",{className:"bg-[#1a1d23] p-2 border-b border-[#cba660] text-[#cba660] text-xs font-bold uppercase tracking-widest flex justify-between items-center",children:[(0,w.jsxs)("span",{children:["Communications (",h.length,")"]}),(0,w.jsx)("button",{onClick:()=>m(!1),className:"text-gray-500 hover:text-white",children:"X"})]}),(0,w.jsx)("div",{className:"overflow-y-auto custom-scrollbar flex-grow p-1",children:0===h.length?(0,w.jsx)("div",{className:"p-4 text-center text-gray-500 text-xs italic",children:"Aucune nouvelle transmission."}):h.map(e=>(0,w.jsxs)("div",{onClick:()=>d2(e.id),className:`p-3 mb-1 border-l-4 transition-colors group relative cursor-pointer
                                        ${e.read?"bg-[#15171c] border-gray-700 text-gray-400":"bg-[#1f2229] border-[#cba660] text-gray-200"}
                                    `,children:[(0,w.jsxs)("div",{className:"flex items-start gap-3",children:[(0,w.jsx)("div",{className:"text-lg mt-0.5",children:function(e){switch(e){case"construction":return"";case"diplomacy":return"";case"war":return"";default:return""}}(e.type)}),(0,w.jsxs)("div",{className:"flex-grow",children:[(0,w.jsx)("div",{className:`text-xs font-bold uppercase mb-1 ${e.read?"text-gray-500":"text-[#cba660]"}`,children:e.title}),(0,w.jsx)("div",{className:"text-[10px] leading-tight",children:e.message}),(0,w.jsx)("div",{className:"text-[9px] text-gray-600 mt-2 text-right",children:e.createdAt?.toDate?e.createdAt.toDate().toLocaleTimeString():""})]})]}),(0,w.jsx)("button",{onClick:t=>d1(t,e.id),className:"absolute top-2 right-2 text-gray-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity text-xs",title:"Supprimer",children:""})]},e.id))})]}),d[12]=f,d[13]=h,d[14]=l):l=d[14],d[15]!==o||d[16]!==l?(c=(0,w.jsxs)("div",{className:"relative z-50 pointer-events-auto mr-2",children:[o,l]}),d[15]=o,d[16]=l,d[17]=c):c=d[17],c}async function d1(e,t){e.stopPropagation(),await oX(aJ(dY,"notifications",t))}async function d2(e){await oK(aJ(dY,"notifications",e),{read:!0})}function d5(e){return!e.read}function d4(e){return{id:e.id,...e.data()}}function d3({userFaction:e,userRole:t,onClose:r}){let[s,n]=(0,N.useState)([]),[i,a]=(0,N.useState)([]),[o,l]=(0,N.useState)(!0),[c,d]=(0,N.useState)(null),[u,h]=(0,N.useState)(null),p="republic"===e,f=["admin","gamemaster"].includes(t),m={bgGradient:p?"bg-[#050a15]":"bg-[#150505]",border:p?"border-blue-600":"border-red-800",textMain:p?"text-blue-300":"text-red-400",connector:p?"bg-blue-500/30":"bg-red-500/30",button:p?"bg-blue-900 hover:bg-blue-800 border-blue-500":"bg-red-900 hover:bg-red-800 border-red-500",bgImageUrl:p?"/images/republic_bg.jpg":"/images/empire_council.jpg"};(0,N.useEffect)(()=>{if(!e)return;let t=oQ(oT(aY(dY,"users"),oM("faction_id","==",e)),e=>{n(e.docs.map(e=>({id:e.id,...e.data()}))),l(!1)});return(async()=>{a((await oG(aY(dY,"factions"))).docs.map(e=>({id:e.id,...e.data()})).filter(t=>t.id!==e&&"neutral"!==t.id))})(),()=>t()},[e]);let g=async(e,t,r,s={})=>{if(confirm("citizen"===t?`R\xe9trograder ${r} au rang de Citoyen ?`:`Nommer ${r} au poste de ${t.toUpperCase()} ?`))try{await oK(aJ(dY,"users",e),{role:t,diplomatic_assignment:s.targetFactionId||null,diplomatic_assignment_name:s.targetFactionName||null}),d(null),h(null)}catch(e){console.error(e)}};return(0,w.jsxs)("div",{className:"fixed inset-0 z-[150] flex items-center justify-center font-sans perspective-1000",onClick:()=>d(null),children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-black/95 backdrop-blur-sm animate-in fade-in duration-500"}),(0,w.jsxs)("div",{className:`w-[98vw] max-w-[1600px] h-[95vh] relative overflow-hidden flex flex-col rounded-xl border-2 ${m.border} ${m.bgGradient} shadow-[0_0_100px_rgba(0,0,0,1)]`,onClick:e=>e.stopPropagation(),children:[u&&(0,w.jsx)("div",{className:"absolute inset-0 z-50 bg-black/90 flex items-center justify-center animate-in fade-in duration-200",children:(0,w.jsxs)("div",{className:`bg-gray-900 border-2 ${m.border} p-6 rounded-lg w-96 shadow-2xl flex flex-col gap-4`,children:[(0,w.jsx)("h3",{className:`text-xl font-bold uppercase text-center ${m.textMain}`,children:"Affectation Diplomatique"}),(0,w.jsxs)("p",{className:"text-gray-400 text-xs text-center",children:["Choisissez la faction auprs de laquelle ",(0,w.jsx)("strong",{children:u.pseudo})," sera Ambassadeur."]}),(0,w.jsx)("div",{className:"flex flex-col gap-2 max-h-60 overflow-y-auto custom-scrollbar border-t border-b border-gray-800 py-2",children:i.map(e=>(0,w.jsxs)("button",{onClick:()=>g(u.id,"diplomat",u.pseudo,{targetFactionId:e.id,targetFactionName:e.name}),className:"flex items-center gap-3 p-2 hover:bg-white/10 transition rounded border border-transparent hover:border-gray-600",children:[(0,w.jsx)("div",{className:"w-6 h-6 rounded-full",style:{backgroundColor:e.color}}),(0,w.jsx)("span",{className:"text-sm font-bold text-gray-200",children:e.name})]},e.id))}),(0,w.jsx)("button",{onClick:()=>h(null),className:"text-xs text-red-500 uppercase font-bold hover:text-white mt-2",children:"Annuler"})]})}),(0,w.jsxs)("div",{className:`relative z-40 flex justify-between items-center p-6 border-b ${m.border} bg-black/90 backdrop-blur-md shadow-lg`,children:[(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[(0,w.jsx)("span",{className:`text-5xl ${m.textMain}`,children:p?"":""}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{className:`text-3xl font-serif font-black uppercase tracking-[0.2em] ${m.textMain} drop-shadow-md`,children:p?"Haute Chambre du Snat":"Citadelle du Conseil Noir"}),(0,w.jsxs)("p",{className:"text-[10px] text-gray-400 uppercase tracking-widest",children:["Organigramme Officiel ",f&&(0,w.jsx)("span",{className:"text-yellow-500 font-bold ml-2",children:"[MODE ADMIN]"})]})]})]}),(0,w.jsx)("button",{onClick:r,className:`px-6 py-2 border ${m.border} text-white uppercase font-bold hover:bg-white/10 transition`,children:"Fermer"})]}),(0,w.jsxs)("div",{className:"flex-grow overflow-y-auto custom-scrollbar relative z-10",children:[(0,w.jsx)("div",{className:"absolute top-0 left-0 right-0 h-[700px] bg-cover bg-top bg-no-repeat pointer-events-none z-0",style:{backgroundImage:`url('${m.bgImageUrl}')`,opacity:1},children:(0,w.jsx)("div",{className:"absolute inset-0",style:{background:`linear-gradient(to bottom, transparent 0%, transparent 70%, ${p?"#050a15":"#150505"} 100%)`}})}),(0,w.jsx)("div",{className:"p-8 flex flex-col items-center relative z-20",children:o?(0,w.jsx)("div",{className:`mt-20 text-2xl font-mono animate-pulse ${m.textMain}`,children:"CHARGEMENT..."}):(0,w.jsxs)("div",{className:"flex flex-col items-center w-full space-y-12 pb-20",children:[(0,w.jsxs)("div",{className:"flex flex-col items-center mt-8",children:[(0,w.jsx)(d6,{member:s.find(e=>"emperor"===e.role),roleName:p?"Chancelier Suprme":"Empereur",theme:m,isUnique:!0,onUpdateRole:g,isAdmin:f}),(0,w.jsx)("div",{className:`w-1 h-12 ${m.connector} shadow-[0_0_10px_currentColor]`})]}),(0,w.jsxs)("div",{className:"flex flex-col items-center w-full",children:[(0,w.jsx)("div",{className:`w-[70%] h-1 ${m.connector} mb-4 shadow-[0_0_10px_currentColor]`}),(0,w.jsx)("div",{className:"grid grid-cols-5 gap-8 w-full justify-items-center px-10",children:Array.from({length:5}).map((e,t)=>(0,w.jsxs)("div",{className:"flex flex-col items-center w-full relative",children:[(0,w.jsx)("div",{className:`absolute -top-4 w-1 h-4 ${m.connector}`}),(0,w.jsx)(d6,{member:s.filter(e=>"conseil"===e.role)[t],roleName:"Conseiller",theme:m,onUpdateRole:g,isAdmin:f})]},t))}),(0,w.jsx)("div",{className:`w-1 h-20 ${m.connector} mt-4`})]}),(0,w.jsxs)("div",{className:"grid grid-cols-3 gap-8 w-full border-t border-dashed border-gray-800 pt-8 bg-black/80 rounded-xl p-6 shadow-2xl border border-white/5",children:[(0,w.jsxs)("div",{className:"flex flex-col items-center border-r border-gray-800/50",children:[(0,w.jsx)("h3",{className:"text-green-500 font-bold uppercase tracking-widest text-sm mb-6 flex items-center gap-2",children:" tat-Major"}),(0,w.jsxs)("div",{className:"flex flex-wrap justify-center gap-4",children:[s.filter(e=>"general"===e.role).map(e=>(0,w.jsx)(d6,{member:e,roleName:"Gnral",theme:m,onUpdateRole:g,isSmall:!0,isAdmin:f,colorOverride:"border-green-800 text-green-400"},e.id)),(0,w.jsx)(d8,{label:"Nommer Gnral",color:"text-green-600 border-green-900"})]})]}),(0,w.jsxs)("div",{className:"flex flex-col items-center border-r border-gray-800/50",children:[(0,w.jsx)("h3",{className:"text-blue-400 font-bold uppercase tracking-widest text-sm mb-6 flex items-center gap-2",children:" Diplomatie"}),(0,w.jsxs)("div",{className:"flex flex-wrap justify-center gap-4",children:[s.filter(e=>"diplomat"===e.role).map(e=>(0,w.jsx)(d6,{member:e,roleName:"Diplomate",subTitle:e.diplomatic_assignment_name?`Ambassadeur : ${e.diplomatic_assignment_name}`:"Non Assign",theme:m,onUpdateRole:g,isSmall:!0,isAdmin:f,colorOverride:"border-blue-500 text-blue-300"},e.id)),(0,w.jsx)(d8,{label:"Nommer Diplomate",color:"text-blue-600 border-blue-900"})]})]}),(0,w.jsxs)("div",{className:"flex flex-col items-center",children:[(0,w.jsx)("h3",{className:"text-yellow-500 font-bold uppercase tracking-widest text-sm mb-6 flex items-center gap-2",children:" Administration"}),(0,w.jsxs)("div",{className:"flex flex-wrap justify-center gap-4",children:[s.filter(e=>"governor"===e.role).map(e=>(0,w.jsx)(d6,{member:e,roleName:"Gouverneur",theme:m,onUpdateRole:g,isSmall:!0,isAdmin:f,colorOverride:"border-yellow-700 text-yellow-400"},e.id)),(0,w.jsx)(d8,{label:"Nommer Gouverneur",color:"text-yellow-600 border-yellow-900"})]})]})]}),(0,w.jsxs)("div",{className:"w-full mt-8 bg-black border border-gray-800 p-6 rounded-lg pb-32 shadow-xl",children:[(0,w.jsx)("h4",{className:"text-gray-500 text-xs uppercase tracking-widest mb-4 border-b border-gray-800 pb-2",children:"Citoyens & Officiers en attente d'affectation"}),(0,w.jsx)("div",{className:"grid grid-cols-6 gap-2",children:s.filter(e=>!["emperor","conseil","general","diplomat","governor"].includes(e.role)).map(e=>{let t=c===e.id;return(0,w.jsxs)("div",{onClick:t=>{var r;t.stopPropagation(),c===(r=e.id)?d(null):d(r)},className:`flex items-center gap-2 p-2 border rounded cursor-pointer transition-all relative
                                                        ${t?"bg-gray-800 border-white":"bg-gray-900/50 border-gray-800 hover:border-gray-500"}
                                                    `,children:[(0,w.jsx)("div",{className:"w-6 h-6 bg-black rounded-full overflow-hidden flex items-center justify-center text-gray-500 border border-gray-700 text-[10px]",children:e.avatar?(0,w.jsx)("img",{src:e.avatar,className:"w-full h-full object-cover"}):""}),(0,w.jsx)("span",{className:"text-xs text-gray-300 truncate select-none",children:e.pseudo}),t&&(0,w.jsxs)("div",{className:"absolute bottom-full left-0 w-48 bg-gray-950 border border-white z-50 shadow-[0_0_20px_black] rounded-md overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[(0,w.jsxs)("div",{className:"bg-white text-black text-[9px] p-1 text-center font-bold uppercase tracking-widest",children:["Affecter ",e.pseudo,"  :"]}),(0,w.jsx)("button",{onClick:()=>g(e.id,"general",e.pseudo),className:"w-full text-[10px] text-green-400 p-2 hover:bg-green-900/30 text-left border-b border-gray-800 flex items-center gap-2",children:" Gnral"}),(0,w.jsx)("button",{onClick:()=>{h(e),d(null)},className:"w-full text-[10px] text-blue-400 p-2 hover:bg-blue-900/30 text-left border-b border-gray-800 flex items-center gap-2",children:" Diplomate"}),(0,w.jsx)("button",{onClick:()=>g(e.id,"governor",e.pseudo),className:"w-full text-[10px] text-yellow-400 p-2 hover:bg-yellow-900/30 text-left border-b border-gray-800 flex items-center gap-2",children:" Gouverneur"}),(0,w.jsx)("button",{onClick:()=>g(e.id,"conseil",e.pseudo),className:"w-full text-[10px] text-purple-400 p-2 hover:bg-purple-900/30 text-left border-b border-gray-800 flex items-center gap-2",children:" Conseil"}),f&&(0,w.jsx)("button",{onClick:()=>g(e.id,"emperor",e.pseudo),className:"w-full text-[10px] text-red-500 p-2 hover:bg-red-900/30 text-left font-bold border-t border-red-900",children:" EMPEREUR (Admin)"})]})]},e.id)})})]})]})})]})]})]})}function d6(e){let t,r,s,n,i=(0,_.c)(18),{member:a,roleName:o,subTitle:l,theme:c,isUnique:d,isSmall:u,onUpdateRole:h,isAdmin:p,colorOverride:f}=e,m=f||`${c.border} ${c.textMain}`,g=u?"w-16 h-16":"w-24 h-24",x=p||"Empereur"!==o&&"Chancelier Suprme"!==o,b=`relative group flex flex-col items-center transition-transform hover:-translate-y-1 ${u?"w-32":"w-48"}`,y=`
                relative flex flex-col items-center justify-center ${u?"w-32 h-40":"w-48 h-64"}
                border-2 bg-black/60 backdrop-blur-md overflow-hidden rounded-lg
                ${a?m:"border-gray-800 text-gray-600 border-dashed"}
                ${d?"shadow-[0_0_50px_rgba(255,215,0,0.3)] border-yellow-600 text-yellow-500":"shadow-lg"}
            `;i[0]!==g||i[1]!==x||i[2]!==d||i[3]!==a||i[4]!==h||i[5]!==o||i[6]!==l?(t=a?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent to-black/90 z-10"}),a.avatar&&(0,w.jsx)("div",{className:"absolute inset-0 bg-cover bg-center opacity-60 z-0",style:{backgroundImage:`url(${a.avatar})`}}),(0,w.jsx)("div",{className:`relative z-20 ${g} rounded-full border-2 ${d?"border-yellow-500":"border-current"} overflow-hidden bg-black shadow-lg mb-2`,children:a.avatar?(0,w.jsx)("img",{src:a.avatar,className:"w-full h-full object-cover"}):(0,w.jsx)("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:""})}),(0,w.jsxs)("div",{className:"relative z-20 text-center w-full px-2",children:[(0,w.jsx)("div",{className:"font-bold uppercase truncate text-xs text-white drop-shadow-md",children:a.pseudo}),(0,w.jsx)("div",{className:`text-[9px] truncate ${l?"text-blue-300 font-bold":"opacity-80"}`,children:l||a.custom_rank||o})]}),x&&(0,w.jsx)("button",{onClick:()=>h(a.id,"citizen",a.pseudo),className:"absolute top-2 right-2 z-30 text-[8px] bg-red-600 text-white px-1.5 py-0.5 rounded opacity-0 group-hover:opacity-100 transition hover:bg-red-500",title:"Rtrograder Citoyen",children:""})]}):(0,w.jsxs)("div",{className:"flex flex-col items-center opacity-50",children:[(0,w.jsx)("span",{className:"text-xl mb-1",children:"+"}),(0,w.jsx)("span",{className:"text-[8px] uppercase tracking-widest",children:"Vacant"})]}),i[0]=g,i[1]=x,i[2]=d,i[3]=a,i[4]=h,i[5]=o,i[6]=l,i[7]=t):t=i[7],i[8]!==y||i[9]!==t?(r=(0,w.jsx)("div",{className:y,children:t}),i[8]=y,i[9]=t,i[10]=r):r=i[10];let v=`mt-[-10px] relative z-30 px-3 py-0.5 bg-black border ${d?"border-yellow-600 text-yellow-500":"border-gray-700 text-gray-400"} text-[8px] font-bold uppercase tracking-widest shadow-md rounded-full`;return i[11]!==o||i[12]!==v?(s=(0,w.jsx)("div",{className:v,children:o}),i[11]=o,i[12]=v,i[13]=s):s=i[13],i[14]!==b||i[15]!==r||i[16]!==s?(n=(0,w.jsxs)("div",{className:b,children:[r,s]}),i[14]=b,i[15]=r,i[16]=s,i[17]=n):n=i[17],n}function d8(e){let t,r,s,n=(0,_.c)(6),{label:i,color:a}=e,o=`w-32 h-40 border-2 border-dashed ${a} flex flex-col items-center justify-center rounded-lg opacity-30 select-none`;return n[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,w.jsx)("br",{}),n[0]=t):t=n[0],n[1]!==i?(r=(0,w.jsxs)("span",{className:"text-[9px] uppercase text-center px-2",children:[i,t,"(Voir liste en bas)"]}),n[1]=i,n[2]=r):r=n[2],n[3]!==o||n[4]!==r?(s=(0,w.jsx)("div",{className:o,children:r}),n[3]=o,n[4]=r,n[5]=s):s=n[5],s}let d9={fighter:{name:"Escadron de Chasseurs",type:"fighter",icon:"",desc:"Rapide et agile.",power:1,cost:50,mat:10,upkeep_cr:2,upkeep_mp:1,tech_req:null},corvette:{name:"Corvette Tactique",type:"corvette",icon:"",desc:"Patrouilleur lger.",power:5,cost:200,mat:50,upkeep_cr:10,upkeep_mp:5,tech_req:"tech_corvette"},frigate:{name:"Frgate de Ligne",type:"frigate",icon:"",desc:"pine dorsale.",power:15,cost:800,mat:200,upkeep_cr:40,upkeep_mp:15,tech_req:"tech_frigate"},cruiser:{name:"Croiseur Lourd",type:"cruiser",icon:"",desc:"Artillerie lourde.",power:40,cost:2e3,mat:600,upkeep_cr:150,upkeep_mp:50,tech_req:"tech_cruiser"},dreadnought:{name:"Dreadnought",type:"dreadnought",icon:"",desc:"Unit Capitale.",power:100,cost:5e3,mat:1500,upkeep_cr:500,upkeep_mp:200,tech_req:"tech_dreadnought"}},d7={infantry:{name:"Infanterie Lgre",type:"infantry",icon:"",desc:"Unit de base.",power:2,cost:50,mat:0,cost_mp:10,upkeep_cr:1,upkeep_mp:1},heavy_infantry:{name:"Infanterie Lourde",type:"heavy_infantry",icon:"",desc:"Unit d'lite.",power:5,cost:150,mat:0,cost_mp:20,upkeep_cr:4,upkeep_mp:2},vehicle:{name:"Vhicules Blinds",type:"vehicle",icon:"",desc:"Soutien mcanis.",power:12,cost:400,mat:0,cost_mp:50,upkeep_cr:15,upkeep_mp:4},air_support:{name:"Escadron Arien",type:"air_support",icon:"",desc:"Frappe arienne.",power:15,cost:600,mat:0,cost_mp:30,upkeep_cr:25,upkeep_mp:3}};function ue(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m=(0,_.c)(103),{userFaction:g,fleets:x,planets:b,factionMembers:y,factionData:v,onSelectFleet:j,onClose:k}=e,[S,C]=(0,N.useState)(null),[E,I]=(0,N.useState)("list"),[T,A]=(0,N.useState)("ships"),M="republic"===g,R=M?"text-blue-400":"text-green-500",P=M?"border-blue-500":"border-green-600",D=M?"bg-blue-950/90":"bg-gray-900/95",O=M?"shadow-[0_0_20px_rgba(59,130,246,0.5)]":"shadow-[0_0_20px_rgba(34,197,94,0.3)]",L=M?"bg-blue-900 hover:bg-blue-800":"bg-green-900 hover:bg-green-800";m[0]!==R||m[1]!==P||m[2]!==D||m[3]!==O||m[4]!==L?(t={main:R,border:P,bg:D,glow:O,button:L},m[0]=R,m[1]=P,m[2]=D,m[3]=O,m[4]=L,m[5]=t):t=m[5];let F=t;m[6]!==v?.unlocked_techs?(r=v?.unlocked_techs||[],m[6]=v?.unlocked_techs,m[7]=r):r=m[7];let U=r;if(m[8]!==T||m[9]!==v||m[10]!==y||m[11]!==x||m[12]!==M||m[13]!==k||m[14]!==j||m[15]!==b||m[16]!==S||m[17]!==F.bg||m[18]!==F.border||m[19]!==F.button||m[20]!==F.glow||m[21]!==F.main||m[22]!==U||m[23]!==g||m[24]!==E){let e,t,r,u,h,p,f,_,N,R,P,D,O,L,z,V,$=y?y.filter(ul):[],q=uo;m[33]!==b||m[34]!==g?(e=async e=>{let t=b.find(t=>t.id===e),r=prompt("Nom de la nouvelle flotte :");if(r)try{await oY(aY(dY,"fleets"),{name:r,owner:g,location_id:e,location_name:t.name,status:"stationed",composition:{fighter:0,corvette:0,frigate:0,cruiser:0,dreadnought:0},troops:{infantry:0,heavy_infantry:0,vehicle:0,air_support:0},commander_id:null,commander_name:null,start_turn:null,arrival_turn:null,destination_id:null})}catch(e){console.error(e)}},m[33]=b,m[34]=g,m[35]=e):e=m[35];let B=e;m[36]!==S?(t=async(e,t)=>{S&&(await oK(aJ(dY,"fleets",S.id),{commander_id:e,commander_name:t}),C({...S,commander_id:e,commander_name:t}))},m[36]=S,m[37]=t):t=m[37];let H=t,G=async(e,t)=>{if(!S)return;let r="ship"===t?d9[e]:d7[e];if("ship"===t){if(Object.values(S.composition||{}).reduce(ua,0)>=20)return alert("Limite de flotte atteinte (20 vaisseaux max)")}else if(Object.values(S.troops||{}).reduce(ui,0)>=20)return alert("Limite de transport atteinte (20 troupes max)");let s=r.cost,n=r.mat||0,i=r.cost_mp||0;if(v.credits<s||v.materials<n||(v.manpower||0)<i)return alert("Ressources insuffisantes !");if(confirm(`Construire ${r.name} ?
Co\xfbt : ${s} CR${n>0?`, ${n} MAT`:""}${i>0?`, ${i} MP`:""}`)){if("ship"===t){let t={...S.composition||{}};t[e]=(t[e]||0)+1,await oK(aJ(dY,"fleets",S.id),{composition:t}),C({...S,composition:t})}else{let t={...S.troops||{}};t[e]=(t[e]||0)+1,await oK(aJ(dY,"fleets",S.id),{troops:t}),C({...S,troops:t})}await oK(aJ(dY,"factions",g),{credits:o4(-s),materials:o4(-n),manpower:o4(-i)})}};m[38]!==S?(r=async()=>{if(S&&confirm(`Voulez-vous vraiment d\xe9manteler la flotte "${S.name}" ? Cette action est irr\xe9versible.`))try{await oX(aJ(dY,"fleets",S.id)),C(null)}catch(e){console.error("Erreur suppression flotte:",e)}},m[38]=S,m[39]=r):r=m[39];let W=r;l="fixed inset-0 z-[100] flex items-center shadow-lg bg-black/80 backdrop-blur-sm p-4 font-mono",i=`w-full max-w-6xl h-[85vh] flex flex-col border-2 ${F.border} ${F.bg} ${F.glow} rounded-lg overflow-hidden relative`,m[40]===Symbol.for("react.memo_cache_sentinel")?(a=(0,w.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(transparent_50%,rgba(0,0,0,0.5)_50%)] bg-[length:100%_4px] pointer-events-none opacity-20"}),m[40]=a):a=m[40];let K=`flex justify-between items-center p-4 border-b ${F.border} bg-black/40 relative z-10`,X=`text-4xl ${F.main}`;m[41]!==X?(u=(0,w.jsx)("span",{className:X,children:""}),m[41]=X,m[42]=u):u=m[42];let Y=`text-2xl font-bold uppercase tracking-[0.2em] ${F.main}`;m[43]!==Y?(h=(0,w.jsx)("h2",{className:Y,children:"Console Tactique"}),m[43]=Y,m[44]=h):h=m[44],m[45]===Symbol.for("react.memo_cache_sentinel")?(p=(0,w.jsx)("p",{className:"text-[10px] text-gray-400 uppercase",children:"Systme de gestion de flotte v5.1"}),m[45]=p):p=m[45],m[46]!==h?(f=(0,w.jsxs)("div",{children:[h,p]}),m[46]=h,m[47]=f):f=m[47],m[48]!==u||m[49]!==f?(_=(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[u,f]}),m[48]=u,m[49]=f,m[50]=_):_=m[50];let Q=`px-4 py-2 border ${F.border} ${F.main} hover:bg-white/5 uppercase text-xs font-bold`;m[51]!==k||m[52]!==Q?(N=(0,w.jsx)("button",{onClick:k,className:Q,children:"Fermer"}),m[51]=k,m[52]=Q,m[53]=N):N=m[53],m[54]!==K||m[55]!==_||m[56]!==N?(o=(0,w.jsxs)("div",{className:K,children:[_,N]}),m[54]=K,m[55]=_,m[56]=N,m[57]=o):o=m[57],s="flex flex-grow overflow-hidden relative z-10";let J=`w-1/4 border-r ${F.border} bg-black/20 flex flex-col`;if(m[58]===Symbol.for("react.memo_cache_sentinel")?(R=(0,w.jsx)("div",{className:"p-2 bg-black/40 text-[10px] text-gray-500 uppercase font-bold tracking-widest text-center",children:"Units Dployes"}),m[58]=R):R=m[58],m[59]!==x||m[60]!==M||m[61]!==S?.id||m[62]!==F.main||m[63]!==g){let e,t;m[65]!==g?(e=e=>e.owner===g,m[65]=g,m[66]=e):e=m[66],m[67]!==M||m[68]!==S?.id||m[69]!==F.main?(t=e=>(0,w.jsxs)("button",{onClick:()=>{C(e),I("details")},className:`w-full text-left p-4 border-b border-gray-800 transition-all hover:bg-white/5 group relative ${S?.id===e.id?"bg-white/10":""}`,children:[S?.id===e.id&&(0,w.jsx)("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${M?"bg-blue-500":"bg-green-500"}`}),(0,w.jsxs)("div",{className:"flex justify-between items-start",children:[(0,w.jsx)("span",{className:`font-bold uppercase text-sm ${F.main}`,children:e.name}),e.commander_id&&(0,w.jsx)("span",{className:"text-xs",children:""})]}),(0,w.jsxs)("div",{className:"text-[10px] text-gray-400 mt-1",children:["Loc: ",e.location_name||"Inconnu"]}),(0,w.jsxs)("div",{className:"text-[10px] text-gray-500",children:["Puissance: ",function(e){let t=0;return e.composition&&Object.entries(e.composition).forEach(e=>{let[r,s]=e;d9[r]&&(t+=d9[r].power*s)}),e.troops&&Object.entries(e.troops).forEach(e=>{let[r,s]=e;d7[r]&&(t+=d7[r].power*s)}),e.commander_id&&(t=Math.round(1.2*t)),t}(e)]})]},e.id),m[67]=M,m[68]=S?.id,m[69]=F.main,m[70]=t):t=m[70],P=x.filter(e).map(t),m[59]=x,m[60]=M,m[61]=S?.id,m[62]=F.main,m[63]=g,m[64]=P}else P=m[64];if(m[71]!==P?(D=(0,w.jsx)("div",{className:"flex-grow overflow-y-auto custom-scrollbar",children:P}),m[71]=P,m[72]=D):D=m[72],m[73]!==B?(O=e=>{e.target.value&&B(e.target.value)},m[73]=B,m[74]=O):O=m[74],m[75]===Symbol.for("react.memo_cache_sentinel")?(L=(0,w.jsx)("option",{value:"",children:"+ Crer Nouvelle Flotte"}),m[75]=L):L=m[75],m[76]!==b||m[77]!==g){let e;m[79]!==g?(e=e=>e.owner===g,m[79]=g,m[80]=e):e=m[80],z=b.filter(e).map(un),m[76]=b,m[77]=g,m[78]=z}else z=m[78];m[81]!==O||m[82]!==z?(V=(0,w.jsx)("div",{className:"p-4 border-t border-gray-800",children:(0,w.jsxs)("select",{className:"w-full bg-black border border-gray-700 text-gray-300 text-xs p-2 mb-2 outline-none",onChange:O,value:"",children:[L,z]})}),m[81]=O,m[82]=z,m[83]=V):V=m[83],m[84]!==J||m[85]!==D||m[86]!==V?(n=(0,w.jsxs)("div",{className:J,children:[R,D,V]}),m[84]=J,m[85]=D,m[86]=V,m[87]=n):n=m[87],c="flex-grow bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] bg-black/80 flex flex-col relative",d=S?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:"p-6 border-b border-gray-800 flex justify-between items-start bg-gradient-to-b from-black/50 to-transparent",children:[(0,w.jsxs)("div",{className:"flex-grow",children:[(0,w.jsx)("h3",{className:"text-3xl font-bold text-white uppercase",children:S.name}),(0,w.jsxs)("div",{className:`text-xs ${F.main} mt-1 flex gap-4`,children:[(0,w.jsxs)("span",{children:["Position : ",S.location_name]}),(0,w.jsxs)("span",{children:["Statut : ",S.status.toUpperCase()]})]}),(0,w.jsxs)("div",{className:"mt-2 text-[10px] text-red-400 font-bold bg-red-900/20 px-2 py-1 rounded inline-block border border-red-900/50",children:["ENTRETIEN : -",q(S).cr," CR / -",q(S).mp," HOM"]})]}),(0,w.jsxs)("div",{className:"bg-black/50 border border-gray-700 p-3 rounded w-64 ml-4",children:[(0,w.jsx)("div",{className:"text-[9px] text-gray-500 uppercase font-bold mb-1",children:"Amiral en Chef"}),S.commander_id?(0,w.jsxs)("div",{className:"flex justify-between items-center",children:[(0,w.jsxs)("span",{className:`font-bold ${F.main}`,children:[" ",S.commander_name]}),(0,w.jsx)("button",{onClick:()=>H(null,null),className:"text-[10px] text-red-500 hover:underline",children:"Rvoquer"})]}):(0,w.jsxs)("select",{className:"w-full bg-gray-900 border border-gray-600 text-xs text-white p-1",onChange:e=>{let t=e.target.selectedIndex;t>0&&H($[t-1].id,$[t-1].pseudo)},children:[(0,w.jsx)("option",{value:"",children:"-- Assigner un Gnral --"}),$.map(us)]}),S.commander_id&&(0,w.jsx)("div",{className:"text-[9px] text-green-400 mt-1",children:"+20% Puissance de Feu"})]})]}),(0,w.jsxs)("div",{className:"flex items-center gap-2 p-4 bg-black/20 border-b border-gray-800",children:[(0,w.jsx)("button",{onClick:()=>I("details"),className:`px-4 py-1 text-xs font-bold uppercase border-b-2 transition-colors ${"details"===E?`${F.main} border-current`:"text-gray-500 border-transparent hover:text-white"}`,children:"Composition"}),"moving"!==S.status&&(0,w.jsx)("button",{onClick:()=>I("build"),className:`px-4 py-1 text-xs font-bold uppercase border-b-2 transition-colors ${"build"===E?`${F.main} border-current`:"text-gray-500 border-transparent hover:text-white"}`,children:"Chantier Naval"}),(0,w.jsxs)("div",{className:"ml-auto flex gap-2",children:[(0,w.jsx)("button",{onClick:W,className:"px-3 py-1 text-[10px] font-bold uppercase text-red-600 hover:text-red-400 border border-transparent hover:border-red-900 hover:bg-red-900/20 transition-all",children:"Dmanteler"}),"moving"!==S.status&&(0,w.jsx)("button",{onClick:()=>j(S,"move"),className:`px-4 py-2 text-xs font-bold uppercase ${F.button} text-white shadow-lg`,children:"Ordre de Mouvement"})]})]}),(0,w.jsxs)("div",{className:"flex-grow p-6 overflow-y-auto",children:["details"===E&&(0,w.jsxs)("div",{className:"space-y-8",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-[10px] uppercase font-bold text-gray-500 mb-4 border-b border-gray-800 pb-1 tracking-widest",children:"Forces Spatiales"}),(0,w.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[S.composition&&Object.entries(S.composition).map(e=>{let[t,r]=e;if(r<=0)return null;let s=d9[t];return s?(0,w.jsxs)("div",{className:`border border-gray-700 bg-black/60 p-4 rounded flex flex-col items-center justify-center relative overflow-hidden group hover:border-${M?"blue":"green"}-500 transition-colors`,children:[(0,w.jsx)("div",{className:"text-4xl mb-2 group-hover:scale-110 transition-transform",children:s.icon}),(0,w.jsx)("div",{className:"text-2xl font-bold text-white",children:r}),(0,w.jsx)("div",{className:"text-[9px] uppercase text-gray-400 tracking-widest",children:s.name}),(0,w.jsxs)("div",{className:`absolute top-0 right-0 p-1 text-[8px] font-bold ${F.main}`,children:["PWR: ",s.power*r]})]},t):null}),(!S.composition||Object.values(S.composition).every(ur))&&(0,w.jsx)("div",{className:"col-span-4 text-center text-gray-500 italic text-xs",children:"Aucun vaisseau assign."})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-[10px] uppercase font-bold text-gray-500 mb-4 border-b border-gray-800 pb-1 tracking-widest",children:"Troupes Embarques"}),(0,w.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[S.troops&&Object.entries(S.troops).map(e=>{let[t,r]=e;if(r<=0)return null;let s=d7[t];return s?(0,w.jsxs)("div",{className:`border border-gray-700 bg-black/60 p-4 rounded flex flex-col items-center justify-center relative overflow-hidden group hover:border-${M?"blue":"green"}-500 transition-colors`,children:[(0,w.jsx)("div",{className:"text-4xl mb-2 group-hover:scale-110 transition-transform",children:s.icon}),(0,w.jsx)("div",{className:"text-2xl font-bold text-white",children:r}),(0,w.jsx)("div",{className:"text-[9px] uppercase text-gray-400 tracking-widest",children:s.name}),(0,w.jsxs)("div",{className:`absolute top-0 right-0 p-1 text-[8px] font-bold ${F.main}`,children:["PWR: ",s.power*r]})]},t):null}),(!S.troops||Object.values(S.troops).every(ut))&&(0,w.jsx)("div",{className:"col-span-4 text-center text-gray-500 italic text-xs",children:"Aucune troupe  bord."})]})]})]}),"build"===E&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:"flex gap-2 mb-4 border-b border-gray-800 pb-2",children:[(0,w.jsx)("button",{onClick:()=>A("ships"),className:`px-4 py-1 text-[10px] font-bold uppercase transition-all ${"ships"===T?`bg-${M?"blue":"green"}-900/50 text-white border border-${M?"blue":"green"}-500`:"text-gray-500 border border-transparent hover:border-gray-700"}`,children:"Vaisseaux"}),(0,w.jsx)("button",{onClick:()=>A("troops"),className:`px-4 py-1 text-[10px] font-bold uppercase transition-all ${"troops"===T?`bg-${M?"blue":"green"}-900/50 text-white border border-${M?"blue":"green"}-500`:"text-gray-500 border border-transparent hover:border-gray-700"}`,children:"Troupes"})]}),(0,w.jsxs)("div",{className:"space-y-2",children:["ships"===T&&Object.entries(d9).map(e=>{let[t,r]=e,s=r.tech_req&&!U.includes(r.tech_req);return(0,w.jsxs)("div",{className:`flex justify-between items-center border p-3 transition-colors relative overflow-hidden ${s?"bg-gray-900/50 border-gray-800 opacity-60 grayscale":"bg-black/40 border-gray-800 hover:border-gray-600"}`,children:[s&&(0,w.jsx)("div",{className:"absolute right-4 text-6xl opacity-10 pointer-events-none",children:""}),(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[(0,w.jsx)("div",{className:"text-3xl bg-gray-900 w-12 h-12 flex items-center justify-center rounded border border-gray-700",children:r.icon}),(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{className:"text-sm font-bold text-gray-200 uppercase",children:r.name}),(0,w.jsx)("div",{className:"text-[10px] text-gray-500",children:r.desc}),(0,w.jsxs)("div",{className:"flex gap-3 mt-1 text-[9px] font-mono",children:[(0,w.jsxs)("span",{className:"text-red-400",children:["ATK: ",r.power]}),(0,w.jsxs)("span",{className:"text-yellow-500",children:["CR: ",r.cost]}),(0,w.jsxs)("span",{className:"text-blue-400",children:["MAT: ",r.mat]})]})]})]}),s?(0,w.jsx)("div",{className:"px-4 py-2 border border-red-900 bg-red-950/20 text-red-500 text-[10px] font-bold uppercase rounded",children:"Technologie Requise"}):(0,w.jsx)("button",{onClick:()=>G(t,"ship"),className:`px-4 py-2 border ${F.border} ${F.main} hover:bg-white/10 text-xs font-bold uppercase`,children:"Construire"})]},t)}),"troops"===T&&Object.entries(d7).map(e=>{let[t,r]=e;return(0,w.jsxs)("div",{className:"flex justify-between items-center border border-gray-800 bg-black/40 p-3 hover:border-gray-600 transition-colors",children:[(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[(0,w.jsx)("div",{className:"text-3xl bg-gray-900 w-12 h-12 flex items-center justify-center rounded border border-gray-700",children:r.icon}),(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{className:"text-sm font-bold text-gray-200 uppercase",children:r.name}),(0,w.jsx)("div",{className:"text-[10px] text-gray-500",children:r.desc}),(0,w.jsxs)("div",{className:"flex gap-3 mt-1 text-[9px] font-mono",children:[(0,w.jsxs)("span",{className:"text-red-400",children:["ATK: ",r.power]}),(0,w.jsxs)("span",{className:"text-yellow-500",children:["CR: ",r.cost]}),(0,w.jsxs)("span",{className:"text-green-400",children:["MP: ",r.cost_mp]})]})]})]}),(0,w.jsx)("button",{onClick:()=>G(t,"troop"),className:`px-4 py-2 border ${F.border} ${F.main} hover:bg-white/10 text-xs font-bold uppercase`,children:"Recruter"})]},t)})]})]})]})]}):(0,w.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-600",children:[(0,w.jsx)("span",{className:"text-6xl mb-4 opacity-20",children:""}),(0,w.jsx)("p",{className:"uppercase tracking-widest text-sm",children:"Slectionnez une flotte pour initialiser le lien."})]}),m[8]=T,m[9]=v,m[10]=y,m[11]=x,m[12]=M,m[13]=k,m[14]=j,m[15]=b,m[16]=S,m[17]=F.bg,m[18]=F.border,m[19]=F.button,m[20]=F.glow,m[21]=F.main,m[22]=U,m[23]=g,m[24]=E,m[25]=s,m[26]=n,m[27]=i,m[28]=a,m[29]=o,m[30]=l,m[31]=c,m[32]=d}else s=m[25],n=m[26],i=m[27],a=m[28],o=m[29],l=m[30],c=m[31],d=m[32];return m[88]!==c||m[89]!==d?(u=(0,w.jsx)("div",{className:c,children:d}),m[88]=c,m[89]=d,m[90]=u):u=m[90],m[91]!==s||m[92]!==n||m[93]!==u?(h=(0,w.jsxs)("div",{className:s,children:[n,u]}),m[91]=s,m[92]=n,m[93]=u,m[94]=h):h=m[94],m[95]!==i||m[96]!==a||m[97]!==o||m[98]!==h?(p=(0,w.jsxs)("div",{className:i,children:[a,o,h]}),m[95]=i,m[96]=a,m[97]=o,m[98]=h,m[99]=p):p=m[99],m[100]!==l||m[101]!==p?(f=(0,w.jsx)("div",{className:l,children:p}),m[100]=l,m[101]=p,m[102]=f):f=m[102],f}function ut(e){return 0===e}function ur(e){return 0===e}function us(e){return(0,w.jsx)("option",{value:e.id,children:e.pseudo},e.id)}function un(e){return(0,w.jsx)("option",{value:e.id,children:e.name},e.id)}function ui(e,t){return e+t}function ua(e,t){return e+t}function uo(e){let t=0,r=0;return e.composition&&Object.entries(e.composition).forEach(e=>{let[s,n]=e;d9[s]&&(t+=d9[s].upkeep_cr*n,r+=d9[s].upkeep_mp*n)}),e.troops&&Object.entries(e.troops).forEach(e=>{let[s,n]=e;d7[s]&&(t+=d7[s].upkeep_cr*n,r+=d7[s].upkeep_mp*n)}),{cr:t,mp:r}}function ul(e){return"general"===e.role||"emperor"===e.role}let uc={fighter:{speed:4,hp:20,damage:5,range:100,cooldown:30,size:4,color:"#aaaaff",label:"Chasseur TIE/X",armor:0,armorPen:0,accuracy:.85,traits:["mechanized"],bonuses:{robotic:1.5}},corvette:{speed:3,hp:100,damage:20,range:200,cooldown:60,size:8,color:"#8888ff",label:"Corvette",armor:10,armorPen:5,accuracy:.8,traits:["mechanized"],bonuses:{mechanized:1.2}},frigate:{speed:2,hp:300,damage:50,range:300,cooldown:90,size:12,color:"#6666ff",label:"Frgate",armor:25,armorPen:15,accuracy:.75,traits:["mechanized"],bonuses:{mechanized:1.2}},cruiser:{speed:1.5,hp:800,damage:150,range:400,cooldown:120,size:16,color:"#4444ff",label:"Croiseur",armor:40,armorPen:30,accuracy:.7,traits:["mechanized"],bonuses:{mechanized:1.1}},dreadnought:{speed:1,hp:2500,damage:400,range:600,cooldown:180,size:24,color:"#2222ff",label:"Dreadnought",armor:60,armorPen:50,accuracy:.6,traits:["mechanized"],bonuses:{mechanized:1.1}},turret:{speed:0,hp:1e3,damage:100,range:500,cooldown:60,size:15,color:"#ffaaaa",label:"Station Dfensive",armor:30,armorPen:20,accuracy:.9,traits:["robotic"],bonuses:{mechanized:1.1}},admiral_ship:{speed:1.8,hp:1500,damage:250,range:450,cooldown:100,size:20,color:"#00ccff",label:"Vaisseau Amiral",isHero:!0,ability:"fleet_repair",maxMana:100,manaCost:50,armor:50,armorPen:40,accuracy:.9,traits:["mechanized"],bonuses:{mechanized:1.2,robotic:1.2}},grand_moff_ship:{speed:1.8,hp:1500,damage:300,range:500,cooldown:110,size:20,color:"#ff0000",label:"Vaisseau de Commandement",isHero:!0,ability:"orbital_bombardment",maxMana:100,manaCost:60,armor:55,armorPen:45,accuracy:.9,traits:["mechanized"],bonuses:{mechanized:1.2,biological:1.5}}},ud={republic:{ships:"#3b82f6",projectiles:"#60a5fa"},empire:{ships:"#ef4444",projectiles:"#f87171"},neutral:{ships:"#ffffff",projectiles:"#e2e8f0"}};function uu({attackerFleet:e,defenderFleets:t,defenderPlanet:r,onBattleEnd:s,customUnits:n=[]}){let i=(0,N.useMemo)(()=>{let e={...uc};return n.forEach(t=>{e[t.id]={speed:Number(t.speed||1),hp:Number(t.hp||100),damage:Number(t.damage||10),range:Number(t.range||200),cooldown:50,size:10,color:t.color||"#d946ef",label:t.name,armor:Number(t.armor||0),armorPen:10,accuracy:.85,traits:t.traits||[],bonuses:t.bonuses||{}}}),e},[n]),a=(0,N.useRef)(null),[o,l]=(0,N.useState)("fighting"),[c,d]=(0,N.useState)([]),[u,h]=(0,N.useState)(null),[p,f]=(0,N.useState)(!1),[m,g]=(0,N.useState)({x:0,y:0}),[x,b]=(0,N.useState)([]),[y,v]=(0,N.useState)(null),_=(0,N.useRef)(null),j=(0,N.useRef)(null),k=(0,N.useRef)({x:0,y:0}),S=(0,N.useRef)([]),C=(0,N.useRef)(!1),E=(0,N.useRef)([]),I=(0,N.useRef)([]),T=(0,N.useRef)([]),A=(0,N.useRef)([]),M=(0,N.useRef)();(0,N.useEffect)(()=>{_.current=u},[u]),(0,N.useEffect)(()=>{k.current=m},[m]),(0,N.useEffect)(()=>{S.current=c},[c]),(0,N.useEffect)(()=>{let e=setInterval(()=>{if(E.current){b(E.current.filter(e=>e.isAttacker).map(e=>({id:e.id,type:e.type,hp:e.hp,maxHp:e.maxHp,state:e.state})));let e=S.current;if(e.length>0){let t=E.current.find(t=>t.id===e[0]);t?v({id:t.id,type:t.type,faction:t.faction,hp:t.hp,maxHp:t.maxHp,mana:t.mana,maxMana:t.maxMana,isSquad:t.isSquad,shipCount:t.ships?t.ships.length:1,cooldown:t.cooldown}):v(null)}else v(null)}},100);return()=>clearInterval(e)},[]),(0,N.useEffect)(()=>{let s=window.innerWidth,n=window.innerHeight,a=[],o=0,l=(e,t,r)=>{let l=r?.2*s:.8*s,c=n/2;Object.entries(e).forEach(([e,s])=>{if(i[e])if("fighter"===e){let n=Math.ceil(s/5);for(let s=0;s<n;s++){let s=[],n=[{x:0,y:0},{x:-10,y:-10},{x:-10,y:10},{x:-20,y:-20},{x:-20,y:20}];for(let t=0;t<5;t++)s.push({id:t,xOff:n[t].x+(Math.random()-.5)*5,yOff:n[t].y+(Math.random()-.5)*5,hp:i[e].hp,maxHp:i[e].hp,cooldown:Math.random()*i[e].cooldown});a.push({id:o++,type:e,faction:t,isAttacker:r,x:l+(Math.random()-.5)*400,y:c+(Math.random()-.5)*400,angle:r?0:Math.PI,isSquad:!0,ships:s,maxHp:5*i[e].hp,target:null,manualMove:null,state:"idle"})}}else for(let n=0;n<s;n++)a.push({id:o++,type:e,faction:t,isAttacker:r,x:l+(Math.random()-.5)*400,y:c+(Math.random()-.5)*400,angle:r?0:Math.PI,hp:i[e].hp,maxHp:i[e].hp,mana:i[e].maxMana||0,maxMana:i[e].maxMana||0,cooldown:Math.random()*i[e].cooldown,target:null,manualMove:null,state:"idle"})})};if(e&&e.composition&&(l(e.composition,e.owner||"republic",!0),"empire"!==e.owner&&l({admiral_ship:1},"republic",!0)),t&&(t.forEach(e=>{l(e.composition,e.owner||"empire",!1)}),l({grand_moff_ship:1},"empire",!1)),r&&r.garrison){let e=r.garrison;if(e.turret)for(let t=0;t<e.turret;t++)a.push({id:o++,type:"turret",faction:r.owner||"empire",isAttacker:!1,x:.9*s+(Math.random()-.5)*100,y:n/(e.turret+1)*(t+1),angle:Math.PI,hp:i.turret.hp,maxHp:i.turret.hp,cooldown:Math.random()*i.turret.cooldown,target:null,state:"idle"})}E.current=a},[e,t,r,i]),(0,N.useEffect)(()=>{let e=a.current,t=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight;let r=()=>{if("fighting"!==o)return;let e=E.current,n=I.current,a=T.current,c=e.some(e=>e.isAttacker),u=e.some(e=>!e.isAttacker);if(c||u)if(c){if(!u){l("victory"),R("victory");return}}else{l("defeat"),R("defeat");return}else{l("draw"),R("draw");return}e.forEach(t=>{let r=i[t.type];if(t.target&&!e.find(e=>e.id===t.target.id)&&(t.target=null),!t.manualMove&&!t.target){let r=null,s=1/0;e.forEach(e=>{if(t.isAttacker!==e.isAttacker){let n=e.x-t.x,i=e.y-t.y,a=Math.sqrt(n*n+i*i);a<s&&(s=a,r=e)}}),t.target=r}let s=null,a=!1;if(t.manualMove){let e=(s=t.manualMove).x-t.x,r=s.y-t.y;10>Math.sqrt(e*e+r*r)&&(t.manualMove=null,void 0!==t.fixedOrientation&&(t.angle=t.fixedOrientation))}else t.target&&void 0===t.fixedOrientation&&(s=t.target,a=!0);if(s&&r.speed>0){let e=s.x-t.x,n=s.y-t.y,i=Math.sqrt(e*e+n*n),o=Math.atan2(n,e);t.angle=o,(!a||i>.95*r.range)&&(t.x+=Math.cos(o)*r.speed,t.y+=Math.sin(o)*r.speed)}if(t.target){let e=t.target.x-t.x,s=t.target.y-t.y,i=Math.sqrt(e*e+s*s);t.manualMove||void 0!==t.fixedOrientation||(t.angle=Math.atan2(s,e)),i<=r.range&&(t.isSquad&&t.ships?t.ships.forEach(e=>{if(e.cooldown>0)return;let s=t.angle,i=t.x+e.xOff*Math.cos(s)-e.yOff*Math.sin(s),a=t.y+e.xOff*Math.sin(s)+e.yOff*Math.cos(s),o=(Math.random()-.5)*.1;n.push({x:i,y:a,vx:10*Math.cos(t.angle+o),vy:10*Math.sin(t.angle+o),damage:r.damage,armorPen:r.armorPen||0,accuracy:r.accuracy||.85,bonuses:r.bonuses||{},faction:t.faction,color:ud[t.faction]?.projectiles||"#fff",life:60}),e.cooldown=r.cooldown*(.8+.4*Math.random())}):t.cooldown<=0&&(n.push({x:t.x,y:t.y,vx:10*Math.cos(t.angle),vy:10*Math.sin(t.angle),damage:r.damage,armorPen:r.armorPen||0,accuracy:r.accuracy||.85,bonuses:r.bonuses||{},faction:t.faction,color:ud[t.faction]?.projectiles||"#fff",life:100}),t.cooldown=r.cooldown),r.isHero&&t.mana<t.maxMana&&(t.mana+=.05))}t.isSquad&&t.ships?t.ships.forEach(e=>{e.cooldown>0&&e.cooldown--}):t.cooldown>0&&t.cooldown--});for(let t=n.length-1;t>=0;t--){let r=n[t];if(r.x+=r.vx,r.y+=r.vy,r.life--,r.life<=0){n.splice(t,1);continue}let s=!1;for(let t of e){if(ud[t.faction]===ud[r.faction]||t.faction===r.faction)continue;let n=!1,o=i[t.type];if(Math.random()>(r.accuracy||.85))continue;let l=Math.min(.9,Math.max(0,(o.armor||0)-(r.armorPen||0))/100),c=1;r.bonuses&&o.traits&&o.traits.forEach(e=>{r.bonuses[e]&&(c*=r.bonuses[e])});let u=r.damage*c*(1-l);if(t.isSquad&&t.ships){let e=t.angle,s=Math.cos(e),i=Math.sin(e);for(let e of t.ships){let l=t.x+e.xOff*s-e.yOff*i,c=t.y+e.xOff*i+e.yOff*s,d=l-r.x,h=c-r.y;if(Math.sqrt(d*d+h*h)<o.size+4){e.hp-=u,a.push({x:l,y:c,life:10,size:5}),n=!0;break}}n&&(t.ships=t.ships.filter(e=>e.hp>0),t.hp=t.ships.reduce((e,t)=>e+t.hp,0),t.ships.length)}else{let e=t.x-r.x,s=t.y-r.y;Math.sqrt(e*e+s*s)<o.size+5&&(t.hp-=u,a.push({x:r.x,y:r.y,life:10,size:5}),n=!0)}if(n){if(s=!0,t.hp<=0){a.push({x:t.x,y:t.y,life:30,size:20});let r=e.indexOf(t);r>-1&&(d(e=>e.filter(e=>e!==t.id)),e.splice(r,1))}break}}s&&n.splice(t,1)}for(let e=a.length-1;e>=0;e--)a[e].life--,a[e].life<=0&&a.splice(e,1);let h=A.current;for(let t=h.length-1;t>=0;t--){if(h[t].life--,"attack"===h[t].type&&h[t].targetId){let r=e.find(e=>e.id===h[t].targetId);r&&(h[t].targetX=r.x,h[t].targetY=r.y)}h[t].life<=0&&h.splice(t,1)}s(t,e,n,a,h),M.current=requestAnimationFrame(r)},s=(t,r,s,n,a=[])=>{t.fillStyle="#050510",t.fillRect(0,0,e.width,e.height),a.forEach(e=>{t.save(),t.globalAlpha=Math.min(1,e.life/20),t.lineWidth=2,t.strokeStyle="move"===e.type?"#00ff00":"#ff0000",t.fillStyle="move"===e.type?"#00ff00":"#ff0000",t.beginPath(),t.moveTo(e.startX,e.startY),t.lineTo(e.targetX,e.targetY),t.stroke();let r=Math.atan2(e.targetY-e.startY,e.targetX-e.startX);t.translate(e.targetX,e.targetY),t.rotate(r),t.beginPath(),t.moveTo(0,0),t.lineTo(-10,-5),t.lineTo(-10,5),t.closePath(),t.fill(),t.rotate(-r),t.beginPath(),t.arc(0,0,5+(40-e.life)/2,0,2*Math.PI),t.stroke(),t.restore()});let o=_.current,l=k.current;o&&l&&(t.strokeStyle="#00ff00",t.lineWidth=1,t.strokeRect(o.x,o.y,l.x-o.x,l.y-o.y),t.fillStyle="rgba(0, 255, 0, 0.1)",t.fillRect(o.x,o.y,l.x-o.x,l.y-o.y));let c=S.current;r.forEach(e=>{let r=i[e.type],s=c.includes(e.id);t.save(),t.translate(e.x,e.y),s&&(t.beginPath(),t.arc(0,0,r.size+10,0,2*Math.PI),t.strokeStyle="#00ff00",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(0,0),t.arc(0,0,r.range,e.angle-Math.PI/6,e.angle+Math.PI/6),t.lineTo(0,0),t.fillStyle="rgba(0, 255, 0, 0.05)",t.fill(),t.strokeStyle="rgba(0, 255, 0, 0.2)",t.stroke(),t.beginPath(),t.arc(0,0,r.range,0,2*Math.PI),t.strokeStyle="rgba(255, 255, 255, 0.05)",t.setLineDash([2,4]),t.stroke(),t.setLineDash([])),t.rotate(e.angle),t.fillStyle=ud[e.faction]?.ships||"#fff",e.isSquad&&e.ships?e.ships.forEach(s=>{t.beginPath(),"fighter"===e.type?(t.moveTo(s.xOff+r.size,s.yOff),t.lineTo(s.xOff-r.size,s.yOff-r.size/2),t.lineTo(s.xOff-r.size,s.yOff+r.size/2)):t.arc(s.xOff,s.yOff,r.size,0,2*Math.PI),t.fill()}):(t.beginPath(),"turret"===e.type?t.rect(-r.size,-r.size,2*r.size,2*r.size):(t.moveTo(r.size,0),t.lineTo(-r.size,-r.size/2),t.lineTo(-r.size,r.size/2)),t.fill()),e.isSquad?(t.fillStyle="red",t.fillRect(-15,-20,30,3),t.fillStyle="green",t.fillRect(-15,-20,30*(e.hp/e.maxHp),3)):(t.fillStyle="red",t.fillRect(-10,-r.size-8,20,3),t.fillStyle="green",t.fillRect(-10,-r.size-8,20*(e.hp/e.maxHp),3)),t.restore()}),s.forEach(e=>{t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,2,0,2*Math.PI),t.fill()}),n.forEach(e=>{t.fillStyle=`rgba(255, 100, 50, ${e.life/30})`,t.beginPath(),t.arc(e.x,e.y,e.size*(1-e.life/30)+e.size,0,2*Math.PI),t.fill()})};return M.current=requestAnimationFrame(r),()=>cancelAnimationFrame(M.current)},[o,c,u,m]);let R=e=>{s({winner:"victory"===e?"attacker":"defender",survivingAttackers:E.current.filter(e=>e.isAttacker),survivingDefenders:E.current.filter(e=>!e.isAttacker)})};return(0,w.jsxs)("div",{className:"fixed inset-0 z-[200]",children:[(0,w.jsx)("canvas",{ref:a,onMouseDown:e=>{if(0===e.button){let t=a.current.getBoundingClientRect();h({x:e.clientX-t.left,y:e.clientY-t.top})}else if(2===e.button)if(e.preventDefault(),p){let t=a.current.getBoundingClientRect();j.current={x:e.clientX-t.left,y:e.clientY-t.top}}else(e=>{if(0===c.length)return;let t=a.current.getBoundingClientRect(),r=e.clientX-t.left,s=e.clientY-t.top,n=null;E.current.forEach(e=>{e.isAttacker||20>Math.sqrt(Math.pow(e.x-r,2)+Math.pow(e.y-s,2))&&(n=e)});let i=E.current.filter(e=>c.includes(e.id)),o=0,l=0;i.length>0&&(o=i.reduce((e,t)=>e+t.x,0)/i.length,l=i.reduce((e,t)=>e+t.y,0)/i.length);let d="move";E.current.forEach(e=>{c.includes(e.id)&&(n?(e.target=n,e.manualMove=null,d="attack"):(e.manualMove={x:r,y:s},e.target=null))}),i.length>0&&("attack"===d&&n?A.current.push({type:"attack",startX:o,startY:l,targetX:n.x,targetY:n.y,targetId:n.id,life:40}):A.current.push({type:"move",startX:o,startY:l,targetX:r,targetY:s,life:40}))})(e)},onMouseMove:e=>{if(!a.current)return;let t=a.current.getBoundingClientRect();g({x:e.clientX-t.left,y:e.clientY-t.top})},onMouseUp:e=>{if(2===e.button&&j.current){let t=a.current.getBoundingClientRect(),r=e.clientX-t.left,s=e.clientY-t.top,n=r-j.current.x,i=Math.atan2(s-j.current.y,n);E.current.forEach(e=>{S.current.includes(e.id)&&(e.manualMove={x:j.current.x,y:j.current.y},e.fixedOrientation=i,e.target=null)}),A.current.push({type:"orientation",startX:j.current.x,startY:j.current.y,endX:r,endY:s,life:40}),j.current=null,f(!1)}else if(0===e.button&&u){let t=a.current.getBoundingClientRect(),r=e.clientX-t.left,s=e.clientY-t.top,n=Math.min(u.x,r),i=Math.min(u.y,s),o=Math.max(u.x,r),l=Math.max(u.y,s),c=[];E.current.forEach(e=>{e.isAttacker&&(e.isAttacker&&e.x>=n&&e.x<=o&&e.y>=i&&e.y<=l?c.push(e.id):e.isAttacker&&5>Math.abs(n-o)&&5>Math.abs(i-l)&&20>Math.sqrt(Math.pow(e.x-n,2)+Math.pow(e.y-i,2))&&c.push(e.id))}),d(c),h(null)}},onContextMenu:e=>e.preventDefault(),className:"w-full h-full cursor-crosshair"}),(0,w.jsxs)("div",{className:"absolute top-4 left-4 text-white text-xl font-bold bg-black/50 px-4 py-2 rounded pointer-events-none",children:["Combat Spatial - ",r?.name||"Secteur Inconnu"]}),(0,w.jsx)("div",{className:"absolute top-4 right-4 flex gap-2",children:(0,w.jsx)("button",{onClick:()=>f(!p),className:`px-4 py-2 font-bold rounded border-2 shadow-lg transition-all ${p?"bg-yellow-600 border-yellow-400 text-white shadow-[0_0_15px_rgba(234,179,8,0.5)]":"bg-gray-900/80 border-gray-600 text-gray-400 hover:bg-gray-800"}`,children:" ORIENTATION"})}),"fighting"!==o&&(0,w.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",pointerEvents:"auto"},children:[(0,w.jsx)("h2",{style:{fontSize:"4rem",color:"victory"===o?"#4ade80":"#f87171",fontWeight:"bold"},children:"victory"===o?"VICTOIRE":"draw"===o?"EGALIT":"DFAITE"}),(0,w.jsx)("button",{onClick:()=>R(o),className:"mt-4 px-6 py-3 bg-white text-black font-bold rounded hover:bg-gray-200",children:"Terminer la bataille"})]}),y&&i[y.type]&&(0,w.jsxs)("div",{className:"absolute bottom-32 right-4 w-80 bg-gray-900/95 border-2 border-[#8B5A2B] rounded-lg shadow-2xl overflow-hidden backdrop-blur-md text-white z-[210]",children:[(0,w.jsxs)("div",{className:"bg-gradient-to-r from-gray-800 to-gray-900 p-3 border-b border-gray-700 flex justify-between items-center",children:[(0,w.jsx)("span",{className:"font-bold uppercase text-[#fbbf24] tracking-wider text-sm",children:i[y.type].label}),(0,w.jsxs)("span",{className:"text-xs text-gray-500 font-mono",children:["#",y.id]})]}),(0,w.jsxs)("div",{className:"p-4 space-y-4",children:[(0,w.jsxs)("div",{className:"flex justify-center py-2 relative",children:[(0,w.jsx)("div",{className:`w-24 h-24 rounded-full flex items-center justify-center border-2 border-gray-600 ${"republic"===y.faction?"bg-blue-900/40 text-blue-400":"bg-red-900/40 text-red-400"}`,children:(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:"w-14 h-14",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 2L4 22h16L12 2zm0 4l4 13H8l4-13z"})})}),i[y.type].isHero&&(0,w.jsx)("div",{className:"absolute -top-1 -right-1 bg-yellow-500 text-black text-[10px] font-bold px-2 py-0.5 rounded-full border border-yellow-300 shadow-glow",children:"HERO"})]}),(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsxs)("div",{className:"space-y-1",children:[(0,w.jsxs)("div",{className:"flex justify-between text-xs text-gray-400",children:[(0,w.jsx)("span",{children:"Boucliers"}),(0,w.jsxs)("span",{children:[Math.ceil(y.hp)," / ",y.maxHp]})]}),(0,w.jsx)("div",{className:"w-full h-2 bg-gray-800 rounded-full overflow-hidden",children:(0,w.jsx)("div",{className:"h-full bg-green-500",style:{width:`${y.hp/y.maxHp*100}%`}})})]}),i[y.type].isHero&&(0,w.jsxs)("div",{className:"space-y-1",children:[(0,w.jsxs)("div",{className:"flex justify-between text-xs text-gray-400",children:[(0,w.jsx)("span",{children:"nergie"}),(0,w.jsxs)("span",{children:[Math.floor(y.mana)," / ",y.maxMana]})]}),(0,w.jsx)("div",{className:"w-full h-2 bg-gray-800 rounded-full overflow-hidden",children:(0,w.jsx)("div",{className:"h-full bg-blue-500",style:{width:`${y.mana/y.maxMana*100}%`}})})]})]}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,w.jsxs)("div",{className:"bg-gray-800/50 p-2 rounded flex justify-between",children:[(0,w.jsx)("span",{className:"text-gray-400",children:"Dgts"}),(0,w.jsx)("span",{className:"font-bold",children:i[y.type].damage})]}),(0,w.jsxs)("div",{className:"bg-gray-800/50 p-2 rounded flex justify-between",children:[(0,w.jsx)("span",{className:"text-gray-400",children:"Pntration"}),(0,w.jsx)("span",{className:"font-bold text-red-300",children:i[y.type].armorPen||0})]}),(0,w.jsxs)("div",{className:"bg-gray-800/50 p-2 rounded flex justify-between",children:[(0,w.jsx)("span",{className:"text-gray-400",children:"Armure"}),(0,w.jsx)("span",{className:"font-bold text-yellow-300",children:i[y.type].armor||0})]}),(0,w.jsxs)("div",{className:"bg-gray-800/50 p-2 rounded flex justify-between",children:[(0,w.jsx)("span",{className:"text-gray-400",children:"Prcision"}),(0,w.jsxs)("span",{className:"font-bold text-blue-300",children:[Math.round(100*(i[y.type].accuracy||.85)),"%"]})]})]}),(0,w.jsxs)("div",{className:"space-y-1",children:[i[y.type].traits&&(0,w.jsx)("div",{className:"flex gap-1 flex-wrap",children:i[y.type].traits.map(e=>(0,w.jsx)("span",{className:"px-2 py-0.5 bg-gray-700 rounded text-[10px] uppercase text-gray-300 border border-gray-600 font-mono tracking-tight",children:"mechanized"===e?" MCA":"robotic"===e?" ROBOT":"biological"===e?" BIO":e},e))}),i[y.type].bonuses&&(0,w.jsxs)("div",{className:"text-[10px] text-green-400",children:[(0,w.jsx)("span",{className:"text-gray-500 mr-1",children:"Bonus:"}),Object.entries(i[y.type].bonuses).map(([e,t])=>(0,w.jsxs)("span",{className:"mr-2",children:["vs ",e.toUpperCase()," +",Math.round((t-1)*100),"%"]},e))]})]}),i[y.type].isHero&&(0,w.jsxs)("button",{onMouseEnter:()=>C.current=!0,onMouseLeave:()=>C.current=!1,onClick:()=>((e,t)=>{let r=E.current.find(t=>t.id===e);if(!r||!i[r.type].isHero)return;let s=i[r.type];if(!(r.mana<(s.manaCost||0))){if(r.mana-=s.manaCost,"fleet_repair"===t)E.current.forEach(e=>{e.faction===r.faction&&500>Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))&&(e.isSquad&&e.ships?(e.ships.forEach(t=>t.hp=Math.min(i[e.type].hp,t.hp+500)),e.hp=e.ships.reduce((e,t)=>e+t.hp,0)):e.hp=Math.min(e.maxHp,e.hp+500),T.current.push({x:e.x,y:e.y,life:30,size:20,color:"#4ade80"}))}),T.current.push({x:r.x,y:r.y,life:40,size:500,color:"rgba(74, 222, 128, 0.2)"});else if("orbital_bombardment"===t){let e=r.target?r.target.x:r.x+400*Math.cos(r.angle),t=r.target?r.target.y:r.y+400*Math.sin(r.angle);E.current.forEach(s=>{200>Math.sqrt(Math.pow(s.x-e,2)+Math.pow(s.y-t,2))&&s.faction!==r.faction&&(s.isSquad&&s.ships?(s.ships.forEach(e=>e.hp-=800),s.hp=s.ships.reduce((e,t)=>e+t.hp,0)):s.hp-=800)}),T.current.push({x:e,y:t,life:50,size:200,color:"#ef4444"})}else if("emergency_shields"===t)E.current.forEach(e=>{e.faction===r.faction&&400>Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))&&(e.isSquad&&e.ships?(e.ships.forEach(t=>t.hp=Math.min(i[e.type].hp,t.hp+1e3)),e.hp=e.ships.reduce((e,t)=>e+t.hp,0)):e.hp=Math.min(e.maxHp,e.hp+1e3))}),T.current.push({x:r.x,y:r.y,life:50,size:400,color:"rgba(0, 200, 255, 0.3)"});else if("concentrated_fire"===t){let e=r.target;if(e){e.isSquad&&e.ships?(e.ships.forEach(t=>t.hp-=2500/e.ships.length),e.hp=e.ships.reduce((e,t)=>e+t.hp,0)):e.hp-=2500,T.current.push({x:e.x,y:e.y,life:40,size:80,color:"#ff5500"});let t=e.x-r.x,s=e.y-r.y;for(let e=0;e<15;e++)T.current.push({x:r.x+e/15*t,y:r.y+e/15*s,life:15,size:10,color:"#ff0000"})}}}})(y.id,i[y.type].ability),disabled:y.mana<i[y.type].manaCost,className:`w-full py-2 rounded font-bold border flex items-center justify-center gap-2 transition-all ${y.mana>=i[y.type].manaCost?"bg-blue-900/50 border-blue-500 hover:bg-blue-800 text-blue-100 shadow-[0_0_10px_rgba(59,130,246,0.3)]":"bg-gray-800 border-gray-700 text-gray-500 cursor-not-allowed"}`,children:[(0,w.jsx)("span",{children:""}),"fleet_repair"===i[y.type].ability?"Rparation Flotte":"Bombardement Ionique",(0,w.jsxs)("span",{className:"text-xs ml-1 opacity-70",children:["(",i[y.type].manaCost,")"]})]})]})]}),(0,w.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-gray-900/90 border-t-2 border-[#8B5A2B] p-2 flex gap-2 h-28 items-center overflow-x-auto custom-scrollbar backdrop-blur-md",children:[(0,w.jsxs)("div",{className:"flex-shrink-0 mr-4 border-r border-gray-700 pr-4 flex flex-col justify-center items-center text-gray-500",children:[(0,w.jsx)("span",{className:"text-2xl",children:""}),(0,w.jsx)("span",{className:"text-[10px] uppercase font-bold",children:"Flotte"}),(0,w.jsx)("span",{className:"text-xs text-white font-mono",children:x.length})]}),x.map(e=>{let t=c.includes(e.id),r=i[e.type],s=e.hp/e.maxHp*100;return(0,w.jsxs)("div",{onClick:t=>{t.ctrlKey?d(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]):d([e.id])},className:`relative w-20 h-24 flex-shrink-0 border-2 rounded p-1 cursor-pointer transition-all hover:bg-gray-800 group
                                ${t?"border-blue-500 bg-blue-900/20 shadow-[0_0_10px_rgba(59,130,246,0.3)]":"border-gray-700 bg-black/40 hover:border-gray-500"}
                            `,children:[(0,w.jsx)("div",{className:"h-2/3 flex items-center justify-center p-1",children:(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:`w-8 h-8 drop-shadow-md ${"fighter"===e.type?"text-gray-300":"text-blue-300"}`,fill:"currentColor",children:(0,w.jsx)("path",{d:"fighter"===e.type?"M12 2L4 22h16L12 2zm0 4l4 13H8l4-13z":"M2 6h20v12H2z"})})}),(0,w.jsxs)("div",{className:"absolute top-1 right-1 text-[8px] font-mono text-gray-400",children:["#",e.id]}),(0,w.jsxs)("div",{className:"absolute bottom-1 left-1 right-1 space-y-1",children:[(0,w.jsx)("div",{className:"text-[9px] text-center font-bold text-gray-300 truncate leading-none mb-1",children:r.label}),(0,w.jsx)("div",{className:"w-full h-1.5 bg-gray-800 rounded-full overflow-hidden border border-gray-600",children:(0,w.jsx)("div",{className:"h-full transition-all duration-300",style:{width:`${s}%`,backgroundColor:s>50?"#3b82f6":s>20?"#eab308":"#ef4444"}})})]})]},e.id)})]})]})}let uh={infantry:{speed:1.5,hp:15,damage:3,range:80,cooldown:20,size:3,color:"#aaaaff",label:"Infanterie",armor:10,armorPen:0,accuracy:.85,traits:["biological"],bonuses:{biological:1.1}},heavy_infantry:{speed:1,hp:40,damage:10,range:120,cooldown:45,size:5,color:"#8888ff",label:"Infanterie Lourde",armor:40,armorPen:15,accuracy:.8,traits:["biological"],bonuses:{mechanized:1.5,robotic:1.2}},vehicle:{speed:2.5,hp:120,damage:35,range:200,cooldown:70,size:9,color:"#4444ff",label:"Vhicule Blind",armor:60,armorPen:30,accuracy:.7,traits:["mechanized"],bonuses:{biological:1.5,mechanized:1}},turret:{speed:0,hp:250,damage:40,range:300,cooldown:30,size:12,color:"#ffaaaa",label:"Tourelle Dfensive",armor:30,armorPen:20,accuracy:.9,traits:["robotic"],bonuses:{mechanized:1.2}},jedi_general:{speed:2.2,hp:450,damage:60,range:40,cooldown:12,size:8,color:"#00ff00",label:"Gnral Jedi",isHero:!0,isMelee:!0,abilities:[],maxMana:100,manaRegen:1,armor:30,armorPen:50,accuracy:.95,traits:["biological"],bonuses:{robotic:2,mechanized:1.5}},sith_lord:{speed:2.2,hp:450,damage:70,range:40,cooldown:12,size:8,color:"#ff0000",label:"Seigneur Sith",isHero:!0,isMelee:!0,abilities:[],maxMana:100,manaRegen:1,armor:30,armorPen:55,accuracy:.95,traits:["biological"],bonuses:{robotic:2,mechanized:1.5}},mandalorian_commander:{speed:2,hp:400,damage:50,range:100,cooldown:10,size:8,color:"#ff8800",label:"Commandant Mandalorien",isHero:!0,isMelee:!1,abilities:[],maxMana:100,manaRegen:1,armor:45,armorPen:40,accuracy:.9,traits:["biological","mechanized"],bonuses:{mechanized:1.5}}},up={republic:{units:"#3b82f6",projectiles:"#60a5fa"},empire:{units:"#ef4444",projectiles:"#f87171"},neutral:{units:"#ffffff",projectiles:"#e2e8f0"}},uf={plains:{color:"#2d5a27",speedMod:1,rangeMod:1,label:"Plaines"},desert:{color:"#e6c288",speedMod:.8,rangeMod:1.2,accuracyMod:.9,label:"Dsert"},urban:{color:"#333333",speedMod:1.2,rangeMod:.8,accuracyMod:.9,label:"Urbain"},snow:{color:"#e5e7eb",speedMod:.7,rangeMod:1,accuracyMod:.8,label:"Polaire"},volcanic:{color:"#2b0a0a",speedMod:.9,rangeMod:1,damageMod:1.1,label:"Volcanique"},forest:{color:"#143316",speedMod:.8,rangeMod:.8,accuracyMod:.8,label:"Fort"},force_nexus:{color:"#290038",speedMod:1,rangeMod:1,manaRegenMod:2,damageMod:1.2,label:"Nexus de Force"},industrial:{color:"#3f3f46",speedMod:1.1,rangeMod:1,label:"Industriel"},unknown:{color:"#2d241b",speedMod:1,rangeMod:1,label:"Standard"}};function um({attackerArmy:e,defenderGarrison:t,planetType:r,onBattleEnd:s,customUnits:n=[],customMap:i=null,heroData:a=null,magicDomains:o=[]}){let l=(0,N.useRef)(null),[c,d]=(0,N.useState)("fighting"),u=uf[r]||uf.unknown,[h,p]=(0,N.useState)({x:0,y:0,zoom:.8}),f=(0,N.useRef)({x:0,y:0,zoom:.8});(0,N.useEffect)(()=>{f.current=h},[h]);let m=(0,N.useMemo)(()=>{let e=JSON.parse(JSON.stringify(uh));return n.forEach(t=>{let r={...t,speed:t.speed||2,hp:t.hp||50,damage:t.damage||5,range:t.range||100,cooldown:t.cooldown||30,size:t.size||5,color:t.color||"#fff",label:t.name,armor:t.armor||0,armorPen:t.armorPen||0,accuracy:t.accuracy||.8,traits:t.traits||["biological"],bonuses:t.bonuses||{},abilities:t.abilities||[]};if(o){if(t.domainId){let e=o.find(e=>e.id===t.domainId);e&&e.talents&&e.talents.forEach(e=>{if(("active"===e.type||"ultimate"===e.type)&&!r.abilities.find(t=>t.id===e.id)){let t="point";("projectile"===e.archetype||"beam"===e.archetype)&&(t="target_enemy"),("explosion"===e.archetype||"heal"===e.archetype)&&(t="area"),"buff"!==e.archetype&&("summon"!==e.archetype||e.stats?.range)||(t="instant"),r.abilities.push({id:e.id,type:t,label:e.label,cost:e.stats?.cost||0,cooldown:e.stats?.cooldown||100})}})}if(t.ability&&!r.abilities.find(e=>e.id===t.ability))for(let e of o){let s=e.talents?.find(e=>e.id===t.ability);if(s){let e="point";("projectile"===s.archetype||"beam"===s.archetype)&&(e="target_enemy"),("explosion"===s.archetype||"heal"===s.archetype)&&(e="area"),"buff"!==s.archetype&&("summon"!==s.archetype||s.stats?.range)||(e="instant"),r.abilities.push({id:s.id,type:e,label:s.label,cost:s.stats?.cost||0,cooldown:s.stats?.cooldown||100});break}}}e[t.id]=r}),a&&a.unlocked&&["jedi_general","sith_lord","mandalorian_commander"].forEach(t=>{if(e[t]){let r=e[t];r.abilities=r.abilities||[],a.unlocked.includes("mag_d1")&&(r.lifeSteal=20),a.unlocked.includes("mag_d2")&&(r.damage=Math.round(1.1*r.damage)),a.unlocked.includes("mag_d3")&&!r.abilities.find(e=>"force_lightning"===e.id)&&r.abilities.push({id:"force_lightning",type:"target_enemy",label:"clair",cost:35,cooldown:150}),a.unlocked.includes("mag_d4")&&(r.lifeSteal=(r.lifeSteal||0)+10),a.unlocked.includes("mag_d6")&&!r.abilities.find(e=>"force_storm"===e.id)&&r.abilities.push({id:"force_storm",type:"area",label:"Tempte",cost:60,cooldown:300}),a.unlocked.includes("mag_d7")&&(r.hp=Math.round(1.2*r.hp),r.damage=Math.round(1.2*r.damage)),a.unlocked.includes("mag_l1")&&(r.manaRegen=(r.manaRegen||1)+2),a.unlocked.includes("mag_l2")&&(r.manaCostMod=.9),a.unlocked.includes("mag_l3")&&!r.abilities.find(e=>"force_heal"===e.id)&&r.abilities.push({id:"force_heal",type:"target_ally",label:"Gurison",cost:40,cooldown:120}),a.unlocked.includes("mag_l4")&&(r.armor+=15),a.unlocked.includes("mag_l5")&&(r.shield=50),a.unlocked.includes("mag_l6")&&!r.abilities.find(e=>"force_push"===e.id)&&r.abilities.push({id:"force_push",type:"area",label:"Onde de Paix",cost:30,cooldown:100}),a.unlocked.includes("mag_l7")&&!r.abilities.find(e=>"force_avatar"===e.id)&&r.abilities.push({id:"force_avatar",type:"instant",label:"Avatar",cost:80,cooldown:600}),a.unlocked.includes("mag_m1")&&(r.armor+=50),a.unlocked.includes("mag_m2")&&(r.accuracy=Math.min(1,r.accuracy+.15)),a.unlocked.includes("mag_m3")&&!r.abilities.find(e=>"mando_missile"===e.id)&&r.abilities.push({id:"mando_missile",type:"target_enemy",label:"Arsenal",cost:30,cooldown:150}),a.unlocked.includes("mag_m4")&&(r.explosiveResist=.5),a.unlocked.includes("mag_m5")&&(r.speed=1.5*r.speed,r.isFlying=!0),a.unlocked.includes("mag_m6")&&!r.abilities.find(e=>"mando_flame"===e.id)&&r.abilities.push({id:"mando_flame",type:"cone",label:"Pyro",cost:40,cooldown:100}),a.unlocked.includes("mag_m7")&&!r.abilities.find(e=>"mando_reinforce"===e.id)&&r.abilities.push({id:"mando_reinforce",type:"instant",label:"Mand'alor",cost:90,cooldown:900})}}),e},[n,a,o]),[g,x]=(0,N.useState)([]),[b,y]=(0,N.useState)(null),[v,_]=(0,N.useState)(!1),[j,k]=(0,N.useState)({x:0,y:0}),[S,C]=(0,N.useState)([]),[E,I]=(0,N.useState)(null),[T,A]=(0,N.useState)(null),M=(0,N.useRef)(null),R=(0,N.useRef)(null),P=(0,N.useRef)(!1),D=(0,N.useRef)({x:0,y:0}),O=(0,N.useRef)({x:0,y:0}),L=(0,N.useRef)([]),F=(0,N.useRef)(!1),U=(0,N.useRef)(null),z=(0,N.useRef)([]),V=(0,N.useRef)([]),$=(0,N.useRef)([]),q=(0,N.useRef)([]),B=(0,N.useRef)([]),H=(0,N.useRef)();(0,N.useEffect)(()=>{M.current=b},[b]),(0,N.useEffect)(()=>{O.current=j},[j]),(0,N.useEffect)(()=>{L.current=g},[g]),(0,N.useEffect)(()=>{U.current=T},[T]),(0,N.useEffect)(()=>{let e=setInterval(()=>{if(z.current){C(z.current.filter(e=>e.isAttacker).map(e=>({id:e.id,type:e.type,hp:e.hp,maxHp:e.maxHp,mana:e.mana,maxMana:e.maxMana,state:e.state})));let e=L.current;if(e.length>0){let t=z.current.find(t=>t.id===e[0]);t?I({id:t.id,type:t.type,faction:t.faction,hp:t.hp,maxHp:t.maxHp,mana:t.mana,maxMana:t.maxMana,isSquad:t.isSquad,soldierCount:t.soldiers?t.soldiers.length:1,cooldown:t.cooldown}):I(null)}else I(null)}},100);return()=>clearInterval(e)},[]),(0,N.useEffect)(()=>{p({x:1500-window.innerWidth/2,y:1e3-window.innerHeight/2,zoom:.6});let s=[],n=[],a=0,o=(e,t,r)=>{for(let s of n)if("rect"===s.shape){let n=r+20;if(e>s.x-s.width/2-n&&e<s.x+s.width/2+n&&t>s.y-s.height/2-n&&t<s.y+s.height/2+n)return!1}else{let n=e-s.x,i=t-s.y,a=s.size/2+r+20;if(n*n+i*i<a*a)return!1}return!0},l=(e,t,r)=>{let n=r?450:2550,l=1e3,c=600;if(i&&i.spawnZones){let e=r?i.spawnZones.attacker:i.spawnZones.defender;e&&(n=e.x,l=e.y,c=e.radius||600)}Object.entries(e).forEach(([e,i])=>{let d=m[e];if(d)if("infantry"===e){let u=Math.ceil(i/5);for(let i=0;i<u;i++){let i,u,h=[],p=[{x:0,y:0},{x:8,y:6},{x:-8,y:-6},{x:8,y:-6},{x:-8,y:6}];for(let e=0;e<5;e++)h.push({id:e,xOff:p[e].x+(Math.random()-.5)*2,yOff:p[e].y+(Math.random()-.5)*2,hp:d.hp,maxHp:d.hp,cooldown:Math.random()*d.cooldown});let f=0;do i=n+(Math.random()-.5)*c,u=l+(Math.random()-.5)*c,f++;while(!o(i,u,d.size)&&f<20)s.push({id:a++,type:e,faction:t,isAttacker:r,x:i,y:u,angle:r?0:Math.PI,isSquad:!0,soldiers:h,maxHp:5*d.hp,buffs:[],target:null,manualMove:null,state:"idle"})}}else for(let u=0;u<i;u++){let i,u,h=0;do i=n+(Math.random()-.5)*c,u=l+(Math.random()-.5)*c,h++;while(!o(i,u,d.size)&&h<20)s.push({id:a++,type:e,faction:t,isAttacker:r,x:i,y:u,angle:r?0:Math.PI,hp:d.hp,maxHp:d.hp,mana:d.maxMana||0,maxMana:d.maxMana||0,buffs:[],shield:(d.traits||[]).includes("shielded")?.5*d.hp:0,maxShield:(d.traits||[]).includes("shielded")?.5*d.hp:0,cooldown:Math.random()*d.cooldown,target:null,manualMove:null,state:"idle"})}})};(()=>{if(i&&i.obstacles)return i.obstacles.forEach(e=>n.push(e));let e=40,t="rock",s="#555";"urban"===r||"industrial"===r?(e=60,t="ruin",s="#444"):"forest"===r?(e=80,t="tree",s="#2d5a27"):"desert"===r?(e=30,t="rock",s="#8b5a2b"):"snow"===r?(e=40,t="rock",s="#aaddff"):"volcanic"===r?(e=50,t="rock",s="#331111"):"force_nexus"===r&&(e=20,t="crystal",s="#aa00ff");for(let r=0;r<e;r++){let e="ruin"===t||"crystal"===t?"rect":"circle",r=60+80*Math.random(),i=600+1800*Math.random(),a=2e3*Math.random();n.push({x:i,y:a,shape:e,size:r,width:r,height:"rect"===e&&"crystal"===t?2*r:r,color:s,type:t})}})(),e&&(l(e.composition,e.owner||"republic",!0),"empire"!==e.owner&&l({jedi_general:1},"republic",!0)),t&&(l(t.composition,t.owner||"empire",!1),"republic"!==t.owner&&l({sith_lord:1},"empire",!1)),z.current=s,$.current=n,V.current=[],q.current=[],x([])},[e,t,m,r]),(0,N.useEffect)(()=>()=>cancelAnimationFrame(H.current),[]),(0,N.useEffect)(()=>{let r=l.current,n=r.getContext("2d");r.width=window.innerWidth,r.height=window.innerHeight;let i=r=>{H.current&&cancelAnimationFrame(H.current),setTimeout(()=>{let n=z.current.filter(e=>e.isAttacker),i=z.current.filter(e=>!e.isAttacker);s({winner:"victory"===r?e?.owner||"republic":t?.owner||"empire",survivingAttackers:n.map(e=>({type:e.type,hp:e.hp})),survivingDefenders:i.map(e=>({type:e.type,hp:e.hp}))})},2e3)},a=()=>{if("fighting"!==c)return;let e=z.current,t=V.current,r=q.current,s=e.some(e=>e.isAttacker),l=e.some(e=>!e.isAttacker);if(s||l)if(s){if(!l){d("victory"),i("victory");return}}else{d("defeat"),i("defeat");return}else{d("draw"),i("draw");return}e.forEach(r=>{if(r.jumpData){let t=r.jumpData;t.progress++;let s=t.progress/t.duration;r.x=t.startX+(t.targetX-t.startX)*s,r.y=t.startY+(t.targetY-t.startY)*s,t.progress>=t.duration&&(r.x=t.targetX,r.y=t.targetY,q.current.push({x:r.x,y:r.y,life:25,size:30,color:"#ffffff"}),e.forEach(e=>{e.id!==r.id&&e.faction!==r.faction&&Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2))<t.aoeRadius&&(e.hp-=40,q.current.push({x:e.x,y:e.y,life:10,size:10,color:"#ff3333"}))}),delete r.jumpData);return}let s=m[r.type];if(r.buffs&&r.buffs.length>0&&(r.buffs.forEach(e=>e.duration--),r.buffs=r.buffs.filter(e=>e.duration>0),r.buffs.length>0&&(s={...s},r.buffs.forEach(e=>{"damage"===e.stat&&(s.damage=(s.damage||0)+e.amount),"armor"===e.stat&&(s.armor=(s.armor||0)+e.amount),"speed"===e.stat&&(s.speed=(s.speed||0)+e.amount),"cooldown"===e.stat&&(s.cooldown=Math.max(5,(s.cooldown||30)-e.amount))}),Math.floor(Date.now()/200)%2!=0||B.current||(B.current=[]))),s.traits&&(s.traits.includes("regeneration")&&r.hp<r.maxHp&&(r.hp=Math.min(r.hp+.05,r.maxHp)),s.traits.includes("shielded")&&r.maxShield>0&&r.shield<r.maxShield&&(r.shield=Math.min(r.shield+.05,r.maxShield))),r.target&&!e.find(e=>e.id===r.target.id)&&(r.target=null),!r.manualMove&&!r.target){let t=null,s=1/0;e.forEach(e=>{if(r.isAttacker!==e.isAttacker){let n=e.x-r.x,i=e.y-r.y,a=Math.sqrt(n*n+i*i);a<s&&(s=a,t=e)}}),s<600&&(r.target=t)}let n=null,i=!1;if(r.manualMove){let e=(n=r.manualMove).x-r.x,t=n.y-r.y;5>Math.sqrt(e*e+t*t)&&(r.manualMove=null,void 0!==r.formationAngle&&(r.angle=r.formationAngle))}else r.target&&!r.holdPosition&&(n=r.target,i=!0);if(n&&s.speed>0){let e=n.x-r.x,t=n.y-r.y,a=Math.sqrt(e*e+t*t),o=Math.atan2(t,e);if(r.angle=o,!i||a>.95*s.range*u.rangeMod){let e=u.speedMod,t=r.x+Math.cos(o)*s.speed*e,n=r.y+Math.sin(o)*s.speed*e,i=!1;for(let e of $.current)if("rect"===e.shape){let r=s.size;if(t>e.x-e.width/2-r&&t<e.x+e.width/2+r&&n>e.y-e.height/2-r&&n<e.y+e.height/2+r){i=!0;break}}else{let r=t-e.x,a=n-e.y,o=e.size/2+s.size;if(r*r+a*a<o*o){i=!0;break}}if(i){let e=!1;for(let n of $.current)if("rect"===n.shape){let i=s.size;if(t>n.x-n.width/2-i&&t<n.x+n.width/2+i&&r.y>n.y-n.height/2-i&&r.y<n.y+n.height/2+i){e=!0;break}}else{let i=t-n.x,a=r.y-n.y,o=n.size/2+s.size;if(i*i+a*a<o*o){e=!0;break}}e||(r.x=t);let i=!1;for(let e of $.current)if("rect"===e.shape){let t=s.size;if(r.x>e.x-e.width/2-t&&r.x<e.x+e.width/2+t&&n>e.y-e.height/2-t&&n<e.y+e.height/2+t){i=!0;break}}else{let t=r.x-e.x,a=n-e.y,o=e.size/2+s.size;if(t*t+a*a<o*o){i=!0;break}}i||(r.y=n)}else r.x=t,r.y=n}}if(r.target){let e=r.target.x-r.x,n=r.target.y-r.y,i=Math.sqrt(e*e+n*n);if(r.manualMove||(r.angle=Math.atan2(n,e)),i<=s.range*u.rangeMod){if(s.isMelee&&r.cooldown<=0){let e=s.accuracy;if(u.accuracyMod&&(e*=u.accuracyMod),Math.random()<=e){let e=m[r.target.type],t=Math.max(0,(e.armor||0)-s.armorPen),n=1;s.bonuses&&e.traits&&e.traits.forEach(e=>{s.bonuses[e]&&(n*=s.bonuses[e])});let i=s.damage;u.damageMod&&(i*=u.damageMod),s.traits&&s.traits.includes("rage")&&r.hp/r.maxHp<.5&&(i*=1.5);let a=i*n*(1-t/100);if(r.target.shield>0){let e=Math.min(r.target.shield,a);r.target.shield-=e,a-=e,q.current.push({x:r.target.x,y:r.target.y,life:8,size:6,color:"#00ffff"})}if(r.target.hp-=a,s.traits&&s.traits.includes("vampirism")){let e=.2*a;r.hp=Math.min(r.hp+e,r.maxHp),B.current.push({type:"heal",startX:r.x,startY:r.y,life:20})}q.current.push({x:r.target.x,y:r.target.y,life:5,size:3,color:"republic"===r.faction?"#00ff00":"#ff0000"})}else B.current.push({type:"miss",startX:r.target.x,startY:r.target.y,life:20});r.cooldown=s.cooldown,B.current.push({type:"melee_slash",startX:r.x,startY:r.y,angle:r.angle,faction:r.faction,life:10})}else if(r.isSquad&&r.soldiers)r.soldiers.forEach(e=>{if(e.cooldown>0)return;let t=r.angle,n=r.x+e.xOff*Math.cos(t)-e.yOff*Math.sin(t),i=r.y+e.xOff*Math.sin(t)+e.yOff*Math.cos(t),a=(Math.random()-.5)*.2,o=s.damage;u.damageMod&&(o*=u.damageMod);let l=s.accuracy;u.accuracyMod&&(l*=u.accuracyMod),s.traits&&s.traits.includes("rage")&&r.hp/r.maxHp<.5&&(o*=1.5),V.current.push({x:n,y:i,vx:12*Math.cos(r.angle+a),vy:12*Math.sin(r.angle+a),damage:o,armorPen:s.armorPen,accuracy:l,bonuses:s.bonuses||{},faction:r.faction,color:up[r.faction]?.projectiles||"#fff",life:40,sourceId:r.id,traits:s.traits||[]}),e.cooldown=s.cooldown*(.8+.4*Math.random())});else if(r.cooldown<=0){let e=(Math.random()-.5)*.2,n=s.damage;u.damageMod&&(n*=u.damageMod),s.traits&&s.traits.includes("rage")&&r.hp/r.maxHp<.5&&(n*=1.5);let i=s.accuracy;u.accuracyMod&&(i*=u.accuracyMod),t.push({x:r.x+(Math.random()-.5)*10,y:r.y+(Math.random()-.5)*10,vx:12*Math.cos(r.angle+e),vy:12*Math.sin(r.angle+e),damage:n,armorPen:s.armorPen,accuracy:i,bonuses:s.bonuses||{},faction:r.faction,color:up[r.faction]?.projectiles||"#fff",life:40,sourceId:r.id,traits:s.traits||[]}),r.cooldown=s.cooldown}}}if(r.isSquad&&r.soldiers?r.soldiers.forEach(e=>{e.cooldown>0&&e.cooldown--}):r.cooldown>0&&r.cooldown--,m[r.type].isHero){let e=.05;u.manaRegenMod&&(e*=u.manaRegenMod),r.mana<r.maxMana&&(r.mana+=e)}});for(let s=t.length-1;s>=0;s--){let n=t[s];if(n.x+=n.vx,n.y+=n.vy,n.life--,n.life<=0){t.splice(s,1);continue}let i=!1;for(let e of $.current)if("rect"===e.shape){if(n.x>e.x-e.width/2&&n.x<e.x+e.width/2&&n.y>e.y-e.height/2&&n.y<e.y+e.height/2){i=!0;break}}else{let t=n.x-e.x,r=n.y-e.y;if(t*t+r*r<e.size/2*(e.size/2)){i=!0;break}}if(i){t.splice(s,1),q.current.push({x:n.x,y:n.y,life:5,size:3,color:"#cccccc"});continue}let a=!1;for(let t of e){if(up[t.faction]?.units===up[n.faction]?.units||t.faction===n.faction)continue;let s=!1;if(t.isSquad&&t.soldiers){let e=t.angle,i=Math.cos(e),a=Math.sin(e);for(let e=0;e<t.soldiers.length;e++){let o=t.soldiers[e],l=t.x+o.xOff*i-o.yOff*a,c=t.y+o.xOff*a+o.yOff*i,d=l-n.x,u=c-n.y;if(Math.sqrt(d*d+u*u)<m[t.type].size+4){if(Math.random()<=n.accuracy){let e=1-Math.max(0,(m[t.type].armor||0)-n.armorPen)/100,s=1,i=m[t.type].traits;n.bonuses&&i&&i.forEach(e=>{n.bonuses[e]&&(s*=n.bonuses[e])});let a=n.damage*s*e;o.hp-=a,r.push({x:l,y:c,life:5,size:2,color:"#ffaaaa"})}else B.current.push({type:"miss",startX:l,startY:c,life:10});s=!0;break}}if(s){let e=t.soldiers.length;t.soldiers=t.soldiers.filter(e=>e.hp>0),t.hp=t.soldiers.reduce((e,t)=>e+t.hp,0),t.soldiers.length<e&&r.push({x:n.x,y:n.y,life:10,size:5,color:"#aa3333"})}}else{let i=t.x-n.x,a=t.y-n.y;if(Math.sqrt(i*i+a*a)<m[t.type].size+4){if(Math.random()<=n.accuracy){let s=1-Math.max(0,(m[t.type].armor||0)-n.armorPen)/100,i=1,a=m[t.type].traits||[];n.bonuses&&a&&a.forEach(e=>{n.bonuses[e]&&(i*=n.bonuses[e])});let o=n.damage*i*s;if(t.shield>0){let e=Math.min(t.shield,o);t.shield-=e,o-=e,r.push({x:n.x,y:n.y,life:8,size:6,color:"#00ffff"})}if(t.hp-=o,n.traits&&n.traits.includes("vampirism")&&n.sourceId){let t=e.find(e=>e.id===n.sourceId);if(t&&t.hp>0){let e=.2*o;t.hp=Math.min(t.hp+e,t.maxHp),B.current.push({type:"heal",startX:t.x,startY:t.y,life:20})}}r.push({x:n.x,y:n.y,life:5,size:3,color:"#ffaaaa"})}else B.current.push({type:"miss",startX:n.x,startY:n.y,life:10});s=!0}}if(s){if(a=!0,t.hp<=0){r.push({x:t.x,y:t.y,life:20,size:10,color:"#ff6600"});let s=e.indexOf(t);s>-1&&(x(e=>e.filter(e=>e!==t.id)),e.splice(s,1))}break}}a&&t.splice(s,1)}for(let e=r.length-1;e>=0;e--)r[e].life--,r[e].life<=0&&r.splice(e,1);let h=B.current;for(let t=h.length-1;t>=0;t--){if(h[t].life--,"attack"===h[t].type&&h[t].targetId){let r=e.find(e=>e.id===h[t].targetId);r&&(h[t].targetX=r.x,h[t].targetY=r.y)}h[t].life<=0&&h.splice(t,1)}o(n,e,t,r,h),H.current=requestAnimationFrame(a)},o=(e,t,s,n,i=[])=>{e.fillStyle="#2d241b",e.fillRect(0,0,r.width,r.height),e.save();let a=f.current;e.scale(a.zoom,a.zoom),e.translate(-a.x,-a.y),e.fillStyle="#251e16",e.fillRect(0,0,3e3,2e3),e.strokeStyle="#554433",e.lineWidth=10,e.strokeRect(0,0,3e3,2e3),e.strokeStyle="rgba(255,255,255,0.05)",e.lineWidth=1/a.zoom;for(let t=0;t<=3e3;t+=100)e.beginPath(),e.moveTo(t,0),e.lineTo(t,2e3),e.stroke();for(let t=0;t<=2e3;t+=100)e.beginPath(),e.moveTo(0,t),e.lineTo(3e3,t),e.stroke();$.current.forEach(t=>{e.fillStyle=t.color,e.save(),e.translate(t.x,t.y),e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=10,e.shadowOffsetX=5,e.shadowOffsetY=5,"rect"===t.shape?(e.fillRect(-t.width/2,-t.height/2,t.width,t.height),e.shadowBlur=0,e.strokeStyle="rgba(0,0,0,0.5)",e.lineWidth=2,e.strokeRect(-t.width/2,-t.height/2,t.width,t.height),("ruin"===t.type||"building"===t.type)&&(e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(-t.width/2+5,-t.height/2+5,10,10),e.fillRect(t.width/2-15,t.height/2-15,10,10))):(e.beginPath(),e.arc(0,0,t.size/2,0,2*Math.PI),e.fill(),e.shadowBlur=0,e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=2,e.stroke(),"tree"===t.type&&(e.fillStyle="rgba(0,0,0,0.2)",e.beginPath(),e.arc(-5,-5,t.size/4,0,2*Math.PI),e.fill())),e.restore()}),i.forEach(t=>{if(e.save(),"heal"===t.type||"area_heal"===t.type)e.globalAlpha=Math.min(1,t.life/20),e.fillStyle="#00ff00","heal"===t.type?(e.beginPath(),e.arc(t.startX,t.startY,10,0,2*Math.PI),e.fill(),e.font="12px Arial",e.fillStyle="white",e.fillText("+",t.startX,t.startY-10-(30-t.life))):(e.globalAlpha=Math.min(.3,t.life/40),e.beginPath(),e.arc(t.startX,t.startY,t.size,0,2*Math.PI),e.fill(),e.strokeStyle="#00ff00",e.lineWidth=2,e.stroke());else if("lightning"===t.type||"area_lightning"===t.type)if(e.globalAlpha=Math.min(1,t.life/10),e.strokeStyle="#aa00ff",e.shadowBlur=10,e.shadowColor="#fff",e.lineWidth=3,"lightning"===t.type){e.beginPath(),e.moveTo(t.startX,t.startY),t.startX,t.startY;for(let r=1;r<=5;r++){let s=r/5,n=t.startX+(t.targetX-t.startX)*s,i=t.startY+(t.targetY-t.startY)*s,a=(Math.random()-.5)*20,o=(Math.random()-.5)*20;e.lineTo(n+a,i+o)}e.stroke()}else e.beginPath(),e.arc(t.startX,t.startY,t.size*(1-t.life/20),0,2*Math.PI),e.stroke();else if("melee_slash"===t.type){e.globalAlpha=Math.min(1,t.life/5),e.strokeStyle="republic"===t.faction?"#00ff00":"#ff0000",e.lineWidth=3,e.shadowBlur=10,e.shadowColor=e.strokeStyle,e.translate(t.startX,t.startY),e.rotate(t.angle),e.beginPath();let r=-Math.PI/3+(10-t.life)/10*Math.PI/2,s=r+Math.PI/3;e.arc(0,0,20,r,s),e.stroke(),e.shadowBlur=0}else if("miss"===t.type)e.fillStyle="white",e.font="10px monospace",e.globalAlpha=Math.min(1,t.life/10),e.fillText("Manqu",t.startX,t.startY-(20-t.life));else{e.globalAlpha=Math.min(1,t.life/20),e.lineWidth=2,e.strokeStyle="move"===t.type?"#00ff00":"#ff0000",e.fillStyle="move"===t.type?"#00ff00":"#ff0000",e.beginPath(),e.moveTo(t.startX,t.startY),e.lineTo(t.targetX,t.targetY),e.stroke();let r=Math.atan2(t.targetY-t.startY,t.targetX-t.startX);e.translate(t.targetX,t.targetY),e.rotate(r),e.beginPath(),e.moveTo(0,0),e.lineTo(-10,-5),e.lineTo(-10,5),e.closePath(),e.fill(),e.rotate(-r),e.beginPath(),e.arc(0,0,5+(40-t.life)/2,0,2*Math.PI),e.stroke()}e.restore()});let o=M.current,l=R.current,d=O.current;if(o&&d){let t=f.current,r=d.x/t.zoom+t.x,s=d.y/t.zoom+t.y,n=o.x,i=o.y;e.strokeStyle="#00ff00",e.lineWidth=2/t.zoom,e.strokeRect(n,i,r-n,s-i),e.fillStyle="rgba(0, 255, 0, 0.1)",e.fillRect(n,i,r-n,s-i)}if(l&&d&&L.current.length>0){let t=f.current,r=d.x/t.zoom+t.x,s=d.y/t.zoom+t.y,n=r-l.x,i=s-l.y,a=Math.sqrt(n*n+i*i);if(a>20){e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(r,s),e.strokeStyle="yellow",e.setLineDash([5,5]),e.lineWidth=2,e.stroke(),e.setLineDash([]);let t=Math.atan2(i,n),o=Math.max(1,Math.floor(a/30)),c=L.current.length;for(let r=0;r<c;r++){let s=Math.floor(r/o),n=r%o,i=l.x+Math.cos(t)*(30*n+15),a=l.y+Math.sin(t)*(30*n+15),c=t-Math.PI/2,d=i+-(30*s*Math.cos(c)),u=a+-(30*s*Math.sin(c));e.fillStyle="rgba(255, 255, 0, 0.5)",e.beginPath(),e.arc(d,u,5,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(d,u),e.lineTo(d+15*Math.cos(c),u+15*Math.sin(c)),e.strokeStyle="yellow",e.lineWidth=1,e.stroke()}}}if(F.current&&L.current.forEach(r=>{let s=t.find(e=>e.id===r);if(s&&m[s.type].isHero){e.save(),e.translate(s.x,s.y),e.fillStyle="republic"===s.faction?"rgba(0, 255, 0, 0.15)":"rgba(128, 0, 128, 0.15)",e.strokeStyle="republic"===s.faction?"rgba(0, 255, 0, 0.5)":"rgba(128, 0, 128, 0.5)",e.lineWidth=2,e.beginPath(),e.arc(0,0,150,0,2*Math.PI),e.fill(),e.stroke();let t=Date.now()%1e3/1e3;e.beginPath(),e.arc(0,0,150*t,0,2*Math.PI),e.strokeStyle=`rgba(255, 255, 255, ${.5-t/2})`,e.stroke(),e.restore()}}),U.current&&"jetpack_jump"===U.current.type){let r=U.current,s=t.find(e=>e.id===r.sourceId),n=O.current;if(s&&n){let t=f.current,i=n.x/t.zoom+t.x,a=n.y/t.zoom+t.y;e.beginPath(),e.arc(s.x,s.y,r.maxRange,0,2*Math.PI),e.strokeStyle="cyan",e.setLineDash([5,5]),e.lineWidth=1,e.stroke(),e.setLineDash([]);let o=i-s.x,l=a-s.y,c=Math.sqrt(o*o+l*l),d=i,u=a;if(c>r.maxRange){let e=r.maxRange/c;d=s.x+o*e,u=s.y+l*e}e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(d,u),e.strokeStyle="rgba(0, 255, 255, 0.5)",e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(d,u,r.aoeRadius,0,2*Math.PI),e.fillStyle="rgba(0, 255, 255, 0.3)",e.fill(),e.strokeStyle="cyan",e.lineWidth=2,e.stroke(),e.beginPath(),e.moveTo(d-10,u),e.lineTo(d+10,u),e.stroke(),e.beginPath(),e.moveTo(d,u-10),e.lineTo(d,u+10),e.stroke()}}let u=L.current;t.forEach(t=>{let s=f.current;if(t.x<s.x-100||t.x>s.x+r.width/s.zoom+100||t.y<s.y-100||t.y>s.y+r.height/s.zoom+100)return;let n=m[t.type],i=u.includes(t.id);if(e.save(),e.translate(t.x,t.y),t.jumpData){let r=Math.sin(t.jumpData.progress/t.jumpData.duration*Math.PI),s=1+.5*r;e.scale(s,s),e.shadowBlur=30*r,e.shadowColor="rgba(0,0,0,0.5)"}if(e.rotate(t.angle),i&&(e.beginPath(),e.arc(0,0,n.size+4,0,2*Math.PI),e.strokeStyle="#00ff00",e.lineWidth=1,e.stroke(),t.holdPosition&&(e.fillStyle="#ffcc00",e.beginPath(),e.arc(0,0,3,0,2*Math.PI),e.fill(),e.strokeStyle="#ffcc00",e.lineWidth=1,e.beginPath(),e.rect(-n.size-4,-n.size-4,(n.size+4)*2,(n.size+4)*2),e.stroke()),e.beginPath(),e.moveTo(0,0),e.arc(0,0,n.range,-Math.PI/6,Math.PI/6),e.lineTo(0,0),e.fillStyle="rgba(0, 255, 0, 0.1)",e.fill(),e.strokeStyle="rgba(0, 255, 0, 0.3)",e.stroke(),e.beginPath(),e.arc(0,0,n.range,0,2*Math.PI),e.strokeStyle="rgba(255, 255, 255, 0.1)",e.setLineDash([2,4]),e.stroke(),e.setLineDash([])),n.traits&&n.traits.includes("stealth")&&(e.globalAlpha=.6),e.fillStyle=up[t.faction]?.units||"#fff",t.isSquad&&t.soldiers)t.soldiers.forEach(t=>{e.beginPath(),e.arc(t.xOff,t.yOff,n.size,0,2*Math.PI),e.fill()});else if("infantry"===t.type)e.beginPath(),e.arc(0,0,n.size,0,2*Math.PI),e.fill();else if("heavy_infantry"===t.type)e.fillRect(-n.size,-n.size,2*n.size,2*n.size);else if("vehicle"===t.type)e.fillRect(-(1.5*n.size),-n.size,3*n.size,2*n.size),e.fillStyle="#111",e.beginPath(),e.arc(0,0,.6*n.size,0,2*Math.PI),e.fill();else if("turret"===t.type)e.beginPath(),e.moveTo(n.size,0),e.lineTo(-n.size,n.size),e.lineTo(-n.size,-n.size),e.fill();else if(m[t.type].isHero&&(e.shadowBlur=15,e.shadowColor="republic"===t.faction?"#00ff00":"#ff0000",e.beginPath(),e.arc(0,0,n.size,0,2*Math.PI),e.fill(),e.shadowBlur=0,e.fillStyle="#fff",e.font="10px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("",0,0),t.maxMana>0)){let r=t.maxShield>0?-n.size-12:-n.size-9;e.fillStyle="#000044",e.fillRect(-6,r,12,2),e.fillStyle="#aa00ff",e.fillRect(-6,r,12*(t.mana/t.maxMana),2)}t.maxShield>0&&(e.fillStyle="#004444",e.fillRect(-6,-n.size-9,12,2),e.fillStyle="#00ffff",e.fillRect(-6,-n.size-9,12*(t.shield/t.maxShield),2)),e.fillStyle="#ff0000",e.fillRect(-6,-n.size-6,12,2),e.fillStyle="#00ff00",e.fillRect(-6,-n.size-6,12*(t.hp/t.maxHp),2),e.restore()}),s.forEach(t=>{let s=f.current;t.x<s.x||t.x>s.x+r.width/s.zoom||t.y<s.y||t.y>s.y+r.height/s.zoom||(e.save(),e.translate(t.x,t.y),e.beginPath(),e.arc(0,0,2,0,2*Math.PI),e.fillStyle=t.color,e.fill(),e.restore())}),n.forEach(t=>{let s=f.current;t.x<s.x-50||t.x>s.x+r.width/s.zoom+50||t.y<s.y-50||t.y>s.y+r.height/s.zoom+50||(e.save(),e.translate(t.x,t.y),e.beginPath(),e.arc(0,0,t.size*(t.life/10),0,2*Math.PI),e.fillStyle=t.color||`rgba(255, 100, 0, ${t.life/20})`,e.fill(),e.restore())}),e.restore(),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(10,10,300,30),e.fillStyle="white",e.font="16px monospace",e.fillText(`Cam\xe9ra: ${Math.round(f.current.x)},${Math.round(f.current.y)} (Zoom: ${f.current.zoom.toFixed(1)}x)`,20,30),e.fillText(`Molette pour Zoomer - Clic Molette pour D\xe9placer`,20,50),"victory"===c&&(e.fillStyle="rgba(0,0,0,0.7)",e.fillRect(0,r.height/2-50,r.width,100),e.fillStyle="#00ff00",e.font="bold 48px serif",e.textAlign="center",e.fillText("VICTOIRE",r.width/2,r.height/2+15)),"defeat"===c&&(e.fillStyle="rgba(0,0,0,0.7)",e.fillRect(0,r.height/2-50,r.width,100),e.fillStyle="#ff0000",e.font="bold 48px serif",e.textAlign="center",e.fillText("DFAITE",r.width/2,r.height/2+15))};H.current=requestAnimationFrame(a)},[c]),(0,N.useEffect)(()=>{let e=e=>{e.preventDefault(),p(t=>{let r=Math.max(.2,Math.min(2,t.zoom-.001*e.deltaY)),s=window.innerWidth,n=window.innerHeight;return{x:t.x+s/2/t.zoom-s/2/r,y:t.y+n/2/t.zoom-n/2/r,zoom:r}})};return window.addEventListener("wheel",e,{passive:!1}),()=>window.removeEventListener("wheel",e)},[]);let G=(e,t,r)=>{let s=z.current.find(t=>t.id===e.sourceId);if(!s)return;let n=m[s.type];if(s.mana<n.manaCost)return;s.mana-=n.manaCost;let i=t-s.x,a=r-s.y,o=Math.sqrt(i*i+a*a),l=t,c=r;if(o>e.maxRange){let t=e.maxRange/o;l=s.x+i*t,c=s.y+a*t}l+=(Math.random()-.5)*10,c+=(Math.random()-.5)*10,B.current.push({type:"move",startX:s.x,startY:s.y,targetX:l,targetY:c,life:15}),s.jumpData={startX:s.x,startY:s.y,targetX:l,targetY:c,progress:0,duration:45,aoeRadius:e.aoeRadius},s.manualMove=null};return(0,w.jsxs)("div",{className:"fixed inset-0 z-[200]",children:[(0,w.jsx)("canvas",{ref:l,className:"w-full h-full cursor-crosshair block",onMouseDown:e=>{if(v)return;if(U.current)return void(0===e.button?(((e,t,r)=>{let s=f.current,n=t/s.zoom+s.x,i=r/s.zoom+s.y,a=z.current.find(t=>t.id===e.sourceId);if(!a)return;let l=m[a.type],c=l.abilities?l.abilities.find(t=>t.id===e.id):null,d=c?c.cost:l.manaCost||0;if(!(a.mana<d))switch(a.mana-=d,e.id){case"jetpack_jump":{G(e,n,i);let t=n-a.x,r=i-a.y,s=Math.sqrt(t*t+r*r),o=n,l=i;s>300&&(o=a.x+300/s*t,l=a.y+300/s*r),B.current.push({type:"move",startX:a.x,startY:a.y,targetX:o,targetY:l,life:15}),a.jumpData={startX:a.x,startY:a.y,targetX:o,targetY:l,progress:0,duration:30},a.state="jumping";break}case"force_lightning":V.current.push({id:Math.random(),x:a.x,y:a.y,targetX:n,targetY:i,speed:20,damage:40,type:"beam",color:"#a855f7",faction:a.faction});break;case"force_storm":q.current.push({x:n,y:i,radius:150,life:60,maxLife:60,color:"#a855f7",damage:1,isDoT:!0,faction:a.faction});break;case"force_heal":B.current.push({type:"heal",startX:n,startY:i,life:30}),z.current.forEach(e=>{e.faction===a.faction&&50>Math.hypot(e.x-n,e.y-i)&&(e.hp=Math.min(e.maxHp,e.hp+60))});break;case"force_push":q.current.push({x:n,y:i,radius:200,life:20,maxLife:20,color:"#38bdf8",damage:0,force:10,faction:a.faction});break;case"force_avatar":z.current.forEach(e=>{e.faction===a.faction&&(e.hp=Math.min(e.maxHp,e.hp+200))}),B.current.push({type:"nova",startX:a.x,startY:a.y,life:60,color:"#0ea5e9"});break;case"mando_missile":V.current.push({id:Math.random(),x:a.x,y:a.y,targetX:n,targetY:i,speed:10,damage:80,type:"missile",color:"#f97316",faction:a.faction,radius:50});break;case"mando_flame":for(let e=0;e<10;e++){let e=Math.atan2(i-a.y,n-a.x)+(Math.random()-.5)*.5;V.current.push({id:Math.random(),x:a.x,y:a.y,targetX:a.x+150*Math.cos(e),targetY:a.y+150*Math.sin(e),speed:8+4*Math.random(),damage:5,type:"fire",color:"#ea580c",faction:a.faction})}break;case"mando_reinforce":for(let e=0;e<3;e++){let t=Date.now()+e,r=(Math.random()-.5)*100,s=(Math.random()-.5)*100;z.current.push({id:t,type:"heavy_infantry",x:n+r,y:i+s,hp:40,maxHp:40,faction:a.faction,isAttacker:a.isAttacker,angle:0,state:"idle",cooldown:0,mana:0,maxMana:0,soldiers:[]}),B.current.push({type:"spawn",startX:n+r,startY:i+s,life:30})}break;default:if(o){let t=null;for(let r of o){let s=r.talents?.find(t=>t.id===e.id);if(s){t=s;break}}if(t){let e=parseFloat(t.stats?.damage||0),r=parseFloat(t.stats?.radius||0),s=parseFloat(t.stats?.duration||0),o=parseFloat(t.stats?.speed||20),l=t.stats?.color||"#ffffff";if("projectile"===t.archetype)V.current.push({id:Math.random(),x:a.x,y:a.y,targetX:n,targetY:i,speed:o,damage:e,type:"missile",color:l,faction:a.faction,radius:10});else if("explosion"===t.archetype)z.current.forEach(t=>{t.faction!==a.faction&&t.hp>0&&Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-i,2))<(r||100)&&(t.hp-=e,B.current.push({type:"miss",startX:t.x,startY:t.y,life:10}))}),q.current.push({x:n,y:i,radius:r||100,life:s||30,maxLife:s||30,color:l,damage:e,faction:a.faction});else if("beam"===t.archetype)V.current.push({id:Math.random(),x:a.x,y:a.y,targetX:n,targetY:i,speed:40,damage:e,type:"beam",color:l,faction:a.faction});else if("heal"===t.archetype)B.current.push({type:"heal",startX:n,startY:i,life:30}),z.current.forEach(e=>{e.faction===a.faction&&Math.hypot(e.x-n,e.y-i)<(r||150)&&(e.hp=Math.min(e.maxHp,e.hp+(parseFloat(t.stats?.amount)||50)))});else if("buff"===t.archetype)B.current.push({type:"heal",startX:n,startY:i,life:30,color:"#ffff00"}),z.current.forEach(e=>{e.faction===a.faction&&Math.hypot(e.x-n,e.y-i)<(r||150)&&(e.buffs||(e.buffs=[]),e.buffs.push({stat:t.stats?.stat||"damage",amount:parseFloat(t.stats?.amount||0),duration:parseFloat(t.stats?.duration||300),label:t.label}))});else if("summon"===t.archetype){let e=parseInt(t.stats?.count||1),r=t.stats?.unitId||"infantry";for(let t=0;t<e;t++)z.current.push({id:Date.now()+Math.random(),type:r,x:n+(Math.random()-.5)*50,y:i+(Math.random()-.5)*50,hp:m[r]?.hp||20,maxHp:m[r]?.hp||20,faction:a.faction,isAttacker:a.isAttacker,angle:0,state:"idle",cooldown:0,mana:0,maxMana:0,buffs:[],soldiers:[]}),B.current.push({type:"spawn",startX:n,startY:i,life:30})}else if("dash"===t.archetype){let e=n-a.x,r=i-a.y,s=Math.sqrt(e*e+r*r),o=parseFloat(t.stats?.range||300),l=n,c=i;s>o&&(l=a.x+o/s*e,c=a.y+o/s*r),B.current.push({type:"move",startX:a.x,startY:a.y,targetX:l,targetY:c,life:15}),a.x=l,a.y=c}}}}})(U.current,e.clientX,e.clientY),A(null)):2===e.button&&A(null));let t=f.current,r=e.clientX/t.zoom+t.x,s=e.clientY/t.zoom+t.y;0===e.button?(y({x:r,y:s}),k({x:e.clientX,y:e.clientY})):1===e.button?(e.preventDefault(),P.current=!0,D.current={x:e.clientX,y:e.clientY}):2===e.button&&(e.preventDefault(),R.current={x:r,y:s})},onMouseMove:e=>{if(k({x:e.clientX,y:e.clientY}),P.current||4===e.buttons){if((4&e.buttons)==0){P.current=!1;return}let t=e.clientX,r=e.clientY;if(!P.current){P.current=!0,D.current={x:t,y:r};return}let s=t-D.current.x,n=r-D.current.y;(0!==s||0!==n)&&(p(e=>({...e,x:e.x-s/e.zoom,y:e.y-n/e.zoom})),D.current={x:t,y:r})}},onMouseUp:e=>{1===e.button&&(P.current=!1);let t=f.current,r=e.clientX/t.zoom+t.x,s=e.clientY/t.zoom+t.y;if(v&&0===e.button){let e=z.current;g.forEach(t=>{let n=e.find(e=>e.id===t);if(n){let e=r-n.x,t=s-n.y;n.angle=Math.atan2(t,e),n.manualMove=null}}),_(!1);return}if(0===e.button&&b){let e=Math.min(b.x,r),t=Math.min(b.y,s),n=Math.max(b.x,r),i=Math.max(b.y,s);x(z.current.filter(r=>r.isAttacker&&r.x>=e&&r.x<=n&&r.y>=t&&r.y<=i).map(e=>e.id)),y(null)}else if(2===e.button&&R.current){let e=R.current,t=Math.sqrt(Math.pow(r-e.x,2)+Math.pow(s-e.y,2)),n=z.current,i=n.filter(e=>g.includes(e.id));if(0===i.length){R.current=null;return}if(t<20){let e=n.find(e=>{let t=e.x-r,n=e.y-s;return Math.sqrt(t*t+n*n)<m[e.type].size+10}),t=i.reduce((e,t)=>e+t.x,0)/i.length,a=i.reduce((e,t)=>e+t.y,0)/i.length,o="move";i.forEach(t=>{t.holdPosition=!1,e&&e.faction!==t.faction?(t.target=e,t.manualMove=null,o="attack"):(t.manualMove={x:r+(Math.random()-.5)*30,y:s+(Math.random()-.5)*30},t.target=null)}),"attack"===o&&e?B.current.push({type:"attack",startX:t,startY:a,targetX:e.x,targetY:e.y,targetId:e.id,life:40}):B.current.push({type:"move",startX:t,startY:a,targetX:r,targetY:s,life:40})}else{let t=r-e.x,n=s-e.y,a=Math.atan2(n,t),o=Math.max(1,Math.floor(Math.sqrt(t*t+n*n)/30));i.forEach((t,r)=>{t.holdPosition=!1;let s=Math.floor(r/o),n=r%o,i=e.x+Math.cos(a)*(30*n+15),l=e.y+Math.sin(a)*(30*n+15),c=a-Math.PI/2;t.manualMove={x:i+-(30*s*Math.cos(c)),y:l+-(30*s*Math.sin(c))},t.formationAngle=c,t.target=null});let l=i.reduce((e,t)=>e+t.x,0)/i.length,c=i.reduce((e,t)=>e+t.y,0)/i.length;B.current.push({type:"move",startX:l,startY:c,targetX:(e.x+r)/2,targetY:(e.y+s)/2,life:40})}R.current=null}},onContextMenu:e=>e.preventDefault()}),E&&m[E.type]&&(0,w.jsxs)("div",{className:"absolute bottom-32 left-4 w-72 bg-gray-900/70 border-2 border-[#8B5A2B] rounded-lg shadow-2xl overflow-hidden backdrop-blur-md text-white z-[210]",children:[(0,w.jsxs)("div",{className:"bg-gradient-to-r from-gray-800/80 to-gray-900/80 p-3 border-b border-gray-700 flex justify-between items-center",children:[(0,w.jsx)("span",{className:"font-bold uppercase text-[#fbbf24] tracking-wider text-sm",children:m[E.type].label}),(0,w.jsxs)("span",{className:"text-xs text-gray-500 font-mono",children:["#",E.id]})]}),(0,w.jsxs)("div",{className:"p-4 space-y-4",children:[(0,w.jsx)("div",{className:"flex justify-center py-2",children:(0,w.jsxs)("div",{className:`w-20 h-20 rounded-full flex items-center justify-center border-2 border-gray-600 ${"republic"===E.faction?"bg-blue-900/40 text-blue-400":"bg-red-900/40 text-red-400"}`,children:["infantry"===E.type&&(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:"w-12 h-12",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),"heavy_infantry"===E.type&&(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:"w-12 h-12",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),"vehicle"===E.type&&(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:"w-12 h-12",fill:"currentColor",children:(0,w.jsx)("path",{d:"M20 13v-2c0-1.65-1.35-3-3-3H6c-1.1 0-2 .9-2 2v3H2v2h2v4h2v-4h12v4h2v-4h2v-2h-2zM6 10h11c.55 0 1 .45 1 1v2H6v-3z"})}),"turret"===E.type&&(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:"w-12 h-12",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 1L3 5v2h18V5l-9-4zm0 3c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm7 5v12h-2v-4h-2v4H9v-4H7v4H5V9h14z"})})]})}),(0,w.jsxs)("div",{className:"space-y-1",children:[(0,w.jsxs)("div",{className:"flex justify-between text-xs text-gray-400",children:[(0,w.jsx)("span",{children:"Intgrit"}),(0,w.jsxs)("span",{children:[Math.ceil(E.hp)," / ",E.maxHp]})]}),(0,w.jsx)("div",{className:"w-full h-3 bg-gray-800 rounded-full overflow-hidden border border-gray-600",children:(0,w.jsx)("div",{className:"h-full transition-all duration-300 bg-gradient-to-r from-green-500 to-emerald-400",style:{width:`${E.hp/E.maxHp*100}%`}})})]}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,w.jsxs)("div",{className:"bg-gray-800/50 p-1.5 rounded flex flex-col items-center hover:bg-gray-700 transition cursor-help",title:"Dgts: Points de vie retirs  la cible avant rduction par l'armure.",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{children:""}),(0,w.jsx)("span",{className:"font-bold text-gray-200",children:m[E.type].damage}),E.isSquad&&(0,w.jsxs)("span",{className:"text-[10px] text-gray-500",children:["x",E.soldierCount]})]}),(0,w.jsx)("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-semibold",children:"Dgts"})]}),(0,w.jsxs)("div",{className:"bg-gray-800/50 p-1.5 rounded flex flex-col items-center hover:bg-gray-700 transition cursor-help",title:"Pntration: Ignore ce montant d'armure chez la cible.",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{children:""}),(0,w.jsx)("span",{className:"font-bold text-gray-200",children:m[E.type].armorPen})]}),(0,w.jsx)("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-semibold",children:"Pntration"})]}),(0,w.jsxs)("div",{className:"bg-gray-800/50 p-1.5 rounded flex flex-col items-center hover:bg-gray-700 transition cursor-help",title:"Armure: Rduit les dgts subis de ce pourcentage.",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{children:""}),(0,w.jsxs)("span",{className:"font-bold text-gray-200",children:[m[E.type].armor,"%"]})]}),(0,w.jsx)("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-semibold",children:"Armure"})]}),(0,w.jsxs)("div",{className:"bg-gray-800/50 p-1.5 rounded flex flex-col items-center hover:bg-gray-700 transition cursor-help",title:"Prcision: Probabilit de toucher la cible  chaque attaque (0-100%).",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{children:""}),(0,w.jsxs)("span",{className:"font-bold text-gray-200",children:[Math.round(100*m[E.type].accuracy),"%"]})]}),(0,w.jsx)("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-semibold",children:"Prcision"})]}),(0,w.jsxs)("div",{className:"bg-gray-800/50 p-1.5 rounded flex flex-col items-center hover:bg-gray-700 transition cursor-help",title:"Porte: Distance maximale pour engager le combat.",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{children:""}),(0,w.jsxs)("span",{className:"font-bold text-gray-200",children:[m[E.type].range,"m"]})]}),(0,w.jsx)("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-semibold",children:"Porte"})]}),(0,w.jsxs)("div",{className:"bg-gray-800/50 p-1.5 rounded flex flex-col items-center hover:bg-gray-700 transition cursor-help",title:"Vitesse: Rapidit de dplacement de l'unit.",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{children:""}),(0,w.jsx)("span",{className:"font-bold text-gray-200",children:m[E.type].speed})]}),(0,w.jsx)("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-semibold",children:"Vitesse"})]}),(0,w.jsxs)("div",{className:"bg-gray-800/50 p-1.5 rounded flex flex-col items-center hover:bg-gray-700 transition cursor-help",title:"Recharge: Temps d'attente (en frames) entre deux attaques.",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{children:""}),(0,w.jsx)("span",{className:"font-bold text-gray-200",children:m[E.type].cooldown})]}),(0,w.jsx)("span",{className:"text-[10px] text-gray-400 uppercase tracking-wide font-semibold",children:"Cooldown"})]}),m[E.type].maxMana>0&&(0,w.jsxs)("div",{className:"bg-gray-800/50 p-1.5 rounded flex flex-col items-center hover:bg-gray-700 transition cursor-help",title:"Force: nergie requise pour activer les capacits spciales.",children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("span",{children:""}),(0,w.jsxs)("span",{className:"font-bold text-cyan-400",children:[Math.floor(E.mana),"/",E.maxMana]})]}),(0,w.jsx)("span",{className:"text-[10px] text-cyan-500 uppercase tracking-wide font-semibold",children:"Force"})]})]}),(0,w.jsxs)("div",{className:"space-y-1",children:[m[E.type].traits&&(0,w.jsx)("div",{className:"flex gap-1 flex-wrap justify-center",children:m[E.type].traits.map(e=>(0,w.jsx)("span",{className:"px-2 py-0.5 bg-gray-700 rounded text-[10px] uppercase text-gray-300 border border-gray-600 font-mono tracking-tight",children:"mechanized"===e?" MCA":"robotic"===e?" ROBOT":"biological"===e?" BIO":e},e))}),m[E.type].bonuses&&(0,w.jsxs)("div",{className:"text-[10px] text-green-400 text-center",children:[(0,w.jsx)("span",{className:"text-gray-500 mr-1",children:"Bonus:"}),Object.entries(m[E.type].bonuses).map(([e,t])=>(0,w.jsxs)("span",{className:"mr-2",children:["vs ",e.toUpperCase()," +",Math.round((t-1)*100),"%"]},e))]})]}),(0,w.jsx)("div",{className:"text-xs text-gray-500 italic border-t border-gray-700 pt-3",children:"infantry"===E.type?"Infanterie standard de la rpublique, quipe de fusils blasters.":"heavy_infantry"===E.type?"Troupes de choc avec armure lourde et canons rotatifs.":"vehicle"===E.type?"Unit mcanise offrant un soutien lourd et une couverture mobile.":"Tourelle dfensive automatise."})]})]}),g.length>0&&(0,w.jsxs)("div",{className:"absolute bottom-32 left-1/2 transform -translate-x-1/2 flex gap-2 z-[200]",children:[(0,w.jsxs)("button",{onClick:()=>{let e=z.current,t=!1;g.forEach(r=>{let s=e.find(e=>e.id===r);s&&s.holdPosition&&(t=!0)});let r=!t;g.forEach(t=>{let s=e.find(e=>e.id===t);s&&(s.holdPosition=r,r&&(s.manualMove=null))})},className:"bg-gray-800/80 hover:bg-gray-700 border-2 border-gray-500 text-white px-4 py-2 rounded-t-lg font-bold flex items-center gap-2 transition-all",title:"Maintenir la Position (H) - Les units ne poursuivront pas les ennemis",children:[(0,w.jsx)("span",{children:""}),(0,w.jsx)("span",{className:"text-sm uppercase tracking-wider",children:"Ne pas bouger"})]}),(0,w.jsxs)("button",{onClick:()=>_(!v),className:`bg-gray-800/80 hover:bg-gray-700 border-2 ${v?"border-yellow-400 text-yellow-400":"border-gray-500 text-white"} px-4 py-2 rounded-t-lg font-bold flex items-center gap-2 transition-all`,title:"Orienter - Cliquer sur la carte pour dfinir la direction du regard",children:[(0,w.jsx)("span",{children:""}),(0,w.jsx)("span",{className:"text-sm uppercase tracking-wider",children:"Orienter"})]}),E&&m[E.type]&&m[E.type].abilities&&m[E.type].abilities.map(e=>(0,w.jsxs)("button",{onClick:()=>{E.mana>=e.cost&&(A({id:e.id,type:e.type,sourceId:E.id}),F.current=!1)},onMouseEnter:()=>F.current=!0,onMouseLeave:()=>F.current=!1,className:`border-2 px-4 py-2 rounded-t-lg font-bold flex items-center gap-2 transition-all shadow-[0_0_15px_rgba(168,85,247,0.5)] ${E.mana>=e.cost?"bg-purple-900/80 hover:bg-purple-700 border-purple-500 text-white":"bg-gray-800 border-gray-600 text-gray-500 cursor-not-allowed"}`,title:`${e.label} (Co\xfbt: ${e.cost})`,children:[(0,w.jsx)("span",{className:"text-xl",children:""}),(0,w.jsxs)("div",{className:"flex flex-col items-start leading-none",children:[(0,w.jsx)("span",{className:"text-sm uppercase tracking-wider font-bold",children:e.label}),(0,w.jsxs)("span",{className:"text-[10px] text-purple-200",children:["Cot: ",e.cost," FP"]})]})]},e.id))]}),(0,w.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-gray-900/90 border-t-2 border-[#8B5A2B] p-2 flex gap-2 h-28 items-center overflow-x-auto custom-scrollbar backdrop-blur-md",children:[(0,w.jsxs)("div",{className:"flex-shrink-0 mr-4 border-r border-gray-700 pr-4 flex flex-col justify-center items-center text-gray-500",children:[(0,w.jsx)("span",{className:"text-2xl",children:""}),(0,w.jsx)("span",{className:"text-[10px] uppercase font-bold",children:"Effectifs"}),(0,w.jsx)("span",{className:"text-xs text-white font-mono",children:S.length})]}),S.map(e=>{let t=g.includes(e.id),r=m[e.type],s=e.hp/e.maxHp*100;return(0,w.jsxs)("div",{onClick:t=>{t.ctrlKey?x(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]):x([e.id])},className:`relative w-20 h-24 flex-shrink-0 border-2 rounded p-1 cursor-pointer transition-all hover:bg-gray-800 group
                                ${t?"border-green-500 bg-green-900/20 shadow-[0_0_10px_rgba(34,197,94,0.3)]":"border-gray-700 bg-black/40 hover:border-gray-500"}
                            `,children:[(0,w.jsxs)("div",{className:"h-2/3 flex items-center justify-center p-1",children:["infantry"===e.type&&(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:"w-8 h-8 text-sky-300 drop-shadow-md",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),"heavy_infantry"===e.type&&(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:"w-8 h-8 text-indigo-400 drop-shadow-md",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),"vehicle"===e.type&&(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:"w-10 h-10 text-emerald-400 drop-shadow-md",fill:"currentColor",children:(0,w.jsx)("path",{d:"M20 13v-2c0-1.65-1.35-3-3-3H6c-1.1 0-2 .9-2 2v3H2v2h2v4h2v-4h12v4h2v-4h2v-2h-2zM6 10h11c.55 0 1 .45 1 1v2H6v-3z"})}),"turret"===e.type&&(0,w.jsx)("svg",{viewBox:"0 0 24 24",className:"w-8 h-8 text-red-500 drop-shadow-md",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 1L3 5v2h18V5l-9-4zm0 3c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm7 5v12h-2v-4h-2v4H9v-4H7v4H5V9h14z"})})]}),(0,w.jsxs)("div",{className:"absolute top-1 right-1 text-[8px] font-mono text-gray-400",children:["#",e.id]}),(0,w.jsxs)("div",{className:"absolute bottom-1 left-1 right-1 space-y-1",children:[(0,w.jsx)("div",{className:"text-[9px] text-center font-bold text-gray-300 truncate leading-none mb-1",children:r.label}),(0,w.jsx)("div",{className:"w-full h-1.5 bg-gray-800 rounded-full overflow-hidden border border-gray-600",children:(0,w.jsx)("div",{className:"h-full transition-all duration-300",style:{width:`${s}%`,backgroundColor:s>50?"#22c55e":s>20?"#eab308":"#ef4444"}})})]})]},e.id)})]})]})}let ug=(3+8881784197001252e-31)*11102230246251565e-32;function ux(e,t,r,s,n){let i,a,o,l,c=t[0],d=s[0],u=0,h=0;d>c==d>-c?(i=c,c=t[++u]):(i=d,d=s[++h]);let p=0;if(u<e&&h<r)for(d>c==d>-c?(a=c+i,o=i-(a-c),c=t[++u]):(a=d+i,o=i-(a-d),d=s[++h]),i=a,0!==o&&(n[p++]=o);u<e&&h<r;)d>c==d>-c?(l=(a=i+c)-i,o=i-(a-l)+(c-l),c=t[++u]):(l=(a=i+d)-i,o=i-(a-l)+(d-l),d=s[++h]),i=a,0!==o&&(n[p++]=o);for(;u<e;)l=(a=i+c)-i,o=i-(a-l)+(c-l),c=t[++u],i=a,0!==o&&(n[p++]=o);for(;h<r;)l=(a=i+d)-i,o=i-(a-l)+(d-l),d=s[++h],i=a,0!==o&&(n[p++]=o);return(0!==i||0===p)&&(n[p++]=i),p}function ub(e){return new Float64Array(e)}let uy=(3+17763568394002505e-31)*11102230246251565e-32,uv=(2+13322676295501878e-31)*11102230246251565e-32,uw=(9+7105427357601002e-30)*11102230246251565e-32*11102230246251565e-32,u_=ub(4),uN=ub(8),uj=ub(12),uk=ub(16),uS=ub(4);function uC(e,t,r,s,n,i){let a=(t-i)*(r-n),o=(e-n)*(s-i),l=a-o,c=Math.abs(a+o);return Math.abs(l)>=uy*c?l:-function(e,t,r,s,n,i,a){let o,l,c,d,u,h,p,f,m,g,x,b,y,v,w,_,N,j,k=e-n,S=r-n,C=t-i,E=s-i;v=k*E,p=(h=0x8000001*k)-(h-k),f=k-p,m=(h=0x8000001*E)-(h-E),w=f*(g=E-m)-(v-p*m-f*m-p*g),_=C*S,p=(h=0x8000001*C)-(h-C),f=C-p,m=(h=0x8000001*S)-(h-S),x=w-(N=f*(g=S-m)-(_-p*m-f*m-p*g)),u=w-x,u_[0]=w-(x+u)+(u-N),u=(b=v+x)-v,x=(y=v-(b-u)+(x-u))-_,u=y-x,u_[1]=y-(x+u)+(u-_),u=(j=b+x)-b,u_[2]=b-(j-u)+(x-u),u_[3]=j;let I=function(e,t){let r=t[0];for(let e=1;e<4;e++)r+=t[e];return r}(0,u_),T=uv*a;if(I>=T||-I>=T||(u=e-k,o=e-(k+u)+(u-n),u=r-S,c=r-(S+u)+(u-n),u=t-C,l=t-(C+u)+(u-i),u=s-E,d=s-(E+u)+(u-i),0===o&&0===l&&0===c&&0===d)||(T=uw*a+ug*Math.abs(I),(I+=k*d+E*o-(C*c+S*l))>=T||-I>=T))return I;v=o*E,p=(h=0x8000001*o)-(h-o),f=o-p,m=(h=0x8000001*E)-(h-E),w=f*(g=E-m)-(v-p*m-f*m-p*g),_=l*S,p=(h=0x8000001*l)-(h-l),f=l-p,m=(h=0x8000001*S)-(h-S),x=w-(N=f*(g=S-m)-(_-p*m-f*m-p*g)),u=w-x,uS[0]=w-(x+u)+(u-N),u=(b=v+x)-v,x=(y=v-(b-u)+(x-u))-_,u=y-x,uS[1]=y-(x+u)+(u-_),u=(j=b+x)-b,uS[2]=b-(j-u)+(x-u),uS[3]=j;let A=ux(4,u_,4,uS,uN);v=k*d,p=(h=0x8000001*k)-(h-k),f=k-p,m=(h=0x8000001*d)-(h-d),w=f*(g=d-m)-(v-p*m-f*m-p*g),_=C*c,p=(h=0x8000001*C)-(h-C),f=C-p,m=(h=0x8000001*c)-(h-c),x=w-(N=f*(g=c-m)-(_-p*m-f*m-p*g)),u=w-x,uS[0]=w-(x+u)+(u-N),u=(b=v+x)-v,x=(y=v-(b-u)+(x-u))-_,u=y-x,uS[1]=y-(x+u)+(u-_),u=(j=b+x)-b,uS[2]=b-(j-u)+(x-u),uS[3]=j;let M=ux(A,uN,4,uS,uj);v=o*d,p=(h=0x8000001*o)-(h-o),f=o-p,m=(h=0x8000001*d)-(h-d),w=f*(g=d-m)-(v-p*m-f*m-p*g),_=l*c,p=(h=0x8000001*l)-(h-l),f=l-p,m=(h=0x8000001*c)-(h-c),x=w-(N=f*(g=c-m)-(_-p*m-f*m-p*g)),u=w-x,uS[0]=w-(x+u)+(u-N),u=(b=v+x)-v,x=(y=v-(b-u)+(x-u))-_,u=y-x,uS[1]=y-(x+u)+(u-_),u=(j=b+x)-b,uS[2]=b-(j-u)+(x-u),uS[3]=j;let R=ux(M,uj,4,uS,uk);return uk[R-1]}(e,t,r,s,n,i,c)}ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(8),ub(8),ub(8),ub(4),ub(8),ub(8),ub(8),ub(12),ub(192),ub(192),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(8),ub(8),ub(8),ub(8),ub(8),ub(8),ub(8),ub(8),ub(8),ub(4),ub(4),ub(4),ub(8),ub(16),ub(16),ub(16),ub(32),ub(32),ub(48),ub(64),ub(1152),ub(1152),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(4),ub(24),ub(24),ub(24),ub(24),ub(24),ub(24),ub(24),ub(24),ub(24),ub(24),ub(1152),ub(1152),ub(1152),ub(1152),ub(1152),ub(2304),ub(2304),ub(3456),ub(5760),ub(8),ub(8),ub(8),ub(16),ub(24),ub(48),ub(48),ub(96),ub(192),ub(384),ub(384),ub(384),ub(768),ub(96),ub(96),ub(96),ub(1152);let uE=new Uint32Array(512);class uI{static from(e,t=uR,r=uP){let s=e.length,n=new Float64Array(2*s);for(let i=0;i<s;i++){let s=e[i];n[2*i]=t(s),n[2*i+1]=r(s)}return new uI(n)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*r),this._halfedges=new Int32Array(3*r),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){var e,t,r,s,n,i;let a,o,l,c,d,u,h,p,f,m,{coords:g,_hullPrev:x,_hullNext:b,_hullTri:y,_hullHash:v}=this,w=g.length>>1,_=1/0,N=1/0,j=-1/0,k=-1/0;for(let e=0;e<w;e++){let t=g[2*e],r=g[2*e+1];t<_&&(_=t),r<N&&(N=r),t>j&&(j=t),r>k&&(k=r),this._ids[e]=e}let S=(_+j)/2,C=(N+k)/2;for(let e=0,t=1/0;e<w;e++){let r=uT(S,C,g[2*e],g[2*e+1]);r<t&&(p=e,t=r)}let E=g[2*p],I=g[2*p+1];for(let e=0,t=1/0;e<w;e++){if(e===p)continue;let r=uT(E,I,g[2*e],g[2*e+1]);r<t&&r>0&&(f=e,t=r)}let T=g[2*f],A=g[2*f+1],M=1/0;for(let e=0;e<w;e++){if(e===p||e===f)continue;let t=function(e,t,r,s,n,i){let a=r-e,o=s-t,l=n-e,c=i-t,d=a*a+o*o,u=l*l+c*c,h=.5/(a*c-o*l),p=(c*d-o*u)*h,f=(a*u-l*d)*h;return p*p+f*f}(E,I,T,A,g[2*e],g[2*e+1]);t<M&&(m=e,M=t)}let R=g[2*m],P=g[2*m+1];if(M===1/0){for(let e=0;e<w;e++)this._dists[e]=g[2*e]-g[0]||g[2*e+1]-g[1];uA(this._ids,this._dists,0,w-1);let e=new Uint32Array(w),t=0;for(let r=0,s=-1/0;r<w;r++){let n=this._ids[r],i=this._dists[n];i>s&&(e[t++]=n,s=i)}this.hull=e.subarray(0,t),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(0>uC(E,I,T,A,R,P)){let e=f,t=T,r=A;f=m,T=R,A=P,m=e,R=t,P=r}let D=(e=E,t=I,r=T,s=A,n=R,i=P,a=r-e,o=s-t,l=n-e,c=i-t,d=a*a+o*o,u=l*l+c*c,h=.5/(a*c-o*l),{x:e+(c*d-o*u)*h,y:t+(a*u-l*d)*h});this._cx=D.x,this._cy=D.y;for(let e=0;e<w;e++)this._dists[e]=uT(g[2*e],g[2*e+1],D.x,D.y);uA(this._ids,this._dists,0,w-1),this._hullStart=p;let O=3;b[p]=x[m]=f,b[f]=x[p]=m,b[m]=x[f]=p,y[p]=0,y[f]=1,y[m]=2,v.fill(-1),v[this._hashKey(E,I)]=p,v[this._hashKey(T,A)]=f,v[this._hashKey(R,P)]=m,this.trianglesLen=0,this._addTriangle(p,f,m,-1,-1,-1);for(let e=0,t,r;e<this._ids.length;e++){let s=this._ids[e],n=g[2*s],i=g[2*s+1];if(e>0&&2220446049250313e-31>=Math.abs(n-t)&&2220446049250313e-31>=Math.abs(i-r)||(t=n,r=i,s===p||s===f||s===m))continue;let a=0;for(let e=0,t=this._hashKey(n,i);e<this._hashSize&&(-1===(a=v[(t+e)%this._hashSize])||a===b[a]);e++);let o=a=x[a],l;for(;l=b[o],uC(n,i,g[2*o],g[2*o+1],g[2*l],g[2*l+1])>=0;)if((o=l)===a){o=-1;break}if(-1===o)continue;let c=this._addTriangle(o,s,b[o],-1,-1,y[o]);y[s]=this._legalize(c+2),y[o]=c,O++;let d=b[o];for(;l=b[d],0>uC(n,i,g[2*d],g[2*d+1],g[2*l],g[2*l+1]);)c=this._addTriangle(d,s,l,y[s],-1,y[d]),y[s]=this._legalize(c+2),b[d]=d,O--,d=l;if(o===a)for(;0>uC(n,i,g[2*(l=x[o])],g[2*l+1],g[2*o],g[2*o+1]);)c=this._addTriangle(l,s,o,-1,y[o],y[l]),this._legalize(c+2),y[l]=c,b[o]=o,O--,o=l;this._hullStart=x[s]=o,b[o]=x[d]=s,b[s]=d,v[this._hashKey(n,i)]=s,v[this._hashKey(g[2*o],g[2*o+1])]=o}this.hull=new Uint32Array(O);for(let e=0,t=this._hullStart;e<O;e++)this.hull[e]=t,t=b[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){var r,s;let n;return Math.floor((r=e-this._cx,n=r/(Math.abs(r)+Math.abs(s=t-this._cy)),(s>0?3-n:1+n)/4*this._hashSize))%this._hashSize}_legalize(e){let{_triangles:t,_halfedges:r,coords:s}=this,n=0,i=0;for(;;){let a=r[e],o=e-e%3;if(i=o+(e+2)%3,-1===a){if(0===n)break;e=uE[--n];continue}let l=a-a%3,c=o+(e+1)%3,d=l+(a+2)%3,u=t[i],h=t[e],p=t[c],f=t[d];if(function(e,t,r,s,n,i,a,o){let l=e-a,c=t-o,d=r-a,u=s-o,h=n-a,p=i-o,f=d*d+u*u,m=h*h+p*p;return l*(u*m-f*p)-c*(d*m-f*h)+(l*l+c*c)*(d*p-u*h)<0}(s[2*u],s[2*u+1],s[2*h],s[2*h+1],s[2*p],s[2*p+1],s[2*f],s[2*f+1])){t[e]=f,t[a]=u;let s=r[d];if(-1===s){let t=this._hullStart;do{if(this._hullTri[t]===d){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,s),this._link(a,r[i]),this._link(i,d);let o=l+(a+1)%3;n<uE.length&&(uE[n++]=o)}else{if(0===n)break;e=uE[--n]}}return i}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,r,s,n,i){let a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=r,this._link(a,s),this._link(a+1,n),this._link(a+2,i),this.trianglesLen+=3,a}}function uT(e,t,r,s){let n=e-r,i=t-s;return n*n+i*i}function uA(e,t,r,s){if(s-r<=20)for(let n=r+1;n<=s;n++){let s=e[n],i=t[s],a=n-1;for(;a>=r&&t[e[a]]>i;)e[a+1]=e[a--];e[a+1]=s}else{let n=r+s>>1,i=r+1,a=s;uM(e,n,i),t[e[r]]>t[e[s]]&&uM(e,r,s),t[e[i]]>t[e[s]]&&uM(e,i,s),t[e[r]]>t[e[i]]&&uM(e,r,i);let o=e[i],l=t[o];for(;;){do i++;while(t[e[i]]<l)do a--;while(t[e[a]]>l)if(a<i)break;uM(e,i,a)}e[r+1]=e[a],e[a]=o,s-i+1>=a-r?(uA(e,t,i,s),uA(e,t,r,a-1)):(uA(e,t,r,a-1),uA(e,t,i,s))}}function uM(e,t,r){let s=e[t];e[t]=e[r],e[r]=s}function uR(e){return e[0]}function uP(e){return e[1]}class uD{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,r){e*=1,t*=1,r*=1;let s=e+r,n=t;if(r<0)throw Error("negative radius");null===this._x1?this._+=`M${s},${n}`:(Math.abs(this._x1-s)>1e-6||Math.abs(this._y1-n)>1e-6)&&(this._+="L"+s+","+n),r&&(this._+=`A${r},${r},0,1,1,${e-r},${t}A${r},${r},0,1,1,${this._x1=s},${this._y1=n}`)}rect(e,t,r,s){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+r}v${+s}h${-r}Z`}value(){return this._||null}}class uO{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class uL{constructor(e,[t,r,s,n]=[0,0,960,500]){if(!((s*=1)>=(t*=1))||!((n*=1)>=(r*=1)))throw Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=s,this.xmin=t,this.ymax=n,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){let e,t,{delaunay:{points:r,hull:s,triangles:n},vectors:i}=this,a=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let i=0,o=0,l=n.length,c,d;i<l;i+=3,o+=2){let l=2*n[i],u=2*n[i+1],h=2*n[i+2],p=r[l],f=r[l+1],m=r[u],g=r[u+1],x=r[h],b=r[h+1],y=m-p,v=g-f,w=x-p,_=b-f,N=(y*_-v*w)*2;if(1e-9>Math.abs(N)){if(void 0===e){for(let n of(e=t=0,s))e+=r[2*n],t+=r[2*n+1];e/=s.length,t/=s.length}let n=1e9*Math.sign((e-p)*_-(t-f)*w);c=(p+x)/2-n*_,d=(f+b)/2+n*w}else{let e=1/N,t=y*y+v*v,r=w*w+_*_;c=p+(_*t-v*r)*e,d=f+(y*r-w*t)*e}a[o]=c,a[o+1]=d}let o=s[s.length-1],l,c=4*o,d,u=r[2*o],h,p=r[2*o+1];i.fill(0);for(let e=0;e<s.length;++e)o=s[e],l=c,d=u,h=p,c=4*o,u=r[2*o],p=r[2*o+1],i[l+2]=i[c]=h-p,i[l+3]=i[c+1]=u-d}render(e){let t=null==e?e=new uD:void 0,{delaunay:{halfedges:r,inedges:s,hull:n},circumcenters:i,vectors:a}=this;if(n.length<=1)return null;for(let t=0,s=r.length;t<s;++t){let s=r[t];if(s<t)continue;let n=2*Math.floor(t/3),a=2*Math.floor(s/3),o=i[n],l=i[n+1],c=i[a],d=i[a+1];this._renderSegment(o,l,c,d,e)}let o,l=n[n.length-1];for(let t=0;t<n.length;++t){o=l;let r=2*Math.floor(s[l=n[t]]/3),c=i[r],d=i[r+1],u=4*o,h=this._project(c,d,a[u+2],a[u+3]);h&&this._renderSegment(c,d,h[0],h[1],e)}return t&&t.value()}renderBounds(e){let t=null==e?e=new uD:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){let r=null==t?t=new uD:void 0,s=this._clip(e);if(null===s||!s.length)return;t.moveTo(s[0],s[1]);let n=s.length;for(;s[0]===s[n-2]&&s[1]===s[n-1]&&n>1;)n-=2;for(let e=2;e<n;e+=2)(s[e]!==s[e-2]||s[e+1]!==s[e-1])&&t.lineTo(s[e],s[e+1]);return t.closePath(),r&&r.value()}*cellPolygons(){let{delaunay:{points:e}}=this;for(let t=0,r=e.length/2;t<r;++t){let e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){let t=new uO;return this.renderCell(e,t),t.value()}_renderSegment(e,t,r,s,n){let i,a=this._regioncode(e,t),o=this._regioncode(r,s);0===a&&0===o?(n.moveTo(e,t),n.lineTo(r,s)):(i=this._clipSegment(e,t,r,s,a,o))&&(n.moveTo(i[0],i[1]),n.lineTo(i[2],i[3]))}contains(e,t,r){return(t*=1)==t&&(r*=1)==r&&this.delaunay._step(e,t,r)===e}*neighbors(e){let t=this._clip(e);if(t)for(let r of this.delaunay.neighbors(e)){let e=this._clip(r);if(e){r:for(let s=0,n=t.length;s<n;s+=2)for(let i=0,a=e.length;i<a;i+=2)if(t[s]===e[i]&&t[s+1]===e[i+1]&&t[(s+2)%n]===e[(i+a-2)%a]&&t[(s+3)%n]===e[(i+a-1)%a]){yield r;break r}}}}_cell(e){let{circumcenters:t,delaunay:{inedges:r,halfedges:s,triangles:n}}=this,i=r[e];if(-1===i)return null;let a=[],o=i;do{let r=Math.floor(o/3);if(a.push(t[2*r],t[2*r+1]),n[o=o%3==2?o-2:o+1]!==e)break;o=s[o]}while(o!==i&&-1!==o)return a}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];let t=this._cell(e);if(null===t)return null;let{vectors:r}=this,s=4*e;return this._simplify(r[s]||r[s+1]?this._clipInfinite(e,t,r[s],r[s+1],r[s+2],r[s+3]):this._clipFinite(e,t))}_clipFinite(e,t){let r=t.length,s=null,n,i,a=t[r-2],o=t[r-1],l,c=this._regioncode(a,o),d,u=0;for(let h=0;h<r;h+=2)if(n=a,i=o,a=t[h],o=t[h+1],l=c,c=this._regioncode(a,o),0===l&&0===c)d=u,u=0,s?s.push(a,o):s=[a,o];else{let t,r,h,p,f;if(0===l){if(null===(t=this._clipSegment(n,i,a,o,l,c)))continue;[r,h,p,f]=t}else{if(null===(t=this._clipSegment(a,o,n,i,c,l)))continue;[p,f,r,h]=t,d=u,u=this._edgecode(r,h),d&&u&&this._edge(e,d,u,s,s.length),s?s.push(r,h):s=[r,h]}d=u,u=this._edgecode(p,f),d&&u&&this._edge(e,d,u,s,s.length),s?s.push(p,f):s=[p,f]}if(s)d=u,u=this._edgecode(s[0],s[1]),d&&u&&this._edge(e,d,u,s,s.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return s}_clipSegment(e,t,r,s,n,i){let a=n<i;for(a&&([e,t,r,s,n,i]=[r,s,e,t,i,n]);;){if(0===n&&0===i)return a?[r,s,e,t]:[e,t,r,s];if(n&i)return null;let o,l,c=n||i;8&c?(o=e+(r-e)*(this.ymax-t)/(s-t),l=this.ymax):4&c?(o=e+(r-e)*(this.ymin-t)/(s-t),l=this.ymin):2&c?(l=t+(s-t)*(this.xmax-e)/(r-e),o=this.xmax):(l=t+(s-t)*(this.xmin-e)/(r-e),o=this.xmin),n?(e=o,t=l,n=this._regioncode(e,t)):(r=o,s=l,i=this._regioncode(r,s))}}_clipInfinite(e,t,r,s,n,i){let a=Array.from(t),o;if((o=this._project(a[0],a[1],r,s))&&a.unshift(o[0],o[1]),(o=this._project(a[a.length-2],a[a.length-1],n,i))&&a.push(o[0],o[1]),a=this._clipFinite(e,a))for(let t=0,r=a.length,s,n=this._edgecode(a[r-2],a[r-1]);t<r;t+=2)s=n,n=this._edgecode(a[t],a[t+1]),s&&n&&(t=this._edge(e,s,n,a,t),r=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,t,r,s,n){for(;t!==r;){let r,i;switch(t){case 5:t=4;continue;case 4:t=6,r=this.xmax,i=this.ymin;break;case 6:t=2;continue;case 2:t=10,r=this.xmax,i=this.ymax;break;case 10:t=8;continue;case 8:t=9,r=this.xmin,i=this.ymax;break;case 9:t=1;continue;case 1:t=5,r=this.xmin,i=this.ymin}(s[n]!==r||s[n+1]!==i)&&this.contains(e,r,i)&&(s.splice(n,0,r,i),n+=2)}return n}_project(e,t,r,s){let n=1/0,i,a,o;if(s<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/s)<n&&(o=this.ymin,a=e+(n=i)*r)}else if(s>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/s)<n&&(o=this.ymax,a=e+(n=i)*r)}if(r>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/r)<n&&(a=this.xmax,o=t+(n=i)*s)}else if(r<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/r)<n&&(a=this.xmin,o=t+(n=i)*s)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:2*(e===this.xmax))|(t===this.ymin?4:8*(t===this.ymax))}_regioncode(e,t){return(e<this.xmin?1:2*(e>this.xmax))|(t<this.ymin?4:8*(t>this.ymax))}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){let r=(t+2)%e.length,s=(t+4)%e.length;(e[t]===e[r]&&e[r]===e[s]||e[t+1]===e[r+1]&&e[r+1]===e[s+1])&&(e.splice(r,2),t-=2)}e.length||(e=null)}return e}}let uF=2*Math.PI,uU=Math.pow;function uz(e){return e[0]}function uV(e){return e[1]}class u${static from(e,t=uz,r=uV,s){return new u$("length"in e?function(e,t,r,s){let n=e.length,i=new Float64Array(2*n);for(let a=0;a<n;++a){let n=e[a];i[2*a]=t.call(s,n,a,e),i[2*a+1]=r.call(s,n,a,e)}return i}(e,t,r,s):Float64Array.from(function*(e,t,r,s){let n=0;for(let i of e)yield t.call(s,i,n,e),yield r.call(s,i,n,e),++n}(e,t,r,s)))}constructor(e){this._delaunator=new uI(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){let e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){let{triangles:t,coords:r}=e;for(let e=0;e<t.length;e+=3){let s=2*t[e],n=2*t[e+1],i=2*t[e+2];if((r[i]-r[s])*(r[n+1]-r[s+1])-(r[n]-r[s])*(r[i+1]-r[s+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},(e,t)=>t).sort((e,r)=>t[2*e]-t[2*r]||t[2*e+1]-t[2*r+1]);let e=this.collinear[0],n=this.collinear[this.collinear.length-1],i=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],a=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(let e=0,n=t.length/2;e<n;++e){var r,s;let n=(r=t[2*e],[r+Math.sin(r+(s=t[2*e+1]))*a,s+Math.cos(r-s)*a]);t[2*e]=n[0],t[2*e+1]=n[1]}this._delaunator=new uI(t)}else delete this.collinear;let n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,a=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),l=this._hullIndex.fill(-1);for(let e=0,t=n.length;e<t;++e){let t=a[e%3==2?e-2:e+1];(-1===n[e]||-1===o[t])&&(o[t]=e)}for(let e=0,t=i.length;e<t;++e)l[i[e]]=e;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],o[i[0]]=1,2===i.length&&(o[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(e){return new uL(this,e)}*neighbors(e){let{inedges:t,hull:r,_hullIndex:s,halfedges:n,triangles:i,collinear:a}=this;if(a){let t=a.indexOf(e);t>0&&(yield a[t-1]),t<a.length-1&&(yield a[t+1]);return}let o=t[e];if(-1===o)return;let l=o,c=-1;do{if(yield c=i[l],i[l=l%3==2?l-2:l+1]!==e)return;if(-1===(l=n[l])){let t=r[(s[e]+1)%r.length];t!==c&&(yield t);return}}while(l!==o)}find(e,t,r=0){let s;if((e*=1)!=e||(t*=1)!=t)return -1;let n=r;for(;(s=this._step(r,e,t))>=0&&s!==r&&s!==n;)r=s;return s}_step(e,t,r){let{inedges:s,hull:n,_hullIndex:i,halfedges:a,triangles:o,points:l}=this;if(-1===s[e]||!l.length)return(e+1)%(l.length>>1);let c=e,d=uU(t-l[2*e],2)+uU(r-l[2*e+1],2),u=s[e],h=u;do{let s=o[h],u=uU(t-l[2*s],2)+uU(r-l[2*s+1],2);if(u<d&&(d=u,c=s),o[h=h%3==2?h-2:h+1]!==e)break;if(-1===(h=a[h])){if((h=n[(i[e]+1)%n.length])!==s&&uU(t-l[2*h],2)+uU(r-l[2*h+1],2)<d)return h;break}}while(h!==u)return c}render(e){let t=null==e?e=new uD:void 0,{points:r,halfedges:s,triangles:n}=this;for(let t=0,i=s.length;t<i;++t){let i=s[t];if(i<t)continue;let a=2*n[t],o=2*n[i];e.moveTo(r[a],r[a+1]),e.lineTo(r[o],r[o+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){void 0!==t||e&&"function"==typeof e.moveTo||(t=e,e=null),t=void 0==t?2:+t;let r=null==e?e=new uD:void 0,{points:s}=this;for(let r=0,n=s.length;r<n;r+=2){let n=s[r],i=s[r+1];e.moveTo(n+t,i),e.arc(n,i,t,0,uF)}return r&&r.value()}renderHull(e){let t=null==e?e=new uD:void 0,{hull:r,points:s}=this,n=2*r[0],i=r.length;e.moveTo(s[n],s[n+1]);for(let t=1;t<i;++t){let n=2*r[t];e.lineTo(s[n],s[n+1])}return e.closePath(),t&&t.value()}hullPolygon(){let e=new uO;return this.renderHull(e),e.value()}renderTriangle(e,t){let r=null==t?t=new uD:void 0,{points:s,triangles:n}=this,i=2*n[e*=3],a=2*n[e+1],o=2*n[e+2];return t.moveTo(s[i],s[i+1]),t.lineTo(s[a],s[a+1]),t.lineTo(s[o],s[o+1]),t.closePath(),r&&r.value()}*trianglePolygons(){let{triangles:e}=this;for(let t=0,r=e.length/3;t<r;++t)yield this.trianglePolygon(t)}trianglePolygon(e){let t=new uO;return this.renderTriangle(e,t),t.value()}}let uq=["#3b82f6","#8b5cf6","#ec4899","#f97316","#eab308","#22c55e","#06b6d4","#64748b"],uB=e=>{let t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)+((t<<5)-t);return uq[Math.abs(t)%uq.length]},uH=e=>Math.round(100*e)/100,uG=(e,t)=>{let r=`${uH(e[0])},${uH(e[1])}`,s=`${uH(t[0])},${uH(t[1])}`;return r<s?r+"|"+s:s+"|"+r},uW=(0,N.memo)(function(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,N,j=(0,_.c)(58),{planets:k,factions:S,onRegionClick:C}=e;s:{let e,r,s,n,i;if(!k||0===k.length){let e;j[0]===Symbol.for("react.memo_cache_sentinel")?(e={cellPaths:{},outlinePaths:{},factionColors:{},regionPaths:{},regionColors:{},regionAreaPaths:{}},j[0]=e):e=j[0],t=e;break s}if(j[1]!==k){let t=k.map(uK),i=k.map(uX);r=Math.min(...t),e=Math.max(...t),s=Math.min(...i),n=Math.max(...i),j[1]=k,j[2]=e,j[3]=r,j[4]=s,j[5]=n}else e=j[2],r=j[3],s=j[4],n=j[5];let a=r-2e3,o=s-2e3,l=e+2e3,c=n+2e3;if(j[6]!==S||j[7]!==k||j[8]!==a||j[9]!==o||j[10]!==l||j[11]!==c){let e,t=[a,o,l,c],r=k.map(uY),s=u$.from(r).voronoi(t),n={},d={},u={},h={},p={};for(let e=0;e<r.length;e++){let t=k[e],r=s.cellPolygon(e),i=t.owner;if(i&&"neutral"!==i){let t=s.renderCell(e);if(n[i]||(n[i]=""),n[i]=n[i]+(t+" "),r){d[i]||(d[i]=new Map);let e=d[i];for(let t=0;t<r.length-1;t++){let s=uG(r[t],r[t+1]);e.set(s,(e.get(s)||0)+1)}}}let a=t.region;if(a){let t=s.renderCell(e);if(p[a]||(p[a]=""),p[a]=p[a]+(t+" "),r)for(let e=0;e<r.length-1;e++){let t=uG(r[e],r[e+1]);u[a]||(u[a]=new Map);let s=u[a];s.set(t,(s.get(t)||0)+1)}h[a]||(h[a]=uB(a))}}j[13]!==S?(e={},S.forEach(t=>e[t.id]=t.color),j[13]=S,j[14]=e):e=j[14];let f={};Object.entries(u).forEach(e=>{let[t,r]=e,s="";for(let[e,t]of r.entries())if(1===t){let[t,r]=e.split("|"),[n,i]=t.split(",").map(Number),[a,o]=r.split(",").map(Number);s+=`M${n},${i}L${a},${o}`}f[t]=s});let m={};Object.entries(d).forEach(e=>{let[t,r]=e,s="";for(let[e,t]of r.entries())if(1===t){let[t,r]=e.split("|"),[n,i]=t.split(",").map(Number),[a,o]=r.split(",").map(Number);s+=`M${n},${i}L${a},${o}`}m[t]=s}),i={cellPaths:n,outlinePaths:m,factionColors:e,regionPaths:f,regionColors:h,regionAreaPaths:p},j[6]=S,j[7]=k,j[8]=a,j[9]=o,j[10]=l,j[11]=c,j[12]=i}else i=j[12];t=i}let{cellPaths:E,outlinePaths:I,factionColors:T,regionPaths:A,regionColors:M,regionAreaPaths:R}=t;return j[15]===Symbol.for("react.memo_cache_sentinel")?(r=(0,w.jsx)("filter",{id:"nebulaBlur",x:"-50%",y:"-50%",width:"200%",height:"200%",children:(0,w.jsx)("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"15"})}),j[15]=r):r=j[15],j[16]===Symbol.for("react.memo_cache_sentinel")?(s=(0,w.jsx)("rect",{x:"-5000",y:"-5000",width:"10000",height:"10000",fill:"black"}),j[16]=s):s=j[16],j[17]!==k?(n=k.map(e=>{let t=2e3;k.forEach(r=>{if(e.id===r.id)return;let s=Math.sqrt((e.x-r.x)**2+(e.y-r.y)**2);s<t&&(t=s)});let r=Math.max(250,Math.min(.55*t,1e3)),s=.7*r;return(0,w.jsxs)("g",{children:[(0,w.jsx)("polygon",{points:`
                                    ${e.x+r},${e.y} 
                                    ${e.x+s},${e.y+s} 
                                    ${e.x},${e.y+r} 
                                    ${e.x-s},${e.y+s} 
                                    ${e.x-r},${e.y} 
                                    ${e.x-s},${e.y-s} 
                                    ${e.x},${e.y-r} 
                                    ${e.x+s},${e.y-s}
                                `,fill:"white"}),e.connected_to?.map(t=>{let s=k.find(e=>e.id===t);return!s||e.id>s.id?null:(0,w.jsx)("line",{x1:e.x,y1:e.y,x2:s.x,y2:s.y,stroke:"white",strokeWidth:.9*r,strokeLinecap:"round"},`mask-link-${e.id}-${s.id}`)})]},`mask-group-${e.id}`)}),j[17]=k,j[18]=n):n=j[18],j[19]!==n?(i=(0,w.jsxs)("mask",{id:"planetInfluenceMask",children:[s,n]}),j[19]=n,j[20]=i):i=j[20],j[21]!==k?(a=k.map(uQ),j[21]=k,j[22]=a):a=j[22],j[23]!==a?(o=(0,w.jsx)("clipPath",{id:"regionClickClip",children:a}),j[23]=a,j[24]=o):o=j[24],j[25]!==i||j[26]!==o?(l=(0,w.jsxs)("defs",{children:[r,i,o]}),j[25]=i,j[26]=o,j[27]=l):l=j[27],j[28]===Symbol.for("react.memo_cache_sentinel")?(c={pointerEvents:"all"},j[28]=c):c=j[28],j[29]!==R?(d=Object.entries(R),j[29]=R,j[30]=d):d=j[30],j[31]!==C||j[32]!==d?(u=(0,w.jsx)("g",{style:c,clipPath:"url(#regionClickClip)",children:d.map(e=>{let[t,r]=e;return(0,w.jsx)("path",{d:r,fill:"transparent",stroke:"none",onClick:e=>{e.stopPropagation(),C&&C(t)},style:{cursor:"cell"},children:(0,w.jsxs)("title",{children:["Rgion : ",t]})},`click-${t}`)})}),j[31]=C,j[32]=d,j[33]=u):u=j[33],j[34]===Symbol.for("react.memo_cache_sentinel")?(h={pointerEvents:"none"},j[34]=h):h=j[34],j[35]!==E?(p=Object.entries(E),j[35]=E,j[36]=p):p=j[36],j[37]!==T||j[38]!==p?(f=(0,w.jsx)("g",{mask:"url(#planetInfluenceMask)",opacity:"0.4",style:h,children:p.map(e=>{let[t,r]=e;return T[t]?(0,w.jsx)("path",{d:r,fill:T[t],stroke:"none",style:{mixBlendMode:"screen"}},t):null})}),j[37]=T,j[38]=p,j[39]=f):f=j[39],j[40]===Symbol.for("react.memo_cache_sentinel")?(m={pointerEvents:"none"},j[40]=m):m=j[40],j[41]!==A?(g=Object.entries(A),j[41]=A,j[42]=g):g=j[42],j[43]!==M||j[44]!==g?(x=(0,w.jsx)("g",{mask:"url(#planetInfluenceMask)",opacity:"0.9",style:m,children:g.map(e=>{let[t,r]=e;return(0,w.jsx)("path",{d:r,fill:"none",stroke:M[t]||"#ffffff",strokeWidth:"8",strokeDasharray:"25,10",strokeLinecap:"butt",strokeOpacity:"0.6",className:"animate-pulse"},`region-${t}`)})}),j[43]=M,j[44]=g,j[45]=x):x=j[45],j[46]===Symbol.for("react.memo_cache_sentinel")?(b={pointerEvents:"none"},j[46]=b):b=j[46],j[47]!==I?(y=Object.entries(I),j[47]=I,j[48]=y):y=j[48],j[49]!==T||j[50]!==y?(v=(0,w.jsx)("g",{mask:"url(#planetInfluenceMask)",opacity:"0.2",style:b,children:y.map(e=>{let[t,r]=e;return T[t]?(0,w.jsx)("path",{d:r,fill:"none",stroke:T[t],strokeWidth:"3",strokeDasharray:"10,5"},`line-${t}`):null})}),j[49]=T,j[50]=y,j[51]=v):v=j[51],j[52]!==u||j[53]!==f||j[54]!==x||j[55]!==v||j[56]!==l?(N=(0,w.jsxs)("g",{className:"border-layer",children:[l,u,f,x,v]}),j[52]=u,j[53]=f,j[54]=x,j[55]=v,j[56]=l,j[57]=N):N=j[57],N});function uK(e){return e.x}function uX(e){return e.y}function uY(e){return[e.x,e.y]}function uQ(e){return(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:"200"},`clip-${e.id}`)}let uJ={root:{id:"root",label:"Hros Initi",desc:"Active le dploiement du Hros",x:50,y:10,cost:0,req:[],color:"#fff"},dark:[{id:"mag_d1",label:"Corruption",desc:"Draine 20 PV ennemis",x:20,y:30,cost:1,req:["root"],type:"passive",color:"#a855f7"},{id:"mag_d2",label:"Haine",desc:"+10% Dgts Force",x:10,y:50,cost:1,req:["mag_d1"],type:"passive",color:"#a855f7"},{id:"mag_d3",label:"clair",desc:"Active: Dgts directs",x:30,y:50,cost:1,req:["mag_d1"],type:"active",color:"#a855f7"},{id:"mag_d4",label:"Siphon",desc:"Vol de vie 10%",x:10,y:70,cost:2,req:["mag_d2"],type:"passive",color:"#a855f7"},{id:"mag_d5",label:"Terreur",desc:"Aura: -15 Moral",x:20,y:70,cost:2,req:["mag_d1"],type:"passive",color:"#a855f7"},{id:"mag_d6",label:"Tempte",desc:"Active: Dgts Zone",x:30,y:70,cost:2,req:["mag_d3"],type:"active",color:"#a855f7"},{id:"mag_d7",label:"Seigneur Sith",desc:"Ultime: +20% Stats Obscur",x:20,y:90,cost:3,req:["mag_d5","mag_d4","mag_d6"],type:"passive",color:"#7e22ce"}],light:[{id:"mag_l1",label:"Mditation",desc:"Rgnration Mana +10%",x:20,y:30,cost:1,req:["root"],type:"passive",color:"#38bdf8"},{id:"mag_l2",label:"Srnit",desc:"Cot Mana -10%",x:10,y:50,cost:1,req:["mag_l1"],type:"passive",color:"#38bdf8"},{id:"mag_l3",label:"Gurison",desc:"Active: Soin alli",x:30,y:50,cost:1,req:["mag_l1"],type:"active",color:"#38bdf8"},{id:"mag_l4",label:"Aura",desc:"Dfense allis +15%",x:10,y:70,cost:2,req:["mag_l2"],type:"passive",color:"#38bdf8"},{id:"mag_l5",label:"Protection",desc:"Bouclier de Force",x:20,y:70,cost:2,req:["mag_l1"],type:"passive",color:"#38bdf8"},{id:"mag_l6",label:"Onde Paix",desc:"Active: Repousse ennemis",x:30,y:70,cost:2,req:["mag_l3"],type:"active",color:"#38bdf8"},{id:"mag_l7",label:"Avatar Force",desc:"Ultime: Soin de masse",x:20,y:90,cost:3,req:["mag_l5","mag_l4","mag_l6"],type:"active",color:"#0ea5e9"}],mandalorian:[{id:"mag_m1",label:"Beskar",desc:"Armure +50",x:20,y:30,cost:1,req:["root"],type:"passive",color:"#f97316"},{id:"mag_m2",label:"Viseur",desc:"Prcision +15%",x:10,y:50,cost:1,req:["mag_m1"],type:"passive",color:"#f97316"},{id:"mag_m3",label:"Arsenal",desc:"Active: Missiles",x:30,y:50,cost:1,req:["mag_m1"],type:"active",color:"#f97316"},{id:"mag_m4",label:"Bouclier",desc:"Rsist. Explosifs 25%",x:10,y:70,cost:2,req:["mag_m2"],type:"passive",color:"#f97316"},{id:"mag_m5",label:"Jetpack",desc:"Mobilit Arienne",x:20,y:70,cost:2,req:["mag_m1"],type:"passive",color:"#f97316"},{id:"mag_m6",label:"Pyro",desc:"Active: Lance-flammes",x:30,y:70,cost:2,req:["mag_m3"],type:"active",color:"#f97316"},{id:"mag_m7",label:"Mand'alor",desc:"Ultime: Appel Renforts",x:20,y:90,cost:3,req:["mag_m5","mag_m4","mag_m6"],type:"active",color:"#ea580c"}],melee:[{id:"cbt_1",label:"Vigueur",desc:"+100 PV (Force)",x:80,y:30,cost:1,req:["root"],type:"passive",color:"#ef4444"},{id:"cbt_2",label:"Charge",desc:"Habilit: Bond vers l'ennemi",x:80,y:50,cost:2,req:["cbt_1"],type:"active",color:"#ef4444"},{id:"cbt_3",label:"Dueliste",desc:"+25% Dgts Mle",x:80,y:70,cost:3,req:["cbt_2"],type:"passive",color:"#ef4444"}],shooter:[{id:"cbt_1",label:"Dextrit",desc:"+10% Critique (Tech)",x:80,y:30,cost:1,req:["root"],type:"passive",color:"#22c55e"},{id:"cbt_2",label:"Surcharge",desc:"Habilit: Tir puissant",x:80,y:50,cost:2,req:["cbt_1"],type:"active",color:"#22c55e"},{id:"cbt_3",label:"Sniper",desc:"+2 Porte & Munitions",x:80,y:70,cost:3,req:["cbt_2"],type:"passive",color:"#22c55e"}]};function uZ({userID:e,onClose:t}){let[r,s]=(0,N.useState)(null),[n,i]=(0,N.useState)([]),[a,o]=(0,N.useState)(null),[l,c]=(0,N.useState)(!1),[d,u]=(0,N.useState)(!1),[h,p]=(0,N.useState)("bio"),[f,m]=(0,N.useState)({pseudo:"",avatar:"",custom_rank:"",bio:""}),[g,x]=(0,N.useState)({level:1,points:1,unlocked:["root"]}),[b,y]=(0,N.useState)({x:0,y:0,scale:1}),[v,_]=(0,N.useState)(!1),[j,k]=(0,N.useState)({x:0,y:0}),S=()=>{_(!1)};(0,N.useEffect)(()=>{(async()=>{if(e)try{let n=aJ(dY,"users",e),a=await oB(n);if(a.exists()){var t,r;let e=a.data();s(e);let n=(t=e.magic_domain,r=e.combat_style,[uJ.root,...uJ[t||"dark"]||uJ.dark,...uJ[r||"melee"]||uJ.melee]);if(i(n),m({pseudo:e.pseudo||"",avatar:e.avatar||"",custom_rank:e.custom_rank||"",bio:e.bio||""}),e.hero_data?x({level:1,points:1,unlocked:["root"],...e.hero_data}):x({level:1,points:1,unlocked:["root"]}),e.faction_id&&"neutral"!==e.faction_id){let t=await oB(aJ(dY,"factions",e.faction_id));t.exists()&&o(t.data())}}}catch(e){console.error("Erreur chargement profil",e)}})()},[e]);let C=async()=>{u(!0);try{await oK(aJ(dY,"users",e),{pseudo:f.pseudo,avatar:f.avatar,custom_rank:f.custom_rank,bio:f.bio,hero_data:g}),s({...r,...f,hero_data:g}),c(!1)}catch(e){console.error(e),alert("Erreur lors de la sauvegarde.")}u(!1)};return r?(0,w.jsx)("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/90 backdrop-blur-md animate-in fade-in duration-300 font-sans",children:(0,w.jsxs)("div",{className:"w-[900px] h-[600px] bg-[#0f1115] border-2 border-[#cba660] flex shadow-[0_0_50px_rgba(203,166,96,0.2)] relative overflow-hidden",children:[(0,w.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10 pointer-events-none",children:(0,w.jsx)("div",{className:"text-9xl text-[#cba660] font-black",children:"ID"})}),(0,w.jsxs)("div",{className:"w-1/4 bg-[#15171c] border-r border-[#cba660]/30 flex flex-col items-center p-6 relative shrink-0",children:[(0,w.jsxs)("div",{className:"relative group mb-4",children:[(0,w.jsx)("div",{className:"w-32 h-32 rounded-full border-4 border-[#cba660] bg-black overflow-hidden shadow-lg relative",children:f.avatar?(0,w.jsx)("img",{src:f.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):(0,w.jsx)("div",{className:"w-full h-full flex items-center justify-center text-4xl text-gray-700",children:""})}),a&&(0,w.jsx)("div",{className:"absolute -bottom-2 -right-2 w-10 h-10 rounded-full border-2 border-[#0f1115] bg-black flex items-center justify-center shadow-lg",title:a.name,children:a.image?(0,w.jsx)("img",{src:a.image,className:"w-full h-full object-cover rounded-full"}):(0,w.jsx)("span",{className:"text-xs",style:{color:a.color},children:""})})]}),(0,w.jsxs)("div",{className:"text-center w-full",children:[(0,w.jsx)("h2",{className:"text-xl font-serif font-bold text-white uppercase tracking-wider truncate",children:r.pseudo}),(0,w.jsx)("div",{className:"text-[#cba660] text-[10px] uppercase font-bold mt-1 tracking-widest",children:f.custom_rank||({admin:"Administrateur Galactique",gamemaster:"Matre du Jeu",emperor:"Empereur / Chancelier",conseil:"Membre du Conseil",general:"Grand Gnral",governor:"Gouverneur Plantaire"})[r.role]||"Citoyen"}),(0,w.jsxs)("div",{className:"mt-6 w-full space-y-2 text-left bg-black/40 p-3 rounded border border-gray-800",children:[(0,w.jsxs)("div",{className:"flex justify-between text-[10px] text-gray-400 uppercase",children:[(0,w.jsx)("span",{children:"Matricule"}),(0,w.jsx)("span",{className:"font-mono text-gray-200",children:e.substring(0,8)})]}),(0,w.jsxs)("div",{className:"flex justify-between text-[10px] text-gray-400 uppercase",children:[(0,w.jsx)("span",{children:"Allgeance"}),(0,w.jsx)("span",{className:"font-bold",style:{color:a?.color||"#fff"},children:a?.name||"Neutre"})]}),(0,w.jsxs)("div",{className:"flex justify-between text-[10px] text-gray-400 uppercase",children:[(0,w.jsx)("span",{children:"Niveau Hros"}),(0,w.jsx)("span",{className:"text-yellow-500 font-bold",children:g.level})]}),(0,w.jsxs)("div",{className:"border-t border-gray-700 mt-2 pt-2 grid grid-cols-2 gap-1 text-center",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{className:"text-[8px] text-purple-500 mb-1",children:"PUISSANCE (Magie)"}),(0,w.jsx)("div",{className:"font-mono text-white font-bold",children:g.unlocked.filter(e=>e.startsWith("mag")).length})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{className:"text-[8px] text-red-500 mb-1",children:"MATRISE (Combat)"}),(0,w.jsx)("div",{className:"font-mono text-white font-bold",children:g.unlocked.filter(e=>e.startsWith("cbt")).length})]})]})]})]})]}),(0,w.jsxs)("div",{className:"flex-1 p-6 flex flex-col min-w-0",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-[#cba660]/30 pb-2",children:[(0,w.jsxs)("div",{className:"flex gap-4",children:[(0,w.jsx)("button",{onClick:()=>p("bio"),className:`text-lg font-serif uppercase tracking-widest ${"bio"===h?"text-[#cba660] underline":"text-gray-500 hover:text-white"}`,children:"Dossier"}),(0,w.jsx)("button",{onClick:()=>p("talents"),className:`text-lg font-serif uppercase tracking-widest ${"talents"===h?"text-[#cba660] underline":"text-gray-500 hover:text-white"}`,children:"Talents"})]}),(0,w.jsxs)("div",{className:"flex gap-2",children:[l?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("button",{onClick:()=>c(!1),className:"text-xs uppercase text-red-400 hover:text-red-300 px-2",children:"Annuler"}),(0,w.jsx)("button",{onClick:C,disabled:d,className:"text-xs uppercase font-bold text-black bg-[#cba660] px-4 py-1 hover:bg-[#e5c07b] transition shadow-lg",children:d?"...":"Sauvegarder"})]}):(0,w.jsx)("button",{onClick:()=>c(!0),className:"text-xs uppercase font-bold text-gray-400 hover:text-white border border-gray-600 px-3 py-1 hover:bg-gray-800 transition",children:"Modifier"}),(0,w.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-white ml-4 text-xl",children:""})]})]}),(0,w.jsx)("div",{className:"flex-grow overflow-y-auto custom-scrollbar relative",children:"bio"===h?l?(0,w.jsxs)("div",{className:"space-y-4 animate-in slide-in-from-right-5 duration-300",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-[10px] uppercase text-gray-500 font-bold mb-1",children:"Nom de code (Pseudo)"}),(0,w.jsx)("input",{value:f.pseudo,onChange:e=>m({...f,pseudo:e.target.value}),className:"w-full bg-black border border-gray-700 p-2 text-white text-sm focus:border-[#cba660] outline-none"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-[10px] uppercase text-gray-500 font-bold mb-1",children:"Titre / Rang RP (Ex: Grand Amiral)"}),(0,w.jsx)("input",{value:f.custom_rank,onChange:e=>m({...f,custom_rank:e.target.value}),className:"w-full bg-black border border-gray-700 p-2 text-white text-sm focus:border-[#cba660] outline-none",placeholder:"Laisser vide pour utiliser le rang systme"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-[10px] uppercase text-gray-500 font-bold mb-1",children:"Holo-Portrait (URL Image)"}),(0,w.jsx)("input",{value:f.avatar,onChange:e=>m({...f,avatar:e.target.value}),className:"w-full bg-black border border-gray-700 p-2 text-white text-sm focus:border-[#cba660] outline-none font-mono"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-[10px] uppercase text-gray-500 font-bold mb-1",children:"Biographie / Notes de service"}),(0,w.jsx)("textarea",{value:f.bio,onChange:e=>m({...f,bio:e.target.value}),className:"w-full h-32 bg-black border border-gray-700 p-2 text-white text-sm focus:border-[#cba660] outline-none resize-none"})]})]}):(0,w.jsxs)("div",{className:"space-y-6",children:[(0,w.jsx)("p",{className:"text-gray-300 text-sm leading-relaxed whitespace-pre-wrap bg-[#1a1d23] p-4 border-l-2 border-[#cba660]",children:r.bio||"Aucune donne biographique disponible dans les archives."}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,w.jsxs)("div",{className:"bg-[#1a1d23] p-3 border border-gray-700",children:[(0,w.jsx)("div",{className:"text-[10px] uppercase text-gray-500",children:"Statut Systme"}),(0,w.jsx)("div",{className:"text-green-400 font-mono text-sm",children:"ACTIF"})]}),(0,w.jsxs)("div",{className:"bg-[#1a1d23] p-3 border border-gray-700",children:[(0,w.jsx)("div",{className:"text-[10px] uppercase text-gray-500",children:"Dernire Connexion"}),(0,w.jsx)("div",{className:"text-white font-mono text-sm",children:"Aujourd'hui"})]})]})]}):(0,w.jsxs)("div",{className:"relative h-full w-full bg-[#050505] overflow-hidden rounded border border-gray-800 shadow-inner group-tab cursor-grab active:cursor-grabbing",onWheel:e=>{if("talents"!==h)return;let t=-(.001*e.deltaY),r=Math.min(Math.max(.5,b.scale+t),3);y(e=>({...e,scale:r}))},onMouseDown:e=>{"talents"===h&&(_(!0),k({x:e.clientX-b.x,y:e.clientY-b.y}))},onMouseMove:e=>{v&&"talents"===h&&y(t=>({...t,x:e.clientX-j.x,y:e.clientY-j.y}))},onMouseUp:S,onMouseLeave:S,children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(20,20,20,0.5)_1px,transparent_1px),linear-gradient(90deg,rgba(20,20,20,0.5)_1px,transparent_1px)] bg-[size:40px_40px] opacity-20 pointer-events-none transition-transform duration-75",style:{transform:`translate(${.5*b.x}px, ${.5*b.y}px) scale(${b.scale})`,transformOrigin:"center"}}),(0,w.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(0,0,0,0)_0%,rgba(0,0,0,0.8)_100%)] pointer-events-none"}),(0,w.jsxs)("div",{className:"absolute top-4 right-4 z-20 flex flex-col items-end pointer-events-none",children:[(0,w.jsxs)("div",{className:"bg-black/80 backdrop-blur px-4 py-2 rounded-sm border-l-4 border-yellow-500 shadow-lg mb-2",children:[(0,w.jsx)("div",{className:"text-[10px] text-gray-400 uppercase tracking-widest",children:"Points de Force"}),(0,w.jsx)("div",{className:"text-2xl font-mono font-bold text-yellow-400 text-right",children:g.points})]}),(0,w.jsx)("div",{className:"text-[10px] text-gray-600 font-mono uppercase",children:"Arbre de Rsonance"}),(0,w.jsxs)("div",{className:"text-[9px] text-gray-700 mt-1",children:["Zoom: ",Math.round(100*b.scale),"%"]})]}),(0,w.jsxs)("div",{className:"absolute inset-0 transform origin-center transition-transform duration-75 ease-out",style:{transform:`translate(${b.x}px, ${b.y}px) scale(${b.scale})`},children:[(0,w.jsxs)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none overflow-visible",children:[(0,w.jsx)("defs",{children:(0,w.jsxs)("filter",{id:"glow-line",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[(0,w.jsx)("feGaussianBlur",{stdDeviation:"2",result:"blur"}),(0,w.jsx)("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]})}),n.map(e=>e.req.map(t=>{let r=n.find(e=>e.id===t);if(!r)return null;let s=g.unlocked.includes(e.id);return(0,w.jsxs)("g",{children:[(0,w.jsx)("line",{x1:`${r.x}%`,y1:`${r.y}%`,x2:`${e.x}%`,y2:`${e.y}%`,stroke:"#1f2937",strokeWidth:"4",strokeLinecap:"round"}),(0,w.jsx)("line",{x1:`${r.x}%`,y1:`${r.y}%`,x2:`${e.x}%`,y2:`${e.y}%`,stroke:e.color,strokeWidth:"2",strokeLinecap:"round",strokeDasharray:s?"none":"4,4",className:`transition-all duration-1000 ${s?"opacity-100":"opacity-30"}`,filter:s?"url(#glow-line)":""})]},`${r.id}-${e.id}`)}))]}),n.map(e=>{let t=g.unlocked.includes(e.id),r=!t&&e.req.every(e=>g.unlocked.includes(e)),s=r&&g.points>=e.cost,i="";return i="root"===e.id?"":e.desc.includes("Ultime")?"":"active"===e.type?"":"",(0,w.jsxs)("div",{className:"absolute -translate-x-1/2 -translate-y-1/2 group z-10",style:{left:`${e.x}%`,top:`${e.y}%`},children:[r&&(0,w.jsx)("div",{className:"absolute inset-0 rounded-full animate-ping opacity-30",style:{backgroundColor:e.color}}),(0,w.jsxs)("div",{onClick:()=>{var t;let r;return t=e.id,!(r=n.find(e=>e.id===t))||g.unlocked.includes(t)?void 0:(l||c(!0),r.req.every(e=>g.unlocked.includes(e)))?g.points<r.cost?alert("Points insuffisants"):void x({...g,points:g.points-r.cost,unlocked:[...g.unlocked,t]}):alert("Pr-requis non remplis")},className:`
                                                        relative w-14 h-14 rounded-full flex items-center justify-center border-2 
                                                        transition-all duration-300 cursor-pointer overflow-hidden
                                                        ${t?`bg-gray-900 border-[${e.color}] shadow-[0_0_20px_${e.color}40]`:r?s?"bg-gray-800 border-white hover:scale-110 hover:border-[${t.color}] shadow-lg":"bg-gray-900 border-gray-600 grayscale":"bg-black border-gray-800 opacity-40 grayscale cursor-not-allowed"}
                                                    `,style:{borderColor:t?e.color:r&&s?"#fff":void 0,boxShadow:t?`0 0 15px ${e.color}60`:void 0},children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent pointer-events-none"}),(0,w.jsx)("span",{className:`text-2xl drop-shadow-md ${t?"text-white":"text-gray-400"}`,style:{textShadow:t?`0 0 10px ${e.color}`:"none"},children:i})]}),(0,w.jsxs)("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 w-48 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-30",children:[(0,w.jsxs)("div",{className:"bg-black/90 backdrop-blur-md rounded border border-gray-700 p-3 shadow-2xl relative overflow-hidden",children:[(0,w.jsx)("div",{className:"absolute top-0 left-0 w-full h-1",style:{backgroundColor:e.color}}),(0,w.jsx)("div",{className:"text-sm font-bold text-white uppercase tracking-wider mb-1 mt-1",children:e.label}),(0,w.jsx)("div",{className:"text-[10px] text-gray-400 leading-tight mb-2 italic",children:"active"===e.type?"[ Comptence Active ]":"[ Bonus Passif ]"}),(0,w.jsx)("div",{className:"text-xs text-gray-300 border-t border-gray-800 pt-2 mb-2",children:e.desc}),!t&&(0,w.jsxs)("div",{className:"flex justify-between items-center bg-gray-900/50 p-1 rounded border border-gray-800",children:[(0,w.jsx)("span",{className:"text-[9px] uppercase text-gray-500",children:"Cot requis"}),(0,w.jsxs)("span",{className:`text-xs font-mono font-bold ${s?"text-green-400":"text-red-500"}`,children:[e.cost," PTS"]})]}),t&&(0,w.jsx)("div",{className:"text-[10px] text-green-500 font-bold uppercase text-center bg-green-900/20 py-1 rounded",children:"Acquis"})]}),(0,w.jsx)("div",{className:"w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-b-[6px] border-b-black/90 absolute -top-[6px] left-1/2 -translate-x-1/2"})]})]},e.id)})]})]})})]})]})}):null}let u0=e=>{};function u1(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,j,k,S,C,E,I,T,A,M=(0,_.c)(63),{techType:R,onWin:P,onClose:D}=e,[O,L]=(0,N.useState)(null);M[0]===Symbol.for("react.memo_cache_sentinel")?(t=["force","force_nexus","cloning","biology","medical","jedi","sith","genetics","life","organic"],M[0]=t):t=M[0];let F=t;M[1]===Symbol.for("react.memo_cache_sentinel")?(r=["military","defense","weapons","energy","tactics","war","physics","electricity","lasers","plasma","shield","power"],M[1]=r):r=M[1];let U=r;M[2]===Symbol.for("react.memo_cache_sentinel")?(s=["economy","trade","management","money","finance","data","production","mining","network","cybernetics","computing","ai","algorithm","credits"],M[2]=s):s=M[2];let z=s;if(M[3]!==R?(n=()=>{let e=R.toLowerCase(),t=F.some(t=>e.includes(t)),r=U.some(t=>e.includes(t)),s=z.some(t=>e.includes(t));t?L(null):s?L("economy"):r?L("electricity"):L("circuit")},i=[R],M[3]=R,M[4]=n,M[5]=i):(n=M[4],i=M[5]),(0,N.useEffect)(n,i),null===O){let e,t,r,s,n,i,a,o,l,c,d,u,h=R.toLowerCase();return F.some(e=>h.includes(e))?(M[6]!==D?(e=(0,w.jsx)("button",{onClick:D,className:"absolute top-4 right-4 text-gray-500 hover:text-white transition",children:" FERMER"}),M[6]=D,M[7]=e):e=M[7],M[8]===Symbol.for("react.memo_cache_sentinel")?(t=(0,w.jsx)("h2",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 uppercase tracking-widest mb-2",children:"Protocole Biologique"}),M[8]=t):t=M[8],M[9]===Symbol.for("react.memo_cache_sentinel")?(r=(0,w.jsxs)("div",{className:"text-center mb-12",children:[t,(0,w.jsxs)("p",{className:"text-gray-400 text-sm font-mono",children:["Niveau de scurit : ",(0,w.jsx)("span",{className:"text-red-500 font-bold",children:"EXTRME"}),". Choisissez votre approche."]})]}),M[9]=r):r=M[9],M[10]===Symbol.for("react.memo_cache_sentinel")?(s=()=>L("dna_linear"),M[10]=s):s=M[10],M[11]===Symbol.for("react.memo_cache_sentinel")?(n=(0,w.jsx)("div",{className:"text-6xl mb-4 group-hover:scale-110 transition-transform",children:""}),i=(0,w.jsx)("h3",{className:"text-xl font-bold text-white uppercase tracking-widest mb-2",children:"Squenceur Amnsique"}),M[11]=n,M[12]=i):(n=M[11],i=M[12]),M[13]===Symbol.for("react.memo_cache_sentinel")?(a=(0,w.jsxs)("button",{onClick:s,className:"group relative h-72 bg-black/50 border border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center hover:bg-gray-800 transition-all hover:border-purple-500 hover:shadow-[0_0_30px_rgba(168,85,247,0.3)]",children:[n,i,(0,w.jsxs)("p",{className:"text-xs text-gray-500 text-center font-mono leading-relaxed",children:["Analyse verticale.",(0,w.jsx)("br",{}),(0,w.jsx)("span",{className:"text-purple-400 font-bold",children:"Effet : Perte de donnes historique."})]})]}),o=()=>L("dna_circular"),M[13]=a,M[14]=o):(a=M[13],o=M[14]),M[15]===Symbol.for("react.memo_cache_sentinel")?(l=(0,w.jsx)("div",{className:"text-6xl mb-4 group-hover:rotate-90 transition-transform duration-700",children:""}),c=(0,w.jsx)("h3",{className:"text-xl font-bold text-white uppercase tracking-widest mb-2",children:"Racteur Aveugle"}),M[15]=l,M[16]=c):(l=M[15],c=M[16]),M[17]===Symbol.for("react.memo_cache_sentinel")?(d=(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-8",children:[a,(0,w.jsxs)("button",{onClick:o,className:"group relative h-72 bg-black/50 border border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center hover:bg-gray-800 transition-all hover:border-green-500 hover:shadow-[0_0_30px_rgba(34,197,94,0.3)]",children:[l,c,(0,w.jsxs)("p",{className:"text-xs text-gray-500 text-center font-mono leading-relaxed",children:["Puzzle Gyroscopique.",(0,w.jsx)("br",{}),(0,w.jsx)("span",{className:"text-green-400 font-bold",children:"Effet : Brouillage latral visuel."})]})]})]}),M[17]=d):d=M[17],M[18]!==e?(u=(0,w.jsx)("div",{className:"fixed inset-0 z-[150] flex items-center justify-center bg-black/95 backdrop-blur-xl animate-in fade-in duration-300",children:(0,w.jsxs)("div",{className:"w-full max-w-4xl bg-gray-900 border border-gray-700 rounded-xl shadow-2xl p-8 relative overflow-hidden",children:[e,r,d]})}),M[18]=e,M[19]=u):u=M[19],u):null}switch(O){case"dna_linear":a=u2,o="Helix : Amnesia Protocol",l="bg-purple-500 shadow-[0_0_10px_purple]",c="L'historique se corrompt. Mmorisez les squences passes.";break;case"dna_circular":a=u4,o="Plasmid : Blind Sector",l="bg-green-500 shadow-[0_0_10px_lime]",c="Interfrences visuelles sur les flancs. Rotation couple.";break;case"electricity":a=u3,o="Harmonic Resonance",l="bg-yellow-400 shadow-[0_0_10px_yellow]",c="Calibrez la frquence et la phase pour stabiliser le signal.";break;case"economy":a=u7,o="Quantum Mining",l="bg-emerald-400 shadow-[0_0_10px_emerald]",c="Identifiez et validez les blocs de hachage instables.";break;default:a=he,o="PCB : Blackout",l="bg-cyan-500 shadow-[0_0_10px_cyan]",c="Panne secteur. Rtablissez le courant  l'aveugle."}M[20]!==o?(d=(0,w.jsx)("h2",{className:"text-white font-bold uppercase tracking-widest text-xl mb-1 text-transparent bg-clip-text bg-gradient-to-r from-gray-100 to-gray-400",children:o}),M[20]=o,M[21]=d):d=M[21];let V=`h-1 w-10 mb-6 ${l}`;return M[22]!==V?(u=(0,w.jsx)("div",{className:V}),M[22]=V,M[23]=u):u=M[23],M[24]!==c?(h=(0,w.jsx)("p",{className:"text-gray-300 text-xs leading-relaxed font-mono border-l-2 border-white pl-2 mb-4",children:c}),M[24]=c,M[25]=h):h=M[25],M[26]!==O?(p="dna_circular"===O&&(0,w.jsxs)("div",{className:"text-[10px] text-center border-t border-gray-700 pt-2 text-gray-400",children:[(0,w.jsxs)("p",{children:["Cibles : ",(0,w.jsx)("span",{className:"text-red-400",children:"A-T"})," | ",(0,w.jsx)("span",{className:"text-blue-400",children:"C-G"})]}),(0,w.jsx)("p",{children:"Clic Droit = Rotation Inverse"})]}),M[26]=O,M[27]=p):p=M[27],M[28]!==O?(f="electricity"===O&&(0,w.jsx)("div",{className:"text-[10px] text-yellow-500 text-center border-t border-gray-700 pt-2",children:"Superposez la ligne VERTE sur la ligne JAUNE."}),M[28]=O,M[29]=f):f=M[29],M[30]!==O?(m="economy"===O&&(0,w.jsx)("div",{className:"text-[10px] text-emerald-500 text-center border-t border-gray-700 pt-2",children:"Cliquez sur le code correspondant  la CIBLE."}),M[30]=O,M[31]=m):m=M[31],M[32]!==p||M[33]!==f||M[34]!==m||M[35]!==d||M[36]!==u||M[37]!==h?(g=(0,w.jsxs)("div",{children:[d,u,h,p,f,m]}),M[32]=p,M[33]=f,M[34]=m,M[35]=d,M[36]=u,M[37]=h,M[38]=g):g=M[38],M[39]!==R?(x=F.some(e=>R.toLowerCase().includes(e))&&(0,w.jsxs)("button",{onClick:()=>L(null),className:"px-4 py-3 border border-gray-600 text-gray-400 text-xs font-bold uppercase hover:bg-gray-800 hover:text-white transition-colors flex items-center justify-center gap-2",children:[(0,w.jsx)("span",{children:""})," Changer"]}),M[39]=R,M[40]=x):x=M[40],M[41]===Symbol.for("react.memo_cache_sentinel")?(b=(0,w.jsx)("span",{className:"absolute inset-0 w-full h-full bg-red-900/50 -translate-x-full group-hover:translate-x-0 transition-transform duration-300"}),y=(0,w.jsx)("span",{className:"relative",children:"Abandonner"}),M[41]=b,M[42]=y):(b=M[41],y=M[42]),M[43]!==D?(v=(0,w.jsxs)("button",{onClick:D,className:"group relative px-4 py-3 border border-red-800 text-red-500 text-xs font-bold uppercase tracking-widest overflow-hidden hover:text-white transition-colors",children:[b,y]}),M[43]=D,M[44]=v):v=M[44],M[45]!==x||M[46]!==v?(j=(0,w.jsxs)("div",{className:"flex flex-col gap-3",children:[x,v]}),M[45]=x,M[46]=v,M[47]=j):j=M[47],M[48]!==g||M[49]!==j?(k=(0,w.jsxs)("div",{className:"w-72 bg-gray-900/90 backdrop-blur-md border-r border-gray-700 p-6 flex flex-col justify-between shrink-0 z-30 shadow-2xl",children:[g,j]}),M[48]=g,M[49]=j,M[50]=k):k=M[50],M[51]===Symbol.for("react.memo_cache_sentinel")?(S={transformStyle:"preserve-3d"},C=(0,w.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_#1a1a2e_0%,_#000000_80%)] -z-20"}),E=(0,w.jsx)("div",{className:"absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] -z-10"}),M[51]=S,M[52]=C,M[53]=E):(S=M[51],C=M[52],E=M[53]),M[54]!==a||M[55]!==D||M[56]!==P?(I=a&&(0,w.jsx)(a,{onWin:P,onClose:D}),M[54]=a,M[55]=D,M[56]=P,M[57]=I):I=M[57],M[58]!==I?(T=(0,w.jsxs)("div",{className:"flex-grow relative bg-black flex items-center justify-center overflow-hidden",style:S,children:[C,E,I]}),M[58]=I,M[59]=T):T=M[59],M[60]!==k||M[61]!==T?(A=(0,w.jsx)("div",{className:"fixed inset-0 z-[150] flex items-center justify-center bg-black/95 backdrop-blur-xl animate-in fade-in duration-500 perspective-2000",children:(0,w.jsxs)("div",{className:"w-full max-w-[1400px] h-[90vh] bg-gray-950/80 border border-gray-800 rounded-xl shadow-2xl relative flex overflow-hidden",children:[k,T]})}),M[60]=k,M[61]=T,M[62]=A):A=M[62],A}function u2(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,j,k,S,C,E,I=(0,_.c)(57),{onWin:T}=e;I[0]===Symbol.for("react.memo_cache_sentinel")?(t={A:{code:"A",color:"bg-red-600",shadow:"shadow-red-500"},C:{code:"C",color:"bg-blue-600",shadow:"shadow-blue-500"},G:{code:"G",color:"bg-green-600",shadow:"shadow-green-500"},T:{code:"T",color:"bg-yellow-500",shadow:"shadow-yellow-500"}},I[0]=t):t=I[0];let A=t;I[1]===Symbol.for("react.memo_cache_sentinel")?(r=["A","C","G","T"],I[1]=r):r=I[1];let M=r;I[2]===Symbol.for("react.memo_cache_sentinel")?(s=[],I[2]=s):s=I[2];let[R,P]=(0,N.useState)(s);I[3]===Symbol.for("react.memo_cache_sentinel")?(n=[],I[3]=n):n=I[3];let[D,O]=(0,N.useState)(n);I[4]===Symbol.for("react.memo_cache_sentinel")?(i=Array(8).fill(null),I[4]=i):i=I[4];let[L,F]=(0,N.useState)(i),[U,z]=(0,N.useState)("playing"),V=(0,N.useRef)(null);I[5]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{P(Array.from({length:8},()=>M[Math.floor(4*Math.random())]))},o=[],I[5]=a,I[6]=o):(a=I[5],o=I[6]),(0,N.useEffect)(a,o),I[7]===Symbol.for("react.memo_cache_sentinel")?(l=()=>{V.current&&(V.current.scrollTop=V.current.scrollHeight)},I[7]=l):l=I[7],I[8]!==D?(c=[D],I[8]=D,I[9]=c):c=I[9],(0,N.useEffect)(l,c),I[10]!==L||I[11]!==U?(d=e=>{if("playing"!==U)return;let t=[...L],r=t.findIndex(u5);-1!==r&&(t[r]=e,F(t),u0("click"))},I[10]=L,I[11]=U,I[12]=d):d=I[12];let $=d;I[13]!==L||I[14]!==U?(u=()=>{if("playing"!==U)return;let e=[...L],t=-1;for(let r=7;r>=0;r--)if(null!==e[r]){t=r;break}-1!==t&&(e[t]=null,F(e))},I[13]=L,I[14]=U,I[15]=u):u=I[15];let q=u;I[16]!==L||I[17]!==D||I[18]!==T||I[19]!==R?(h=()=>{if(L.includes(null))return;let e=Array(8).fill("wrong"),t=[...R],r=[...L],s=0;for(let n=0;n<8;n++)r[n]===t[n]&&(e[n]="correct",t[n]=null,r[n]=null,s++);for(let s=0;s<8;s++)if(null!==r[s]){let n=t.indexOf(r[s]);-1!==n&&(e[s]="misplaced",t[n]=null)}let n=[...D,{input:L,results:e}];O(n),F(Array(8).fill(null)),8===s?(z("won"),setTimeout(T,2e3)):n.length>=12&&z("lost")},I[16]=L,I[17]=D,I[18]=T,I[19]=R,I[20]=h):h=I[20];let B=h;if(I[21]===Symbol.for("react.memo_cache_sentinel")?(p=(0,w.jsx)("div",{className:"text-center text-gray-500 text-xs mb-4 font-mono uppercase animate-pulse",children:" Donnes corrompues. Rtention : 2 cycles. "}),I[21]=p):p=I[21],I[22]!==D){let e;I[24]!==D.length?(e=(e,t)=>{let r=t>=D.length-2;return(0,w.jsxs)("div",{className:`flex items-center gap-2 mb-2 p-2 rounded border transition-opacity duration-500 ${r?"bg-gray-900/50 border-gray-700 opacity-100":"bg-black border-transparent opacity-20 blur-[2px]"}`,children:[(0,w.jsxs)("span",{className:"text-gray-500 font-mono w-6",children:["#",t+1]}),e.input.map((t,s)=>(0,w.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,w.jsx)("div",{className:`w-8 h-8 rounded flex items-center justify-center font-bold text-white ${r?A[t].color:"bg-gray-800 text-transparent"}`,children:t}),r&&(0,w.jsx)("div",{className:`w-2 h-2 rounded-full ${"correct"===e.results[s]?"bg-green-500":"misplaced"===e.results[s]?"bg-yellow-500":"bg-gray-800"}`})]},s))]},t)},I[24]=D.length,I[25]=e):e=I[25],f=D.map(e),I[22]=D,I[23]=f}else f=I[23];return I[26]!==L||I[27]!==D.length||I[28]!==U?(m="playing"===U&&(0,w.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-blue-900/20 rounded border border-blue-500/50 animate-pulse",children:[(0,w.jsxs)("span",{className:"text-blue-400 font-mono w-6",children:["#",D.length+1]}),L.map((e,t)=>(0,w.jsx)("div",{className:`w-8 h-8 rounded flex items-center justify-center font-bold border-2 ${e?`${A[e].color} border-transparent text-white`:"border-gray-600 text-gray-500"}`,children:e||"?"},t))]}),I[26]=L,I[27]=D.length,I[28]=U,I[29]=m):m=I[29],I[30]!==U?(g="won"===U&&(0,w.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-20",children:(0,w.jsx)("div",{className:"text-green-400 text-4xl font-bold uppercase tracking-widest animate-bounce",children:"Squenage Termin"})}),I[30]=U,I[31]=g):g=I[31],I[32]!==R||I[33]!==U?(x="lost"===U&&(0,w.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-20 flex-col",children:[(0,w.jsx)("div",{className:"text-red-500 text-3xl font-bold uppercase tracking-widest",children:"chec"}),(0,w.jsxs)("div",{className:"text-gray-400 mt-2",children:["Solution : ",R.join("")]})]}),I[32]=R,I[33]=U,I[34]=x):x=I[34],I[35]!==f||I[36]!==m||I[37]!==g||I[38]!==x?(b=(0,w.jsxs)("div",{ref:V,className:"flex-grow w-full max-w-3xl overflow-y-auto custom-scrollbar mb-4 bg-black/40 border border-gray-800 rounded-lg p-4 relative",children:[p,f,m,g,x]}),I[35]=f,I[36]=m,I[37]=g,I[38]=x,I[39]=b):b=I[39],I[40]!==$||I[41]!==U?(y=M.map(e=>(0,w.jsx)("button",{onClick:()=>$(e),disabled:"playing"!==U,className:`w-16 h-16 rounded-lg text-2xl font-bold text-white ${A[e].color} transition-transform active:scale-95 shadow-lg`,children:e},e)),I[40]=$,I[41]=U,I[42]=y):y=I[42],I[43]===Symbol.for("react.memo_cache_sentinel")?(v=(0,w.jsx)("div",{className:"w-px bg-gray-700 mx-2"}),I[43]=v):v=I[43],I[44]!==q?(j=(0,w.jsx)("button",{onClick:q,className:"px-4 py-1 bg-gray-700 text-white rounded uppercase text-xs font-bold",children:"Effacer"}),I[44]=q,I[45]=j):j=I[45],I[46]!==B?(k=(0,w.jsx)("button",{onClick:B,className:"px-4 py-2 bg-blue-600 text-white rounded uppercase text-xs font-bold shadow-lg hover:bg-blue-500",children:"Analyser"}),I[46]=B,I[47]=k):k=I[47],I[48]!==j||I[49]!==k?(S=(0,w.jsxs)("div",{className:"flex flex-col gap-2",children:[j,k]}),I[48]=j,I[49]=k,I[50]=S):S=I[50],I[51]!==y||I[52]!==S?(C=(0,w.jsxs)("div",{className:"flex gap-4",children:[y,v,S]}),I[51]=y,I[52]=S,I[53]=C):C=I[53],I[54]!==b||I[55]!==C?(E=(0,w.jsxs)("div",{className:"w-full h-full flex flex-col items-center p-4 relative",children:[b,C]}),I[54]=b,I[55]=C,I[56]=E):E=I[56],E}function u5(e){return null===e}function u4({onWin:e}){let t=["A","C","G","T"],r={A:"T",T:"A",C:"G",G:"C"},s={A:"bg-red-900 border-red-500 text-red-100",C:"bg-blue-900 border-blue-500 text-blue-100",G:"bg-green-900 border-green-500 text-green-100",T:"bg-yellow-900 border-yellow-500 text-yellow-100","?":"bg-gray-800 border-gray-600 text-gray-500 animate-pulse"},[n,i]=(0,N.useState)([]),[a,o]=(0,N.useState)([0,0,0,0]),[l,c]=(0,N.useState)("loading"),[d,u]=(0,N.useState)("?"),h=[0,3,6,9];(0,N.useEffect)(()=>{let e=setInterval(()=>{let e=["?","#","%","","ERR"];u(e[Math.floor(Math.random()*e.length)])},200);return()=>clearInterval(e)},[]),(0,N.useEffect)(()=>{let e=Array.from({length:12},()=>t[Math.floor(4*Math.random())]),s=e.map(e=>r[e]),n=s.map(e=>r[e]),a=n.map(e=>r[e]),l=[e,s,n,a],d=l.map(()=>30*Math.floor(12*Math.random()));i(l),o(d),c("playing")},[]),(0,N.useEffect)(()=>{"playing"===l&&m()},[a]);let p=(e,t,r)=>{e.preventDefault(),e.stopPropagation(),"playing"===l&&0!==t&&(u0("click"),o(e=>{let s=[...e];return s[t]+=30*r,t+1<4&&(s[t+1]-=30*r),s}))},f=(e,t)=>{let r=(t-Math.round(a[e]/30))%12;return n[e][r<0?r+12:r]},m=()=>{if(0===n.length)return;let t=!0;for(let e of h){let s=f(0,e),n=f(1,e),i=f(2,e),a=f(3,e);r[s]!==n&&(t=!1),r[n]!==i&&(t=!1),r[i]!==a&&(t=!1)}t&&(c("won"),u0("success"),setTimeout(e,1500))};return(0,w.jsxs)("div",{className:"flex flex-col items-center justify-center h-full relative select-none",children:[(0,w.jsx)("div",{className:"absolute top-0 bottom-0 left-0 w-[30%] bg-gradient-to-r from-black via-black/80 to-transparent z-20 pointer-events-none flex items-center justify-center",children:(0,w.jsx)("div",{className:"text-gray-800 text-9xl font-black opacity-20 rotate-90 tracking-widest",children:"ERROR"})}),(0,w.jsx)("div",{className:"absolute top-0 bottom-0 right-0 w-[30%] bg-gradient-to-l from-black via-black/80 to-transparent z-20 pointer-events-none flex items-center justify-center",children:(0,w.jsx)("div",{className:"text-gray-800 text-9xl font-black opacity-20 -rotate-90 tracking-widest",children:"ERROR"})}),(0,w.jsx)("div",{className:"absolute w-[2px] h-[600px] bg-green-500/30 z-0 shadow-[0_0_10px_lime]"}),(0,w.jsx)("div",{className:"absolute top-4 text-green-500 font-mono text-xs animate-pulse font-bold bg-black px-2",children:"SCANNER NORD"}),(0,w.jsx)("div",{className:"absolute bottom-4 text-green-500 font-mono text-xs animate-pulse font-bold bg-black px-2",children:"SCANNER SUD"}),(0,w.jsxs)("div",{className:"relative w-[560px] h-[560px] flex items-center justify-center rounded-full bg-black border-4 border-gray-800 shadow-2xl",children:[n.map((e,t)=>{let r=(t+1)*130+40,n=10-t;return(0,w.jsx)("div",{className:`absolute rounded-full border-2 border-dashed flex items-center justify-center transition-transform duration-300 ease-out ${0===t?"border-gray-700 bg-gray-900":"border-gray-600 hover:border-green-400 cursor-pointer"} ${"won"===l?"border-green-400 shadow-[0_0_20px_lime]":""}`,style:{width:`${r}px`,height:`${r}px`,zIndex:n,transform:`rotate(${a[t]}deg)`},onClick:e=>p(e,t,1),onContextMenu:e=>p(e,t,-1),children:e.map((e,r)=>{let n=30*r,i=(n+a[t])%360;i<0&&(i+=360);let o=i>330||i<30,c=i>150&&i<210,u=o||c||"won"===l;return(0,w.jsx)("div",{className:"absolute top-0 left-1/2 -ml-4 origin-bottom",style:{height:"50%",transform:`rotate(${n}deg)`},children:(0,w.jsx)("div",{className:`w-8 h-8 -mt-4 rounded-full border flex items-center justify-center font-bold text-sm shadow-md ${u?s[e]:s["?"]}`,style:{transform:`rotate(${-a[t]-n}deg)`},children:u?e:d})},r)})},t)}),(0,w.jsx)("div",{className:"absolute w-24 h-24 bg-gray-900 rounded-full border-4 border-green-500 flex items-center justify-center z-20 shadow-[0_0_30px_green]",children:(0,w.jsx)("span",{className:"text-4xl",children:""})})]}),"won"===l&&(0,w.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 z-50 backdrop-blur-sm animate-in zoom-in",children:(0,w.jsx)("div",{className:"bg-green-900/90 border-2 border-green-400 p-8 rounded-xl text-center shadow-2xl",children:(0,w.jsx)("h3",{className:"text-3xl font-bold text-green-100 uppercase tracking-widest mb-2",children:"Plasmide Stabilis"})})})]})}function u3(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,j,k,S,C,E,I,T=(0,_.c)(53),{onWin:A}=e,[M,R]=(0,N.useState)(2),[P,D]=(0,N.useState)(50),[O,L]=(0,N.useState)(0),[F,U]=(0,N.useState)(1),[z,V]=(0,N.useState)(20),[$,q]=(0,N.useState)(0),[B,H]=(0,N.useState)(0),[G,W]=(0,N.useState)("playing"),K=(0,N.useRef)(null),X=(0,N.useRef)(0);T[0]===Symbol.for("react.memo_cache_sentinel")?(t=()=>{R(1+3*Math.random()),D(30+40*Math.random()),L(Math.random()*Math.PI*2)},r=[],T[0]=t,T[1]=r):(t=T[0],r=T[1]),(0,N.useEffect)(t,r),T[2]!==G||T[3]!==P||T[4]!==M||T[5]!==O||T[6]!==z||T[7]!==F||T[8]!==$?(s=()=>{let e;if("playing"!==G)return;let t=()=>{X.current=X.current+.05;let r=K.current;if(!r)return;let s=r.getContext("2d"),n=r.width,i=r.height,a=i/2;s.clearRect(0,0,n,i),s.beginPath(),s.strokeStyle="rgba(255, 255, 0, 0.3)",s.lineWidth=4,s.setLineDash([5,5]);for(let e=0;e<n;e++){let t=a+Math.sin(.02*e*M+O+X.current)*P;s.lineTo(e,t)}s.stroke(),s.setLineDash([]),s.beginPath();let o=Math.abs(F-M)+Math.abs(z-P)/20+Math.abs($-O)<1;s.strokeStyle=o?"#4ade80":"#f87171",s.lineWidth=3,s.shadowBlur=10,s.shadowColor=s.strokeStyle;for(let e=0;e<n;e++){let t=a+Math.sin(.02*e*F+$+X.current)*z;s.lineTo(e,t)}s.stroke(),s.shadowBlur=0,o?H(u9):H(u8),Math.random()>.96&&L(u6),e=requestAnimationFrame(t)};return t(),()=>cancelAnimationFrame(e)},n=[F,z,$,M,P,O,G],T[2]=G,T[3]=P,T[4]=M,T[5]=O,T[6]=z,T[7]=F,T[8]=$,T[9]=s,T[10]=n):(s=T[9],n=T[10]),(0,N.useEffect)(s,n),T[11]!==A||T[12]!==B||T[13]!==G?(i=()=>{B>=100&&"won"!==G&&(W("won"),u0("success"),setTimeout(A,1500))},T[11]=A,T[12]=B,T[13]=G,T[14]=i):i=T[14],T[15]!==B?(a=[B],T[15]=B,T[16]=a):a=T[16],(0,N.useEffect)(i,a),T[17]===Symbol.for("react.memo_cache_sentinel")?(o=(0,w.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(0,255,0,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(0,255,0,0.1)_1px,transparent_1px)] bg-[length:40px_40px]"}),l=(0,w.jsx)("canvas",{ref:K,width:800,height:256,className:"absolute inset-0 w-full h-full"}),T[17]=o,T[18]=l):(o=T[17],l=T[18]),T[19]===Symbol.for("react.memo_cache_sentinel")?(c=(0,w.jsx)("span",{children:"SYNCHRONISATION"}),T[19]=c):c=T[19],T[20]!==B?(d=Math.round(B),T[20]=B,T[21]=d):d=T[21],T[22]!==d?(u=(0,w.jsxs)("div",{className:"flex justify-between text-xs text-green-500 font-mono mb-1",children:[c,(0,w.jsxs)("span",{children:[d,"%"]})]}),T[22]=d,T[23]=u):u=T[23];let Y=`${B}%`;return T[24]!==Y?(h=(0,w.jsx)("div",{className:"h-2 bg-gray-900 border border-gray-600 rounded-full overflow-hidden",children:(0,w.jsx)("div",{className:"h-full bg-green-500 shadow-[0_0_10px_lime] transition-all duration-100",style:{width:Y}})}),T[24]=Y,T[25]=h):h=T[25],T[26]!==u||T[27]!==h?(p=(0,w.jsxs)("div",{className:"absolute top-4 right-4 w-48",children:[u,h]}),T[26]=u,T[27]=h,T[28]=p):p=T[28],T[29]!==G?(f="won"===G&&(0,w.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-20",children:(0,w.jsx)("div",{className:"text-yellow-400 text-4xl font-mono font-bold tracking-widest animate-bounce border-4 border-yellow-400 p-4 rounded",children:"HARMONIE ATTEINTE"})}),T[29]=G,T[30]=f):f=T[30],T[31]!==p||T[32]!==f?(m=(0,w.jsxs)("div",{className:"relative w-full h-64 bg-black border-4 border-gray-700 rounded-lg shadow-inner overflow-hidden",children:[o,l,p,f]}),T[31]=p,T[32]=f,T[33]=m):m=T[33],T[34]===Symbol.for("react.memo_cache_sentinel")?(g=(0,w.jsx)("label",{className:"text-yellow-500 font-mono text-xs uppercase",children:"Frquence (Hz)"}),T[34]=g):g=T[34],T[35]===Symbol.for("react.memo_cache_sentinel")?(x=e=>U(parseFloat(e.target.value)),T[35]=x):x=T[35],T[36]!==F?(b=(0,w.jsxs)("div",{className:"flex flex-col gap-2",children:[g,(0,w.jsx)("input",{type:"range",min:"0.5",max:"5",step:"0.1",value:F,onChange:x,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500"})]}),T[36]=F,T[37]=b):b=T[37],T[38]===Symbol.for("react.memo_cache_sentinel")?(y=(0,w.jsx)("label",{className:"text-yellow-500 font-mono text-xs uppercase",children:"Amplitude (V)"}),T[38]=y):y=T[38],T[39]===Symbol.for("react.memo_cache_sentinel")?(v=e=>V(parseFloat(e.target.value)),T[39]=v):v=T[39],T[40]!==z?(j=(0,w.jsxs)("div",{className:"flex flex-col gap-2",children:[y,(0,w.jsx)("input",{type:"range",min:"10",max:"100",step:"1",value:z,onChange:v,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500"})]}),T[40]=z,T[41]=j):j=T[41],T[42]===Symbol.for("react.memo_cache_sentinel")?(k=(0,w.jsx)("label",{className:"text-yellow-500 font-mono text-xs uppercase",children:"Dphasage ()"}),T[42]=k):k=T[42],T[43]===Symbol.for("react.memo_cache_sentinel")?(S=e=>q(parseFloat(e.target.value)),T[43]=S):S=T[43],T[44]!==$?(C=(0,w.jsxs)("div",{className:"flex flex-col gap-2",children:[k,(0,w.jsx)("input",{type:"range",min:"0",max:"6.28",step:"0.1",value:$,onChange:S,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500"})]}),T[44]=$,T[45]=C):C=T[45],T[46]!==b||T[47]!==j||T[48]!==C?(E=(0,w.jsxs)("div",{className:"grid grid-cols-3 gap-8 w-full px-8",children:[b,j,C]}),T[46]=b,T[47]=j,T[48]=C,T[49]=E):E=T[49],T[50]!==m||T[51]!==E?(I=(0,w.jsxs)("div",{className:"flex flex-col items-center w-full max-w-4xl gap-6",children:[m,E]}),T[50]=m,T[51]=E,T[52]=I):I=T[52],I}function u6(e){return e+(Math.random()-.5)*.2}function u8(e){return Math.max(0,e-.3)}function u9(e){return Math.min(100,e+.4)}function u7({onWin:e}){let t=["A","B","C","D","E","F","0","1","2","3","4","5","6","7","8","9"],[r,s]=(0,N.useState)([]),[n,i]=(0,N.useState)(""),[a,o]=(0,N.useState)(0),[l,c]=(0,N.useState)("playing"),[d,u]=(0,N.useState)(100);(0,N.useEffect)(()=>{h();let e=setInterval(()=>{"playing"===l&&(h(),o(e=>Math.max(0,e-1)))},1500),t=setInterval(()=>{"playing"===l&&u(e=>e>0?e-2:0)},30);return()=>{clearInterval(e),clearInterval(t)}},[l]);let h=()=>{u(100);let e=Array.from({length:16},()=>t[Math.floor(Math.random()*t.length)]+t[Math.floor(Math.random()*t.length)]),r=e[Math.floor(Math.random()*e.length)];s(e),i(r)};return(0,w.jsxs)("div",{className:"flex flex-col items-center gap-8 w-full max-w-2xl",children:[(0,w.jsxs)("div",{className:"flex justify-between w-full items-end border-b border-emerald-900 pb-4",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{className:"text-emerald-600 text-xs font-mono uppercase",children:"Hash Cible"}),(0,w.jsx)("div",{className:"text-5xl font-mono font-bold text-white tracking-widest animate-pulse drop-shadow-[0_0_10px_white]",children:n})]}),(0,w.jsxs)("div",{className:"text-right",children:[(0,w.jsx)("div",{className:"text-emerald-600 text-xs font-mono uppercase",children:"Blocs Valids"}),(0,w.jsxs)("div",{className:"text-4xl font-mono font-bold text-emerald-400",children:[a," ",(0,w.jsxs)("span",{className:"text-lg text-emerald-800",children:["/ ",5]})]})]})]}),(0,w.jsx)("div",{className:"w-full h-2 bg-gray-900 rounded-full overflow-hidden",children:(0,w.jsx)("div",{className:`h-full transition-all duration-100 linear ${d<30?"bg-red-500":"bg-emerald-500"}`,style:{width:`${d}%`}})}),(0,w.jsx)("div",{className:"grid grid-cols-4 gap-4 p-4 bg-gray-900/50 rounded-xl border border-gray-700 shadow-2xl",children:r.map((t,r)=>(0,w.jsx)("button",{onClick:()=>(t=>{if("playing"===l)if(t===n){u0("click");let t=a+1;o(t),t>=5?(c("won"),u0("success"),setTimeout(e,1500)):h()}else u0("error"),o(e=>Math.max(0,e-2))})(t),disabled:"playing"!==l,className:"w-24 h-24 flex items-center justify-center text-2xl font-mono font-bold text-emerald-100 bg-gray-800 border-2 border-emerald-900/30 rounded-lg hover:bg-emerald-900 hover:border-emerald-400 hover:scale-105 hover:shadow-[0_0_15px_emerald] transition-all duration-75 active:scale-95",children:t},r))}),"won"===l&&(0,w.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-20",children:(0,w.jsxs)("div",{className:"text-center",children:[(0,w.jsx)("div",{className:"text-6xl mb-4",children:""}),(0,w.jsx)("div",{className:"text-emerald-400 text-4xl font-bold uppercase tracking-widest animate-bounce",children:"Transaction Valide"})]})})]})}function he({onWin:e,onClose:t}){let[r,s]=(0,N.useState)([]),[n,i]=(0,N.useState)(new Set(["0-0"])),[a,o]=(0,N.useState)("loading"),[l,c]=(0,N.useState)(0),d={STRAIGHT:{id:"straight",cx:[1,0,1,0]},CORNER:{id:"corner",cx:[1,1,0,0]},T:{id:"t",cx:[1,1,1,0]},CROSS:{id:"cross",cx:[1,1,1,1]},BROKEN:{id:"broken",cx:[0,0,0,0]}};(0,N.useEffect)(()=>{u()},[]),(0,N.useEffect)(()=>{"playing"===a&&h()},[r,a]);let u=()=>{let e=Array(8).fill(null).map((e,t)=>Array(8).fill(null).map((e,r)=>({x:r,y:t,type:d.STRAIGHT,rotation:0}))),t=0,r=0,n=[{x:0,y:0}];for(;t<7||r<7;){let e=!1;Math.random()>.5&&t<7?(t++,e=!0):r<7?(r++,e=!0):t<7&&(t++,e=!0),e&&n.push({x:t,y:r})}for(let t=0;t<n.length;t++){let r=n[t],s=n[t-1],i=n[t+1],a=0,o=0,l=0,c=0;s?(s.y<r.y&&(a=1),s.x>r.x&&(o=1),s.y>r.y&&(l=1),s.x<r.x&&(c=1)):c=1,i?(i.y<r.y&&(a=1),i.x>r.x&&(o=1),i.y>r.y&&(l=1),i.x<r.x&&(c=1)):o=1;let u="STRAIGHT",h=0;a&&l?(u="STRAIGHT",h=0):c&&o?(u="STRAIGHT",h=1):a&&o?(u="CORNER",h=0):o&&l?(u="CORNER",h=1):l&&c?(u="CORNER",h=2):c&&a?(u="CORNER",h=3):(u="T",h=0),e[r.y][r.x]={x:r.x,y:r.y,type:d[u],rotation:h,onPath:!0}}for(let t=0;t<8;t++)for(let r=0;r<8;r++)if(!e[t][r].onPath)if(Math.random()>.85)e[t][r]={x:r,y:t,type:d.BROKEN,rotation:0,onPath:!1};else{let s=["STRAIGHT","CORNER","T","CROSS"],n=s[Math.floor(Math.random()*s.length)];e[t][r]={x:r,y:t,type:d[n],rotation:Math.floor(4*Math.random()),onPath:!1}}let i=0;s(e.map(e=>e.map(e=>{if("broken"===e.type.id)return e;let t=Math.floor(4*Math.random());return e.onPath&&(i+=(4-t)%4),{...e,rotation:(e.rotation+t)%4}}))),c(Math.max(20,Math.min(60,i+15))),o("playing")},h=()=>{let t=[{x:0,y:0}],s=new Set(["0-0"]),n=new Set(["0-0"]),c=!1;for(;t.length>0;){let{x:e,y:i}=t.shift();7===e&&7===i&&(c=!0);let a=r[i][e];if("broken"===a.type.id)continue;let o=[...a.type.cx];for(let e=0;e<a.rotation;e++)o.unshift(o.pop());[{x:e,y:i-1},{x:e+1,y:i},{x:e,y:i+1},{x:e-1,y:i}].forEach((e,i)=>{if(1===o[i]&&e.x>=0&&e.x<8&&e.y>=0&&e.y<8){let a=r[e.y][e.x];if("broken"===a.type.id)return;let o=[...a.type.cx];for(let e=0;e<a.rotation;e++)o.unshift(o.pop());if(1===o[(i+2)%4]){let r=`${e.x}-${e.y}`;s.has(r)||(s.add(r),n.add(r),t.push(e))}}})}i(n),c&&"won"!==a?(o("won"),u0("success"),setTimeout(e,1500)):0!==l||c||o("lost")};return(0,w.jsxs)("div",{className:"flex flex-col items-center gap-4 h-full justify-center relative z-20",children:[(0,w.jsxs)("div",{className:`text-3xl font-mono font-bold mb-2 transition-colors ${l<10?"text-red-500 animate-pulse":"text-cyan-400"}`,children:[l," ",(0,w.jsx)("span",{className:"text-sm text-gray-500",children:"MOVES"})]}),(0,w.jsxs)("div",{className:"relative p-2 bg-[#0a1510]/80 backdrop-blur-md rounded-lg border-4 border-gray-700 shadow-2xl",children:[(0,w.jsx)("div",{className:"absolute -left-8 top-4 text-cyan-400 font-mono text-xs font-bold animate-pulse",children:"PWR "}),(0,w.jsx)("div",{className:"absolute -right-8 bottom-4 text-cyan-400 font-mono text-xs font-bold animate-pulse",children:" CPU"}),(0,w.jsx)("div",{className:"grid gap-px bg-[#050a08]/50",style:{gridTemplateColumns:"repeat(8, 1fr)"},children:r.length>0&&r.map((e,t)=>e.map((e,i)=>{let o=n.has(`${i}-${t}`),d=o?"opacity-100":"opacity-10 grayscale blur-[1px]";return(0,w.jsx)("button",{onClick:()=>((e,t)=>{let n=r[t][e];if("playing"!==a||l<=0||"broken"===n.type.id)return;u0("click"),c(e=>e-1);let i=[...r];i[t]=[...i[t]],i[t][e]={...i[t][e],rotation:(i[t][e].rotation+1)%4},s(i)})(i,t),disabled:"playing"!==a||"broken"===e.type.id,className:`w-10 h-10 relative flex items-center justify-center transition-all duration-300 ${"broken"===e.type.id?"bg-red-900/10":o?"bg-cyan-900/40":"bg-transparent"} hover:bg-white/10 active:scale-95 disabled:cursor-not-allowed`,children:(0,w.jsx)("div",{className:`w-full h-full transition-all duration-300 ease-out ${d}`,style:{transform:`rotate(${90*e.rotation}deg)`},children:(0,w.jsx)(ht,{type:e.type.id,powered:o})})},`${i}-${t}`)}))})]}),(0,w.jsxs)("div",{className:"h-8",children:["won"===a&&(0,w.jsx)("div",{className:"text-green-400 font-bold animate-bounce uppercase tracking-widest bg-black/50 px-4 py-1 rounded",children:"CONNEXION TABLIE"}),"lost"===a&&(0,w.jsx)("div",{className:"text-red-500 font-bold uppercase tracking-widest bg-black/50 px-4 py-1 rounded",children:"CHEC DU ROUTAGE"})]})]})}let ht=e=>{let t,r,s,n,i,a,o,l=(0,_.c)(24),{type:c,powered:d}=e,u=d?"#22d3ee":"#333",h=d?"drop-shadow(0 0 4px #06b6d4)":"";if("broken"===c){let e;return l[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,w.jsx)("svg",{viewBox:"0 0 100 100",className:"w-full h-full p-2",children:(0,w.jsx)("path",{d:"M 20 20 L 80 80 M 80 20 L 20 80",stroke:"#500",strokeWidth:"10"})}),l[0]=e):e=l[0],e}return l[1]!==h?(t={filter:h},l[1]=h,l[2]=t):t=l[2],l[3]!==u||l[4]!==c?(r="straight"===c&&(0,w.jsx)("line",{x1:"50",y1:"0",x2:"50",y2:"100",stroke:u,strokeWidth:"16",strokeLinecap:"square"}),l[3]=u,l[4]=c,l[5]=r):r=l[5],l[6]!==u||l[7]!==c?(s="corner"===c&&(0,w.jsx)("path",{d:"M 50 0 L 50 50 L 100 50",stroke:u,strokeWidth:"16",fill:"none",strokeLinecap:"square",strokeLinejoin:"round"}),l[6]=u,l[7]=c,l[8]=s):s=l[8],l[9]!==u||l[10]!==c?(n="t"===c&&(0,w.jsx)("path",{d:"M 50 0 L 50 100 M 50 50 L 100 50",stroke:u,strokeWidth:"16",fill:"none",strokeLinecap:"square",strokeLinejoin:"round"}),l[9]=u,l[10]=c,l[11]=n):n=l[11],l[12]!==u||l[13]!==c?(i="cross"===c&&(0,w.jsx)("path",{d:"M 50 0 L 50 100 M 0 50 L 100 50",stroke:u,strokeWidth:"16",fill:"none",strokeLinecap:"square"}),l[12]=u,l[13]=c,l[14]=i):i=l[14],l[15]!==u?(a=(0,w.jsx)("circle",{cx:"50",cy:"50",r:"5",fill:"#111",stroke:u,strokeWidth:"2"}),l[15]=u,l[16]=a):a=l[16],l[17]!==t||l[18]!==r||l[19]!==s||l[20]!==n||l[21]!==i||l[22]!==a?(o=(0,w.jsxs)("svg",{viewBox:"0 0 100 100",className:"w-full h-full p-0.5",style:t,children:[r,s,n,i,a]}),l[17]=t,l[18]=r,l[19]=s,l[20]=n,l[21]=i,l[22]=a,l[23]=o):o=l[23],o},hr={military:[{id:"tech_corvette",label:"Chssis Corvette",cost:200,desc:"Dbloque la construction des Corvettes.",icon:"",parent:null},{id:"tech_frigate",label:"Frgates de Ligne",cost:800,desc:"Dbloque les Frgates.",icon:"",parent:"tech_corvette"},{id:"tech_cruiser",label:"Croiseurs Lourds",cost:2500,desc:"Dbloque les Croiseurs.",icon:"",parent:"tech_frigate"},{id:"tech_dreadnought",label:"Projet Titan",cost:1e4,desc:"Dbloque les Dreadnoughts.",icon:"",parent:"tech_cruiser"}],economic:[{id:"tech_mining_1",label:"Extraction Profonde",cost:300,desc:"+10% Revenus Matriaux.",icon:"",parent:null},{id:"tech_trade_1",label:"Routes Commerciales",cost:300,desc:"+10% Revenus Crdits.",icon:"",parent:null},{id:"tech_cloning",label:"Cuves de Clonage",cost:1e3,desc:"+20% Recrutement (Manpower).",icon:"",parent:"tech_mining_1"}],force:[{id:"tech_holocron",label:"tude des Holocrons",cost:500,desc:"Dbloque les Temples de niveau 2.",icon:"",parent:null},{id:"tech_meditation",label:"Mditation de Combat",cost:2e3,desc:"Bonus +10% Attaque pour toutes les flottes.",icon:"",parent:"tech_holocron"}]};function hs({userFaction:e,factionData:t,onClose:r}){let[s,n]=(0,N.useState)("military"),[i,a]=(0,N.useState)(null),[o,l]=(0,N.useState)(!1),c=t?.unlocked_techs||[],d=t?.science||0,u=async()=>{a(null),l(!0);try{await oK(aJ(dY,"factions",e),{science:o4(-i.cost),unlocked_techs:o2(i.id)})}catch(e){console.error(e)}finally{l(!1)}};return(0,w.jsxs)(w.Fragment,{children:[i&&(0,w.jsx)(u1,{techType:s,onWin:u,onClose:()=>a(null)}),(0,w.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 font-sans animate-in fade-in zoom-in-95 duration-200",children:(0,w.jsxs)("div",{className:"w-full max-w-5xl h-[85vh] bg-gray-900 border-2 border-blue-500/50 rounded-xl flex flex-col shadow-[0_0_50px_rgba(37,99,235,0.2)] overflow-hidden",children:[(0,w.jsxs)("div",{className:"p-6 border-b border-blue-900/50 bg-black/40 flex justify-between items-center",children:[(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[(0,w.jsx)("div",{className:"text-4xl animate-pulse",children:""}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h2",{className:"text-2xl font-bold text-blue-100 uppercase tracking-widest",children:"Laboratoire de Recherche"}),(0,w.jsxs)("p",{className:"text-blue-400 text-xs uppercase",children:["Ressources : ",(0,w.jsx)("span",{className:"font-mono font-bold text-white text-lg",children:d.toLocaleString()})," Donnes"]})]})]}),(0,w.jsx)("button",{onClick:r,className:"px-4 py-2 border border-blue-800 hover:bg-blue-900/50 text-blue-200 uppercase text-xs font-bold rounded transition",children:"Fermer"})]}),(0,w.jsxs)("div",{className:"flex border-b border-blue-900/30 bg-black/20",children:[(0,w.jsx)("button",{onClick:()=>n("military"),className:`flex-1 py-4 text-xs font-bold uppercase tracking-widest transition ${"military"===s?"bg-red-900/20 text-red-400 border-b-2 border-red-500":"text-gray-500 hover:text-white"}`,children:" Militaire"}),(0,w.jsx)("button",{onClick:()=>n("economic"),className:`flex-1 py-4 text-xs font-bold uppercase tracking-widest transition ${"economic"===s?"bg-yellow-900/20 text-yellow-400 border-b-2 border-yellow-500":"text-gray-500 hover:text-white"}`,children:" conomique"}),(0,w.jsx)("button",{onClick:()=>n("force"),className:`flex-1 py-4 text-xs font-bold uppercase tracking-widest transition ${"force"===s?"bg-purple-900/20 text-purple-400 border-b-2 border-purple-500":"text-gray-500 hover:text-white"}`,children:" Force & Traditions"})]}),(0,w.jsx)("div",{className:"flex-grow p-8 overflow-y-auto bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] bg-fixed relative",children:(0,w.jsx)("div",{className:"flex flex-col items-center gap-12",children:hr[s].map(e=>{let t=c.includes(e.id),r=!c.includes(e.id)&&(!e.parent||!!c.includes(e.parent)),s=!t&&!r;return(0,w.jsxs)("div",{className:"relative flex flex-col items-center group",children:[e.parent&&(0,w.jsx)("div",{className:"absolute -top-12 w-0.5 h-12 bg-gray-700 group-hover:bg-blue-500/50 transition-colors"}),(0,w.jsxs)("button",{onClick:()=>r&&(e=>{if(d<e.cost)return alert("Donnes insuffisantes !");a(e)})(e),disabled:s||t||o,className:`
                                                w-96 p-4 border-2 rounded-lg flex items-center gap-4 transition-all duration-300 relative overflow-hidden text-left
                                                ${t?"bg-green-950/40 border-green-500/50 shadow-[0_0_20px_rgba(34,197,94,0.2)]":r?"bg-gray-900/80 border-blue-500 hover:bg-blue-900/30 hover:scale-105 hover:shadow-[0_0_30px_rgba(59,130,246,0.3)] cursor-pointer":"bg-black/60 border-gray-800 opacity-50 grayscale cursor-not-allowed"}
                                            `,children:[(0,w.jsx)("div",{className:`text-3xl w-16 h-16 flex items-center justify-center rounded-full bg-black/50 border ${t?"border-green-500":"border-gray-600"}`,children:t?"":e.icon}),(0,w.jsxs)("div",{className:"flex-grow",children:[(0,w.jsx)("h4",{className:`text-sm font-bold uppercase ${t?"text-green-400":"text-gray-200"}`,children:e.label}),(0,w.jsx)("p",{className:"text-[10px] text-gray-400",children:e.desc}),!t&&(0,w.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-xs font-mono",children:[(0,w.jsxs)("span",{className:`${d>=e.cost?"text-blue-300":"text-red-500"}`,children:[e.cost," "]}),s&&(0,w.jsx)("span",{className:"text-red-500 uppercase text-[9px] ml-auto",children:" Requis : Tech Prcdente"})]})]})]})]},e.id)})})})]})})]})}let hn={id:"new_ship",label:"Nouveau Vaisseau",type:"fighter",speed:4,hp:100,damage:10,range:200,cooldown:50,size:6,color:"#ffffff",armor:0,armorPen:0,accuracy:.85,traits:[],bonuses:{},availableFactions:["republic","empire"],isHero:!1,maxMana:0,manaCost:0,ability:""},hi={id:"new_unit",label:"Nouvelle Unit",type:"infantry",speed:1,hp:20,damage:5,range:100,cooldown:30,size:4,color:"#ffffff",armor:0,armorPen:0,accuracy:.85,traits:[],bonuses:{},availableFactions:["republic","empire"],isHero:!1,isMelee:!1,maxMana:0,manaCost:0,ability:""},ha=["biological","mechanized","robotic","vampirism","regeneration","stealth","rage","shielded"],ho={biological:"Cible standard pour les dgts biologiques.",mechanized:"Cible mcanique, vulnrable aux armes anti-vhicules.",robotic:"Cible robotique, immunise au moral (si implment).",vampirism:"Soigne 20% des dgts infligs.",regeneration:"Rgnre 1 HP toutes les secondes.",stealth:"Invisible pour les ennemis jusqu' attaque ou proximit.",rage:"Les dgts augmentent quand les PV diminuent.",shielded:"Possde un bouclier qui se recharge hors combat."},hl=[{id:"republic",label:"La Rpublique"},{id:"empire",label:"L'Empire Sith"},{id:"neutral",label:"Neutre / Minor"}],hc=["fleet_repair","orbital_bombardment","emergency_shields","concentrated_fire"],hd=["force_heal","force_lightning","battle_meditation","force_push","jetpack_jump"];function hu(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,j=(0,_.c)(61),{onClose:k}=e,[S,C]=(0,N.useState)("space");j[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],j[0]=t):t=j[0];let[E,I]=(0,N.useState)(t);j[1]===Symbol.for("react.memo_cache_sentinel")?(r=[],j[1]=r):r=j[1];let[T,A]=(0,N.useState)(r),[M,R]=(0,N.useState)(null),[,P]=(0,N.useState)(!0);j[2]===Symbol.for("react.memo_cache_sentinel")?(s=()=>{P(!0);let e=oQ(aY(dY,"custom_units"),e=>{I(e.docs.map(hf)),P(!1)}),t=oQ(aY(dY,"magic_domains"),e=>{A(e.docs.map(hp))});return()=>{e(),t()}},n=[],j[2]=s,j[3]=n):(s=j[2],n=j[3]),(0,N.useEffect)(s,n),j[4]!==S?(i=async e=>{if(!e.id||!e.label)return alert("ID et Label requis");let t={...e,category:S};e.dbId?await oK(aJ(dY,"custom_units",e.dbId),t):await oY(aY(dY,"custom_units"),t),R(null)},j[4]=S,j[5]=i):i=j[5];let D=i;if(j[6]!==S||j[7]!==M?.dbId||j[8]!==k||j[9]!==E){let e,t,r,s,n,i,m;j[19]!==S?(e=e=>e.category===S,j[19]=S,j[20]=e):e=j[20];let g=E.filter(e);d="fixed inset-0 bg-black/90 z-[300] flex items-center justify-center p-10",o="bg-gray-900 w-full max-w-6xl h-full max-h-[90vh] border border-gray-700 rounded-lg flex flex-col shadow-2xl",j[21]===Symbol.for("react.memo_cache_sentinel")?(t=(0,w.jsx)("h2",{className:"text-xl font-bold text-yellow-500 uppercase tracking-widest",children:"diteur d'Units"}),j[21]=t):t=j[21],j[22]!==k?(l=(0,w.jsxs)("div",{className:"p-4 border-b border-gray-800 flex justify-between items-center bg-gray-900 rounded-t-lg",children:[t,(0,w.jsx)("button",{onClick:k,className:"text-red-400 hover:text-red-300 font-bold border border-red-900 px-3 py-1 rounded",children:"FERMER"})]}),j[22]=k,j[23]=l):l=j[23],j[24]===Symbol.for("react.memo_cache_sentinel")?(r=()=>{C("space"),R(null)},j[24]=r):r=j[24];let x=`flex-1 py-3 text-center font-bold uppercase tracking-wide transition-colors ${"space"===S?"bg-blue-900/40 text-blue-400 border-b-2 border-blue-500":"text-gray-500 hover:bg-gray-800"}`;j[25]!==x?(s=(0,w.jsx)("button",{onClick:r,className:x,children:" Units Spatiales"}),j[25]=x,j[26]=s):s=j[26],j[27]===Symbol.for("react.memo_cache_sentinel")?(n=()=>{C("ground"),R(null)},j[27]=n):n=j[27];let b=`flex-1 py-3 text-center font-bold uppercase tracking-wide transition-colors ${"ground"===S?"bg-green-900/40 text-green-400 border-b-2 border-green-500":"text-gray-500 hover:bg-gray-800"}`;j[28]!==b?(i=(0,w.jsx)("button",{onClick:n,className:b,children:" Units Terrestres"}),j[28]=b,j[29]=i):i=j[29],j[30]!==s||j[31]!==i?(c=(0,w.jsxs)("div",{className:"flex border-b border-gray-800",children:[s,i]}),j[30]=s,j[31]=i,j[32]=c):c=j[32],a="flex-grow flex overflow-hidden",p="w-1/4 border-r border-gray-800 p-4 bg-black/20 overflow-y-auto",j[33]!==S?(f=(0,w.jsx)("button",{onClick:()=>R("space"===S?{...hn}:{...hi}),className:"w-full py-2 bg-green-700 hover:bg-green-600 text-white font-bold rounded mb-4",children:"+ CRER"}),j[33]=S,j[34]=f):f=j[34],u="space-y-2",j[35]!==M?.dbId?(m=e=>(0,w.jsxs)("div",{onClick:()=>R(e),className:`p-3 rounded border cursor-pointer hover:bg-gray-800 transition-colors ${M?.dbId===e.dbId?"bg-gray-800 border-yellow-600":"bg-gray-900 border-gray-700"}`,children:[(0,w.jsx)("div",{className:"font-bold text-gray-200",children:e.label}),(0,w.jsx)("div",{className:"text-xs text-gray-500 font-mono",children:e.id})]},e.dbId),j[35]=M?.dbId,j[36]=m):m=j[36],h=g.map(m),j[6]=S,j[7]=M?.dbId,j[8]=k,j[9]=E,j[10]=a,j[11]=o,j[12]=l,j[13]=c,j[14]=d,j[15]=u,j[16]=h,j[17]=p,j[18]=f}else a=j[10],o=j[11],l=j[12],c=j[13],d=j[14],u=j[15],h=j[16],p=j[17],f=j[18];return j[37]!==u||j[38]!==h?(m=(0,w.jsx)("div",{className:u,children:h}),j[37]=u,j[38]=h,j[39]=m):m=j[39],j[40]!==m||j[41]!==p||j[42]!==f?(g=(0,w.jsxs)("div",{className:p,children:[f,m]}),j[40]=m,j[41]=p,j[42]=f,j[43]=g):g=j[43],j[44]!==S||j[45]!==M||j[46]!==D||j[47]!==T?(x=(0,w.jsx)("div",{className:"flex-1 p-6 overflow-y-auto bg-gray-900/50",children:M?(0,w.jsx)(hm,{unit:M,onChange:R,onSave:D,onDelete:hh,isSpace:"space"===S,magicDomains:T}):(0,w.jsx)("div",{className:"h-full flex items-center justify-center text-gray-600 font-mono text-xl uppercase",children:"Slectionnez ou crez une unit"})}),j[44]=S,j[45]=M,j[46]=D,j[47]=T,j[48]=x):x=j[48],j[49]!==a||j[50]!==g||j[51]!==x?(b=(0,w.jsxs)("div",{className:a,children:[g,x]}),j[49]=a,j[50]=g,j[51]=x,j[52]=b):b=j[52],j[53]!==o||j[54]!==l||j[55]!==c||j[56]!==b?(y=(0,w.jsxs)("div",{className:o,children:[l,c,b]}),j[53]=o,j[54]=l,j[55]=c,j[56]=b,j[57]=y):y=j[57],j[58]!==d||j[59]!==y?(v=(0,w.jsx)("div",{className:d,children:y}),j[58]=d,j[59]=y,j[60]=v):v=j[60],v}async function hh(e){window.confirm("Supprimer cette unit ?")&&await oX(aJ(dY,"custom_units",e.dbId))}function hp(e){return{...e.data(),id:e.id}}function hf(e){return{dbId:e.id,...e.data()}}function hm(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,N,j,k,S,C,E,I,T,A,M,R,P,D,O,L,F,U,z,V,$,q,B,H,G,W,K,X,Y,Q,J,Z,ee,et,er,es,en,ei,ea,eo,el,ec,ed,eu,eh,ep=(0,_.c)(169),{unit:ef,onChange:em,onSave:eg,onDelete:ex,isSpace:eb,magicDomains:ey}=e;ep[0]!==em||ep[1]!==ef?(t=(e,t)=>{em({...ef,[e]:t})},ep[0]=em,ep[1]=ef,ep[2]=t):t=ep[2];let ev=t;ep[3]!==em||ep[4]!==ef?(r=(e,t)=>{let r={...ef.bonuses};1===t?delete r[e]:r[e]=parseFloat(t),em({...ef,bonuses:r})},ep[3]=em,ep[4]=ef,ep[5]=r):r=ep[5];let ew=r;ep[6]!==ev?(s=e=>ev("label",e.target.value),ep[6]=ev,ep[7]=s):s=ep[7],ep[8]!==s||ep[9]!==ef.label?(n=(0,w.jsx)("input",{type:"text",value:ef.label,onChange:s,className:"bg-transparent text-3xl font-bold text-yellow-500 border-b border-gray-700 outline-none w-full placeholder-gray-600 mb-2",placeholder:"Nom de l'unit"}),ep[8]=s,ep[9]=ef.label,ep[10]=n):n=ep[10],ep[11]===Symbol.for("react.memo_cache_sentinel")?(i=(0,w.jsx)("span",{className:"text-xs font-mono uppercase",children:"ID Unique:"}),ep[11]=i):i=ep[11],ep[12]!==ev?(a=e=>ev("id",e.target.value),ep[12]=ev,ep[13]=a):a=ep[13],ep[14]!==a||ep[15]!==ef.id?(o=(0,w.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[i,(0,w.jsx)("input",{type:"text",value:ef.id,onChange:a,className:"bg-gray-800 border border-gray-700 rounded px-2 py-0.5 text-xs font-mono text-white outline-none"})]}),ep[14]=a,ep[15]=ef.id,ep[16]=o):o=ep[16],ep[17]!==n||ep[18]!==o?(l=(0,w.jsxs)("div",{children:[n,o]}),ep[17]=n,ep[18]=o,ep[19]=l):l=ep[19],ep[20]!==ex||ep[21]!==ef?(c=(0,w.jsx)("button",{onClick:()=>ex(ef),className:"px-4 py-2 border border-red-800 text-red-500 hover:bg-red-900/30 rounded",children:"Supprimer"}),ep[20]=ex,ep[21]=ef,ep[22]=c):c=ep[22],ep[23]!==eg||ep[24]!==ef?(d=(0,w.jsx)("button",{onClick:()=>eg(ef),className:"px-6 py-2 bg-yellow-600 hover:bg-yellow-500 text-black font-bold rounded shadow-lg shadow-yellow-900/20",children:"ENREGISTRER"}),ep[23]=eg,ep[24]=ef,ep[25]=d):d=ep[25],ep[26]!==d||ep[27]!==c?(u=(0,w.jsxs)("div",{className:"flex gap-2",children:[c,d]}),ep[26]=d,ep[27]=c,ep[28]=u):u=ep[28],ep[29]!==u||ep[30]!==l?(h=(0,w.jsxs)("div",{className:"flex justify-between items-start",children:[l,u]}),ep[29]=u,ep[30]=l,ep[31]=h):h=ep[31],ep[32]===Symbol.for("react.memo_cache_sentinel")?(p=(0,w.jsx)("h4",{className:"text-gray-400 font-bold text-xs uppercase border-b border-gray-700 pb-2 mb-2",children:"Combat"}),ep[32]=p):p=ep[32],ep[33]!==ev?(f=e=>ev("hp",e),ep[33]=ev,ep[34]=f):f=ep[34],ep[35]!==f||ep[36]!==ef.hp?(m=(0,w.jsx)(hw,{label:"HP (Points de Vie)",value:ef.hp,onChange:f}),ep[35]=f,ep[36]=ef.hp,ep[37]=m):m=ep[37],ep[38]!==ev?(g=e=>ev("damage",e),ep[38]=ev,ep[39]=g):g=ep[39],ep[40]!==g||ep[41]!==ef.damage?(x=(0,w.jsx)(hw,{label:"Dgts",value:ef.damage,onChange:g}),ep[40]=g,ep[41]=ef.damage,ep[42]=x):x=ep[42],ep[43]!==ev?(b=e=>ev("range",e),ep[43]=ev,ep[44]=b):b=ep[44],ep[45]!==b||ep[46]!==ef.range?(y=(0,w.jsx)(hw,{label:"Porte",value:ef.range,onChange:b}),ep[45]=b,ep[46]=ef.range,ep[47]=y):y=ep[47],ep[48]!==ev?(v=e=>ev("cooldown",e),ep[48]=ev,ep[49]=v):v=ep[49],ep[50]!==v||ep[51]!==ef.cooldown?(N=(0,w.jsx)(hw,{label:"Cooldown (Recharge)",value:ef.cooldown,onChange:v}),ep[50]=v,ep[51]=ef.cooldown,ep[52]=N):N=ep[52],ep[53]!==ev?(j=e=>ev("accuracy",e),ep[53]=ev,ep[54]=j):j=ep[54],ep[55]!==j||ep[56]!==ef.accuracy?(k=(0,w.jsx)(hw,{label:"Prcision (0-1)",value:ef.accuracy,onChange:j,step:.05,max:1}),ep[55]=j,ep[56]=ef.accuracy,ep[57]=k):k=ep[57],ep[58]!==m||ep[59]!==x||ep[60]!==y||ep[61]!==N||ep[62]!==k?(S=(0,w.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded border border-gray-700 space-y-3",children:[p,m,x,y,N,k]}),ep[58]=m,ep[59]=x,ep[60]=y,ep[61]=N,ep[62]=k,ep[63]=S):S=ep[63],ep[64]===Symbol.for("react.memo_cache_sentinel")?(C=(0,w.jsx)("h4",{className:"text-gray-400 font-bold text-xs uppercase border-b border-gray-700 pb-2 mb-2",children:"Dfense & Mouvement"}),ep[64]=C):C=ep[64],ep[65]!==ev?(E=e=>ev("armor",e),ep[65]=ev,ep[66]=E):E=ep[66],ep[67]!==E||ep[68]!==ef.armor?(I=(0,w.jsx)(hw,{label:"Armure",value:ef.armor,onChange:E}),ep[67]=E,ep[68]=ef.armor,ep[69]=I):I=ep[69],ep[70]!==ev?(T=e=>ev("armorPen",e),ep[70]=ev,ep[71]=T):T=ep[71],ep[72]!==T||ep[73]!==ef.armorPen?(A=(0,w.jsx)(hw,{label:"Pntration Armure",value:ef.armorPen,onChange:T}),ep[72]=T,ep[73]=ef.armorPen,ep[74]=A):A=ep[74],ep[75]!==ev?(M=e=>ev("speed",e),ep[75]=ev,ep[76]=M):M=ep[76],ep[77]!==M||ep[78]!==ef.speed?(R=(0,w.jsx)(hw,{label:"Vitesse",value:ef.speed,onChange:M,step:.1}),ep[77]=M,ep[78]=ef.speed,ep[79]=R):R=ep[79],ep[80]!==ev?(P=e=>ev("size",e),ep[80]=ev,ep[81]=P):P=ep[81],ep[82]!==P||ep[83]!==ef.size?(D=(0,w.jsx)(hw,{label:"Taille (Hitbox)",value:ef.size,onChange:P}),ep[82]=P,ep[83]=ef.size,ep[84]=D):D=ep[84],ep[85]!==I||ep[86]!==A||ep[87]!==R||ep[88]!==D?(O=(0,w.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded border border-gray-700 space-y-3",children:[C,I,A,R,D]}),ep[85]=I,ep[86]=A,ep[87]=R,ep[88]=D,ep[89]=O):O=ep[89],ep[90]===Symbol.for("react.memo_cache_sentinel")?(L=(0,w.jsx)("h4",{className:"text-gray-400 font-bold text-xs uppercase border-b border-gray-700 pb-2 mb-2",children:"Apparence & Type"}),ep[90]=L):L=ep[90],ep[91]===Symbol.for("react.memo_cache_sentinel")?(F=(0,w.jsx)("label",{className:"text-xs text-gray-500",children:"Couleur (Hex)"}),ep[91]=F):F=ep[91],ep[92]!==ev?(U=e=>ev("color",e.target.value),ep[92]=ev,ep[93]=U):U=ep[93],ep[94]!==U||ep[95]!==ef.color?(z=(0,w.jsx)("input",{type:"color",value:ef.color,onChange:U,className:"w-8 h-8 rounded cursor-pointer"}),ep[94]=U,ep[95]=ef.color,ep[96]=z):z=ep[96],ep[97]!==ev?(V=e=>ev("color",e.target.value),ep[97]=ev,ep[98]=V):V=ep[98],ep[99]!==V||ep[100]!==ef.color?($=(0,w.jsx)("input",{type:"text",value:ef.color,onChange:V,className:"flex-1 bg-gray-900 border border-gray-600 rounded px-2 text-sm text-white"}),ep[99]=V,ep[100]=ef.color,ep[101]=$):$=ep[101],ep[102]!==z||ep[103]!==$?(q=(0,w.jsxs)("div",{className:"space-y-1",children:[F,(0,w.jsxs)("div",{className:"flex gap-2",children:[z,$]})]}),ep[102]=z,ep[103]=$,ep[104]=q):q=ep[104],ep[105]!==ev||ep[106]!==eb||ep[107]!==ef.isMelee?(B=!eb&&(0,w.jsxs)("div",{className:"flex items-center gap-2 mt-4",children:[(0,w.jsx)("input",{type:"checkbox",checked:ef.isMelee,onChange:e=>ev("isMelee",e.target.checked),className:"w-4 h-4 accent-yellow-500"}),(0,w.jsx)("span",{className:"text-sm text-gray-300",children:"Unit de Mle"})]}),ep[105]=ev,ep[106]=eb,ep[107]=ef.isMelee,ep[108]=B):B=ep[108],ep[109]===Symbol.for("react.memo_cache_sentinel")?(H=(0,w.jsx)("label",{className:"text-xs text-gray-500 block mb-2",children:"Factions Disponibles"}),ep[109]=H):H=ep[109],ep[110]!==ev||ep[111]!==ef.availableFactions?(G=hl.map(e=>(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("input",{type:"checkbox",checked:(ef.availableFactions||[]).includes(e.id),onChange:t=>{let r=ef.availableFactions||[];ev("availableFactions",t.target.checked?[...r,e.id]:r.filter(t=>t!==e.id))},className:"w-4 h-4 accent-blue-500"}),(0,w.jsx)("span",{className:"text-sm text-gray-300",children:e.label})]},e.id)),ep[110]=ev,ep[111]=ef.availableFactions,ep[112]=G):G=ep[112],ep[113]!==G?(W=(0,w.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[H,(0,w.jsx)("div",{className:"flex flex-col gap-2",children:G})]}),ep[113]=G,ep[114]=W):W=ep[114],ep[115]!==q||ep[116]!==B||ep[117]!==W?(K=(0,w.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded border border-gray-700 space-y-3",children:[L,q,B,W]}),ep[115]=q,ep[116]=B,ep[117]=W,ep[118]=K):K=ep[118],ep[119]!==S||ep[120]!==O||ep[121]!==K?(X=(0,w.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[S,O,K]}),ep[119]=S,ep[120]=O,ep[121]=K,ep[122]=X):X=ep[122],ep[123]===Symbol.for("react.memo_cache_sentinel")?(Y=(0,w.jsx)("h4",{className:"text-gray-400 font-bold text-xs uppercase border-b border-gray-700 pb-2 mb-3",children:"Traits & Bonus"}),ep[123]=Y):Y=ep[123],ep[124]===Symbol.for("react.memo_cache_sentinel")?(Q=(0,w.jsx)("label",{className:"text-xs text-gray-500 block mb-1",children:"Traits de l'unit"}),ep[124]=Q):Q=ep[124],ep[125]!==ev||ep[126]!==ef.traits?(J=ha.map(e=>(0,w.jsx)("button",{title:ho[e]||e,onClick:()=>{ev("traits",ef.traits.includes(e)?ef.traits.filter(t=>t!==e):[...ef.traits,e])},className:`px-2 py-1 text-xs border rounded uppercase transition-colors ${ef.traits.includes(e)?"bg-indigo-900 border-indigo-500 text-indigo-200":"border-gray-700 text-gray-500 hover:border-gray-500"}`,children:e},e)),ep[125]=ev,ep[126]=ef.traits,ep[127]=J):J=ep[127],ep[128]!==J?(Z=(0,w.jsxs)("div",{className:"mb-4",children:[Q,(0,w.jsx)("div",{className:"flex gap-2 flex-wrap",children:J})]}),ep[128]=J,ep[129]=Z):Z=ep[129],ep[130]===Symbol.for("react.memo_cache_sentinel")?(ee=(0,w.jsx)("label",{className:"text-xs text-gray-500 block mb-1",children:"Bonus de Dgts (Multiplicateur)"}),ep[130]=ee):ee=ep[130],ep[131]!==ew||ep[132]!==ef.bonuses?(et=ha.map(e=>(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsxs)("span",{className:"text-xs text-gray-400 w-24 uppercase",children:["vs ",e]}),(0,w.jsx)("input",{type:"number",value:ef.bonuses?.[e]||1,onChange:t=>ew(e,t.target.value),step:.1,className:"w-20 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm text-white"})]},e)),ep[131]=ew,ep[132]=ef.bonuses,ep[133]=et):et=ep[133],ep[134]!==et?(er=(0,w.jsxs)("div",{children:[ee,(0,w.jsx)("div",{className:"space-y-2",children:et})]}),ep[134]=et,ep[135]=er):er=ep[135],ep[136]!==Z||ep[137]!==er?(es=(0,w.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded border border-gray-700",children:[Y,Z,er]}),ep[136]=Z,ep[137]=er,ep[138]=es):es=ep[138],ep[139]===Symbol.for("react.memo_cache_sentinel")?(en=(0,w.jsx)("h4",{className:"text-gray-400 font-bold text-xs uppercase",children:"Hros & Capacits"}),ep[139]=en):en=ep[139],ep[140]!==ev?(ei=e=>ev("isHero",e.target.checked),ep[140]=ev,ep[141]=ei):ei=ep[141],ep[142]!==ei||ep[143]!==ef.isHero?(ea=(0,w.jsx)("input",{type:"checkbox",checked:ef.isHero,onChange:ei,className:"w-4 h-4 accent-yellow-500"}),ep[142]=ei,ep[143]=ef.isHero,ep[144]=ea):ea=ep[144];let e_=`text-sm font-bold ${ef.isHero?"text-yellow-500":"text-gray-500"}`;return ep[145]!==e_?(eo=(0,w.jsx)("span",{className:e_,children:"HROS"}),ep[145]=e_,ep[146]=eo):eo=ep[146],ep[147]!==ea||ep[148]!==eo?(el=(0,w.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-700 pb-2 mb-3",children:[en,(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[ea,eo]})]}),ep[147]=ea,ep[148]=eo,ep[149]=el):el=ep[149],ep[150]!==ev||ep[151]!==eb||ep[152]!==ey||ep[153]!==ef.ability||ep[154]!==ef.domainId||ep[155]!==ef.isHero||ep[156]!==ef.manaRegen||ep[157]!==ef.maxMana?(ec=ef.isHero&&(0,w.jsxs)("div",{className:"space-y-3 animation-fade-in relative",children:[(0,w.jsx)(hw,{label:"Mana Max",value:ef.maxMana,onChange:e=>ev("maxMana",e)}),(0,w.jsx)(hw,{label:"Rgnration Mana",value:ef.manaRegen||1,onChange:e=>ev("manaRegen",e),step:.1}),ey&&!eb&&(0,w.jsxs)("div",{className:"space-y-2 border-t border-gray-700 pt-2 mt-2",children:[(0,w.jsxs)("label",{className:"text-xs text-purple-400 font-bold uppercase",children:["Domaine de Magie (",ey.length," dispos)"]}),(0,w.jsxs)("select",{value:ef.domainId||"",onChange:e=>ev("domainId",e.target.value),className:"w-full bg-gray-900 border border-purple-900 rounded px-2 py-1.5 text-sm text-white outline-none",children:[(0,w.jsx)("option",{value:"",children:"-- Aucun --"}),ey.map(hv)]})]}),(0,w.jsxs)("div",{className:"space-y-1",children:[(0,w.jsx)("label",{className:"text-xs text-gray-500",children:"Capacit Active Principale"}),(0,w.jsxs)("select",{value:ef.ability,onChange:e=>ev("ability",e.target.value),className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1.5 text-sm text-white outline-none",children:[(0,w.jsx)("option",{value:"",children:"-- Aucune --"}),(0,w.jsx)("optgroup",{label:"Standard",children:(eb?hc:hd).map(hy)}),!eb&&ey&&ey.map(hg)]}),(0,w.jsxs)("p",{className:"text-[9px] text-gray-500 mt-1",children:['* Si un "Domaine" est slectionn, l\'unit reoit automatiquement ',(0,w.jsx)("strong",{children:"tous"})," les pouvoirs actifs de ce domaine. Slectionner une capacit ici permet d'ajouter un pouvoir spcifique hors-domaine."]})]})]}),ep[150]=ev,ep[151]=eb,ep[152]=ey,ep[153]=ef.ability,ep[154]=ef.domainId,ep[155]=ef.isHero,ep[156]=ef.manaRegen,ep[157]=ef.maxMana,ep[158]=ec):ec=ep[158],ep[159]!==el||ep[160]!==ec?(ed=(0,w.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded border border-gray-700",children:[el,ec]}),ep[159]=el,ep[160]=ec,ep[161]=ed):ed=ep[161],ep[162]!==es||ep[163]!==ed?(eu=(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[es,ed]}),ep[162]=es,ep[163]=ed,ep[164]=eu):eu=ep[164],ep[165]!==h||ep[166]!==X||ep[167]!==eu?(eh=(0,w.jsxs)("div",{className:"space-y-6 max-w-4xl mx-auto",children:[h,X,eu]}),ep[165]=h,ep[166]=X,ep[167]=eu,ep[168]=eh):eh=ep[168],eh}function hg(e){return(0,w.jsx)("optgroup",{label:e.label,children:e.talents?.filter(hb).map(hx)},e.id)}function hx(e){return(0,w.jsxs)("option",{value:e.id,children:[" ",e.label]},e.id)}function hb(e){return"active"===e.type||"ultimate"===e.type}function hy(e){return(0,w.jsx)("option",{value:e,children:e},e)}function hv(e){return(0,w.jsx)("option",{value:e.id,children:e.label},e.id)}let hw=e=>{let t,r,s,n,i=(0,_.c)(12),{label:a,value:o,onChange:l,step:c,max:d}=e,u=void 0===c?1:c;i[0]!==a?(t=(0,w.jsx)("label",{className:"text-xs text-gray-500 block",children:a}),i[0]=a,i[1]=t):t=i[1];let h=isNaN(o)?"":o;return i[2]!==l?(r=e=>l(""===e.target.value?0:parseFloat(e.target.value)),i[2]=l,i[3]=r):r=i[3],i[4]!==d||i[5]!==u||i[6]!==h||i[7]!==r?(s=(0,w.jsx)("input",{type:"number",value:h,onChange:r,step:u,max:d,className:"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-yellow-500 outline-none"}),i[4]=d,i[5]=u,i[6]=h,i[7]=r,i[8]=s):s=i[8],i[9]!==t||i[10]!==s?(n=(0,w.jsxs)("div",{className:"space-y-1",children:[t,s]}),i[9]=t,i[10]=s,i[11]=n):n=i[11],n},h_=[{id:"plains",label:"Plaines",color:"#2d5a27"},{id:"desert",label:"Dsert",color:"#e6c288"},{id:"urban",label:"Urbain",color:"#333333"},{id:"snow",label:"Polaire",color:"#e5e7eb"},{id:"volcanic",label:"Volcanique",color:"#2b0a0a"},{id:"forest",label:"Fort",color:"#143316"},{id:"force_nexus",label:"Nexus de Force",color:"#290038"},{id:"industrial",label:"Industriel",color:"#3f3f46"}],hN=[{id:"rock",label:"Rocher",defaultColor:"#555555"},{id:"wall",label:"Mur",defaultColor:"#333333"},{id:"tree",label:"Arbre",defaultColor:"#1e4d2b"},{id:"ruin",label:"Ruine",defaultColor:"#4a4a4a"},{id:"water",label:"Eau",defaultColor:"#3b82f6"},{id:"lava",label:"Lave",defaultColor:"#ef4444"},{id:"crystal",label:"Cristal",defaultColor:"#a855f7"}];function hj(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,j,k,S,C,E,I,T,A,M,R,P,D,O,L,F,U,z,V,$,q,B=(0,_.c)(106),{onClose:H,onSave:G,existingMap:W}=e,K=(0,N.useRef)(null),[X,Y]=(0,N.useState)(W?.name||"Nouvelle Carte"),[Q,J]=(0,N.useState)(W?.terrainType||"plains");B[0]!==W?.obstacles?(t=W?.obstacles||[],B[0]=W?.obstacles,B[1]=t):t=B[1];let[Z,ee]=(0,N.useState)(t);B[2]!==W?.spawnZones?(r=W?.spawnZones||{attacker:{x:450,y:1e3,radius:600},defender:{x:2550,y:1e3,radius:600}},B[2]=W?.spawnZones,B[3]=r):r=B[3];let[et,er]=(0,N.useState)(r);B[4]===Symbol.for("react.memo_cache_sentinel")?(s={x:1500-window.innerWidth/2,y:1e3-window.innerHeight/2,zoom:.6},B[4]=s):s=B[4];let[es,en]=(0,N.useState)(s),[ei,ea]=(0,N.useState)(!1);B[5]===Symbol.for("react.memo_cache_sentinel")?(n={x:0,y:0},B[5]=n):n=B[5];let[eo,el]=(0,N.useState)(n),[ec,ed]=(0,N.useState)("select"),[eu,eh]=(0,N.useState)(null);(0,N.useState)(null),B[6]!==es.x||B[7]!==es.y||B[8]!==es.zoom||B[9]!==Z||B[10]!==eu||B[11]!==et||B[12]!==Q?(i=()=>{let e=K.current;if(!e)return;let t=e.getContext("2d"),r=()=>{e.width=window.innerWidth,e.height=window.innerHeight,t.save(),t.fillStyle="#050505",t.fillRect(0,0,e.width,e.height),t.translate(-es.x*es.zoom,-es.y*es.zoom),t.scale(es.zoom,es.zoom),t.fillStyle=h_.find(e=>e.id===Q)?.color||"#111",t.fillRect(0,0,3e3,2e3),t.strokeStyle="#666",t.lineWidth=10,t.strokeRect(0,0,3e3,2e3),t.strokeStyle="#222",t.lineWidth=2,t.beginPath();for(let e=0;e<=3e3;e+=200)t.moveTo(e,0),t.lineTo(e,2e3);for(let e=0;e<=2e3;e+=200)t.moveTo(0,e),t.lineTo(3e3,e);t.stroke(),Z.forEach((e,r)=>{t.fillStyle=e.color||"#666",eu===r?(t.shadowColor="#00ffff",t.shadowBlur=15,t.strokeStyle="#fff",t.lineWidth=2):t.shadowBlur=0,"rect"===e.shape?(t.fillRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height),eu===r&&t.strokeRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height)):(t.beginPath(),t.arc(e.x,e.y,e.size/2,0,2*Math.PI),t.fill(),eu===r&&t.stroke()),t.shadowBlur=0}),t.strokeStyle="#0088ff",t.lineWidth=5,t.setLineDash([20,10]),t.beginPath(),t.arc(et.attacker.x,et.attacker.y,et.attacker.radius,0,2*Math.PI),t.stroke(),t.setLineDash([]),t.fillStyle="rgba(0,100,255,0.1)",t.fill(),t.fillStyle="#fff",t.font="40px Arial",t.fillText("A",et.attacker.x-10,et.attacker.y+10),t.strokeStyle="#ff4444",t.beginPath(),t.arc(et.defender.x,et.defender.y,et.defender.radius,0,2*Math.PI),t.stroke(),t.fillStyle="rgba(255,50,50,0.1)",t.fill(),t.fillStyle="#fff",t.fillText("D",et.defender.x-10,et.defender.y+10),t.restore(),requestAnimationFrame(r)};r()},B[6]=es.x,B[7]=es.y,B[8]=es.zoom,B[9]=Z,B[10]=eu,B[11]=et,B[12]=Q,B[13]=i):i=B[13],B[14]!==es||B[15]!==Z||B[16]!==eu||B[17]!==et?(a=[es,Z,et,eu],B[14]=es,B[15]=Z,B[16]=eu,B[17]=et,B[18]=a):a=B[18],(0,N.useEffect)(i,a),B[19]!==es.x||B[20]!==es.y||B[21]!==es.zoom?(o=e=>(K.current.getBoundingClientRect(),{x:(e.clientX+es.x*es.zoom)/es.zoom,y:(e.clientY+es.y*es.zoom)/es.zoom}),B[19]=es.x,B[20]=es.y,B[21]=es.zoom,B[22]=o):o=B[22];let ep=o;B[23]!==ep||B[24]!==Z||B[25]!==et||B[26]!==ec?(l=e=>{if(1===e.button||0===e.button&&e.shiftKey){ea(!0),el({x:e.clientX,y:e.clientY});return}let{x:t,y:r}=ep(e);if("select"===ec){let e=null;for(let s=Z.length-1;s>=0;s--){let n=Z[s];if("rect"===n.shape){if(t>n.x-n.width/2&&t<n.x+n.width/2&&r>n.y-n.height/2&&r<n.y+n.height/2){e=s;break}}else{let i=t-n.x,a=r-n.y;if(i*i+a*a<n.size/2*(n.size/2)){e=s;break}}}eh(e)}else if("rect"===ec)ee([...Z,{x:t,y:r,shape:"rect",width:200,height:100,color:"#555",type:"custom_wall"}]),ed("select");else if("circle"===ec)ee([...Z,{x:t,y:r,shape:"circle",size:150,width:150,height:150,color:"#555",type:"custom_rock"}]),ed("select");else if("atk_spawn"===ec)er({...et,attacker:{...et.attacker,x:t,y:r}}),ed("select");else if("def_spawn"===ec)er({...et,defender:{...et.defender,x:t,y:r}}),ed("select");else if("erase"===ec){let e=-1;for(let s=Z.length-1;s>=0;s--){let n=Z[s];if("rect"===n.shape){if(t>n.x-n.width/2&&t<n.x+n.width/2&&r>n.y-n.height/2&&r<n.y+n.height/2){e=s;break}}else{let i=t-n.x,a=r-n.y;if(i*i+a*a<n.size/2*(n.size/2)){e=s;break}}}if(-1!==e){let t=[...Z];t.splice(e,1),ee(t)}}},B[23]=ep,B[24]=Z,B[25]=et,B[26]=ec,B[27]=l):l=B[27];let ef=l;B[28]!==es||B[29]!==ep||B[30]!==ei||B[31]!==eo||B[32]!==Z||B[33]!==eu||B[34]!==ec?(c=e=>{if(ei){let t=(e.clientX-eo.x)/es.zoom,r=(e.clientY-eo.y)/es.zoom;en({...es,x:es.x-t,y:es.y-r}),el({x:e.clientX,y:e.clientY});return}if("select"===ec&&null!==eu&&1===e.buttons){let{x:t,y:r}=ep(e),s=[...Z];s[eu]={...s[eu],x:t,y:r},ee(s)}},B[28]=es,B[29]=ep,B[30]=ei,B[31]=eo,B[32]=Z,B[33]=eu,B[34]=ec,B[35]=c):c=B[35];let em=c;B[36]===Symbol.for("react.memo_cache_sentinel")?(d=()=>{ea(!1)},B[36]=d):d=B[36];let eg=d;B[37]!==es?(u=e=>{e.preventDefault();let t=e.deltaY>0?.9:1.1;en({...es,zoom:Math.max(.2,Math.min(3,es.zoom*t))})},B[37]=es,B[38]=u):u=B[38];let ex=u;B[39]!==W?.id||B[40]!==X||B[41]!==Z||B[42]!==H||B[43]!==G||B[44]!==et||B[45]!==Q?(h=()=>{G({id:W?.id||`map_${Date.now()}`,name:X,width:3e3,height:2e3,obstacles:Z,spawnZones:et,terrainType:Q}),H()},B[39]=W?.id,B[40]=X,B[41]=Z,B[42]=H,B[43]=G,B[44]=et,B[45]=Q,B[46]=h):h=B[46];let eb=h;B[47]===Symbol.for("react.memo_cache_sentinel")?(p=(0,w.jsx)("h2",{className:"text-xl font-bold text-yellow-500",children:"DITEUR DE CARTE"}),B[47]=p):p=B[47],B[48]===Symbol.for("react.memo_cache_sentinel")?(f=e=>Y(e.target.value),B[48]=f):f=B[48],B[49]!==X?(m=(0,w.jsx)("input",{type:"text",value:X,onChange:f,className:"bg-gray-800 border border-gray-600 px-2 py-1 rounded w-32",placeholder:"Nom"}),B[49]=X,B[50]=m):m=B[50],B[51]===Symbol.for("react.memo_cache_sentinel")?(g=e=>J(e.target.value),B[51]=g):g=B[51],B[52]===Symbol.for("react.memo_cache_sentinel")?(x=h_.map(hS),B[52]=x):x=B[52],B[53]!==Q?(b=(0,w.jsx)("select",{value:Q,onChange:g,className:"bg-gray-800 border border-gray-600 px-2 py-1 rounded text-xs ml-2",children:x}),B[53]=Q,B[54]=b):b=B[54],B[55]!==m||B[56]!==b?(y=(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[p,m,b]}),B[55]=m,B[56]=b,B[57]=y):y=B[57],B[58]===Symbol.for("react.memo_cache_sentinel")?(v=()=>ed("select"),B[58]=v):v=B[58];let ey=`px-3 py-1 rounded ${"select"===ec?"bg-blue-600":"hover:bg-gray-700"}`;B[59]!==ey?(j=(0,w.jsx)("button",{onClick:v,className:ey,children:""}),B[59]=ey,B[60]=j):j=B[60],B[61]===Symbol.for("react.memo_cache_sentinel")?(k=()=>ed("rect"),B[61]=k):k=B[61];let ev=`px-3 py-1 rounded ${"rect"===ec?"bg-blue-600":"hover:bg-gray-700"}`;B[62]!==ev?(S=(0,w.jsx)("button",{onClick:k,className:ev,children:" Mur"}),B[62]=ev,B[63]=S):S=B[63],B[64]===Symbol.for("react.memo_cache_sentinel")?(C=()=>ed("circle"),B[64]=C):C=B[64];let ew=`px-3 py-1 rounded ${"circle"===ec?"bg-blue-600":"hover:bg-gray-700"}`;B[65]!==ew?(E=(0,w.jsx)("button",{onClick:C,className:ew,children:" Rocher"}),B[65]=ew,B[66]=E):E=B[66],B[67]===Symbol.for("react.memo_cache_sentinel")?(I=()=>ed("atk_spawn"),B[67]=I):I=B[67];let e_=`px-3 py-1 rounded ${"atk_spawn"===ec?"bg-blue-600":"hover:bg-gray-700"}`;B[68]!==e_?(T=(0,w.jsx)("button",{onClick:I,className:e_,children:" Spawn"}),B[68]=e_,B[69]=T):T=B[69],B[70]===Symbol.for("react.memo_cache_sentinel")?(A=()=>ed("def_spawn"),B[70]=A):A=B[70];let eN=`px-3 py-1 rounded ${"def_spawn"===ec?"bg-blue-600":"hover:bg-gray-700"}`;B[71]!==eN?(M=(0,w.jsx)("button",{onClick:A,className:eN,children:" Spawn"}),B[71]=eN,B[72]=M):M=B[72],B[73]===Symbol.for("react.memo_cache_sentinel")?(R=()=>ed("erase"),B[73]=R):R=B[73];let ej=`px-3 py-1 rounded ${"erase"===ec?"bg-red-600":"hover:bg-gray-700"}`;return B[74]!==ej?(P=(0,w.jsx)("button",{onClick:R,className:ej,children:""}),B[74]=ej,B[75]=P):P=B[75],B[76]!==j||B[77]!==S||B[78]!==E||B[79]!==T||B[80]!==M||B[81]!==P?(D=(0,w.jsxs)("div",{className:"flex gap-2 bg-gray-800 p-1 rounded-lg",children:[j,S,E,T,M,P]}),B[76]=j,B[77]=S,B[78]=E,B[79]=T,B[80]=M,B[81]=P,B[82]=D):D=B[82],B[83]!==H?(O=(0,w.jsx)("button",{onClick:H,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded",children:"Fermer"}),B[83]=H,B[84]=O):O=B[84],B[85]!==eb?(L=(0,w.jsx)("button",{onClick:eb,className:"px-4 py-2 bg-green-700 hover:bg-green-600 rounded font-bold",children:"Sauver"}),B[85]=eb,B[86]=L):L=B[86],B[87]!==O||B[88]!==L?(F=(0,w.jsxs)("div",{className:"flex gap-3",children:[O,L]}),B[87]=O,B[88]=L,B[89]=F):F=B[89],B[90]!==y||B[91]!==D||B[92]!==F?(U=(0,w.jsxs)("div",{className:"absolute top-0 left-0 w-full h-16 bg-gray-900 border-b border-gray-700 flex items-center justify-between px-4 z-50",children:[y,D,F]}),B[90]=y,B[91]=D,B[92]=F,B[93]=U):U=B[93],B[94]!==ef||B[95]!==em||B[96]!==ex?(z=(0,w.jsx)("canvas",{ref:K,onMouseDown:ef,onMouseMove:em,onMouseUp:eg,onWheel:ex,className:"block cursor-crosshair"}),B[94]=ef,B[95]=em,B[96]=ex,B[97]=z):z=B[97],B[98]!==Z||B[99]!==eu?(V=null!==eu&&Z[eu]&&(0,w.jsxs)("div",{className:"absolute top-20 right-4 w-64 bg-gray-900 border border-gray-700 p-4 rounded shadow-xl z-50",children:[(0,w.jsx)("h3",{className:"text-yellow-500 font-bold mb-2 uppercase text-xs border-b border-gray-700 pb-1",children:"Proprits"}),(0,w.jsxs)("div",{className:"space-y-3",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-gray-400 text-[10px] uppercase block mb-1",children:"Type"}),(0,w.jsx)("select",{value:Z[eu].type||"rock",onChange:e=>{let t=e.target.value,r=hN.find(e=>e.id===t)?.defaultColor,s=[...Z];s[eu]={...s[eu],type:t,color:r},ee(s)},className:"w-full bg-black border border-gray-600 text-xs px-2 py-1 rounded text-white",children:hN.map(hk)})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-gray-400 text-[10px] uppercase block mb-1",children:"Couleur"}),(0,w.jsx)("input",{type:"color",value:Z[eu].color||"#555555",onChange:e=>{let t=[...Z];t[eu]={...t[eu],color:e.target.value},ee(t)},className:"w-full h-8 cursor-pointer border border-gray-600 rounded bg-black"})]}),"rect"===Z[eu].shape?(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-gray-400 text-[10px] uppercase block mb-1",children:"Largeur"}),(0,w.jsx)("input",{type:"number",value:Math.round(Z[eu].width),onChange:e=>{let t=[...Z];t[eu]={...t[eu],width:Number(e.target.value)},ee(t)},className:"w-full bg-black border border-gray-600 text-xs px-2 py-1 rounded text-white"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-gray-400 text-[10px] uppercase block mb-1",children:"Hauteur"}),(0,w.jsx)("input",{type:"number",value:Math.round(Z[eu].height),onChange:e=>{let t=[...Z];t[eu]={...t[eu],height:Number(e.target.value)},ee(t)},className:"w-full bg-black border border-gray-600 text-xs px-2 py-1 rounded text-white"})]})]}):(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-gray-400 text-[10px] uppercase block mb-1",children:"Taille"}),(0,w.jsx)("input",{type:"number",value:Math.round(Z[eu].size),onChange:e=>{let t=[...Z];t[eu]={...t[eu],size:Number(e.target.value)},ee(t)},className:"w-full bg-black border border-gray-600 text-xs px-2 py-1 rounded text-white"})]}),(0,w.jsx)("button",{onClick:()=>{let e=[...Z];e.splice(eu,1),ee(e),eh(null)},className:"w-full bg-red-900/50 hover:bg-red-800 text-red-200 border border-red-800 text-xs py-1 uppercase font-bold rounded mt-2",children:"Supprimer"})]})]}),B[98]=Z,B[99]=eu,B[100]=V):V=B[100],B[101]===Symbol.for("react.memo_cache_sentinel")?($=(0,w.jsx)("div",{className:"absolute bottom-4 left-4 bg-black/50 p-2 text-xs text-gray-400 pointer-events-none",children:"Molette: Zoom | Clic Milieu / Shift+Clic: Panoramique"}),B[101]=$):$=B[101],B[102]!==U||B[103]!==z||B[104]!==V?(q=(0,w.jsxs)("div",{className:"fixed inset-0 z-[100] bg-black text-white",children:[U,z,V,$]}),B[102]=U,B[103]=z,B[104]=V,B[105]=q):q=B[105],q}function hk(e){return(0,w.jsx)("option",{value:e.id,children:e.label},e.id)}function hS(e){return(0,w.jsx)("option",{value:e.id,children:e.label},e.id)}let hC={dark:{label:"Ct Obscur",desc:"La voie de la passion, de la domination et de la destruction.",color:"#ef4444",icon:"",talents:[{label:"Corruption",desc:"Draine 20 PV ennemis (Passif)",rank:1,type:"passive"},{label:"Haine",desc:"+10% Dgts Force (Passif)",rank:2,type:"passive"},{label:"clair",desc:"Active: Dgts directs",rank:2,type:"active"},{label:"Siphon",desc:"Vol de vie 10% (Passif)",rank:3,type:"passive"},{label:"Terreur",desc:"Aura: -15 Moral (Passif)",rank:3,type:"passive"},{label:"Tempte",desc:"Active: Dgts Zone",rank:3,type:"active"},{label:"Seigneur Sith",desc:"Ultime: +20% Stats Obscur",rank:4,type:"ultimate"}]},light:{label:"Ct Lumineux",desc:"La voie de la srnit, de la protection et de l'harmonie.",color:"#3b82f6",icon:"",talents:[{label:"Mditation",desc:"Rgnration Mana +10% (Passif)",rank:1,type:"passive"},{label:"Srnit",desc:"Cot Mana -10% (Passif)",rank:2,type:"passive"},{label:"Gurison",desc:"Active: Soin alli",rank:2,type:"active"},{label:"Aura",desc:"Dfense allis +15% (Passif)",rank:3,type:"passive"},{label:"Protection",desc:"Bouclier de Force (Passif)",rank:3,type:"passive"},{label:"Onde Paix",desc:"Active: Repousse ennemis",rank:3,type:"active"},{label:"Avatar Force",desc:"Ultime: Soin de masse",rank:4,type:"ultimate"}]},mandalorian:{label:"Mandalorien",desc:"La voie de l'honneur, de la technologie et de la puissance de feu.",color:"#f59e0b",icon:"",talents:[{label:"Beskar",desc:"Armure +50 (Passif)",rank:1,type:"passive"},{label:"Viseur",desc:"Prcision +15% (Passif)",rank:2,type:"passive"},{label:"Arsenal",desc:"Active: Missiles",rank:2,type:"active"},{label:"Bouclier",desc:"Rsist. Explosifs 25% (Passif)",rank:3,type:"passive"},{label:"Jetpack",desc:"Mobilit Arienne (Passif)",rank:3,type:"passive"},{label:"Pyro",desc:"Active: Lance-flammes",rank:3,type:"active"},{label:"Mand'alor",desc:"Ultime: Appel Renforts",rank:4,type:"ultimate"}]}},hE={infantry:{label:"Infanterie Standard",desc:"Unit de base polyvalente.",stats:{hp:15,dmg:3,range:80,speed:1.5,type:"Bio"}},heavy_infantry:{label:"Infanterie Lourde",desc:"Unit d'lite avec armure lourde.",stats:{hp:40,dmg:10,range:120,speed:1,type:"Bio/Mca"}},vehicle:{label:"Blind Lger",desc:"Vhicule de soutien rapide.",stats:{hp:120,dmg:35,range:200,speed:2.5,type:"Mca"}},turret:{label:"Tourelle Dfensive",desc:"Structure statique  haute puissance de feu.",stats:{hp:250,dmg:40,range:300,speed:0,type:"Structure"}},jedi_general:{label:"Gnral Jedi",desc:"Hros commandant utilisant la Force Lumineuse.",stats:{hp:450,dmg:60,range:40,speed:2.2,type:"Hros"}},sith_lord:{label:"Seigneur Sith",desc:"Hros commandant utilisant le Ct Obscur.",stats:{hp:450,dmg:70,range:40,speed:2.2,type:"Hros"}},mandalorian_commander:{label:"Commandant Mandalorien",desc:"Hros tacticien quip de gadgets avancs.",stats:{hp:400,dmg:50,range:100,speed:2,type:"Hros"}}},hI={economic:"conomie",military:"Militaire",orbital:"Orbital",force:"Ordre & Culte",unique:"Merveille",unknown:"Autre"};function hT(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,j=(0,_.c)(98),{onClose:k,userFaction:S,magicDomains:C,buildingsTemplates:E}=e;j[0]!==E?(t=void 0===E?[]:E,j[0]=E,j[1]=t):t=j[1];let I=t,[T,A]=(0,N.useState)("units"),[M,R]=(0,N.useState)(null),[P,D]=(0,N.useState)(""),[O,L]=(0,N.useState)("name"),[F,U]=(0,N.useState)("asc");s:{let e;if("empire"===S){let e;j[2]===Symbol.for("react.memo_cache_sentinel")?(e={primary:"text-red-500",border:"border-red-500",shadow:"shadow-red-500/20",bg_gradient:"from-red-900/40",accent:"#ef4444"},j[2]=e):e=j[2],r=e;break s}if("republic"===S){let e;j[3]===Symbol.for("react.memo_cache_sentinel")?(e={primary:"text-blue-500",border:"border-blue-500",shadow:"shadow-blue-500/20",bg_gradient:"from-blue-900/40",accent:"#3b82f6"},j[3]=e):e=j[3],r=e;break s}j[4]===Symbol.for("react.memo_cache_sentinel")?(e={primary:"text-cyan-400",border:"border-cyan-500",shadow:"shadow-cyan-500/20",bg_gradient:"from-cyan-900/40",accent:"#22d3ee"},j[4]=e):e=j[4],r=e}let z=r;if(j[5]!==I||j[6]!==C||j[7]!==k||j[8]!==P||j[9]!==M?.id||j[10]!==O||j[11]!==F||j[12]!==T||j[13]!==z.accent||j[14]!==z.bg_gradient||j[15]!==z.border||j[16]!==z.primary||j[17]!==z.shadow){let e,t,r,p,f,m,g,x,b,y,v,_,N,S,E,V,$,q,B,H=[...Object.values(hC).map(hL),...C||[]];j[28]!==O||j[29]!==F?(e=(e,t)=>[...e].sort((e,r)=>{let s,n;return"name"===O?(s=("unit"===t?e[1].label:"magic"===t?e.label:e.name)||"",n=("unit"===t?r[1].label:"magic"===t?r.label:r.name)||"","asc"===F?s.localeCompare(n):n.localeCompare(s)):("cost"===O&&(s="building"===t&&e.cost||0,n="building"===t&&r.cost||0),"power"===O&&(s="unit"===t&&e[1].stats?.dmg||0,n="unit"===t&&r[1].stats?.dmg||0),"asc"===F?s-n:n-s)}),j[28]=O,j[29]=F,j[30]=e):e=j[30];let G=e,W=G(Object.entries(hE).filter(e=>{let[,t]=e;return t.label.toLowerCase().includes(P.toLowerCase())}),"unit"),K=G(H.filter(e=>e.label.toLowerCase().includes(P.toLowerCase())),"magic"),X=I.filter(e=>(e.name||"").toLowerCase().includes(P.toLowerCase()));X.sort((e,t)=>"name"===O?"asc"===F?(e.name||"").localeCompare(t.name||""):(t.name||"").localeCompare(e.name||""):"cost"===O?"asc"===F?(e.cost||0)-(t.cost||0):(t.cost||0)-(e.cost||0):0);let Y={};X.forEach(e=>{let t=e.category||"unknown";Y[t]||(Y[t]=[]),Y[t].push(e)}),a="fixed inset-0 z-[120] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-300 font-sans p-8 perspective-1000",h=`w-[1200px] h-[800px] bg-[#050508] border border-opacity-50 flex flex-col relative overflow-hidden rounded-xl shadow-2xl ${z.border} ${z.shadow}`,j[31]===Symbol.for("react.memo_cache_sentinel")?(s=(0,w.jsx)("div",{className:"absolute inset-0 z-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,3px_100%] pointer-events-none opacity-20"}),n=(0,w.jsx)("div",{className:"absolute inset-0 z-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10 pointer-events-none mix-blend-screen"}),j[31]=s,j[32]=n):(s=j[31],n=j[32]);let Q=`w-16 h-16 rounded-lg ${z.border} border-2 flex items-center justify-center bg-black/50 shadow-[0_0_15px_rgba(0,0,0,0.5)]`;j[33]===Symbol.for("react.memo_cache_sentinel")?(t=(0,w.jsx)("span",{className:"text-4xl filter drop-shadow-[0_0_5px_rgba(255,255,255,0.5)]",children:""}),j[33]=t):t=j[33],j[34]!==Q?(r=(0,w.jsx)("div",{className:Q,children:t}),j[34]=Q,j[35]=r):r=j[35];let J=`text-4xl font-bold uppercase tracking-widest ${z.primary} drop-shadow-md`;j[36]!==J?(p=(0,w.jsx)("h2",{className:J,children:"Archives"}),j[36]=J,j[37]=p):p=j[37],j[38]===Symbol.for("react.memo_cache_sentinel")?(f=(0,w.jsxs)("div",{className:"flex items-center gap-2 text-xs font-mono text-gray-400 mt-1",children:[(0,w.jsx)("span",{className:"animate-pulse",children:""}),(0,w.jsx)("span",{children:"CONNEXION SCURISE TABLIE"}),(0,w.jsx)("span",{className:"text-gray-600",children:"|"}),(0,w.jsx)("span",{children:"ACCS NIVEAU 5"})]}),j[38]=f):f=j[38],j[39]!==p?(m=(0,w.jsxs)("div",{children:[p,f]}),j[39]=p,j[40]=m):m=j[40],j[41]!==r||j[42]!==m?(g=(0,w.jsxs)("div",{className:"flex items-center gap-6",children:[r,m]}),j[41]=r,j[42]=m,j[43]=g):g=j[43],j[44]===Symbol.for("react.memo_cache_sentinel")?(x=e=>D(e.target.value),j[44]=x):x=j[44];let Z=`bg-black/40 border border-gray-700 text-gray-300 text-[10px] rounded px-3 py-1 w-40 focus:outline-none focus:border-${z.accent} transition-all uppercase font-mono tracking-wider`;j[45]!==P||j[46]!==Z?(b=(0,w.jsx)("div",{className:"relative group",children:(0,w.jsx)("input",{type:"text",placeholder:"Rechercher...",value:P,onChange:x,className:Z})}),j[45]=P,j[46]=Z,j[47]=b):b=j[47],j[48]===Symbol.for("react.memo_cache_sentinel")?(y=e=>L(e.target.value),j[48]=y):y=j[48],j[49]===Symbol.for("react.memo_cache_sentinel")?(v=(0,w.jsx)("option",{value:"name",children:"Nom"}),_=(0,w.jsx)("option",{value:"cost",children:"Cot"}),j[49]=v,j[50]=_):(v=j[49],_=j[50]),j[51]!==T?(N="units"===T&&(0,w.jsx)("option",{value:"power",children:"Puissance"}),j[51]=T,j[52]=N):N=j[52],j[53]!==O||j[54]!==N?(S=(0,w.jsxs)("select",{value:O,onChange:y,className:"bg-black/40 border border-gray-700 text-gray-300 text-[10px] rounded px-2 py-1 focus:outline-none uppercase font-mono",children:[v,_,N]}),j[53]=O,j[54]=N,j[55]=S):S=j[55],j[56]===Symbol.for("react.memo_cache_sentinel")?(E=()=>U(hO),j[56]=E):E=j[56];let ee="asc"===F?"":"";j[57]!==ee?(V=(0,w.jsx)("button",{onClick:E,className:"bg-black/40 border border-gray-700 text-gray-300 w-6 h-6 flex items-center justify-center rounded hover:bg-white/10",children:ee}),j[57]=ee,j[58]=V):V=j[58],j[59]!==k?($=(0,w.jsx)("button",{onClick:k,className:"w-8 h-8 rounded-full border border-gray-700 hover:bg-red-900/30 hover:border-red-500 text-gray-400 hover:text-red-400 flex items-center justify-center transition-all duration-300 ml-2",children:""}),j[59]=k,j[60]=$):$=j[60],j[61]!==b||j[62]!==S||j[63]!==V||j[64]!==$?(q=(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[b,S,V,$]}),j[61]=b,j[62]=S,j[63]=V,j[64]=$,j[65]=q):q=j[65],j[66]!==g||j[67]!==q?(i=(0,w.jsxs)("div",{className:"relative z-10 bg-black/60 border-b border-gray-800 p-6 flex justify-between items-center backdrop-blur-md",children:[g,q]}),j[66]=g,j[67]=q,j[68]=i):i=j[68],u="flex-grow flex relative z-10 overflow-hidden",c="w-80 bg-black/40 border-r border-gray-800/50 flex flex-col backdrop-blur-sm",j[69]===Symbol.for("react.memo_cache_sentinel")?(B=[{id:"units",icon:"",label:"Units"},{id:"buildings",icon:"",label:"Btiments"},{id:"magic",icon:"",label:"Force & Tech"}],j[69]=B):B=j[69],j[70]!==T||j[71]!==z.border?(d=(0,w.jsx)("div",{className:"flex p-2 gap-2 bg-black/40",children:B.map(e=>(0,w.jsxs)("button",{onClick:()=>{A(e.id),R(null),D("")},className:`flex-1 flex flex-col items-center justify-center p-3 rounded transition-all duration-300 border border-transparent
                                        ${T===e.id?`bg-gray-800 ${z.border} text-white shadow-[inset_0_0_10px_rgba(0,0,0,0.5)]`:"bg-transparent hover:bg-gray-800/50 text-gray-500"}`,children:[(0,w.jsx)("span",{className:"text-xl mb-1 dark:drop-shadow-[0_0_5px_rgba(255,255,255,0.3)]",children:e.icon}),(0,w.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:e.label})]},e.id))}),j[70]=T,j[71]=z.border,j[72]=d):d=j[72],o="flex-grow overflow-y-auto custom-scrollbar p-3 space-y-2",l="units"===T?W.map(e=>{let[t,r]=e;return(0,w.jsx)("div",{onClick:()=>R({id:t,...r}),className:`p-3 rounded border border-l-4 cursor-pointer transition-all group relative overflow-hidden
                                            ${M?.id===t?`bg-gradient-to-r ${z.bg_gradient} to-transparent ${z.border} text-white border-l-current`:"bg-[#121212] border-gray-800 border-l-gray-700 text-gray-400 hover:bg-gray-800 hover:text-gray-200"}`,children:(0,w.jsxs)("div",{className:"flex justify-between items-center relative z-10",children:[(0,w.jsx)("span",{className:"font-bold text-sm tracking-wide",children:r.label}),(0,w.jsx)("span",{className:"text-[10px] bg-black/50 px-2 py-0.5 rounded border border-gray-700 font-mono",children:r.stats.type})]})},t)}):"buildings"===T?Object.entries(Y).map(e=>{let[t,r]=e;return(0,w.jsxs)("div",{className:"mb-4",children:[(0,w.jsx)("div",{className:"text-[10px] uppercase font-bold text-gray-500 mb-2 pl-2 border-b border-gray-800 pb-1 sticky top-0 bg-[#050508] z-20",children:hI[t]||t}),r.map(e=>(0,w.jsx)("div",{onClick:()=>R({...e,type:"building"}),className:`p-3 mb-1 rounded border border-l-4 cursor-pointer transition-all group relative overflow-hidden
                                                    ${M?.id===e.id?`bg-gradient-to-r ${z.bg_gradient} to-transparent ${z.border} text-white border-l-current`:"bg-[#121212] border-gray-800 border-l-gray-700 text-gray-400 hover:bg-gray-800 hover:text-gray-200"}`,children:(0,w.jsxs)("div",{className:"flex justify-between items-center relative z-10",children:[(0,w.jsx)("span",{className:"font-bold text-sm tracking-wide",children:e.name}),(0,w.jsxs)("span",{className:"text-[10px] bg-black/50 px-2 py-0.5 rounded border border-gray-700 font-mono",children:["NIV ",e.level||1]})]})},e.id))]},t)}):K.map(e=>(0,w.jsxs)("div",{onClick:()=>R({...e,type:"domain"}),className:`p-3 rounded border border-l-4 cursor-pointer transition-all group relative overflow-hidden
                                            ${M?.id===e.id?`bg-gradient-to-r from-[${e.color}]/10 to-transparent border-[${e.color}] text-white`:"bg-[#121212] border-gray-800 text-gray-400 hover:bg-gray-800 hover:text-gray-200"}`,style:M?.id===e.id?{borderColor:e.color,backgroundColor:`${e.color}11`}:{borderLeftColor:e.color},children:[(0,w.jsxs)("div",{className:"flex justify-between items-center relative z-10",children:[(0,w.jsx)("span",{className:"font-bold text-sm tracking-wide",style:{color:e.color},children:e.label}),(0,w.jsx)("span",{className:"text-xs",children:e.icon})]}),(0,w.jsxs)("div",{className:"relative z-10 text-[10px] text-gray-600 uppercase mt-1 truncate",children:[e.talents?.length||0," Pouvoirs disponibles"]})]},e.id)),j[5]=I,j[6]=C,j[7]=k,j[8]=P,j[9]=M?.id,j[10]=O,j[11]=F,j[12]=T,j[13]=z.accent,j[14]=z.bg_gradient,j[15]=z.border,j[16]=z.primary,j[17]=z.shadow,j[18]=s,j[19]=n,j[20]=i,j[21]=a,j[22]=o,j[23]=l,j[24]=c,j[25]=d,j[26]=u,j[27]=h}else s=j[18],n=j[19],i=j[20],a=j[21],o=j[22],l=j[23],c=j[24],d=j[25],u=j[26],h=j[27];return j[73]!==o||j[74]!==l?(p=(0,w.jsx)("div",{className:o,children:l}),j[73]=o,j[74]=l,j[75]=p):p=j[75],j[76]!==p||j[77]!==c||j[78]!==d?(f=(0,w.jsxs)("div",{className:c,children:[d,p]}),j[76]=p,j[77]=c,j[78]=d,j[79]=f):f=j[79],j[80]===Symbol.for("react.memo_cache_sentinel")?(m=(0,w.jsx)("div",{className:"absolute inset-0 z-0 bg-[linear-gradient(rgba(255,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:40px_40px] opacity-20 pointer-events-none"}),j[80]=m):m=j[80],j[81]!==I||j[82]!==M?(g=(0,w.jsxs)("div",{className:"flex-grow p-8 bg-black/60 relative overflow-hidden flex flex-col",children:[m,M?(0,w.jsx)("div",{className:"relative z-10 animate-in slide-in-from-bottom-4 duration-500 flex flex-col h-full",children:"domain"===M.type?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:"flex items-end gap-4 mb-4 border-b border-gray-800 pb-4",children:[(0,w.jsx)("div",{className:"w-20 h-20 rounded-lg flex items-center justify-center border-2 bg-black/50 shadow-lg text-5xl",style:{borderColor:M.color,color:M.color},children:M.icon||""}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-4xl font-bold uppercase tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-400",style:{textShadow:`0 0 20px ${M.color}`},children:M.label}),(0,w.jsx)("p",{className:"text-gray-400 font-mono text-sm max-w-2xl mt-1",children:M.desc})]})]}),(0,w.jsxs)("div",{className:"flex-grow overflow-y-auto custom-scrollbar pr-2 mt-4",children:[(0,w.jsxs)("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-[0.2em] mb-4 flex items-center gap-2",children:[(0,w.jsx)("span",{className:"bg-gray-700 w-8 h-[1px]"}),"Arbre de Talents",(0,w.jsx)("span",{className:"bg-gray-700 flex-grow h-[1px]"})]}),(0,w.jsx)("div",{className:"grid grid-cols-2 gap-4",children:M.talents.map((e,t)=>(0,w.jsxs)("div",{className:"relative group bg-gray-900/50 border border-gray-800 p-4 rounded hover:border-gray-500 hover:bg-gray-800/80 transition-all flex gap-4 overflow-hidden",children:[(0,w.jsx)("div",{className:"absolute top-0 right-0 p-1",children:(0,w.jsx)("div",{className:`text-[8px] font-bold uppercase px-2 py-0.5 rounded border ${"passive"===e.type?"border-gray-600 text-gray-500":"ultimate"===e.type?"border-yellow-600 text-yellow-500":"border-blue-600 text-blue-500"}`,children:e.type||"Inconnu"})}),(0,w.jsxs)("div",{className:"flex flex-col items-center justify-center w-12 h-12 rounded border bg-black shrink-0 relative z-10",style:{borderColor:M.color},children:[(0,w.jsx)("span",{className:"text-lg font-bold text-white",children:e.rank}),(0,w.jsx)("span",{className:"text-[8px] text-gray-500 uppercase",children:"Rang"})]}),(0,w.jsxs)("div",{className:"relative z-10",children:[(0,w.jsx)("div",{className:"font-bold text-gray-200 uppercase tracking-wide group-hover:text-white transition-colors",children:e.label}),(0,w.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:e.desc})]}),(0,w.jsx)("div",{className:"absolute bottom-0 right-0 w-16 h-16 bg-gradient-to-tl from-white/5 to-transparent rounded-tl-full opacity-0 group-hover:opacity-100 transition-opacity"})]},t))})]})]}):"building"===M.type?(0,w.jsxs)("div",{className:"flex flex-col h-full animate-in fade-in duration-300",children:[(0,w.jsxs)("div",{className:"flex justify-between items-start border-b border-gray-800 pb-6 mb-6",children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{className:"text-[10px] font-mono text-[#cba660] mb-1 flex items-center gap-2",children:[(0,w.jsx)("span",{className:"animate-pulse",children:""}),"INFRASTRUCTURE C.E.O."]}),(0,w.jsxs)("h3",{className:"text-4xl font-bold uppercase tracking-tight text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]",children:[M.name,M.parentName&&(0,w.jsxs)("span",{className:"text-gray-500 text-2xl ml-4",children:["(",M.parentName,")"]})]}),(0,w.jsxs)("div",{className:"flex gap-2 mt-3",children:[M.parentName&&(0,w.jsx)("button",{onClick:e=>{e.stopPropagation();let t=I.find(e=>e.id===M.parentId);t&&R({...t,type:"building"})},className:"px-2 py-1 bg-red-900/40 text-red-300 rounded text-[10px] font-bold border border-red-700 uppercase hover:bg-red-900/60",children:"< Retour Niveau 1"}),(0,w.jsx)("span",{className:"px-2 py-1 bg-gray-800 rounded text-[10px] font-bold text-gray-400 border border-gray-700 uppercase",children:M.category||"Gnral"}),(0,w.jsxs)("span",{className:"px-2 py-1 bg-gray-800 rounded text-[10px] font-bold text-yellow-500 border border-gray-700 uppercase",children:["Cot: ",M.cost||0," CR"]}),M.level&&(0,w.jsxs)("span",{className:"px-2 py-1 bg-gray-800 rounded text-[10px] font-bold text-green-400 border border-gray-700 uppercase",children:["Niveau ",M.level]})]})]}),(0,w.jsx)("div",{className:"w-32 h-32 border border-gray-700 rounded bg-black/50 flex items-center justify-center relative overflow-hidden",children:(0,w.jsx)("span",{className:"text-6xl opacity-50",children:""})})]}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,w.jsxs)("div",{className:"bg-black/40 p-6 rounded border border-gray-800 relative overflow-hidden",children:[(0,w.jsx)("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest mb-4 relative z-10",children:"Production / Tour"}),(0,w.jsxs)("div",{className:"space-y-2 relative z-10",children:[M.production&&Object.entries(M.production).map(hD),(!M.production||Object.values(M.production).every(hP))&&(0,w.jsx)("span",{className:"text-gray-600 italic text-xs",children:"Aucun rendement conomique direct."})]})]}),(0,w.jsxs)("div",{className:"space-y-4",children:[M.unlocks_units&&M.unlocks_units.length>0&&(0,w.jsxs)("div",{className:"bg-blue-950/20 p-4 rounded border border-blue-900/50",children:[(0,w.jsx)("h4",{className:"text-xs font-bold text-blue-400 uppercase tracking-widest mb-2",children:"Dbloque Units"}),(0,w.jsx)("div",{className:"flex flex-wrap gap-2",children:M.unlocks_units.map(hR)})]}),M.upgrades&&M.upgrades.length>0&&(0,w.jsxs)("div",{className:"bg-purple-950/20 p-4 rounded border border-purple-900/50",children:[(0,w.jsx)("h4",{className:"text-xs font-bold text-purple-400 uppercase tracking-widest mb-3",children:"Arbre Tech"}),(0,w.jsx)("div",{className:"space-y-3",children:M.upgrades.map((e,t)=>(0,w.jsxs)("button",{onClick:()=>R({...e,type:"building",category:M.category,level:t+2,parentName:M.name,parentId:M.id}),className:"flex flex-col gap-1 bg-black/40 p-2 rounded border border-gray-700 w-full text-left hover:bg-white/5 hover:border-gray-500 transition-colors",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,w.jsx)("span",{className:"text-gray-200 text-xs font-bold uppercase",children:e.name||`Niveau ${t+2}`}),(0,w.jsxs)("span",{className:"text-[9px] text-gray-500 font-mono",children:["T",t+2]})]}),(0,w.jsxs)("div",{className:"flex gap-2 mt-1 w-full flex-wrap",children:[e.production&&Object.entries(e.production).map(hM),(0,w.jsxs)("span",{className:"text-[8px] text-yellow-500 ml-auto",children:[e.cost," CR"]})]})]},t))})]})]})]})]}):(0,w.jsxs)("div",{className:"flex flex-col h-full",children:[(0,w.jsxs)("div",{className:"flex justify-between items-start border-b border-gray-800 pb-6 mb-6",children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{className:"text-[10px] font-mono text-cyan-500 mb-1 flex items-center gap-2",children:[(0,w.jsx)("span",{className:"animate-spin duration-[3000ms]",children:""}),"UNIT IDENTIFIE"]}),(0,w.jsx)("h3",{className:"text-5xl font-bold uppercase tracking-tight text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]",children:M.label}),(0,w.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,w.jsx)("span",{className:"px-2 py-1 bg-gray-800 rounded text-[10px] font-bold text-gray-400 border border-gray-700 uppercase",children:M.stats.type}),(0,w.jsxs)("span",{className:"px-2 py-1 bg-gray-800 rounded text-[10px] font-bold text-gray-400 border border-gray-700 uppercase",children:["Taille: ",M.stats.size||"Moyenne"]})]})]}),(0,w.jsxs)("div",{className:"w-32 h-32 border border-gray-700 rounded bg-black/50 flex items-center justify-center relative overflow-hidden group",children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(0deg,transparent_0%,rgba(0,255,0,0.2)_50%,transparent_100%)] bg-[length:100%_200%] animate-scanline opacity-20"}),(0,w.jsx)("span",{className:"text-6xl opacity-50 text-gray-600 group-hover:scale-110 transition-transform duration-500",children:""})]})]}),(0,w.jsxs)("p",{className:"text-lg text-gray-300 mb-8 font-light italic border-l-2 border-gray-700 pl-4 py-2 bg-gradient-to-r from-gray-900/50 to-transparent",children:['"',M.desc,'"']}),(0,w.jsx)("div",{className:"grid grid-cols-2 gap-x-8 gap-y-6 bg-black/20 p-6 rounded-lg border border-gray-800/50",children:[{label:"Durabilit (HP)",val:M.stats.hp,max:500,color:"bg-green-500"},{label:"Puissance de Feu",val:M.stats.dmg,max:100,color:"bg-red-500"},{label:"Porte Effective",val:M.stats.range,max:300,color:"bg-yellow-500"},{label:"Vitesse Tactique",val:M.stats.speed,max:3,color:"bg-cyan-500"}].map(hA)})]})}):(0,w.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-600 opacity-40 select-none",children:[(0,w.jsx)("div",{className:"w-32 h-32 border-4 border-dashed border-gray-700 rounded-full flex items-center justify-center mb-4 animate-[spin_10s_linear_infinite]",children:(0,w.jsx)("span",{className:"text-6xl animate-pulse",children:""})}),(0,w.jsx)("span",{className:"uppercase tracking-[0.3em] font-bold text-xl",children:"En attente de donnes"}),(0,w.jsx)("span",{className:"text-xs font-mono mt-2 text-gray-500",children:"SLECTIONNEZ UN SUJET DANS L'INDEX"})]})]}),j[81]=I,j[82]=M,j[83]=g):g=j[83],j[84]!==f||j[85]!==g||j[86]!==u?(x=(0,w.jsxs)("div",{className:u,children:[f,g]}),j[84]=f,j[85]=g,j[86]=u,j[87]=x):x=j[87],j[88]===Symbol.for("react.memo_cache_sentinel")?(b=(0,w.jsx)("div",{className:"h-2 bg-gradient-to-r from-transparent via-gray-700 to-transparent opacity-50"}),j[88]=b):b=j[88],j[89]!==s||j[90]!==n||j[91]!==i||j[92]!==x||j[93]!==h?(y=(0,w.jsxs)("div",{className:h,children:[s,n,i,x,b]}),j[89]=s,j[90]=n,j[91]=i,j[92]=x,j[93]=h,j[94]=y):y=j[94],j[95]!==a||j[96]!==y?(v=(0,w.jsx)("div",{className:a,children:y}),j[95]=a,j[96]=y,j[97]=v):v=j[97],v}function hA(e,t){return(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{className:"flex justify-between text-xs uppercase font-bold text-gray-500 mb-1",children:[(0,w.jsx)("span",{children:e.label}),(0,w.jsx)("span",{className:"text-white font-mono",children:e.val})]}),(0,w.jsx)("div",{className:"h-2 w-full bg-gray-800 rounded-full overflow-hidden border border-gray-700/50",children:(0,w.jsx)("div",{className:`h-full ${e.color} shadow-[0_0_10px_currentColor] relative`,style:{width:`${Math.min(100,e.val/e.max*100)}%`},children:(0,w.jsx)("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})})})]},t)}function hM(e){let[t,r]=e;return r>0&&(0,w.jsxs)("span",{className:"text-[8px] text-green-400 bg-green-900/20 px-1 rounded border border-green-900/30",children:["+",r," ",t.substr(0,3)]},t)}function hR(e){return(0,w.jsx)("span",{className:"px-3 py-1 bg-blue-900/40 text-blue-200 border border-blue-700/50 rounded text-[10px] uppercase font-bold",children:e},e)}function hP(e){return 0===e}function hD(e){let[t,r]=e;return 0!==r&&(0,w.jsxs)("div",{className:"flex justify-between items-center border-b border-gray-800 pb-1",children:[(0,w.jsx)("span",{className:"text-gray-400 uppercase text-[10px] font-bold",children:t}),(0,w.jsxs)("span",{className:`font-mono font-bold ${r>0?"text-green-400":"text-red-400"}`,children:[r>0?"+":"",r]})]},t)}function hO(e){return"asc"===e?"desc":"asc"}function hL(e,t){return{...e,id:`base_${t}`}}let hF="undefined"!=typeof document?document.createElement("style"):null;hF&&(hF.innerHTML=`
  @keyframes scanline {
    0% { background-position: 0% 0%; }
    100% { background-position: 0% 100%; }
  }
  .animate-scanline {
    animation: scanline 2s linear infinite;
  }
`,"undefined"!=typeof document&&document.head.appendChild(hF));let hU=[{id:"projectile",label:"Projectile (Tir)",params:["damage","range","speed","color","sprite"]},{id:"explosion",label:"Explosion (Zone)",params:["damage","range","radius","color"]},{id:"beam",label:"Rayon (Laser/Eclair)",params:["damage","range","color"]},{id:"heal",label:"Soin (Zone)",params:["amount","radius","range"]},{id:"buff",label:"Buff (Stats)",params:["stat","amount","duration"]},{id:"summon",label:"Invocation",params:["unitId","count","duration"]},{id:"dash",label:"Mouvement (Saut/Dash)",params:["range","speed"]}];function hz(e){let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x=(0,_.c)(36),{onClose:b}=e;x[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],x[0]=t):t=x[0];let[y,v]=(0,N.useState)(t),[j,k]=(0,N.useState)(null),[S,C]=(0,N.useState)(null);x[1]!==j?(r=()=>{let e=oQ(aY(dY,"magic_domains"),e=>{let t=e.docs.map(hB);if(v(t),j){let e=t.find(e=>e.id===j.id);e&&k(e)}});return()=>e()},x[1]=j,x[2]=r):r=x[2];let E=j?.id;x[3]!==E?(s=[E],x[3]=E,x[4]=s):s=x[4],(0,N.useEffect)(r,s);let I=h$;x[5]===Symbol.for("react.memo_cache_sentinel")?(n=async e=>{confirm("Supprimer ce domaine ?")&&(await oX(aJ(dY,"magic_domains",e)),k(null))},x[5]=n):n=x[5];let T=n;x[6]!==j?(i=async e=>{if(!j)return;let t=[...j.talents||[]];if(e.isNew){let{isNew:r,...s}=e;t.push({...s,id:`t_${Date.now()}`})}else{let r=t.findIndex(t=>t.id===e.id);r>=0&&(t[r]=e)}await I(j.id,{talents:t}),C(null)},x[6]=j,x[7]=i):i=x[7];let A=i;x[8]!==j?(a=async e=>{if(!j)return;let t=j.talents.filter(t=>t.id!==e);await I(j.id,{talents:t})},x[8]=j,x[9]=a):a=x[9];let M=a;if(x[10]===Symbol.for("react.memo_cache_sentinel")?(o=(0,w.jsx)("h2",{className:"text-xl font-bold text-purple-400 uppercase tracking-widest mb-4",children:"Domaines"}),x[10]=o):o=x[10],x[11]!==y||x[12]!==j?.id){let e;x[14]!==j?.id?(e=e=>(0,w.jsxs)("div",{onClick:()=>k(e),className:`p-3 border rounded cursor-pointer transition ${j?.id===e.id?"bg-purple-900/30 border-purple-500":"bg-gray-800 border-gray-700 hover:border-gray-500"}`,children:[(0,w.jsxs)("div",{className:"font-bold flex items-center gap-2",children:[(0,w.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),e.label]}),(0,w.jsxs)("div",{className:"text-[10px] text-gray-400 truncate",children:[e.talents?.length||0," Pouvoirs"]})]},e.id),x[14]=j?.id,x[15]=e):e=x[15],l=y.map(e),x[11]=y,x[12]=j?.id,x[13]=l}else l=x[13];return x[16]!==l?(c=(0,w.jsx)("div",{className:"overflow-y-auto flex-grow space-y-2",children:l}),x[16]=l,x[17]=c):c=x[17],x[18]===Symbol.for("react.memo_cache_sentinel")?(d=(0,w.jsx)("button",{onClick:hq,className:"w-full py-2 bg-purple-700 hover:bg-purple-600 font-bold uppercase text-xs rounded",children:"+ Nouveau Domaine"}),x[18]=d):d=x[18],x[19]!==b?(u=(0,w.jsx)("button",{onClick:b,className:"mt-2 w-full py-2 border border-gray-600 hover:bg-gray-800 text-gray-400 font-bold uppercase text-xs rounded",children:"Fermer"}),x[19]=b,x[20]=u):u=x[20],x[21]!==c||x[22]!==u?(h=(0,w.jsxs)("div",{className:"w-1/4 bg-black/50 border-r border-gray-800 p-4 flex flex-col gap-2",children:[o,c,d,u]}),x[21]=c,x[22]=u,x[23]=h):h=x[23],x[24]!==M||x[25]!==j?(p=(0,w.jsx)("div",{className:"flex-grow p-6 flex flex-col bg-[#111] overflow-y-auto",children:j?(0,w.jsxs)("div",{className:"space-y-6",children:[(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-4 border-b border-gray-800 pb-6",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-xs uppercase text-gray-500 block mb-1",children:"Nom du Domaine"}),(0,w.jsx)("input",{value:j.label,onChange:e=>I(j.id,{label:e.target.value}),className:"w-full bg-black border border-gray-700 p-2 text-white"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-xs uppercase text-gray-500 block mb-1",children:"Couleur"}),(0,w.jsx)("input",{type:"color",value:j.color,onChange:e=>I(j.id,{color:e.target.value}),className:"w-full h-10 bg-black border border-gray-700 cursor-pointer"})]}),(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"text-xs uppercase text-gray-500 block mb-1",children:"Description"}),(0,w.jsx)("textarea",{value:j.desc,onChange:e=>I(j.id,{desc:e.target.value}),className:"w-full h-16 bg-black border border-gray-700 p-2 text-white text-sm"})]}),(0,w.jsx)("div",{className:"col-span-2",children:(0,w.jsx)("button",{onClick:()=>T(j.id),className:"text-red-500 text-xs underline hover:text-red-400",children:"Supprimer ce domaine dfinitivement"})})]}),(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,w.jsx)("h3",{className:"text-lg font-bold text-blue-400 uppercase",children:"Pouvoirs & Passifs"}),(0,w.jsx)("button",{onClick:()=>C({isNew:!0,label:"Nouveau Pouvoir",type:"active",archetype:"projectile",stats:{damage:10,cost:10}}),className:"px-3 py-1 bg-blue-900 hover:bg-blue-700 text-xs font-bold uppercase rounded border border-blue-500",children:"+ Ajouter"})]}),(0,w.jsx)("div",{className:"grid grid-cols-2 gap-3",children:j.talents?.map(e=>(0,w.jsxs)("div",{className:"bg-[#1a1a1a] p-3 rounded border border-gray-800 flex justify-between items-center group",children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{className:"font-bold text-sm text-gray-200",children:[e.label," ",(0,w.jsxs)("span",{className:"text-[10px] text-gray-500 uppercase",children:["(",e.type,")"]})]}),(0,w.jsxs)("div",{className:"text-[10px] text-gray-400",children:[e.archetype,"  ",e.stats?.damage||0," DMG  ",e.stats?.cost||0," Mana"]})]}),(0,w.jsxs)("div",{className:"flex gap-2",children:[(0,w.jsx)("button",{onClick:()=>C({...e,isNew:!1}),className:"text-yellow-500 hover:text-white",children:""}),(0,w.jsx)("button",{onClick:()=>M(e.id),className:"text-red-500 hover:text-white",children:""})]})]},e.id))})]})]}):(0,w.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-600",children:[(0,w.jsx)("span",{className:"text-4xl text-gray-700 mb-2",children:""}),(0,w.jsx)("span",{className:"uppercase tracking-widest font-bold",children:"Slectionnez ou crez un domaine"})]})}),x[24]=M,x[25]=j,x[26]=p):p=x[26],x[27]!==h||x[28]!==p?(f=(0,w.jsxs)("div",{className:"bg-gray-900 border border-purple-500 w-full max-w-6xl h-[80vh] flex shadow-2xl rounded text-white overflow-hidden",children:[h,p]}),x[27]=h,x[28]=p,x[29]=f):f=x[29],x[30]!==S||x[31]!==A?(m=S&&(0,w.jsx)("div",{className:"absolute inset-0 z-[160] bg-black/80 flex items-center justify-center",children:(0,w.jsxs)("div",{className:"bg-gray-900 border border-blue-500 p-6 rounded shadow-2xl w-[500px] space-y-4",children:[(0,w.jsx)("h3",{className:"text-blue-400 font-bold uppercase text-center border-b border-gray-800 pb-2",children:"diter Pouvoir"}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase",children:"Nom"}),(0,w.jsx)("input",{value:S.label,onChange:e=>C(t=>({...t,label:e.target.value})),className:"w-full bg-black border border-gray-700 p-2 text-white"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase",children:"Type"}),(0,w.jsxs)("select",{value:S.type,onChange:e=>C(t=>({...t,type:e.target.value})),className:"w-full bg-black border border-gray-700 p-2 text-white",children:[(0,w.jsx)("option",{value:"active",children:"Actif"}),(0,w.jsx)("option",{value:"passive",children:"Passif"}),(0,w.jsx)("option",{value:"ultimate",children:"Ultime"})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase",children:"Rang Requis"}),(0,w.jsx)("input",{type:"number",value:S.rank||1,onChange:e=>C(t=>({...t,rank:parseInt(e.target.value)})),className:"w-full bg-black border border-gray-700 p-2 text-white"})]}),(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase",children:"Description"}),(0,w.jsx)("input",{value:S.desc,onChange:e=>C(t=>({...t,desc:e.target.value})),className:"w-full bg-black border border-gray-700 p-2 text-white"})]})]}),"passive"!==S.type&&(0,w.jsxs)("div",{className:"space-y-3 border-t border-gray-800 pt-3",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-yellow-500 uppercase font-bold",children:"Archetype d'Effet"}),(0,w.jsx)("select",{value:S.archetype,onChange:e=>C(t=>({...t,archetype:e.target.value})),className:"w-full bg-black border border-yellow-800 text-yellow-500 p-2",children:hU.map(hV)})]}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2 bg-black/30 p-2 rounded",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[9px] text-gray-500 uppercase",children:"Cot Mana"}),(0,w.jsx)("input",{type:"number",value:S.stats?.cost||0,onChange:e=>C(t=>({...t,stats:{...t.stats,cost:parseInt(e.target.value)}})),className:"w-full bg-black border border-gray-700 p-1 text-white text-xs"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[9px] text-gray-500 uppercase",children:"Cooldown (s)"}),(0,w.jsx)("input",{type:"number",value:S.stats?.cooldown||0,onChange:e=>C(t=>({...t,stats:{...t.stats,cooldown:parseInt(e.target.value)}})),className:"w-full bg-black border border-gray-700 p-1 text-white text-xs"})]}),hU.find(e=>e.id===S.archetype)?.params.map(e=>(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[9px] text-blue-400 uppercase",children:e}),(0,w.jsx)("input",{type:"color"===e?"color":"text",value:S.stats?.[e]||("color"===e?"#ffffff":""),onChange:t=>C(r=>({...r,stats:{...r.stats,[e]:t.target.value}})),className:`w-full bg-black border border-gray-700 p-1 text-white text-xs ${"color"===e?"h-6":""}`})]},e))]})]}),(0,w.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,w.jsx)("button",{onClick:()=>C(null),className:"flex-1 py-2 text-gray-400 text-xs font-bold uppercase border border-gray-700 hover:bg-gray-800",children:"Annuler"}),(0,w.jsx)("button",{onClick:()=>A(S),className:"flex-1 py-2 bg-blue-700 hover:bg-blue-600 text-white text-xs font-bold uppercase",children:"Sauvegarder"})]})]})}),x[30]=S,x[31]=A,x[32]=m):m=x[32],x[33]!==f||x[34]!==m?(g=(0,w.jsxs)("div",{className:"fixed inset-0 z-[150] flex items-center justify-center bg-black/80 backdrop-blur-sm p-10",children:[f,m]}),x[33]=f,x[34]=m,x[35]=g):g=x[35],g}function hV(e){return(0,w.jsx)("option",{value:e.id,children:e.label},e.id)}async function h$(e,t){await oK(aJ(dY,"magic_domains",e),t)}async function hq(){await oY(aY(dY,"magic_domains"),{label:"Nouveau Domaine",desc:"Description du domaine...",color:"#ffffff",talents:[]})}function hB(e){return{...e.data(),id:e.id}}let hH=(0,N.memo)(()=>(0,w.jsxs)("defs",{children:[(0,w.jsx)("pattern",{id:"grid",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:(0,w.jsx)("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"rgba(255,255,255,0.05)",strokeWidth:"1"})}),(0,w.jsxs)("filter",{id:"routeGlow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[(0,w.jsx)("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),(0,w.jsx)("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]}),(0,w.jsxs)("filter",{id:"planetGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[(0,w.jsx)("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),(0,w.jsx)("feColorMatrix",{in:"blur",type:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7",result:"glow"}),(0,w.jsxs)("feMerge",{children:[(0,w.jsx)("feMergeNode",{in:"glow"}),(0,w.jsx)("feMergeNode",{in:"SourceGraphic"})]})]}),(0,w.jsxs)("radialGradient",{id:"grad-standard",children:[(0,w.jsx)("stop",{offset:"30%",stopColor:"#4b5563"}),(0,w.jsx)("stop",{offset:"90%",stopColor:"#1f2937"}),(0,w.jsx)("stop",{offset:"100%",stopColor:"#000000"})]}),(0,w.jsxs)("radialGradient",{id:"grad-industrial",children:[(0,w.jsx)("stop",{offset:"20%",stopColor:"#fb923c"}),(0,w.jsx)("stop",{offset:"80%",stopColor:"#7c2d12"}),(0,w.jsx)("stop",{offset:"100%",stopColor:"#431407"})]}),(0,w.jsxs)("radialGradient",{id:"grad-capital",children:[(0,w.jsx)("stop",{offset:"10%",stopColor:"#fcd34d"}),(0,w.jsx)("stop",{offset:"70%",stopColor:"#b45309"}),(0,w.jsx)("stop",{offset:"100%",stopColor:"#451a03"})]}),(0,w.jsxs)("radialGradient",{id:"grad-nexus",children:[(0,w.jsx)("stop",{offset:"10%",stopColor:"#d8b4fe"}),(0,w.jsx)("stop",{offset:"70%",stopColor:"#6b21a8"}),(0,w.jsx)("stop",{offset:"100%",stopColor:"#3b0764"})]}),(0,w.jsxs)("radialGradient",{id:"grad-unknown",children:[(0,w.jsx)("stop",{offset:"30%",stopColor:"#374151"}),(0,w.jsx)("stop",{offset:"100%",stopColor:"#111827"})]})]})),hG=(0,N.memo)(()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("image",{href:"/carte_galactique.png",x:"-5000",y:"-5000",width:"10000",height:"10000",preserveAspectRatio:"none",opacity:"0.4"}),(0,w.jsx)("rect",{x:"-5000",y:"-5000",width:"10000",height:"10000",fill:"url(#grid)"})]})),hW=(0,N.memo)(({planets:e})=>{let t=(0,N.useMemo)(()=>new Map(e.map(e=>[e.id,e])),[e]);return(0,w.jsx)("g",{children:e.flatMap(e=>(e.connected_to||[]).map(r=>{let s=t.get(r);return!s||e.id>s.id?null:(0,w.jsxs)("g",{children:[(0,w.jsx)("line",{x1:e.x,y1:e.y,x2:s.x,y2:s.y,stroke:"#3b82f6",strokeWidth:"2",opacity:"0.1",strokeLinecap:"round"}),(0,w.jsx)("line",{x1:e.x,y1:e.y,x2:s.x,y2:s.y,stroke:"#60a5fa",strokeWidth:"0.5",opacity:"0.6",strokeDasharray:"3,3"}),(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:"1",fill:"#3b82f6",opacity:"0.5"}),(0,w.jsx)("circle",{cx:s.x,cy:s.y,r:"1",fill:"#3b82f6",opacity:"0.5"})]},`route-${e.id}-${s.id}`)}))})}),hK=(0,N.memo)(({fleets:e,planets:t,currentTurn:r,shouldShowFleets:s,fleetMovePreview:n})=>{let i=(0,N.useMemo)(()=>new Map(t.map(e=>[e.id,e])),[t]);return(0,w.jsxs)(w.Fragment,{children:[s&&e.filter(e=>"moving"===e.status&&e.path).map(e=>{let t=e.path.map(e=>{let t=i.get(e);return t?`${t.x},${t.y}`:null}).filter(Boolean).join(" "),s=((e,t,r)=>{if(!e.path||e.path.length<2)return null;let s=e.arrival_turn-e.start_turn;if(s<=0)return null;let n=Math.max(0,Math.min(1,(r-e.start_turn)/s));r>=e.arrival_turn&&(n=1);let i=0,a=[];for(let r=0;r<e.path.length-1;r++){let s=t.get(e.path[r]),n=t.get(e.path[r+1]);if(s&&n){let e=n.x-s.x,t=n.y-s.y,r=Math.sqrt(e*e+t*t);a.push({d:r,p1:s,p2:n,dx:e,dy:t}),i+=r}}let o=i*n,l=0;for(let e of a){if(l+e.d>=o){let t=(o-l)/e.d;return{x:e.p1.x+e.dx*t,y:e.p1.y+e.dy*t}}l+=e.d}let c=t.get(e.path[e.path.length-1]);return c?{x:c.x,y:c.y}:null})(e,i,r);return s?(0,w.jsxs)("g",{children:[(0,w.jsx)("polyline",{points:t,fill:"none",stroke:"cyan",strokeWidth:"1.5",strokeDasharray:"4,4",opacity:"0.6"}),(0,w.jsxs)("g",{transform:`translate(${s.x}, ${s.y})`,className:"animate-pulse",children:[(0,w.jsx)("polygon",{points:"0,-10 8,6 0,2 -8,6",fill:"cyan",stroke:"black",strokeWidth:"1"}),(0,w.jsx)("text",{y:"-15",fill:"cyan",fontSize:"8",textAnchor:"middle",fontWeight:"bold",children:e.name})]})]},e.id):null}),n&&n.path&&(0,w.jsxs)("g",{className:"animate-in fade-in duration-300",children:[(0,w.jsx)("polyline",{points:n.path.map(e=>{let t=i.get(e);return t?`${t.x},${t.y}`:null}).filter(Boolean).join(" "),fill:"none",stroke:"#fbbf24",strokeWidth:"2",strokeDasharray:"8,4",className:"animate-pulse"}),(0,w.jsx)("circle",{cx:n.target.x,cy:n.target.y,r:"12",fill:"none",stroke:"#fbbf24",strokeWidth:"2",strokeDasharray:"2,2",className:"animate-spin-slow"}),(0,w.jsx)("circle",{cx:n.target.x,cy:n.target.y,r:"4",fill:"#fbbf24",className:"animate-ping"}),(0,w.jsx)("rect",{x:n.target.x-25,y:n.target.y-30,width:"50",height:"20",rx:"4",fill:"black",stroke:"#fbbf24",strokeWidth:"1"}),(0,w.jsxs)("text",{x:n.target.x,y:n.target.y-17,fill:"#fbbf24",fontSize:"10",textAnchor:"middle",fontWeight:"bold",fontFamily:"monospace",children:[n.turns," Tours"]})]})]})}),hX=(0,N.memo)(({planets:e,factions:t,fleets:r,activePlanet:s,shouldShowFleets:n,onPlanetClick:i,zoomLevel:a})=>{let o=(0,N.useMemo)(()=>new Map(t.map(e=>[e.id,e])),[t]),l=(0,N.useMemo)(()=>{let e=new Map;return r.forEach(t=>{"stationed"===t.status&&(e.has(t.location_id)||e.set(t.location_id,[]),e.get(t.location_id).push(t))}),e},[r]),c=a||800,d=c<2500,u=c<1e3;return(0,w.jsx)(w.Fragment,{children:e.map(e=>{if(!d)return null;let t=o.get(e.owner),r=n&&l.get(e.id)||[],a=e.planet_type||"standard",c="capital"===a?8:"force_nexus"===a?6:4;return(0,w.jsxs)("g",{className:"cursor-pointer",onClick:t=>i(t,e),opacity:s?.id===e.id?1:.9,children:[n&&r.length>0&&(0,w.jsxs)("g",{children:[(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:"25",stroke:"cyan",strokeWidth:"1",fill:"none",strokeDasharray:"4,2",className:"animate-spin-slow"}),(0,w.jsx)("circle",{cx:e.x+18,cy:e.y-18,r:"7",fill:"#0f172a",stroke:"cyan"}),(0,w.jsxs)("text",{x:e.x+18,y:e.y-15,textAnchor:"middle",fontSize:"7",fill:"cyan",fontWeight:"bold",children:["",r.length]})]}),(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:"30",fill:"transparent"}),s?.id===e.id&&(0,w.jsxs)("g",{className:"animate-pulse",children:[(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:"20",stroke:"white",strokeWidth:"0.5",fill:"none",opacity:"0.5"}),(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:"24",stroke:"white",strokeWidth:"1",fill:"none",strokeDasharray:"2,4"})]}),t&&"neutral"!==t.id&&(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:"18",fill:t.color,fillOpacity:"0.1"}),(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:c,fill:`url(#${"industrial"===a?"grad-industrial":"capital"===a?"grad-capital":"force_nexus"===a?"grad-nexus":"grad-standard"})`,stroke:t?.color||"#555",strokeWidth:t?.id!=="neutral"?1.5:.5}),(0,w.jsx)("circle",{cx:e.x-.3*c,cy:e.y-.3*c,r:.4*c,fill:"white",fillOpacity:"0.1"}),"capital"===e.planet_type&&(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:c+3,stroke:t?.color||"goldenrod",strokeWidth:"1",fill:"none",opacity:"0.7"}),"force_nexus"===e.planet_type&&(0,w.jsx)("circle",{cx:e.x,cy:e.y,r:c+2,stroke:"#a855f7",strokeWidth:"0.5",fill:"none",className:"animate-pulse"}),e.governor_id&&(0,w.jsx)("text",{x:e.x+8,y:e.y-8,fontSize:"8",children:""}),u&&(0,w.jsx)("text",{x:e.x,y:e.y+18,fill:"#e5e7eb",fontSize:"8",textAnchor:"middle",className:"font-mono uppercase font-bold drop-shadow-md tracking-wider",style:{textShadow:"0px 2px 4px black"},children:e.name})]},e.id)})})}),hY=["admin","gamemaster"],hQ=["admin","conseil","general","emperor"],hJ={capital:8,industrial:6,force_nexus:5,standard:4,unknown:3},hZ=[{id:"economic",label:"Infrastructures Civiles & conomie",icon:"",color:"text-yellow-400",border:"border-yellow-600/30",bg:"bg-yellow-900/10"},{id:"military",label:"Infrastructures de Combat Terrestre",icon:"",color:"text-red-500",border:"border-red-600/30",bg:"bg-red-900/10"},{id:"orbital",label:"Dfense & Chantiers Orbitaux",icon:"",color:"text-cyan-500",border:"border-cyan-600/30",bg:"bg-cyan-900/10"},{id:"force",label:"Ordres de la Force & Cultes",icon:"",color:"text-purple-400",border:"border-purple-600/30",bg:"bg-purple-900/10"},{id:"unique",label:"Merveilles & Uniques",icon:"",color:"text-orange-400",border:"border-orange-600/30",bg:"bg-orange-900/10"}],h0={fighter:{cr:2,mp:1,power:1},corvette:{cr:10,mp:5,power:5},frigate:{cr:40,mp:15,power:15},cruiser:{cr:150,mp:50,power:40},dreadnought:{cr:500,mp:200,power:100}},h1={fighter:{label:"Chasseurs"},corvette:{label:"Corvettes"},frigate:{label:"Frgates"},cruiser:{label:"Croiseurs"},dreadnought:{label:"Dreadnoughts"}},h2={infantry:{label:"Infanterie"},heavy_infantry:{label:"Infanterie Lourde"},vehicle:{label:"Vhicules Blinds"},air_support:{label:"Soutien Arien"},turret:{label:"Tourelles Dfensives"}},h5={infantry:{cr:1,mp:1,power:2},heavy_infantry:{cr:4,mp:2,power:5},vehicle:{cr:15,mp:4,power:12},air_support:{cr:25,mp:3,power:15},turret:{cr:5,mp:0,power:8}},h4={infantry:{label:"Infanterie Lgre",cost:{cr:50,mp:10}},heavy_infantry:{label:"Infanterie Lourde",cost:{cr:150,mp:20}},vehicle:{label:"Vhicules Blinds",cost:{cr:400,mp:50}},air_support:{label:"Escadron Arien",cost:{cr:600,mp:30}},turret:{label:"Dfense Plantaire",cost:{cr:250,mp:5}}},h3=(e,t,r)=>{let s=0,n={...e.composition};e.composition&&Object.entries(e.composition).forEach(([e,t])=>{let r=h0[e]||{power:1};s+=r.power*t}),e.commander_id&&(s*=1.2);let i=20;t.garrison&&Object.entries(t.garrison).forEach(([e,t])=>{let r=h5[e]||{power:1};i+=r.power*t}),r.forEach(e=>{let t=0;e.composition&&Object.entries(e.composition).forEach(([e,r])=>{let s=h0[e]||{power:1};t+=s.power*r}),e.commander_id&&(t*=1.2),i+=t});let a=s*(.9+.2*Math.random()),o=i*(.9+.2*Math.random()),l=a>o,c=Math.min(.8,(l?o:a)/(l?a:o)*.5),d={},u={};l&&Object.entries(n).forEach(([e,t])=>{let r=Math.ceil(t*c*(.8+.4*Math.random()));d[e]=r,u[e]=Math.max(0,t-r)});let h=t.garrison||{};l?h={}:(h={},Object.entries(t.garrison||{}).forEach(([e,t])=>{let r=Math.ceil(t*c*(.8+.4*Math.random()));h[e]=Math.max(0,t-r)}));let p=`--- RAPPORT TACTIQUE : ${t.name} ---

`;return p+=`Forces en pr\xe9sence :
> ATTAQUANT (${e.owner}) : Puissance ${Math.round(s)}
> D\xc9FENSEUR (${t.owner}) : Puissance ${Math.round(i)}

R\xc9SULTAT : ${l?"VICTOIRE DE L'ENVAHISSEUR":"DFENSE HROQUE"}

`,l?(p+=`Pertes de l'Attaquant :
`,Object.entries(d).forEach(([e,t])=>{t>0&&(p+=`- ${h1[e]?.label||e}: -${t}
`)}),p+=`
Pertes du D\xe9fenseur :
> AN\xc9ANTISSEMENT TOTAL des flottes et de la garnison.`):p+=`L'attaquant a \xe9t\xe9 repouss\xe9 et sa flotte enti\xe8rement d\xe9truite.
La plan\xe8te reste sous contr\xf4le de ${t.owner}.`,{attackerWon:l,newAttackerComposition:u,newGarrison:h,reportLog:p}},h6=()=>(0,w.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),h8=()=>(0,w.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),h9=()=>(0,w.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),h7=()=>(0,w.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),pe=()=>(0,w.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),pt=()=>(0,w.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:(0,w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),pr=()=>(0,w.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 10l7-7m0 0l7 7m-7-7v18"})}),ps=()=>(0,w.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),pn=e=>{let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v=(0,_.c)(38),{planet:N,factionData:j,onClose:k,onRecruit:S,onDisband:C,planetBuildings:E,buildingsTemplates:I}=e;v[0]!==E?(t=void 0===E?[]:E,v[0]=E,v[1]=t):t=v[1];let T=t;v[2]!==I?(r=void 0===I?[]:I,v[2]=I,v[3]=r):r=v[3];let A=r;if(!N)return null;v[4]!==N.garrison?(s=N.garrison||{},v[4]=N.garrison,v[5]=s):s=v[5];let M=s;return v[6]===Symbol.for("react.memo_cache_sentinel")?(n=(0,w.jsx)("div",{className:"absolute top-0 left-0 w-1 h-full bg-red-600 shadow-[0_0_10px_rgba(220,38,38,0.5)]"}),v[6]=n):n=v[6],v[7]===Symbol.for("react.memo_cache_sentinel")?(i=(0,w.jsx)("div",{className:"w-12 h-12 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center justify-center text-2xl shadow-[0_0_15px_rgba(220,38,38,0.2)]",children:""}),a=(0,w.jsx)("h2",{className:"text-xl font-bold uppercase text-white tracking-widest font-sans",children:"Commandement de Garnison"}),v[7]=i,v[8]=a):(i=v[7],a=v[8]),v[9]!==N.name?(o=(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[i,(0,w.jsxs)("div",{children:[a,(0,w.jsxs)("p",{className:"text-red-400 text-xs font-mono uppercase tracking-wider",children:["Secteur ",N.name]})]})]}),v[9]=N.name,v[10]=o):o=v[10],v[11]!==k?(l=(0,w.jsx)("button",{onClick:k,className:"w-8 h-8 rounded-full border border-gray-700 hover:border-red-500 hover:bg-red-900/20 text-gray-400 hover:text-red-400 flex items-center justify-center transition-all",children:""}),v[11]=k,v[12]=l):l=v[12],v[13]!==l||v[14]!==o?(c=(0,w.jsxs)("div",{className:"p-6 bg-gradient-to-r from-red-950/40 via-gray-900 to-gray-900 border-b border-red-900/30 flex justify-between items-center relative overflow-hidden",children:[n,o,l]}),v[13]=l,v[14]=o,v[15]=c):c=v[15],v[16]===Symbol.for("react.memo_cache_sentinel")?(d=(0,w.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-black/50 to-transparent pointer-events-none"}),v[16]=d):d=v[16],v[17]===Symbol.for("react.memo_cache_sentinel")?(u=(0,w.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,w.jsx)("div",{className:"h-px bg-gray-700 flex-grow"}),(0,w.jsx)("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:"Forces Dployes"}),(0,w.jsx)("div",{className:"h-px bg-gray-700 flex-grow"})]}),h=Object.keys(h4),v[17]=u,v[18]=h):(u=v[17],h=v[18]),v[19]!==M||v[20]!==C?(p=(0,w.jsxs)("div",{className:"grid grid-cols-1 gap-6 mb-8 relative z-10",children:[u,h.map(e=>{let t=M[e]||0,r=h4[e],s=h5[e];return(0,w.jsxs)("div",{className:"flex items-center justify-between bg-gray-900/50 p-4 rounded-xl border border-gray-800 hover:border-gray-600 transition-colors group",children:[(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[(0,w.jsx)("div",{className:"w-12 h-12 bg-black rounded-lg flex items-center justify-center border border-gray-800 text-2xl shadow-inner group-hover:shadow-[0_0_10px_rgba(255,255,255,0.1)] transition-shadow",children:"turret"===e?"":"vehicle"===e?"":""}),(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{className:"font-bold text-gray-200 text-sm uppercase tracking-wide group-hover:text-white transition-colors",children:r.label}),(0,w.jsxs)("div",{className:"text-[10px] text-gray-500 flex gap-3 font-mono mt-1",children:[(0,w.jsxs)("span",{className:"flex items-center gap-1",children:[(0,w.jsx)("span",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full"}),"Puissance: ",s.power]}),(0,w.jsxs)("span",{className:"text-red-400 flex items-center gap-1",children:[(0,w.jsx)("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),"-",s.cr,"Cr/t"]})]})]})]}),(0,w.jsxs)("div",{className:"flex items-center gap-4",children:[(0,w.jsx)("div",{className:"bg-black/40 px-3 py-1 rounded border border-gray-800 font-mono text-xl text-white",children:String(t).padStart(2,"0")}),t>0&&(0,w.jsx)("button",{onClick:()=>C(e),className:"w-8 h-8 rounded-lg flex items-center justify-center bg-red-950/30 text-red-400 hover:bg-red-900 hover:text-white border border-red-900/50 hover:border-red-500 transition-all",title:"Dmanteler",children:"-"})]})]},e)})]}),v[19]=M,v[20]=C,v[21]=p):p=v[21],v[22]===Symbol.for("react.memo_cache_sentinel")?(f=(0,w.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,w.jsx)("div",{className:"h-px bg-gray-700 flex-grow"}),(0,w.jsx)("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:"Protocoles de Recrutement"}),(0,w.jsx)("div",{className:"h-px bg-gray-700 flex-grow"})]}),v[22]=f):f=v[22],v[23]!==A||v[24]!==j||v[25]!==S||v[26]!==T?(m=(0,w.jsxs)("div",{className:"grid grid-cols-1 gap-6 relative z-10",children:[f,(0,w.jsx)("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(h4).map(e=>{let[t,r]=e,s=r.cost,n="infantry"===t||T.some(e=>{let r=A.find(t=>t.id===e.template_id);return!!r&&(!!r.unlocks_units?.includes(t)||!!r.upgrades&&r.upgrades.some(r=>r.level<=e.level&&r.unlocks_units?.includes(t)))}),i=j.credits>=s.cr&&j.manpower>=s.mp,a=i&&n;return(0,w.jsxs)("button",{onClick:()=>a&&S(t),disabled:!a,className:`p-4 border rounded-xl flex flex-col gap-3 transition-all text-left relative overflow-hidden group 
                                        ${a?"bg-gray-900/80 border-gray-700 hover:border-red-500/50 hover:bg-gray-800 hover:shadow-[0_0_20px_rgba(220,38,38,0.1)]":"bg-black/60 border-gray-800/50 opacity-40 cursor-not-allowed grayscale"}`,children:[a&&(0,w.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-red-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),!n&&(0,w.jsx)("div",{className:"absolute top-2 right-2 text-xl",children:""}),(0,w.jsxs)("div",{className:"flex justify-between items-start z-10",children:[(0,w.jsx)("span",{className:`font-bold text-sm uppercase tracking-wider ${i?"text-gray-200 group-hover:text-red-400":"text-gray-600"}`,children:r.label}),(0,w.jsxs)("span",{className:"text-[9px] bg-black/80 border border-gray-800 px-1.5 py-0.5 rounded text-yellow-500 font-mono shadow-sm",children:[h5[t].power," POW"]})]}),(0,w.jsxs)("div",{className:"flex items-center gap-4 text-xs z-10 mt-auto bg-black/20 p-2 rounded -mx-1",children:[(0,w.jsxs)("span",{className:`flex items-center gap-1.5 font-mono ${i?"text-yellow-500":"text-red-700"}`,children:[s.cr,(0,w.jsx)(h6,{className:"w-3 h-3"})]}),(0,w.jsxs)("span",{className:`flex items-center gap-1.5 font-mono ${i?"text-green-500":"text-red-700"}`,children:[s.mp,(0,w.jsx)(h9,{className:"w-3 h-3"})]})]})]},t)})})]}),v[23]=A,v[24]=j,v[25]=S,v[26]=T,v[27]=m):m=v[27],v[28]!==p||v[29]!==m?(g=(0,w.jsxs)("div",{className:"flex-grow p-8 overflow-y-auto custom-scrollbar bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] relative",children:[d,p,m]}),v[28]=p,v[29]=m,v[30]=g):g=v[30],v[31]===Symbol.for("react.memo_cache_sentinel")?(x=(0,w.jsxs)("div",{className:"p-3 bg-black/80 border-t border-gray-800 flex justify-between items-center text-[10px] text-gray-500 font-mono uppercase px-6",children:[(0,w.jsx)("span",{children:"tat: Oprationnel"}),(0,w.jsx)("span",{children:"Capacit Max: Illimite"})]}),v[31]=x):x=v[31],v[32]!==c||v[33]!==g?(b=(0,w.jsxs)("div",{className:"bg-gray-950/95 border border-gray-700 w-full max-w-2xl shadow-[0_0_50px_rgba(255,0,0,0.1)] rounded-2xl overflow-hidden flex flex-col max-h-[85vh] ring-1 ring-white/10",onClick:pu,children:[c,g,x]}),v[32]=c,v[33]=g,v[34]=b):b=v[34],v[35]!==k||v[36]!==b?(y=(0,w.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:k,children:b}),v[35]=k,v[36]=b,v[37]=y):y=v[37],y},pi=e=>{let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,N,j,k=(0,_.c)(52),{userFaction:S,factionData:C,projectedIncome:E,currentTurn:I,isAdmin:T,isProcessingTurn:A,handleNextTurn:M,handleLogout:R,onOpenProfile:P,onOpenMapEditor:D}=e;k[0]!==S?(t=(0,w.jsx)(d0,{userID:S}),k[0]=S,k[1]=t):t=k[1],k[2]===Symbol.for("react.memo_cache_sentinel")?(r=(0,w.jsx)("span",{className:"text-[9px] text-gray-500 uppercase tracking-widest leading-none mb-1",children:"Calendrier"}),k[2]=r):r=k[2],k[3]!==I?(s=(0,w.jsxs)("span",{className:"text-lg font-bold text-white font-mono leading-none",children:["TOUR ",I]}),k[3]=I,k[4]=s):s=k[4],k[5]!==M||k[6]!==T||k[7]!==A?(n=T&&(0,w.jsx)("button",{onClick:M,disabled:A,className:`text-[9px] mt-1 px-2 py-0.5 rounded font-bold uppercase tracking-wide transition-colors w-full ${A?"bg-gray-800 text-gray-500":"bg-yellow-600 text-white hover:bg-yellow-500"}`,children:A?"...":"SUIVANT >>"}),k[5]=M,k[6]=T,k[7]=A,k[8]=n):n=k[8],k[9]!==s||k[10]!==n?(i=(0,w.jsxs)("div",{className:"px-4 py-2 flex flex-col justify-center border-r border-gray-700 bg-black/20 min-w-[100px] text-center",children:[r,(0,w.jsxs)("div",{className:"flex flex-col items-center",children:[s,n]})]}),k[9]=s,k[10]=n,k[11]=i):i=k[11],k[12]===Symbol.for("react.memo_cache_sentinel")?(a=(0,w.jsx)(h6,{}),k[12]=a):a=k[12];let O=C?.credits;k[13]!==E.credits||k[14]!==O?(o=(0,w.jsx)(pa,{icon:a,label:"Crdits",value:O,income:E.credits,color:"text-yellow-500"}),k[13]=E.credits,k[14]=O,k[15]=o):o=k[15],k[16]===Symbol.for("react.memo_cache_sentinel")?(l=(0,w.jsx)(h8,{}),k[16]=l):l=k[16];let L=C?.materials;k[17]!==E.materials||k[18]!==L?(c=(0,w.jsx)(pa,{icon:l,label:"Matriaux",value:L,income:E.materials,color:"text-blue-400"}),k[17]=E.materials,k[18]=L,k[19]=c):c=k[19],k[20]===Symbol.for("react.memo_cache_sentinel")?(d=(0,w.jsx)(h9,{}),k[20]=d):d=k[20];let F=C?.manpower;k[21]!==E.manpower||k[22]!==F?(u=(0,w.jsx)(pa,{icon:d,label:"Effectifs",value:F,income:E.manpower,color:"text-green-500"}),k[21]=E.manpower,k[22]=F,k[23]=u):u=k[23],k[24]===Symbol.for("react.memo_cache_sentinel")?(h=(0,w.jsx)(h7,{}),k[24]=h):h=k[24];let U=C?.science||0;return k[25]!==E.science||k[26]!==U?(p=(0,w.jsx)(pa,{icon:h,label:"Donnes",value:U,income:E.science,color:"text-purple-400"}),k[25]=E.science,k[26]=U,k[27]=p):p=k[27],k[28]!==c||k[29]!==u||k[30]!==p||k[31]!==o?(f=(0,w.jsxs)("div",{className:"flex items-center gap-4 px-2",children:[o,c,u,p]}),k[28]=c,k[29]=u,k[30]=p,k[31]=o,k[32]=f):f=k[32],k[33]===Symbol.for("react.memo_cache_sentinel")?(m=(0,w.jsx)("div",{className:"w-px bg-gray-700 my-1"}),k[33]=m):m=k[33],k[34]!==T||k[35]!==D?(g=T&&(0,w.jsx)("button",{onClick:D,className:"px-3 hover:bg-gray-800 group flex flex-col items-center justify-center transition-colors rounded",title:"diteur de Carte",children:(0,w.jsx)("div",{className:"text-gray-500 group-hover:text-blue-400",children:""})}),k[34]=T,k[35]=D,k[36]=g):g=k[36],k[37]===Symbol.for("react.memo_cache_sentinel")?(x=(0,w.jsx)("div",{className:"text-gray-500 group-hover:text-[#cba660]",children:(0,w.jsx)(ps,{})}),k[37]=x):x=k[37],k[38]!==P?(b=(0,w.jsx)("button",{onClick:P,className:"px-3 hover:bg-gray-800 group flex flex-col items-center justify-center transition-colors rounded",title:"Profil",children:x}),k[38]=P,k[39]=b):b=k[39],k[40]===Symbol.for("react.memo_cache_sentinel")?(y=(0,w.jsx)("div",{className:"text-gray-500 group-hover:text-red-400",children:(0,w.jsx)(pe,{})}),k[40]=y):y=k[40],k[41]!==R?(v=(0,w.jsx)("button",{onClick:R,className:"px-3 hover:bg-red-900/30 group flex flex-col items-center justify-center transition-colors rounded",title:"Dconnexion",children:y}),k[41]=R,k[42]=v):v=k[42],k[43]!==f||k[44]!==g||k[45]!==b||k[46]!==v||k[47]!==i?(N=(0,w.jsxs)("div",{className:"flex items-stretch gap-2 bg-gray-950/90 border border-gray-700 rounded-lg shadow-2xl backdrop-blur-md overflow-hidden p-1",children:[i,f,m,g,b,v]}),k[43]=f,k[44]=g,k[45]=b,k[46]=v,k[47]=i,k[48]=N):N=k[48],k[49]!==t||k[50]!==N?(j=(0,w.jsx)("div",{className:"absolute top-4 right-4 z-50 flex flex-col items-end gap-2 pointer-events-none",children:(0,w.jsxs)("div",{className:"flex items-start gap-2 pointer-events-auto",children:[t,N]})}),k[49]=t,k[50]=N,k[51]=j):j=k[51],j},pa=e=>{let t,r,s,n,i,a,o,l,c=(0,_.c)(22),{icon:d,label:u,value:h,income:p,color:f}=e,m=`${f} bg-gray-900 p-1.5 rounded border border-gray-800`;c[0]!==d||c[1]!==m?(t=(0,w.jsx)("div",{className:m,children:d}),c[0]=d,c[1]=m,c[2]=t):t=c[2],c[3]!==u?(r=(0,w.jsx)("span",{className:"text-[9px] text-gray-500 uppercase font-bold",children:u}),c[3]=u,c[4]=r):r=c[4],c[5]!==h?(s=h?.toLocaleString()??0,c[5]=h,c[6]=s):s=c[6],c[7]!==s?(n=(0,w.jsx)("span",{className:"text-sm font-bold text-white font-mono",children:s}),c[7]=s,c[8]=n):n=c[8];let g=`text-[10px] font-mono font-bold ${p>=0?"text-green-500":"text-red-500"}`,x=p>=0?"+":"";return c[9]!==p||c[10]!==g||c[11]!==x?(i=(0,w.jsxs)("span",{className:g,children:[x,p]}),c[9]=p,c[10]=g,c[11]=x,c[12]=i):i=c[12],c[13]!==n||c[14]!==i?(a=(0,w.jsxs)("div",{className:"flex items-baseline gap-1",children:[n,i]}),c[13]=n,c[14]=i,c[15]=a):a=c[15],c[16]!==r||c[17]!==a?(o=(0,w.jsxs)("div",{className:"flex flex-col",children:[r,a]}),c[16]=r,c[17]=a,c[18]=o):o=c[18],c[19]!==o||c[20]!==t?(l=(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[t,o]}),c[19]=o,c[20]=t,c[21]=l):l=c[21],l},po=e=>{let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x,b,y,v,N,j,k,S,C=(0,_.c)(66),{selectedPlanet:E,isTerritoryOwned:I,canBuild:T,slots:A,buildingsTemplates:M,currentTurn:R,setShowBuildMenu:P,handleUpgrade:D,handleDemolish:O,handleCancel:L,showAssignMenu:F,setShowAssignMenu:U,factionMembers:z,handleAssignGovernor:V,isHighCommand:$,setShowGarrisonMenu:q}=e;if(!E)return null;C[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,w.jsx)("div",{className:"absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-[#e5c07b] to-transparent opacity-50"}),C[0]=t):t=C[0],C[1]===Symbol.for("react.memo_cache_sentinel")?(r=(0,w.jsx)("div",{className:"text-[10px] text-gray-500 font-mono mb-1 uppercase tracking-widest",children:"Systme"}),C[1]=r):r=C[1],C[2]!==E.name?(s=(0,w.jsx)("h2",{className:"text-2xl font-bold text-white uppercase tracking-wider font-sans truncate drop-shadow-lg",children:E.name}),C[2]=E.name,C[3]=s):s=C[3];let B=`text-[9px] px-2 py-1 rounded bg-gray-800 border ${I?"border-green-600 text-green-400":"border-red-600 text-red-400"} uppercase font-bold tracking-wider`,H=I?"CONTRL":"HOSTILE";C[4]!==B||C[5]!==H?(n=(0,w.jsx)("div",{className:B,children:H}),C[4]=B,C[5]=H,C[6]=n):n=C[6];let G=E.planet_type||"Standard";C[7]!==G?(i=(0,w.jsx)("div",{className:"text-[9px] px-2 py-1 rounded bg-gray-800 border border-blue-600 text-blue-400 uppercase font-bold tracking-wider",children:G}),C[7]=G,C[8]=i):i=C[8],C[9]!==n||C[10]!==i?(a=(0,w.jsxs)("div",{className:"flex gap-2 mt-3",children:[n,i]}),C[9]=n,C[10]=i,C[11]=a):a=C[11],C[12]!==s||C[13]!==a?(o=(0,w.jsxs)("div",{children:[r,s,a]}),C[12]=s,C[13]=a,C[14]=o):o=C[14],C[15]===Symbol.for("react.memo_cache_sentinel")?(l=(0,w.jsx)("span",{children:"Gouverneur"}),C[15]=l):l=C[15],C[16]!==$||C[17]!==I||C[18]!==U||C[19]!==F?(c=I&&$&&(0,w.jsx)("button",{onClick:()=>U(!F),className:"hover:text-white transition-colors cursor-pointer",children:""}),C[16]=$,C[17]=I,C[18]=U,C[19]=F,C[20]=c):c=C[20],C[21]!==c?(d=(0,w.jsxs)("div",{className:"text-[9px] text-[#cba660] uppercase tracking-widest mb-2 font-bold flex justify-between",children:[l,c]}),C[21]=c,C[22]=d):d=C[22];let W=E.governor_name?"":"?";return C[23]!==W?(u=(0,w.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-800 border border-gray-600 flex items-center justify-center text-lg overflow-hidden",children:W}),C[23]=W,C[24]=u):u=C[24],C[25]!==E.governor_name?(h=E.governor_name||(0,w.jsx)("span",{className:"text-gray-600 italic",children:"Poste Vacant"}),C[25]=E.governor_name,C[26]=h):h=C[26],C[27]!==h?(p=(0,w.jsx)("div",{className:"text-sm font-bold text-gray-200 truncate",children:h}),C[27]=h,C[28]=p):p=C[28],C[29]===Symbol.for("react.memo_cache_sentinel")?(f=(0,w.jsx)("div",{className:"text-[9px] text-gray-500",children:"Administration Civile"}),C[29]=f):f=C[29],C[30]!==p?(m=(0,w.jsxs)("div",{className:"flex-1 min-w-0",children:[p,f]}),C[30]=p,C[31]=m):m=C[31],C[32]!==u||C[33]!==m?(g=(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[u,m]}),C[32]=u,C[33]=m,C[34]=g):g=C[34],C[35]!==d||C[36]!==g?(x=(0,w.jsxs)("div",{className:"mt-4 bg-black/40 p-3 rounded border border-gray-700 relative group",children:[d,g]}),C[35]=d,C[36]=g,C[37]=x):x=C[37],C[38]!==I||C[39]!==q?(b=I&&(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[(0,w.jsxs)("button",{onClick:()=>q(!0),className:"bg-gradient-to-br from-red-900 to-red-950 hover:from-red-800 hover:to-red-900 border border-red-500/50 hover:border-red-400 text-white text-[10px] py-2 uppercase font-bold rounded-lg transition-all flex items-center justify-center gap-2 shadow-[0_0_10px_rgba(220,38,38,0.2)] hover:shadow-[0_0_15px_rgba(220,38,38,0.4)] relative overflow-hidden group",children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"}),(0,w.jsx)("span",{className:"relative z-10 text-lg",children:""}),(0,w.jsx)("span",{className:"relative z-10 tracking-wider",children:"Garnison"})]}),(0,w.jsxs)("button",{className:"bg-gradient-to-br from-gray-800 to-gray-900 hover:from-gray-700 hover:to-gray-800 border border-gray-600 hover:border-gray-400 text-gray-200 hover:text-white text-[10px] py-2 uppercase font-bold rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg",children:[(0,w.jsx)("span",{className:"text-lg",children:""}),(0,w.jsx)("span",{className:"tracking-wider",children:"Dtails"})]})]}),C[38]=I,C[39]=q,C[40]=b):b=C[40],C[41]!==z||C[42]!==V||C[43]!==F?(y=F&&(0,w.jsxs)("div",{className:"absolute bottom-full left-0 w-64 bg-gray-900 border border-gray-700 p-2 overflow-y-auto max-h-60 rounded-t-lg shadow-2xl custom-scrollbar z-50 mb-[-1px]",children:[(0,w.jsx)("div",{className:"text-[10px] text-gray-500 uppercase font-bold p-2 border-b border-gray-800 mb-1",children:"Candidats Disponibles"}),z.map(e=>(0,w.jsxs)("button",{onClick:()=>V(e),className:"w-full text-left p-2 hover:bg-blue-900/20 text-xs text-gray-300 flex items-center gap-2 rounded transition-colors",children:[(0,w.jsx)("div",{className:"w-6 h-6 rounded-full bg-gray-800 flex items-center justify-center text-[10px]",children:""}),(0,w.jsx)("span",{className:"font-bold truncate",children:e.pseudo})]},e.id))]}),C[41]=z,C[42]=V,C[43]=F,C[44]=y):y=C[44],C[45]!==o||C[46]!==x||C[47]!==b||C[48]!==y?(v=(0,w.jsxs)("div",{className:"w-64 p-5 border-r border-gray-800 bg-gray-900/50 flex flex-col justify-between shrink-0 relative",children:[o,x,b,y]}),C[45]=o,C[46]=x,C[47]=b,C[48]=y,C[49]=v):v=C[49],C[50]===Symbol.for("react.memo_cache_sentinel")?(N=(0,w.jsx)("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10 pointer-events-none"}),C[50]=N):N=C[50],C[51]!==M||C[52]!==T||C[53]!==R||C[54]!==L||C[55]!==O||C[56]!==D||C[57]!==I||C[58]!==P||C[59]!==A?(j=I?A.map((e,t)=>{let r=e&&R>=e.finish_turn,s=M.find(t=>t.id===e?.template_id),n=s&&s.upgrades&&s.upgrades.find(t=>t.level===(e.level||1)+1);return(0,w.jsxs)("div",{className:"flex flex-col gap-2 group relative shrink-0 w-32",children:[(0,w.jsxs)("div",{className:"text-[9px] text-gray-600 font-mono uppercase tracking-widest text-center",children:["Slot 0",t+1]}),(0,w.jsx)("div",{className:`h-36 border flex flex-col justify-between p-3 relative shadow-lg transition-all rounded-xl overflow-hidden cursor-pointer
                                    ${e?r?"bg-gray-900 border-gray-600":"bg-gray-900 border-yellow-600/50 border-dashed":T?"bg-black/40 border-gray-800 hover:border-[#cba660] hover:bg-gray-900 hover:shadow-[0_0_15px_rgba(203,166,96,0.2)]":"bg-black/20 border-gray-800 opacity-50 cursor-not-allowed"}`,onClick:()=>!e&&T&&P(!0),children:e?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:"relative z-10 flex flex-col h-full",children:[(0,w.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,w.jsx)("span",{className:"text-xl",children:r?"":""}),(0,w.jsxs)("span",{className:"text-[9px] font-bold bg-black px-1.5 rounded text-gray-400 border border-gray-800",children:["Nv.",e.level]})]}),(0,w.jsx)("div",{className:"font-bold text-xs text-gray-200 leading-tight uppercase mb-auto",children:e.name}),!r&&(0,w.jsxs)("div",{className:"mt-2 text-[9px] text-yellow-500 bg-yellow-900/20 border border-yellow-900/50 rounded px-2 py-1 flex items-center justify-center gap-1",children:[(0,w.jsx)("span",{className:"animate-spin-slow",children:""})," ",e.finish_turn-R," trs"]}),r&&e.production&&(0,w.jsx)("div",{className:"mt-1 flex flex-wrap gap-1",children:Object.entries(e.production).map(ph)})]}),T&&(0,w.jsxs)("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 z-20",children:[r&&n&&(0,w.jsx)("button",{onClick:t=>{t.stopPropagation(),D(e)},className:"w-8 h-8 rounded-full bg-green-900 text-green-400 border border-green-600 flex items-center justify-center hover:scale-110 transition-transform",title:"Amliorer",children:(0,w.jsx)(pr,{})}),(0,w.jsx)("button",{onClick:t=>{t.stopPropagation(),r?O(e):L(e)},className:`w-8 h-8 rounded-full border flex items-center justify-center hover:scale-110 transition-transform ${r?"bg-red-900 text-red-400 border-red-600":"bg-orange-900 text-orange-400 border-orange-600"}`,title:r?"Dmolir":"Annuler",children:r?"":""})]})]}):T?(0,w.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-2 opacity-50 group-hover:opacity-100 transition-opacity",children:[(0,w.jsx)("span",{className:"text-3xl text-[#cba660] font-thin",children:"+"}),(0,w.jsx)("span",{className:"text-[9px] uppercase tracking-widest text-[#cba660]",children:"Construire"})]}):(0,w.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,w.jsx)("span",{className:"text-2xl text-gray-700",children:""})})})]},t)}):(0,w.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,w.jsxs)("div",{className:"p-6 border border-red-900/30 bg-red-950/20 rounded-lg flex items-center gap-4",children:[(0,w.jsx)("span",{className:"text-4xl opacity-50",children:""}),(0,w.jsxs)("div",{className:"text-red-300",children:[(0,w.jsx)("h3",{className:"font-bold uppercase tracking-widest text-sm",children:"Accs Refus"}),(0,w.jsx)("p",{className:"text-xs text-red-400/70",children:"Territoire hostile ou contest."})]})]})}),C[51]=M,C[52]=T,C[53]=R,C[54]=L,C[55]=O,C[56]=D,C[57]=I,C[58]=P,C[59]=A,C[60]=j):j=C[60],C[61]!==j?(k=(0,w.jsxs)("div",{className:"flex-grow p-6 overflow-x-auto flex items-center gap-4 relative custom-scrollbar",children:[N,j]}),C[61]=j,C[62]=k):k=C[62],C[63]!==v||C[64]!==k?(S=(0,w.jsx)("div",{className:"h-64 fixed bottom-0 left-0 w-full flex z-40 animate-in slide-in-from-bottom-20 duration-500",children:(0,w.jsxs)("div",{className:"bg-black/95 backdrop-blur-xl border-t border-gray-700 shadow-[0_0_50px_rgba(0,0,0,0.8)] flex overflow-hidden relative w-full",children:[t,v,k]})}),C[63]=v,C[64]=k,C[65]=S):S=C[65],S},pl=e=>{let t,r,s,n,i,a,o,l,c,d,u,h,p,f=(0,_.c)(25),{buildingsTemplates:m,factionData:g,selectedPlanet:x,handleConstruct:b,onClose:y,userFaction:v}=e;return f[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,w.jsx)("div",{className:"absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-[#cba660] to-transparent shadow-[0_0_15px_rgba(203,166,96,0.6)] z-20"}),f[0]=t):t=f[0],f[1]===Symbol.for("react.memo_cache_sentinel")?(r=(0,w.jsx)("div",{className:"w-14 h-14 rounded-xl bg-[#cba660]/10 border border-[#cba660]/30 flex items-center justify-center text-3xl shadow-[0_0_20px_rgba(203,166,96,0.1)]",children:""}),f[1]=r):r=f[1],f[2]===Symbol.for("react.memo_cache_sentinel")?(s=(0,w.jsxs)("h4",{className:"text-white font-sans font-bold uppercase tracking-[0.2em] text-3xl flex items-center gap-3",children:["Arbre de Construction",(0,w.jsx)("span",{className:"text-xs bg-[#cba660] text-black px-2 py-0.5 rounded font-bold tracking-widest",children:"INITIATIVE"})]}),f[2]=s):s=f[2],f[3]===Symbol.for("react.memo_cache_sentinel")?(n=(0,w.jsx)("span",{className:"text-[#cba660]",children:"Dveloppement Infrastructurel"}),f[3]=n):n=f[3],f[4]!==x.name?(i=(0,w.jsxs)("div",{className:"flex items-center gap-6",children:[r,(0,w.jsxs)("div",{children:[s,(0,w.jsxs)("p",{className:"text-gray-500 text-xs uppercase tracking-widest font-mono mt-1",children:["Secteur: ",x.name," // ",n]})]})]}),f[4]=x.name,f[5]=i):i=f[5],f[6]===Symbol.for("react.memo_cache_sentinel")?(a=(0,w.jsx)("span",{children:"Fermer le protocole"}),o=(0,w.jsx)("span",{className:"group-hover:text-red-500 transition-colors",children:"[X]"}),f[6]=a,f[7]=o):(a=f[6],o=f[7]),f[8]!==y?(l=(0,w.jsxs)("button",{onClick:y,className:"group flex items-center gap-2 text-gray-400 hover:text-white border border-gray-700 px-6 py-3 rounded hover:bg-red-950/30 hover:border-red-500/50 transition-all text-xs uppercase font-bold tracking-widest",children:[a,o]}),f[8]=y,f[9]=l):l=f[9],f[10]!==i||f[11]!==l?(c=(0,w.jsxs)("div",{className:"flex justify-between items-center px-10 py-5 border-b border-gray-800 bg-black/40 shrink-0 relative z-10 backdrop-blur-md",children:[i,l]}),f[10]=i,f[11]=l,f[12]=c):c=f[12],f[13]===Symbol.for("react.memo_cache_sentinel")?(d=(0,w.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-black/50 to-gray-900/50 pointer-events-none"}),f[13]=d):d=f[13],f[14]!==m||f[15]!==g||f[16]!==b||f[17]!==x.planet_type||f[18]!==v?(u=hZ.map(e=>{let t=m.filter(t=>(t.category||"economic")===e.id);return 0===t.length?null:(0,w.jsxs)("div",{className:"relative z-10",children:[(0,w.jsxs)("div",{className:"flex items-center gap-4 mb-6 pb-2 border-b border-gray-800",children:[(0,w.jsx)("div",{className:`p-2 rounded bg-gray-900/50 border border-gray-700 ${e.color} shadow-lg`,children:(0,w.jsx)("span",{className:"text-xl",children:e.icon})}),(0,w.jsx)("h3",{className:"text-2xl font-bold uppercase tracking-[0.15em] text-gray-200 font-sans",children:e.label}),(0,w.jsx)("div",{className:"flex-grow h-px bg-gray-800/50"})]}),(0,w.jsx)("div",{className:"flex gap-8 overflow-x-auto pb-8 pt-2 pl-2 custom-scrollbar",children:t.map(e=>{let t=[e,...e.upgrades||[]];return(0,w.jsx)("div",{className:"flex flex-col items-center gap-4 min-w-[240px]",children:t.map((t,r)=>{let s=0===r,n=t.cost||0,i=t.cost_materials||0,a=(e=>{let t={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},r="",s;for(s in t)for(;e>=t[s];)r+=s,e-=t[s];return r})(t.level||r+1),o=s&&g.credits>=n&&g.materials>=i,l=!e.allowed_types||e.allowed_types.includes("any")||e.allowed_types.includes(x.planet_type),c=!e.allowed_factions||0===e.allowed_factions.length||e.allowed_factions.includes(v);return(0,w.jsxs)("div",{className:"flex flex-col items-center relative w-full",children:[r>0&&(0,w.jsx)("div",{className:"h-4 w-0.5 bg-gray-700/50 mb-2"}),(0,w.jsxs)("button",{onClick:()=>s&&b(e),disabled:!s||!o||!l||!c,className:`relative w-full group overflow-hidden transition-all duration-300 border
                                                                ${s?o&&l&&c?"bg-gray-900/80 border-gray-600 hover:border-[#cba660] hover:shadow-[0_0_25px_rgba(203,166,96,0.15)] hover:-translate-y-1":"bg-black/60 border-red-900/30 grayscale opacity-60 cursor-not-allowed hover:border-red-800":"bg-black/40 border-gray-800 border-dashed cursor-default opacity-70"}
                                                                rounded-xl`,children:[(0,w.jsxs)("div",{className:`h-24 w-full relative flex items-center justify-center border-b border-gray-800 ${s?"bg-gray-800/50":"bg-black/20"}`,children:[(0,w.jsx)("div",{className:"absolute top-2 left-2 flex flex-col gap-1 z-20",children:(0,w.jsxs)("div",{className:"bg-black/80 text-[#cba660] text-[9px] font-bold px-1.5 py-0.5 border border-[#cba660]/30 rounded shadow-sm backdrop-blur-sm",children:["TIER ",a]})}),!s&&(0,w.jsx)("div",{className:"absolute top-2 right-2 bg-blue-900/40 text-blue-200 text-[8px] px-1.5 py-0.5 rounded border border-blue-500/30 uppercase tracking-widest z-20",children:"Upgrade"}),(0,w.jsx)("span",{className:`text-4xl transition-transform duration-500 group-hover:scale-110 ${s?"text-gray-400 group-hover:text-[#cba660]":"text-gray-600"}`,children:(0,w.jsx)(pt,{})})]}),(0,w.jsxs)("div",{className:"p-4 text-left",children:[(0,w.jsxs)("div",{className:"text-sm font-bold text-gray-100 uppercase leading-none mb-3 group-hover:text-[#cba660] transition-colors truncate",children:[e.series_name||t.name,e.series_name&&(0,w.jsx)("span",{className:"text-[9px] text-gray-500 block normal-case mt-0.5",children:t.name})]}),t.production?.credits>0||t.production?.materials>0||t.production?.manpower>0||t.production?.science>0?(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[t.production.credits>0&&(0,w.jsxs)("span",{className:"text-[10px] bg-black/40 px-1 py-0.5 rounded text-green-400 flex items-center gap-1 border border-gray-800",children:["+",t.production.credits," ",(0,w.jsx)(h6,{className:"w-2.5 h-2.5"})]}),t.production.materials>0&&(0,w.jsxs)("span",{className:"text-[10px] bg-black/40 px-1 py-0.5 rounded text-blue-400 flex items-center gap-1 border border-gray-800",children:["+",t.production.materials," ",(0,w.jsx)(h8,{className:"w-2.5 h-2.5"})]}),t.production.manpower>0&&(0,w.jsxs)("span",{className:"text-[10px] bg-black/40 px-1 py-0.5 rounded text-green-600 flex items-center gap-1 border border-gray-800",children:["+",t.production.manpower," ",(0,w.jsx)(h9,{className:"w-2.5 h-2.5"})]}),t.production.science>0&&(0,w.jsxs)("span",{className:"text-[10px] bg-black/40 px-1 py-0.5 rounded text-purple-400 flex items-center gap-1 border border-gray-800",children:["+",t.production.science," ",(0,w.jsx)(h7,{className:"w-2.5 h-2.5"})]})]}):(0,w.jsx)("div",{className:"h-6 mb-3"}),t.unlocks_units&&t.unlocks_units.length>0&&(0,w.jsx)("div",{className:"mb-3 flex flex-wrap gap-1",children:t.unlocks_units.map(pp)}),(0,w.jsxs)("div",{className:"flex justify-between items-center pt-3 border-t border-gray-800/50",children:[s?(0,w.jsxs)("div",{className:"flex flex-col gap-0.5",children:[n>0&&(0,w.jsxs)("span",{className:`text-[10px] font-mono flex items-center gap-1 ${o?"text-yellow-600":"text-red-500"}`,children:[n," ",(0,w.jsx)(h6,{className:"w-2.5 h-2.5"})]}),i>0&&(0,w.jsxs)("span",{className:`text-[10px] font-mono flex items-center gap-1 ${g.materials>=i?"text-orange-500":"text-red-500"}`,children:[i," ",(0,w.jsx)(h8,{className:"w-2.5 h-2.5"})]})]}):(0,w.jsxs)("span",{className:"text-[10px] text-gray-500 font-mono",children:["Requis: T",r]}),(0,w.jsxs)("div",{className:"text-[10px] text-blue-400 font-mono flex items-center gap-1",children:[" ",t.turns_required||2,"t"]})]}),s&&(!l||!c)&&(0,w.jsx)("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-[1px] flex items-center justify-center z-30",children:(0,w.jsx)("span",{className:"text-red-500 text-xs font-bold uppercase border border-red-500/50 px-2 py-1 rounded bg-red-950/50",children:l?"Faction Non Autorise":"Climat Incompatible"})})]})]})]},r)})},e.id)})})]},e.id)}),f[14]=m,f[15]=g,f[16]=b,f[17]=x.planet_type,f[18]=v,f[19]=u):u=f[19],f[20]!==u?(h=(0,w.jsxs)("div",{className:"flex-grow overflow-y-auto p-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] custom-scrollbar space-y-16 relative",children:[d,u]}),f[20]=u,f[21]=h):h=f[21],f[22]!==h||f[23]!==c?(p=(0,w.jsx)("div",{className:"fixed inset-x-0 bottom-60 top-0 z-[90] flex flex-col justify-end bg-black/60 backdrop-blur-sm animate-in fade-in duration-300 pointer-events-none",children:(0,w.jsxs)("div",{className:"bg-gray-950/95 border-t border-gray-700 w-full h-full flex flex-col shadow-[0_-10px_50px_rgba(0,0,0,0.8)] relative animate-in slide-in-from-bottom-10 duration-500 pointer-events-auto overflow-hidden",children:[t,c,h]})}),f[22]=h,f[23]=c,f[24]=p):p=f[24],p},pc=e=>{let t,r,s,n,i,a,o,l,c,d,u,h,p,f,m,g,x=(0,_.c)(35),{onClose:b,onStart:y,customUnits:v}=e,j=void 0===v?[]:v,[k,S]=(0,N.useState)("space"),C=j.filter(pf),E=j.filter(pm);x[0]===Symbol.for("react.memo_cache_sentinel")?(t={fighter:5,corvette:2,frigate:1,cruiser:0,dreadnought:0},x[0]=t):t=x[0];let[I,T]=(0,N.useState)(t);x[1]===Symbol.for("react.memo_cache_sentinel")?(r={fighter:3,corvette:1,frigate:0,cruiser:0,dreadnought:0},x[1]=r):r=x[1];let[A,M]=(0,N.useState)(r);x[2]===Symbol.for("react.memo_cache_sentinel")?(s={turret:2},x[2]=s):s=x[2];let[R,P]=(0,N.useState)(s);x[3]===Symbol.for("react.memo_cache_sentinel")?(n={infantry:20,heavy_infantry:5,vehicle:2},x[3]=n):n=x[3];let[D,O]=(0,N.useState)(n);x[4]===Symbol.for("react.memo_cache_sentinel")?(i={infantry:15,heavy_infantry:5,vehicle:1,turret:4},x[4]=i):i=x[4];let[L,F]=(0,N.useState)(i),[U,z]=(0,N.useState)("plains");x[5]!==D||x[6]!==I||x[7]!==L||x[8]!==A||x[9]!==R||x[10]!==k||x[11]!==y||x[12]!==U?(a=()=>{"space"===k?y({mode:"space",attacker:I,defender:A,garrison:R}):y({mode:"ground",attacker:D,defender:L,planetType:U})},x[5]=D,x[6]=I,x[7]=L,x[8]=A,x[9]=R,x[10]=k,x[11]=y,x[12]=U,x[13]=a):a=x[13];let V=a;x[14]===Symbol.for("react.memo_cache_sentinel")?(o=(0,w.jsx)("h2",{className:"text-xl font-bold text-red-500",children:"Simulateur de Combat"}),x[14]=o):o=x[14],x[15]===Symbol.for("react.memo_cache_sentinel")?(l=()=>S("space"),x[15]=l):l=x[15];let $=`px-3 py-1 rounded text-xs font-bold uppercase ${"space"===k?"bg-blue-600 text-white":"bg-gray-800 text-gray-500"}`;x[16]!==$?(c=(0,w.jsx)("button",{onClick:l,className:$,children:"Espace"}),x[16]=$,x[17]=c):c=x[17],x[18]===Symbol.for("react.memo_cache_sentinel")?(d=()=>S("ground"),x[18]=d):d=x[18];let q=`px-3 py-1 rounded text-xs font-bold uppercase ${"ground"===k?"bg-orange-600 text-white":"bg-gray-800 text-gray-500"}`;x[19]!==q?(u=(0,w.jsx)("button",{onClick:d,className:q,children:"Sol"}),x[19]=q,x[20]=u):u=x[20],x[21]!==c||x[22]!==u?(h=(0,w.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-red-800 pb-2",children:[o,(0,w.jsxs)("div",{className:"flex gap-2",children:[c,u]})]}),x[21]=c,x[22]=u,x[23]=h):h=x[23];let B="space"===k?(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-blue-400 font-bold mb-2",children:"Attaquant (Rpublique)"}),Object.keys(h1).filter(pg).map(e=>(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1 bg-blue-900/20 p-1 rounded",children:[(0,w.jsx)("span",{className:"text-xs uppercase",children:e}),(0,w.jsx)("input",{type:"number",min:"0",value:I[e]||0,onChange:t=>T({...I,[e]:parseInt(t.target.value)}),className:"w-16 bg-black border border-blue-800 text-xs p-1"})]},e)),C.map(e=>(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1 bg-purple-900/20 p-1 rounded border border-purple-500/30",children:[(0,w.jsx)("span",{className:"text-xs uppercase text-purple-300",children:e.label}),(0,w.jsx)("input",{type:"number",min:"0",value:I[e.id]||0,onChange:t=>T({...I,[e.id]:parseInt(t.target.value)}),className:"w-16 bg-black border border-purple-800 text-xs p-1"})]},e.id))]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-red-400 font-bold mb-2",children:"Dfenseur (Empire)"}),Object.keys(h1).filter(px).map(e=>(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1 bg-red-900/20 p-1 rounded",children:[(0,w.jsx)("span",{className:"text-xs uppercase",children:e}),(0,w.jsx)("input",{type:"number",min:"0",value:A[e]||0,onChange:t=>M({...A,[e]:parseInt(t.target.value)}),className:"w-16 bg-black border border-red-800 text-xs p-1"})]},e)),C.map(e=>(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1 bg-purple-900/20 p-1 rounded border border-purple-500/30",children:[(0,w.jsx)("span",{className:"text-xs uppercase text-purple-300",children:e.label}),(0,w.jsx)("input",{type:"number",min:"0",value:A[e.id]||0,onChange:t=>M({...A,[e.id]:parseInt(t.target.value)}),className:"w-16 bg-black border border-purple-800 text-xs p-1"})]},e.id)),(0,w.jsx)("h4",{className:"text-xs text-yellow-500 mt-2 mb-1 uppercase font-bold",children:"Garnison Spatiale"}),(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1 bg-yellow-900/20 p-1 rounded",children:[(0,w.jsx)("span",{className:"text-xs uppercase",children:"Turret"}),(0,w.jsx)("input",{type:"number",min:"0",value:R.turret||0,onChange:e=>P({...R,turret:parseInt(e.target.value)}),className:"w-16 bg-black border border-yellow-800 text-xs p-1"})]})]})]}):(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-orange-400 font-bold mb-2",children:"Arme d'Invasion (Rp.)"}),Object.keys(h2).filter(pb).map(e=>(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1 bg-orange-900/20 p-1 rounded",children:[(0,w.jsx)("span",{className:"text-xs uppercase",children:h2[e].label}),(0,w.jsx)("input",{type:"number",min:"0",value:D[e]||0,onChange:t=>O({...D,[e]:parseInt(t.target.value)}),className:"w-16 bg-black border border-orange-800 text-xs p-1"})]},e)),E.map(e=>(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1 bg-purple-900/20 p-1 rounded border border-purple-500/30",children:[(0,w.jsx)("span",{className:"text-xs uppercase text-purple-300",children:e.label}),(0,w.jsx)("input",{type:"number",min:"0",value:D[e.id]||0,onChange:t=>O({...D,[e.id]:parseInt(t.target.value)}),className:"w-16 bg-black border border-purple-800 text-xs p-1"})]},e.id))]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-green-400 font-bold mb-2",children:"Garnison Plantaire (Emp.)"}),Object.keys(h2).map(e=>(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1 bg-green-900/20 p-1 rounded",children:[(0,w.jsx)("span",{className:"text-xs uppercase",children:h2[e].label}),(0,w.jsx)("input",{type:"number",min:"0",value:L[e]||0,onChange:t=>F({...L,[e]:parseInt(t.target.value)}),className:"w-16 bg-black border border-green-800 text-xs p-1"})]},e)),E.map(e=>(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1 bg-purple-900/20 p-1 rounded border border-purple-500/30",children:[(0,w.jsx)("span",{className:"text-xs uppercase text-purple-300",children:e.label}),(0,w.jsx)("input",{type:"number",min:"0",value:L[e.id]||0,onChange:t=>F({...L,[e.id]:parseInt(t.target.value)}),className:"w-16 bg-black border border-purple-800 text-xs p-1"})]},e.id)),(0,w.jsxs)("div",{className:"mt-4 pt-2 border-t border-gray-700",children:[(0,w.jsx)("label",{className:"text-xs uppercase text-gray-400 block mb-1",children:"Type de Terrain"}),(0,w.jsxs)("select",{value:U,onChange:e=>z(e.target.value),className:"w-full bg-black border border-gray-600 rounded p-1 text-xs text-white",children:[(0,w.jsx)("option",{value:"plains",children:"Plaines (Standard)"}),(0,w.jsx)("option",{value:"desert",children:"Dsert (Lent, Porte+)"}),(0,w.jsx)("option",{value:"urban",children:"Urbain (Rapide, Porte-)"}),(0,w.jsx)("option",{value:"snow",children:"Polaire (Lent, Prcision-)"}),(0,w.jsx)("option",{value:"volcanic",children:"Volcanique (Dgts+ sur temps?)"}),(0,w.jsx)("option",{value:"forest",children:"Fort (Couvert, Prcision+)"}),(0,w.jsx)("option",{value:"force_nexus",children:"Nexus de Force"}),(0,w.jsx)("option",{value:"industrial",children:"Industriel"})]})]})]})]});return x[24]!==b?(p=(0,w.jsx)("button",{onClick:b,className:"px-4 py-2 border border-gray-600 hover:bg-gray-800 rounded",children:"Annuler"}),x[24]=b,x[25]=p):p=x[25],x[26]!==V?(f=(0,w.jsx)("button",{onClick:V,className:"flex-grow px-4 py-2 bg-red-700 hover:bg-red-600 font-bold rounded shadow-lg uppercase tracking-widest",children:"Lancer Simulation"}),x[26]=V,x[27]=f):f=x[27],x[28]!==p||x[29]!==f?(m=(0,w.jsxs)("div",{className:"flex gap-3 mt-6",children:[p,f]}),x[28]=p,x[29]=f,x[30]=m):m=x[30],x[31]!==h||x[32]!==B||x[33]!==m?(g=(0,w.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:(0,w.jsxs)("div",{className:"bg-gray-900 border-2 border-red-900 w-[600px] p-6 shadow-2xl rounded text-white overflow-y-auto max-h-[90vh]",children:[h,B,m]})}),x[31]=h,x[32]=B,x[33]=m,x[34]=g):g=x[34],g};function pd({userFaction:e,userRole:t,userID:r,userName:s,heroData:n}){let[i,a]=(0,N.useState)(!1),[o,l]=(0,N.useState)(null),[c,d]=(0,N.useState)(!0),[u,h]=(0,N.useState)([]),[p,f]=(0,N.useState)([]),[m,g]=(0,N.useState)([]),[x,b]=(0,N.useState)(1),[y,v]=(0,N.useState)(null),[_,j]=(0,N.useState)(null),[k,S]=(0,N.useState)({credits:0,materials:0,manpower:0,science:0}),[C,E]=(0,N.useState)(!1),[I,T]=(0,N.useState)(!0),[A,M]=(0,N.useState)(null),[R,P]=(0,N.useState)([]),[D,O]=(0,N.useState)(!1),[L,F]=(0,N.useState)(!1),[U,z]=(0,N.useState)(!1),[V,$]=(0,N.useState)(!1),[q,B]=(0,N.useState)(!1),[H,G]=(0,N.useState)(!1),[W,K]=(0,N.useState)(!1),[X,Y]=(0,N.useState)([]),[Q,J]=(0,N.useState)([]),[Z,et]=(0,N.useState)(!1),[er,es]=(0,N.useState)(null),[en,ei]=(0,N.useState)(!1),[ea,eo]=(0,N.useState)({x:0,y:0,w:800,h:500}),[el,ec]=(0,N.useState)(!1),[ed,eu]=(0,N.useState)({x:0,y:0}),eh=(0,N.useRef)({x:0,y:0}),ep=(0,N.useRef)(null),[ef,em]=(0,N.useState)(null),[eg,ex]=(0,N.useState)(null),[eb,ey]=(0,N.useState)(!1),[ev,ew]=(0,N.useState)(!1),[e_,eN]=(0,N.useState)(!1),[ej,ek]=(0,N.useState)([]),[eS,eC]=(0,N.useState)(!1),[eE,eI]=(0,N.useState)(!1),[eT,eA]=(0,N.useState)(!1),[eM,eR]=(0,N.useState)(!1),[eP,eD]=(0,N.useState)(!1),[eO,eL]=(0,N.useState)(!1),[eF,eU]=(0,N.useState)([]),[ez,eV]=(0,N.useState)([]),[e$,eq]=(0,N.useState)(1),[eB,eH]=(0,N.useState)(1),[eG,eW]=(0,N.useState)(null),[eK,eX]=(0,N.useState)({x:0,y:0}),[eY,eQ]=(0,N.useState)(null),[eJ,eZ]=(0,N.useState)(""),[e0,e1]=(0,N.useState)("all"),[e2,e5]=(0,N.useState)("all"),[e4,e3]=(0,N.useState)("all"),[e6,e8]=(0,N.useState)([]),[e9,e7]=(0,N.useState)(!1),[te,tt]=(0,N.useState)(!1);(0,N.useEffect)(()=>{p.length>0&&0===e6.length&&e8(p.map(e=>e.id))},[p]);let[tr,ts]=(0,N.useState)(!1),[tn,ti]=(0,N.useState)(null),[ta,to]=(0,N.useState)([]),[tl,tc]=(0,N.useState)(null),[td,tu]=(0,N.useState)(null),th=A?u.find(e=>e.id===A.id):null,tp=th?.owner===e,tf=hY.includes(t),tm="admin"===t,tg=hQ.includes(t),tx=tg||_?.is_diplomat===!0||"diplomat"===t,tb=tg||_?.is_general===!0||"general"===t,ty=th?.governor_id&&String(th.governor_id)===String(r),tv=tp&&(tg||ty),tw=tb&&tp&&th||tg&&I||tf,t_=I||tf,tN=["admin","emperor","conseil"].includes(t),tj=V||q||H||eb||ev||W||i||e_||Z||e9,tk=e=>{let t=p.find(t=>t.id===e);return t?t.color:"#9ca3af"};(0,N.useEffect)(()=>{let e=oQ(aY(dY,"custom_units"),e=>{eU(e.docs.map(e=>({...e.data(),dbId:e.id})))}),t=oQ(aY(dY,"magic_domains"),e=>{ek(e.docs.map(e=>({...e.data(),id:e.id})))});return()=>{e(),t()}},[]),(0,N.useEffect)(()=>{console.log("Subscribing to regions...");let e=oQ(aY(dY,"regions"),e=>{let t=e.docs.map(e=>({...e.data(),id:e.id}));console.log("Filtered regions:",t),eV(t.sort((e,t)=>(e.name||"").localeCompare(t.name||"")))},e=>{console.error("Error fetching regions:",e)});return()=>e()},[]),(0,N.useEffect)(()=>{let t=oQ(aY(dY,"provinces"),e=>h(e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>e.name.localeCompare(t.name)))),s=oQ(aY(dY,"factions"),e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));t.find(e=>"neutral"===e.id)||t.push({id:"neutral",name:"Neutre",color:"#9ca3af",type:"minor"}),f(t)}),n=oQ(aY(dY,"buildings"),e=>g(e.docs.map(e=>({id:e.id,...e.data()})))),i=oQ(aJ(dY,"game_state","global"),e=>{if(e.exists()){let t=e.data();b(t.current_turn),T(t.fleets_enabled??!0)}}),a=()=>{},o=()=>{},l=()=>{};return e&&(o=oQ(aJ(dY,"factions",e),t=>{t.exists()?v(t.data()):(console.warn("Faction data missing for ID:",e),v({name:"Faction Dtruite",color:"#888888",credits:0,materials:0,manpower:0,science:0,diplomatic_phrases:{}}))}),r&&(a=oQ(aJ(dY,"users",r),e=>{e.exists()&&j(e.data())})),l=oQ(oT(aY(dY,"fleets")),e=>{J(e.docs.map(e=>({id:e.id,...e.data()})))})),()=>{t(),s(),n(),i(),a(),o(),l()}},[e,r]),(0,N.useEffect)(()=>{if(tg&&e){let t=oQ(oT(aY(dY,"users"),oM("faction_id","==",e)),e=>Y(e.docs.map(e=>({id:e.id,...e.data()}))));return()=>t()}},[e,tg]),(0,N.useEffect)(()=>{let e=ep.current,t=t=>{t.preventDefault();let r=e.getBoundingClientRect(),s=t.clientX-r.left,n=t.clientY-r.top,i=ea.x+s/r.width*ea.w,a=ea.y+n/r.height*ea.h,o=t.deltaY>0?1.1:.9,l=Math.max(200,Math.min(25e3,ea.w*o)),c=Math.max(125,Math.min(25e3,ea.h*o));eo({x:i-s/r.width*l,y:a-n/r.height*c,w:l,h:c})};return e&&e.addEventListener("wheel",t,{passive:!1}),()=>{e&&e.removeEventListener("wheel",t)}},[ea]),(0,N.useEffect)(()=>{if(!e||0===u.length)return;let t=u.filter(t=>t.owner===e).map(e=>e.id),r=oT(aQ(dY,"constructions"),oM("finish_turn","<=",x)),s=Q.filter(t=>t.owner===e),n=oQ(r,r=>{let n={credits:0,materials:0,manpower:0,science:0};r.forEach(e=>{let r=e.data();e.ref.parent?.parent&&t.includes(e.ref.parent.parent.id)&&(r.production&&(n.credits+=Number(r.production.credits)||0,n.materials+=Number(r.production.materials)||0,n.manpower+=Number(r.production.manpower)||0,n.science+=Number(r.production.science)||0),r.maintenance&&(n.credits-=Number(r.maintenance.credits)||0,n.materials-=Number(r.maintenance.materials)||0,n.manpower-=Number(r.maintenance.manpower)||0))}),s.forEach(e=>{e.composition&&Object.entries(e.composition).forEach(([e,t])=>{let r=h0[e];r&&(n.credits-=r.cr*t,n.manpower-=r.mp*t)})}),u.filter(t=>t.owner===e).forEach(e=>{e.garrison&&Object.entries(e.garrison).forEach(([e,t])=>{let r=h5[e];r&&(n.credits-=r.cr*t,n.manpower-=r.mp*t)})}),S(n)});return()=>n()},[e,u,x,Q]);let tS=async e=>{if(!o)return;if(o.isSimulation){l(null),alert(`Simulation Termin\xe9e !
Vainqueur : ${e.winner.toUpperCase()}

Survivants Atttaquant : ${e.survivingAttackers.length}
Survivants D\xe9fenseur : ${e.survivingDefenders.length}`);return}let{winner:t,survivingAttackers:r}=e,{attackerFleet:s,defenderPlanet:n,defenderFleets:i}=o,a=o3(dY),c={};if(r.forEach(e=>{e.type&&"turret"!==e.type&&(c[e.type]=(c[e.type]||0)+1)}),"attacker"===t){let e=n.owner;a.update(aJ(dY,"provinces",n.id),{owner:s.owner,color:tk(s.owner),governor_id:null,governor_name:null,garrison:{}}),a.update(aJ(dY,"fleets",s.id),{location_id:s.destination_id,location_name:n.name,destination_id:null,arrival_turn:null,status:"stationed",path:null,start_turn:null,composition:c}),a.set(aJ(aY(dY,"notifications")),{targetId:s.owner,type:"battle",title:"Victoire !",message:`Nous avons conquis ${n.name}.`,read:!1,createdAt:new Date}),e&&"neutral"!==e&&a.set(aJ(aY(dY,"notifications")),{targetId:e,type:"battle",title:"Invasion",message:`Nous avons perdu ${n.name}.`,read:!1,createdAt:new Date}),i.forEach(e=>a.delete(aJ(dY,"fleets",e.id)))}else a.delete(aJ(dY,"fleets",s.id)),a.set(aJ(aY(dY,"notifications")),{targetId:s.owner,type:"battle",title:"Dfaite",message:`Notre flotte a \xe9t\xe9 d\xe9truite sur ${n.name}.`,read:!1,createdAt:new Date}),n.owner&&"neutral"!==n.owner&&a.set(aJ(aY(dY,"notifications")),{targetId:n.owner,type:"battle",title:"Victoire Dfensive",message:`Invasion repouss\xe9e sur ${n.name}.`,read:!1,createdAt:new Date});await a.commit(),l(null)},tC=async()=>{if(!C&&confirm(`Passer au Tour ${x+1} ?`)){E(!0);try{let e=o3(dY),t={};p.forEach(e=>t[e.id]={credits:0,materials:0,manpower:0,science:0});let r=await oG(aY(dY,"provinces")),s=await oG(aY(dY,"fleets")),n={};r.forEach(e=>n[e.id]={id:e.id,...e.data()});let i=[];if(s.forEach(e=>i.push({id:e.id,...e.data()})),c){for(let e of i)if("moving"===e.status&&e.arrival_turn<=x+1){let t=n[e.destination_id];if(t&&"neutral"!==t.owner&&t.owner!==e.owner){let r=i.filter(e=>e.location_id===t.id&&"stationed"===e.status&&e.owner===t.owner);l({attackerFleet:e,defenderPlanet:t,defenderFleets:r}),E(!1);return}}}r.forEach(e=>{let r=e.data();r.owner&&t[r.owner]&&r.garrison&&Object.entries(r.garrison).forEach(([e,s])=>{let n=h5[e];n&&(t[r.owner].credits-=n.cr*s,t[r.owner].manpower-=n.mp*s)})});let a=[];s.forEach(e=>a.push({id:e.id,...e.data()}));let o=oT(aQ(dY,"constructions"),oM("finish_turn","<=",x));for(let r of((await oG(o)).forEach(e=>{let r=e.data(),s=e.ref.parent.parent.id,i=n[s]?.owner;i&&t[i]&&(r.production&&(t[i].credits+=Number(r.production.credits)||0,t[i].materials+=Number(r.production.materials)||0,t[i].manpower+=Number(r.production.manpower)||0,t[i].science+=Number(r.production.science)||0),r.maintenance&&(t[i].credits-=Number(r.maintenance.credits)||0,t[i].materials-=Number(r.maintenance.materials)||0,t[i].manpower-=Number(r.maintenance.manpower)||0))}),a))if(r.owner&&t[r.owner]&&r.composition&&Object.entries(r.composition).forEach(([e,s])=>{let n=h0[e];n&&(t[r.owner].credits-=n.cr*s,t[r.owner].manpower-=n.mp*s)}),"moving"===r.status&&r.arrival_turn<=x+1){let t=n[r.destination_id];if(t)if("neutral"!==t.owner&&t.owner!==r.owner){let s=a.filter(e=>e.location_id===t.id&&"stationed"===e.status&&e.owner===t.owner),n=h3(r,t,s);if(n.attackerWon){let i=t.owner;e.update(aJ(dY,"provinces",t.id),{owner:r.owner,color:tk(r.owner),governor_id:null,governor_name:null}),e.update(aJ(dY,"fleets",r.id),{location_id:r.destination_id,location_name:t.name,destination_id:null,arrival_turn:null,status:"stationed",path:null,start_turn:null,composition:n.newAttackerComposition}),e.set(aJ(aY(dY,"notifications")),{targetId:r.owner,type:"battle",title:"Victoire Majeure !",message:n.reportLog,read:!1,createdAt:new Date}),e.set(aJ(aY(dY,"notifications")),{targetId:i,type:"battle",title:"Alerte Invasion",message:`Nous avons perdu ${t.name} et nos flottes ont \xe9t\xe9 an\xe9anties.`,read:!1,createdAt:new Date}),s.forEach(t=>e.delete(aJ(dY,"fleets",t.id)))}else e.delete(aJ(dY,"fleets",r.id)),e.set(aJ(aY(dY,"notifications")),{targetId:r.owner,type:"battle",title:"Dfaite Totale",message:n.reportLog,read:!1,createdAt:new Date}),e.set(aJ(aY(dY,"notifications")),{targetId:t.owner,type:"battle",title:"Victoire Dfensive",message:`L'invasion de ${t.name} a \xe9t\xe9 repouss\xe9e avec succ\xe8s.`,read:!1,createdAt:new Date})}else"neutral"===t.owner&&(e.update(aJ(dY,"provinces",t.id),{owner:r.owner,color:tk(r.owner)}),e.set(aJ(aY(dY,"notifications")),{targetId:r.owner,type:"info",title:"Colonisation",message:`${t.name} est maintenant sous notre contr\xf4le.`,read:!1,createdAt:new Date})),e.update(aJ(dY,"fleets",r.id),{location_id:r.destination_id,location_name:t.name,destination_id:null,arrival_turn:null,status:"stationed",path:null,start_turn:null})}for(let[r,s]of Object.entries(t))"neutral"!==r&&p.find(e=>e.id===r)&&e.update(aJ(dY,"factions",r),{credits:o4(s.credits),materials:o4(s.materials),manpower:o4(s.manpower),science:o4(s.science)});e.update(aJ(dY,"game_state","global"),{current_turn:o4(1)}),await e.commit()}catch(e){console.error(e)}finally{E(!1)}}},tE=async()=>{try{await oW(aJ(dY,"game_state","global"),{fleets_enabled:!I},{merge:!0})}catch(e){console.error(e)}},tI=e=>{eo(t=>({...t,x:e.x-t.w/2,y:e.y-t.h/2}))},tT=(0,N.useCallback)(async e=>{if(!ef)return;let t=u.find(e=>e.id===ef.location_id);if(!t){console.error("Plante source introuvable"),em(null);return}let r=((e,t,r)=>{let s={};r.forEach(e=>{s[e.id]=e.connected_to||[]});let n={},i={},a=[];for(r.forEach(e=>{n[e.id]=1/0,i[e.id]=null,a.push(e.id)}),n[e]=0;a.length>0;){let r=a.reduce((e,t)=>n[t]<n[e]?t:e,a[0]);if(r===t){let t=[];for(;i[r];)t.unshift(r),r=i[r];return t.unshift(e),t}let o=a.indexOf(r);if(o>-1&&a.splice(o,1),n[r]===1/0)break;s[r]&&s[r].forEach(e=>{if(a.includes(e)){let t=n[r]+1;t<n[e]&&(n[e]=t,i[e]=r)}})}return null})(t.id,e.id,u);if(!r){alert("Aucune route disponible."),em(null);return}let s=0;for(let e=0;e<r.length-1;e++){let t=u.find(t=>t.id===r[e]),n=u.find(t=>t.id===r[e+1]);t&&n&&(s+=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2)))}ex({fleet:ef,target:e,path:r,turns:Math.max(1,Math.ceil(s/75)),source:t})},[ef,u]),tA=async()=>{if(!eg)return;let{fleet:e,target:t,path:r,turns:s}=eg;try{await oK(aJ(dY,"fleets",e.id),{destination_id:t.id,arrival_turn:x+s,status:"moving",path:r,start_turn:x}),em(null),ex(null)}catch(e){console.error("Erreur mouvement flotte:",e)}},tM=(0,N.useCallback)(e=>{if(ec(!1),15>Math.sqrt(Math.pow(e.clientX-eh.current.x,2)+Math.pow(e.clientY-eh.current.y,2)))if(en){let t=ep.current.getBoundingClientRect();eX({x:Math.round(ea.x+(e.clientX-t.left)*(ea.w/t.width)),y:Math.round(ea.y+(e.clientY-t.top)*(ea.h/t.height))}),eC(!0)}else M(null),O(!1),z(!1)},[en,ea]),tR=(0,N.useCallback)((e,t)=>{if(e.stopPropagation(),!(Math.sqrt(Math.pow(e.clientX-eh.current.x,2)+Math.pow(e.clientY-eh.current.y,2))>15)){if(te)return void(eY?t.id===eY.id?eQ(null):t.connected_to?.includes(eY.id)?(oK(aJ(dY,"provinces",eY.id),{connected_to:o5(t.id)}),oK(aJ(dY,"provinces",t.id),{connected_to:o5(eY.id)})):(oK(aJ(dY,"provinces",eY.id),{connected_to:o2(t.id)}),oK(aJ(dY,"provinces",t.id),{connected_to:o2(eY.id)})):eQ(t));if(en)return eY?t.id===eY.id?void eQ(null):(oK(aJ(dY,"provinces",eY.id),{connected_to:o2(t.id)}),oK(aJ(dY,"provinces",t.id),{connected_to:o2(eY.id)}),void eQ(null)):(eW(t),void eI(!0));if(ef)return void tT(t);M(t),oQ(oT(aY(dY,`provinces/${t.id}/constructions`)),e=>P(e.docs.map(e=>({id:e.id,...e.data()}))))}},[en,eY,ef,tT,te]),tP=async e=>{e.preventDefault();let t=new FormData(e.target);try{await oY(aY(dY,"factions"),{name:t.get("name"),color:t.get("color"),image:t.get("image"),diplomatic_phrases:{war:t.get("phrase_war"),alliance:t.get("phrase_alliance"),neutral_good:t.get("phrase_good"),neutral_bad:t.get("phrase_bad")},type:"minor",credits:1e3,materials:500,manpower:100}),e.target.reset()}catch(e){console.error(e)}},tD=async e=>{if(e.preventDefault(),!er)return;let t=new FormData(e.target);try{await oK(aJ(dY,"factions",er.id),{name:t.get("name"),color:t.get("color"),image:t.get("image"),diplomatic_phrases:{war:t.get("phrase_war"),alliance:t.get("phrase_alliance"),neutral_good:t.get("phrase_good"),neutral_bad:t.get("phrase_bad")}}),es(null),e.target.reset()}catch(e){console.error(e)}},tO=async e=>{e.preventDefault();let t=new FormData(e.target),r={name:t.get("level_1_name"),series_name:t.get("series_name"),description:t.get("description"),category:t.get("category")||"economic",group:t.get("group")||null,allowed_types:t.getAll("allowed_types"),allowed_factions:t.getAll("allowed_factions"),max_levels:e$,turns_required:Number(t.get("level_1_turns")),cost:Number(t.get("level_1_cost_credits")),cost_materials:Number(t.get("level_1_cost_materials")),production:{credits:Number(t.get("level_1_prod_credits"))||0,materials:Number(t.get("level_1_prod_materials"))||0,manpower:Number(t.get("level_1_prod_manpower"))||0,science:Number(t.get("level_1_prod_science"))||0},unlocks_units:t.getAll("level_1_unlocks"),maintenance:{credits:Number(t.get("level_1_maint_credits"))||0,materials:Number(t.get("level_1_maint_materials"))||0,manpower:Number(t.get("level_1_maint_manpower"))||0},upgrades:[]};for(let e=2;e<=e$;e++)r.upgrades.push({level:e,name:t.get(`level_${e}_name`),turns_required:Number(t.get(`level_${e}_turns`)),cost:Number(t.get(`level_${e}_cost_credits`)),cost_materials:Number(t.get(`level_${e}_cost_materials`)),production:{credits:Number(t.get(`level_${e}_prod_credits`))||0,materials:Number(t.get(`level_${e}_prod_materials`))||0,manpower:Number(t.get(`level_${e}_prod_manpower`))||0,science:Number(t.get(`level_${e}_prod_science`))||0},unlocks_units:t.getAll(`level_${e}_unlocks`),maintenance:{credits:Number(t.get(`level_${e}_maint_credits`))||0,materials:Number(t.get(`level_${e}_maint_materials`))||0,manpower:Number(t.get(`level_${e}_maint_manpower`))||0}});try{td?(await oK(aJ(dY,"buildings",td.id),r),tu(null)):await oY(aY(dY,"buildings"),r),e.target.reset(),eq(1),alert("Plan sauvegard !")}catch(e){console.error(e)}},tL=async e=>{e.preventDefault();let t=new FormData(e.target);try{await oY(aY(dY,"provinces"),{name:t.get("name"),region:t.get("region"),owner:t.get("owner"),planet_type:t.get("type"),color:tk(t.get("owner")),x:eK.x,y:eK.y,connected_to:[],population:Number(t.get("population"))||0,base_production:{credits:Number(t.get("prod_credits"))||0,materials:Number(t.get("prod_materials"))||0}}),eC(!1)}catch(e){console.error(e)}},tF=async e=>{if(e.preventDefault(),!eG)return;let t=new FormData(e.target);try{await oK(aJ(dY,"provinces",eG.id),{name:t.get("name"),region:t.get("region"),planet_type:t.get("planet_type"),owner:t.get("owner"),color:t.get("color"),ground_map_id:t.get("ground_map_id"),population:Number(t.get("population"))||0,base_production:{credits:Number(t.get("prod_credits"))||0,materials:Number(t.get("prod_materials"))||0}}),eI(!1)}catch(e){console.error(e)}},tU=async()=>{if(!eG||!confirm("Supprimer ?"))return;let e=o3(dY);e.delete(aJ(dY,"provinces",eG.id)),u.filter(e=>e.connected_to?.includes(eG.id)).forEach(t=>{e.update(aJ(dY,"provinces",t.id),{connected_to:o5(eG.id)})}),await e.commit(),eI(!1)},tz=async e=>{await oK(aJ(dY,"provinces",eG.id),{connected_to:o5(e)}),await oK(aJ(dY,"provinces",e),{connected_to:o5(eG.id)})},tV=async t=>{if(!tv)return alert("Accs refus");if(!y)return alert("Donnes de faction introuvables");let r=t.cost||0,s=t.cost_materials||0;if((y.credits||0)<r||(y.materials||0)<s)return alert("Ressources insuffisantes");try{await oY(aY(dY,`provinces/${A.id}/constructions`),{name:t.name,template_id:t.id,level:1,started_at_turn:x,finish_turn:x+t.turns_required,cost:r,cost_materials:s,production:t.production||{},maintenance:t.maintenance||{}}),await oK(aJ(dY,"factions",e),{credits:o4(-r),materials:o4(-s)}),O(!1)}catch(e){console.error(e)}},t$=async t=>{if(!tv)return;if(!y)return alert("Donnes de faction introuvables");let r=m.find(e=>e.id===t.template_id),s=r?.upgrades?.find(e=>e.level===(t.level||1)+1);if(!s)return;let n=s.cost||0,i=s.cost_materials||0;if((y.credits||0)<n||(y.materials||0)<i)return alert("Ressources insuffisantes");if(confirm(`Am\xe9liorer ?`))try{await oK(aJ(dY,`provinces/${A.id}/constructions`,t.id),{name:s.name,level:s.level,started_at_turn:x,finish_turn:x+s.turns_required,cost:n,cost_materials:i,production:s.production||{},maintenance:s.maintenance||{}}),await oK(aJ(dY,"factions",e),{credits:o4(-n),materials:o4(-i)})}catch(e){console.error(e)}},tq=async t=>{if(tv&&confirm(`D\xe9molir ?`))try{await oX(aJ(dY,`provinces/${A.id}/constructions`,t.id)),await oK(aJ(dY,"factions",e),{credits:o4(.5*(t.cost||0)),materials:o4(.5*(t.cost_materials||0))})}catch(e){console.error(e)}},tB=async t=>{if(tv&&confirm("Annuler ?"))try{await oX(aJ(dY,`provinces/${A.id}/constructions`,t.id)),await oK(aJ(dY,"factions",e),{credits:o4(t.cost||0),materials:o4(t.cost_materials||0)})}catch(e){console.error(e)}},tH=async()=>{tm?Y((await oG(aY(dY,"users"))).docs.map(e=>({id:e.id,...e.data()}))):e&&Y((await oG(oT(aY(dY,"users"),oM("faction_id","==",e)))).docs.map(e=>({id:e.id,...e.data()})))},tG=async e=>{confirm(`Nommer ${e.pseudo} ?`)&&(await oK(aJ(dY,"provinces",A.id),{governor_id:e.id,governor_name:e.pseudo}),M(t=>({...t,governor_id:e.id,governor_name:e.pseudo})),z(!1))},tW=async t=>{if(!tv||!A)return;if(!y)return alert("Donnes de faction introuvables");let r=h4[t];if(!r)return;let s=r.cost;if((y.credits||0)<s.cr||(y.manpower||0)<s.mp)return alert("Ressources insuffisantes");let n=A.garrison||{},i=(n[t]||0)+1,a={...n,[t]:i};try{await oK(aJ(dY,"provinces",A.id),{garrison:a}),await oK(aJ(dY,"factions",e),{credits:o4(-s.cr),manpower:o4(-s.mp)}),M(e=>({...e,garrison:a}))}catch(e){console.error(e)}},tK=async e=>{if(!tv||!A)return;let t=A.garrison||{},r=t[e]||0;if(r<=0)return;let s={...t,[e]:r-1};0===s[e]&&delete s[e];try{await oK(aJ(dY,"provinces",A.id),{garrison:s}),M(e=>({...e,garrison:s}))}catch(e){console.error(e)}},tX=Array(th?hJ[th.planet_type]||4:0).fill(null).map((e,t)=>R[t]||null),tY=(0,N.useCallback)(e=>{let t=ez.find(t=>t.name===e),r=u.filter(t=>t.region===e);tc({name:e,description:t?.description||"",planets:r})},[ez,u]),tQ=(0,N.useMemo)(()=>p.length>0&&e6.length===p.length?u:u.filter(e=>{let t=e.owner||"neutral";return e6.includes(t)}),[u,e6,p]),tJ=(0,N.useMemo)(()=>p.filter(e=>e6.includes(e.id)),[p,e6]),tZ=(0,N.useMemo)(()=>Q.filter(e=>e6.includes(e.owner)),[Q,e6]);return(0,N.useMemo)(()=>Q.filter(e=>e6.includes(e.owner)&&"stationed"===e.status),[Q,e6]),(0,w.jsxs)("div",{className:`flex flex-col h-screen w-screen fixed inset-0 overflow-hidden bg-black select-none font-sans ${ef?"cursor-crosshair":""}`,children:[(0,w.jsxs)("div",{className:"flex-grow flex relative overflow-hidden z-0 bg-black",children:[en&&(0,w.jsxs)("div",{className:"absolute top-0 left-0 bottom-0 w-64 bg-gray-900 border-r border-gray-700 flex flex-col z-[60] shadow-2xl opacity-95",children:[(0,w.jsxs)("div",{className:"p-3 border-b border-gray-800 bg-gray-900 space-y-2",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center",children:[(0,w.jsx)("h3",{className:"text-yellow-500 font-bold uppercase text-xs tracking-widest",children:"Architecture"}),(0,w.jsx)("button",{onClick:()=>{ei(!1),tt(!1)},className:"text-[10px] text-red-400 border border-red-900 px-1 rounded hover:bg-red-900",children:"Fermer"})]}),(0,w.jsxs)("button",{onClick:()=>{tt(!te),eQ(null)},className:`w-full text-[10px] py-1 rounded font-bold uppercase border ${te?"bg-blue-600 text-white border-blue-400":"bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700"}`,children:[" Mode Routes ",te?"(ON)":""]}),(0,w.jsx)("button",{onClick:()=>eA(!0),className:"w-full bg-purple-900/30 border border-purple-800 text-purple-300 text-[10px] py-1 rounded font-bold uppercase",children:" Grer Factions"}),(0,w.jsx)("button",{onClick:()=>eL(!0),className:"w-full bg-orange-900/30 border border-orange-800 text-orange-300 text-[10px] py-1 rounded font-bold uppercase",children:" Grer Rgions"}),(0,w.jsx)("button",{onClick:()=>eR(!0),className:"w-full bg-blue-900/30 border border-blue-800 text-blue-300 text-[10px] py-1 rounded font-bold uppercase",children:" Grer Btiments"}),(0,w.jsx)("button",{onClick:()=>eD(!0),className:"w-full bg-green-900/30 border border-green-800 text-green-300 text-[10px] py-1 rounded font-bold uppercase",children:" Grer Units"}),(0,w.jsxs)("div",{className:"space-y-2 pt-2 border-t border-gray-800",children:[(0,w.jsx)("input",{type:"text",placeholder:"Rechercher une plante...",className:"w-full bg-black border border-gray-700 text-white text-[10px] p-2 rounded outline-none focus:border-yellow-500 transition-colors",onChange:e=>eZ(e.target.value)}),(0,w.jsxs)("select",{value:e0,onChange:e=>e1(e.target.value),className:"w-full bg-black border border-gray-700 text-white text-[10px] p-1 rounded outline-none focus:border-yellow-500",children:[(0,w.jsx)("option",{value:"all",children:"Toutes Factions"}),p.map(e=>(0,w.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,w.jsxs)("div",{className:"flex gap-2",children:[(0,w.jsxs)("select",{value:e2,onChange:e=>e5(e.target.value),className:"w-1/2 bg-black border border-gray-700 text-white text-[10px] p-1 rounded outline-none focus:border-yellow-500",children:[(0,w.jsx)("option",{value:"all",children:"Tous Types"}),Object.keys(hJ).map(e=>(0,w.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")},e))]}),(0,w.jsxs)("select",{value:e4,onChange:e=>e3(e.target.value),className:"w-1/2 bg-black border border-gray-700 text-white text-[10px] p-1 rounded outline-none focus:border-yellow-500",children:[(0,w.jsx)("option",{value:"all",children:"Toutes Rgions"}),[...new Set(u.map(e=>e.region).filter(Boolean))].sort().map(e=>(0,w.jsx)("option",{value:e,children:e},e))]})]})]})]}),(0,w.jsx)("div",{className:"flex-grow overflow-y-auto custom-scrollbar",children:u.filter(e=>{let t=e.name.toLowerCase().includes(eJ.toLowerCase()),r="all"===e0||e.owner===e0,s="all"===e2||e.planet_type===e2,n="all"===e4||e.region===e4;return t&&r&&s&&n}).map(e=>(0,w.jsxs)("div",{className:"p-2 border-b border-gray-800 hover:bg-gray-800 flex justify-between items-center group cursor-pointer",onClick:()=>tI(e),children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color||"#fff"}}),(0,w.jsx)("div",{className:"text-xs text-gray-300",children:e.name})]}),(0,w.jsx)("button",{onClick:t=>{t.stopPropagation(),eW(e),eI(!0)},className:"text-gray-500 hover:text-white opacity-0 group-hover:opacity-100 transition-opacity",children:""})]},e.id))})]}),(0,w.jsx)("div",{className:"absolute bottom-4 left-4 z-50 pointer-events-auto",children:(0,w.jsxs)("div",{className:"flex items-end gap-2",children:[!en&&!th&&!tj&&(0,w.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-900/95 border border-gray-700 rounded-xl shadow-2xl backdrop-blur-md",children:[tg&&(0,w.jsx)("button",{onClick:()=>B(!0),className:"group relative w-12 h-12 bg-gray-800 rounded-lg border border-yellow-600/50 hover:bg-yellow-900/50 hover:border-yellow-400 transition-all flex items-center justify-center text-2xl shadow-lg",title:"Conseil Noir",children:(0,w.jsx)("span",{className:"group-hover:scale-110 transition-transform",children:""})}),tx&&(0,w.jsx)("button",{onClick:()=>$(!0),className:"group relative w-12 h-12 bg-gray-800 rounded-lg border border-orange-600/50 hover:bg-orange-900/50 hover:border-orange-400 transition-all flex items-center justify-center text-2xl shadow-lg",title:"Diplomatie",children:(0,w.jsx)("span",{className:"group-hover:scale-110 transition-transform",children:""})}),tw&&(0,w.jsx)("button",{onClick:()=>G(!0),className:"group relative w-12 h-12 bg-gray-800 rounded-lg border border-green-600/50 hover:bg-green-900/50 hover:border-green-400 transition-all flex items-center justify-center text-2xl shadow-lg",title:"Gestion de Flotte",children:(0,w.jsx)("span",{className:"group-hover:scale-110 transition-transform",children:""})}),tg&&(0,w.jsx)("button",{onClick:()=>ey(!0),className:"group relative w-12 h-12 bg-gray-800 rounded-lg border border-blue-600/50 hover:bg-blue-900/50 hover:border-blue-400 transition-all flex items-center justify-center text-2xl shadow-lg",title:"Recherche & Technologie",children:(0,w.jsx)("span",{className:"group-hover:scale-110 transition-transform",children:""})}),(0,w.jsx)("div",{className:"w-px h-8 bg-gray-700 mx-1"}),(0,w.jsx)("button",{onClick:()=>ew(!0),className:"group relative w-10 h-10 bg-gray-800 rounded-lg border border-cyan-600/50 hover:bg-cyan-900/50 hover:border-cyan-400 transition-all flex items-center justify-center text-xl shadow-lg",title:"Encyclopdie",children:(0,w.jsx)("span",{className:"group-hover:scale-110 transition-transform",children:""})}),(0,w.jsx)("button",{onClick:()=>e7(!0),className:"group relative w-10 h-10 bg-gray-800 rounded-lg border border-white/30 hover:bg-white/10 hover:border-white/60 transition-all flex items-center justify-center text-xl shadow-lg",title:"Filtres de Carte",children:(0,w.jsx)("span",{className:"group-hover:scale-110 transition-transform",children:""})})]}),!en&&(tf||"admin"===t)&&!tj&&(0,w.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-black/80 border border-gray-800 rounded-xl shadow-2xl backdrop-blur-md",children:[tf&&(0,w.jsx)("button",{onClick:()=>ei(!0),className:"w-8 h-8 rounded border border-purple-500/50 text-purple-400 hover:bg-purple-900/50 hover:text-white transition flex items-center justify-center text-sm",title:"Mode diteur",children:""}),(0,w.jsx)("button",{onClick:()=>{tt(!te),eQ(null)},className:`w-8 h-8 rounded border transition flex items-center justify-center text-sm ${te?"border-blue-500 bg-blue-900/50 text-white shadow-[0_0_10px_rgba(37,99,235,0.5)]":"border-blue-500/50 text-blue-400 hover:bg-blue-900/50 hover:text-white"}`,title:"Mode Routes",children:""}),tf&&(0,w.jsx)("button",{onClick:()=>eN(!0),className:"w-8 h-8 rounded border border-fuchsia-500/50 text-fuchsia-400 hover:bg-fuchsia-900/50 hover:text-white transition flex items-center justify-center text-sm",title:"diteur Magie",children:""}),"admin"===t&&(0,w.jsx)("button",{onClick:()=>a(!0),className:"w-8 h-8 rounded border border-red-500/50 text-red-500 hover:bg-red-900/50 hover:text-white transition flex items-center justify-center text-sm",title:"Simulateur Combat",children:""}),tf&&(0,w.jsx)("button",{onClick:()=>et(!0),className:"w-8 h-8 rounded border border-gray-600 text-gray-400 hover:bg-gray-700 hover:text-white transition flex items-center justify-center text-base",title:"Paramtres",children:""})]})]})}),ef&&(0,w.jsxs)("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-50 bg-yellow-900/90 text-white px-6 py-2 rounded-full border border-yellow-500 shadow-[0_0_20px_rgba(234,179,8,0.5)] animate-pulse flex items-center gap-3 pointer-events-none",children:[(0,w.jsx)("span",{className:"text-xl",children:""}),(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{className:"text-[10px] font-bold uppercase text-yellow-200",children:"Ordre en cours pour"}),(0,w.jsx)("div",{className:"font-bold font-mono text-sm",children:ef.name})]}),(0,w.jsx)("div",{className:"text-[10px] text-gray-300 ml-2",children:" Slectionnez une destination"})]}),!en&&!V&&(0,w.jsx)("div",{className:tN?"mt-24 transition-all duration-500":"",children:(0,w.jsx)(pi,{userFaction:e,factionData:y,projectedIncome:k,currentTurn:x,isAdmin:tm,isProcessingTurn:C,handleNextTurn:tC,handleLogout:()=>ee(dQ).signOut(),onOpenProfile:()=>K(!0),onOpenMapEditor:()=>ts(!0)})}),(0,w.jsxs)("svg",{ref:ep,viewBox:`${ea.x} ${ea.y} ${ea.w} ${ea.h}`,className:`w-full h-full cursor-move ${en?"cursor-crosshair":""}`,preserveAspectRatio:"xMidYMid slice",onMouseDown:e=>{(0===e.button||1===e.button)&&(ec(!0),eu({x:e.clientX,y:e.clientY}),eh.current={x:e.clientX,y:e.clientY})},onMouseMove:e=>{if(el){let t=ep.current.getBoundingClientRect();eo(r=>({...r,x:r.x-(e.clientX-ed.x)*(r.w/t.width),y:r.y-(e.clientY-ed.y)*(r.h/t.height)})),eu({x:e.clientX,y:e.clientY})}},onMouseUp:tM,onMouseLeave:()=>ec(!1),children:[(0,w.jsx)(hH,{}),(0,w.jsx)(hG,{}),!te&&(0,w.jsx)(uW,{planets:u,factions:tJ,onRegionClick:tY}),(0,w.jsx)(hW,{planets:tQ}),(0,w.jsx)(hK,{fleets:tZ,planets:u,currentTurn:x,shouldShowFleets:t_,fleetMovePreview:eg}),(0,w.jsx)(hX,{planets:tQ,factions:tJ,fleets:tZ,activePlanet:th,shouldShowFleets:t_,onPlanetClick:tR,zoomLevel:ea.w})]})]}),e9&&(0,w.jsxs)("div",{className:"absolute bottom-20 left-4 bg-gray-900 border border-gray-700 p-4 rounded-xl shadow-2xl w-64 z-50 animate-in slide-in-from-bottom-5",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-gray-800",children:[(0,w.jsx)("h3",{className:"text-white font-bold uppercase text-xs tracking-wider",children:"Calques Factions"}),(0,w.jsx)("button",{onClick:()=>e7(!1),className:"text-gray-400 hover:text-white",children:""})]}),(0,w.jsxs)("div",{className:"flex flex-col gap-2 max-h-60 overflow-y-auto custom-scrollbar",children:[(0,w.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,w.jsx)("button",{onClick:()=>e8(p.map(e=>e.id)),className:"flex-1 bg-gray-800 hover:bg-gray-700 text-[9px] text-gray-300 py-1 rounded",children:"Tout Afficher"}),(0,w.jsx)("button",{onClick:()=>e8([]),className:"flex-1 bg-gray-800 hover:bg-gray-700 text-[9px] text-gray-300 py-1 rounded",children:"Tout Masquer"})]}),p.map(e=>(0,w.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-white/5 p-1 rounded transition-colors group",children:[(0,w.jsx)("input",{type:"checkbox",checked:e6.includes(e.id),onChange:t=>{t.target.checked?e8(t=>[...t,e.id]):e8(t=>t.filter(t=>t!==e.id))},className:"accent-white bg-transparent border-gray-600 rounded-sm"}),(0,w.jsx)("span",{className:"w-2 h-2 rounded-full shadow-[0_0_5px]",style:{backgroundColor:e.color,boxShadow:`0 0 5px ${e.color}`}}),(0,w.jsx)("span",{className:`${e6.includes(e.id)?"text-gray-200":"text-gray-500"} text-xs font-bold transition-colors`,children:e.name})]},e.id))]})]}),!en&&th&&(0,w.jsx)(po,{selectedPlanet:th,isTerritoryOwned:tp,canBuild:tv,slots:tX,buildingsTemplates:m,currentTurn:x,setShowBuildMenu:O,handleUpgrade:t$,handleDemolish:tq,handleCancel:tB,showAssignMenu:U,setShowAssignMenu:e=>{z(e),e&&tH()},factionMembers:X,handleAssignGovernor:tG,isHighCommand:tg,setShowGarrisonMenu:F}),L&&th&&(0,w.jsx)(pn,{planet:th,factionData:y,planetBuildings:R,buildingsTemplates:m,onClose:()=>F(!1),onRecruit:tW,onDisband:tK}),q&&(0,w.jsx)(d3,{userFaction:e,userRole:t,onClose:()=>B(!1)}),H&&(0,w.jsx)(ue,{userFaction:e,fleets:Q,planets:u,currentTurn:x,factionData:y,factionMembers:X,onSelectFleet:(e,t)=>{let r=u.find(t=>t.id===e.location_id);r&&(tI(r),M(r)),"move"===t&&(em(e),G(!1))},onClose:()=>G(!1)}),o&&("ground"===o.type?(0,w.jsx)(um,{attackerArmy:o.attackerArmy,defenderGarrison:o.defenderGarrison,planetType:o.defenderPlanet?.planet_type||"unknown",onBattleEnd:tS,customUnits:eF.filter(e=>"ground"===e.category),customMap:ta.find(e=>e.id===o.defenderPlanet?.ground_map_id),heroData:n,magicDomains:ej}):(0,w.jsx)(uu,{attackerFleet:o.attackerFleet,defenderFleets:o.defenderFleets,defenderPlanet:o.defenderPlanet,onBattleEnd:tS,customUnits:eF.filter(e=>"space"===e.category)})),V&&(0,w.jsx)(dJ,{userFaction:e,onClose:()=>$(!1)}),D&&tv&&(0,w.jsx)(pl,{buildingsTemplates:m,factionData:y,selectedPlanet:th,handleConstruct:tV,onClose:()=>O(!1),userFaction:e}),W&&uZ&&(0,w.jsx)(uZ,{userID:r,onClose:()=>K(!1)}),eg&&(0,w.jsx)("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:(0,w.jsxs)("div",{className:"bg-gray-900 border-2 border-yellow-600 rounded-xl p-6 shadow-[0_0_50px_rgba(234,179,8,0.2)] max-w-md w-full relative overflow-hidden",children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20 pointer-events-none"}),(0,w.jsxs)("h3",{className:"text-2xl font-bold text-yellow-500 uppercase tracking-widest mb-4 flex items-center gap-3 border-b border-yellow-900/50 pb-4",children:[(0,w.jsx)("span",{className:"text-3xl",children:""})," Ordre de Navigation"]}),(0,w.jsxs)("div",{className:"space-y-6 relative z-10 px-2",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center bg-black/40 p-3 rounded border border-gray-800",children:[(0,w.jsxs)("span",{className:"text-gray-400 text-xs uppercase flex items-center gap-2",children:[(0,w.jsx)("span",{className:"w-2 h-2 rounded-full bg-cyan-500 animate-pulse"}),"Flotte"]}),(0,w.jsx)("span",{className:"text-white font-bold",children:eg.fleet.name})]}),(0,w.jsxs)("div",{className:"flex items-center justify-between text-sm px-4",children:[(0,w.jsxs)("div",{className:"flex flex-col items-center gap-1 group",children:[(0,w.jsx)("span",{className:"text-gray-500 text-[10px] uppercase tracking-wider",children:"Origine"}),(0,w.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-800 border-2 border-gray-600 flex items-center justify-center text-lg shadow-lg group-hover:border-white transition-colors",children:""}),(0,w.jsx)("span",{className:"text-white font-bold text-center mt-1 text-xs",children:eg.source.name})]}),(0,w.jsxs)("div",{className:"flex-grow flex flex-col items-center px-4",children:[(0,w.jsx)("div",{className:"w-full h-px bg-yellow-600/50 relative",children:(0,w.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-900 px-2 text-yellow-500 text-xs",children:""})}),(0,w.jsxs)("span",{className:"text-[10px] text-gray-500 mt-2 font-mono",children:[eg.turns," Tours"]})]}),(0,w.jsxs)("div",{className:"flex flex-col items-center gap-1 group",children:[(0,w.jsx)("span",{className:"text-gray-500 text-[10px] uppercase tracking-wider",children:"Destination"}),(0,w.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-800 border-2 border-yellow-500 flex items-center justify-center text-lg shadow-[0_0_15px_rgba(234,179,8,0.3)] animate-pulse",children:""}),(0,w.jsx)("span",{className:"text-yellow-400 font-bold text-center mt-1 text-xs",children:eg.target.name})]})]}),(0,w.jsxs)("div",{className:"bg-yellow-900/10 border border-yellow-600/30 p-4 rounded flex justify-between items-center",children:[(0,w.jsx)("span",{className:"text-xs uppercase text-yellow-200 tracking-widest",children:"Dure estime"}),(0,w.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,w.jsx)("span",{className:"text-2xl font-mono font-bold text-yellow-400",children:eg.turns}),(0,w.jsx)("span",{className:"text-xs text-yellow-600 font-bold uppercase",children:"Tours"})]})]})]}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-8 relative z-10 border-t border-gray-800 pt-4",children:[(0,w.jsx)("button",{onClick:()=>{ex(null)},className:"py-3 rounded border border-gray-600 text-gray-400 hover:bg-gray-800 hover:text-white uppercase font-bold text-xs transition-all hover:border-gray-400",children:"Changer Cible"}),(0,w.jsxs)("button",{onClick:tA,className:"py-3 rounded bg-gradient-to-r from-yellow-800 to-yellow-600 hover:from-yellow-700 hover:to-yellow-500 text-white border border-yellow-500 uppercase font-bold text-xs shadow-[0_0_20px_rgba(234,179,8,0.3)] hover:shadow-[0_0_30px_rgba(234,179,8,0.5)] transition-all flex items-center justify-center gap-2 transform hover:scale-[1.02]",children:[(0,w.jsx)("span",{children:"Lancer FTL"}),(0,w.jsx)("span",{children:""})]})]})]})}),eb&&(0,w.jsx)(hs,{userFaction:e,factionData:y,onClose:()=>ey(!1)}),ev&&(0,w.jsx)(hT,{onClose:()=>ew(!1),userFaction:e,magicDomains:ej,buildingsTemplates:m}),e_&&(0,w.jsx)(hz,{onClose:()=>eN(!1)}),i&&(0,w.jsx)(pc,{onClose:()=>a(!1),onStart:e=>{"ground"===e.mode?l({id:`sim-ground-${Date.now()}`,type:"ground",attackerArmy:{id:"sim-army",name:"Arme (Sim)",owner:"republic",composition:e.attacker},defenderGarrison:{id:"sim-garrison",name:"Garnison (Sim)",owner:"empire",composition:e.defender},defenderPlanet:{name:"Simulation Surface",planet_type:"standard"},isSimulation:!0}):l({id:`sim-${Date.now()}`,type:"space",attackerFleet:{id:"sim-attacker",name:"Attaquant (Sim)",owner:"republic",composition:e.attacker,totalPower:1e3},defenderFleets:[{id:"sim-defender",name:"Dfenseur (Sim)",owner:"empire",composition:e.defender,totalPower:1e3}],defenderPlanet:{name:"Simulation",garrison:e.garrison,owner:"empire"},isSimulation:!0}),a(!1)},customUnits:eF}),tl&&(0,w.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-900/95 border-2 border-orange-500 p-6 z-[100] w-[500px] max-h-[80vh] flex flex-col shadow-[0_0_50px_rgba(249,115,22,0.3)] rounded-xl backdrop-blur-sm animate-in fade-in zoom-in duration-200",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-gray-700 pb-2",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)("span",{className:"text-3xl",children:""}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"text-orange-400 font-bold uppercase text-xl font-sans tracking-wide",children:tl.name}),(0,w.jsx)("p",{className:"text-xs text-orange-200/70 font-mono",children:"SECTEUR GALACTIQUE"})]})]}),(0,w.jsx)("button",{onClick:()=>tc(null),className:"w-8 h-8 rounded-full border border-gray-600 hover:border-orange-500 hover:bg-orange-900/30 text-gray-400 hover:text-white transition-all flex items-center justify-center",children:""})]}),(0,w.jsxs)("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-4",children:[tl.description&&(0,w.jsx)("div",{className:"bg-black/40 p-4 rounded-lg border border-orange-900/30",children:(0,w.jsxs)("p",{className:"text-sm text-gray-300 italic font-serif leading-relaxed",children:['"',tl.description,'"']})}),(0,w.jsxs)("div",{children:[(0,w.jsxs)("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2 flex items-center gap-2",children:[(0,w.jsx)("span",{className:"w-1 h-1 bg-orange-500 rounded-full"}),"Systmes Plantaires (",tl.planets.length,")"]}),(0,w.jsx)("div",{className:"grid grid-cols-2 gap-2",children:tl.planets.map(e=>{let t=p.find(t=>t.id===e.owner);return(0,w.jsxs)("div",{className:"bg-black/60 p-2 rounded border border-gray-800 flex items-center justify-between group hover:border-orange-700/50 transition-colors cursor-pointer",onClick:()=>{tI(e),tc(null)},children:[(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[(0,w.jsx)("div",{className:"w-2 h-2 rounded-full shadow-[0_0_5px]",style:{backgroundColor:e.color,boxShadow:`0 0 5px ${e.color}`}}),(0,w.jsx)("span",{className:"text-xs font-bold text-gray-200",children:e.name})]}),t&&(0,w.jsx)("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-gray-900 border border-gray-700 text-gray-400 max-w-[80px] truncate",children:t.name})]},e.id)})})]}),(0,w.jsxs)("div",{className:"grid grid-cols-3 gap-2 mt-4 pt-4 border-t border-gray-800",children:[(0,w.jsxs)("div",{className:"text-center",children:[(0,w.jsx)("div",{className:"text-[10px] text-gray-500 uppercase",children:"Population"}),(0,w.jsx)("div",{className:"text-lg font-mono text-blue-400",children:tl.planets.reduce((e,t)=>e+(t.population||0),0).toLocaleString()})]}),(0,w.jsxs)("div",{className:"text-center",children:[(0,w.jsx)("div",{className:"text-[10px] text-gray-500 uppercase",children:"conomie"}),(0,w.jsxs)("div",{className:"text-lg font-mono text-yellow-500",children:[tl.planets.reduce((e,t)=>e+(t.base_production?.credits||0),0)," ",(0,w.jsx)("span",{className:"text-xs",children:"Cr"})]})]}),(0,w.jsxs)("div",{className:"text-center",children:[(0,w.jsx)("div",{className:"text-[10px] text-gray-500 uppercase",children:"Contrle"}),(0,w.jsx)("div",{className:"text-xs text-gray-300 mt-1",children:(()=>{let e={};tl.planets.forEach(t=>e[t.owner]=(e[t.owner]||0)+1);let t=Object.entries(e).sort((e,t)=>t[1]-e[1])[0];if(!t)return"Inconnu";let r=p.find(e=>e.id===t[0]);return r?`${r.name} (${Math.round(t[1]/tl.planets.length*100)}%)`:"Neutre"})()})]})]})]})]}),Z&&(0,w.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-900 border-2 border-white p-6 z-[100] w-80 shadow-2xl rounded",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-gray-700 pb-2",children:[(0,w.jsx)("h3",{className:"text-white font-bold uppercase",children:"Paramtres Globaux"}),(0,w.jsx)("button",{onClick:()=>et(!1),className:"text-gray-400 hover:text-white",children:""})]}),(0,w.jsxs)("div",{className:"flex justify-between items-center",children:[(0,w.jsx)("span",{className:"text-sm text-gray-300 uppercase",children:"Systme de Flotte"}),(0,w.jsx)("button",{onClick:tE,className:`px-3 py-1 rounded text-xs font-bold uppercase ${I?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:I?"ACTIF":"INACTIF"})]})]}),eT&&en&&(0,w.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-900 border-2 border-purple-600 p-6 z-[100] w-[500px] max-h-[85vh] flex flex-col shadow-2xl",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-gray-700 pb-2",children:[(0,w.jsx)("h3",{className:"text-purple-400 font-bold uppercase",children:er?"Modifier Faction":"Grer Factions"}),(0,w.jsx)("button",{onClick:()=>{eA(!1),es(null)},className:"text-white hover:text-red-500",children:"X"})]}),(0,w.jsxs)("form",{onSubmit:er?tD:tP,className:"flex flex-col gap-3 mb-4 p-4 bg-black/40 rounded border border-gray-800 overflow-y-auto custom-scrollbar flex-grow",children:[(0,w.jsx)("span",{className:"text-[10px] text-gray-400 uppercase font-bold",children:er?`Modifier ${er.name}`:"Nouvelle Faction"}),(0,w.jsx)("input",{name:"name",defaultValue:er?.name||"",placeholder:"Nom",className:"bg-black border border-gray-700 p-1 text-xs text-white",required:!0}),(0,w.jsx)("input",{name:"image",defaultValue:er?.image||"",placeholder:"URL Image",className:"bg-black border border-gray-700 p-1 text-xs text-white"}),(0,w.jsxs)("div",{className:"space-y-2 border-t border-gray-800 pt-2",children:[(0,w.jsx)("span",{className:"text-[10px] text-[#e5c07b] uppercase font-bold",children:"Phrases Diplomatiques"}),(0,w.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[9px] text-red-400 uppercase",children:"Guerre"}),(0,w.jsx)("textarea",{name:"phrase_war",defaultValue:er?.diplomatic_phrases?.war||"",className:"w-full h-10 bg-black border border-gray-700 p-1 text-[10px] text-white"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[9px] text-green-400 uppercase",children:"Alliance"}),(0,w.jsx)("textarea",{name:"phrase_alliance",defaultValue:er?.diplomatic_phrases?.alliance||"",className:"w-full h-10 bg-black border border-gray-700 p-1 text-[10px] text-white"})]})]})]}),(0,w.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,w.jsx)("input",{name:"color",type:"color",className:"h-8 w-10 cursor-pointer bg-transparent",defaultValue:er?.color||"#00ff00"}),(0,w.jsx)("button",{type:"submit",className:"flex-grow bg-green-900 hover:bg-green-700 text-white text-[10px] font-bold uppercase rounded",children:er?"Sauvegarder":"Crer"})]})]},er?er.id:"new"),(0,w.jsx)("div",{className:"overflow-y-auto space-y-1",children:p.map(e=>(0,w.jsxs)("div",{className:"flex justify-between items-center p-2 border border-gray-800 bg-black",children:[(0,w.jsx)("div",{className:"flex items-center gap-2",children:(0,w.jsx)("span",{className:"text-xs font-bold",style:{color:e.color},children:e.name})}),(0,w.jsxs)("div",{className:"flex gap-2",children:[(0,w.jsx)("button",{onClick:()=>es(e),className:"text-yellow-500 text-[10px]",children:""}),(0,w.jsx)("button",{onClick:async()=>{confirm("Supprimer "+e.name+" ? Cela ne changera pas le propritaire des plantes actuelles.")&&await oX(aJ(dY,"factions",e.id))},className:"text-red-500 text-[10px] hover:text-red-400",children:""})]})]},e.id))})]}),eO&&en&&(0,w.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-900 border-2 border-orange-600 p-6 z-[100] w-[400px] max-h-[85vh] flex flex-col shadow-2xl",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-gray-700 pb-2",children:[(0,w.jsx)("h3",{className:"text-orange-400 font-bold uppercase",children:"Grer Rgions"}),(0,w.jsx)("button",{onClick:()=>eL(!1),className:"text-white hover:text-red-500",children:"X"})]}),(0,w.jsxs)("form",{onSubmit:async e=>{e.preventDefault();let t=new FormData(e.target),r=t.get("name"),s=t.get("description");if(r)try{await oY(aY(dY,"regions"),{name:r,description:s,created_at:new Date}),e.target.reset()}catch(e){console.error("Error adding region:",e),alert("Erreur lors de la cration : "+e.message)}},className:"flex flex-col gap-2 mb-4 bg-black/40 p-3 rounded border border-gray-800",children:[(0,w.jsx)("span",{className:"text-[10px] text-gray-400 uppercase font-bold",children:"Nouvelle Rgion"}),(0,w.jsx)("input",{name:"name",placeholder:"Nom de la rgion",className:"w-full bg-black border border-gray-700 p-2 text-xs text-white focus:border-orange-500 outline-none",required:!0}),(0,w.jsx)("textarea",{name:"description",placeholder:"Description courte (optionnelle)",className:"w-full h-16 bg-black border border-gray-700 p-2 text-xs text-white resize-none focus:border-orange-500 outline-none"}),(0,w.jsx)("button",{type:"submit",className:"w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-1 rounded text-xs uppercase transition-colors",children:"Ajouter la Rgion"})]}),(0,w.jsxs)("div",{className:"overflow-y-auto space-y-1 custom-scrollbar flex-grow bg-black/20 p-1 min-h-[100px]",children:[ez.map(e=>(0,w.jsxs)("div",{className:"p-2 border border-gray-800 bg-black hover:bg-gray-800 group transition-colors",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,w.jsx)("span",{className:"text-xs text-orange-200 font-bold",children:e.name||"Sans Nom"}),(0,w.jsx)("button",{type:"button",onClick:async()=>{confirm("Supprimer "+e.name+" ?")&&await oX(aJ(dY,"regions",e.id))},className:"text-red-500 text-[10px] hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]}),e.description&&(0,w.jsx)("p",{className:"text-[9px] text-gray-500 italic border-l-2 border-orange-900/50 pl-2",children:e.description})]},e.id)),0===ez.length&&(0,w.jsx)("div",{className:"text-gray-500 text-xs italic text-center p-4 border border-dashed border-gray-800 rounded",children:"Aucune rgion dfinie"})]})]}),eP&&en&&(0,w.jsx)(hu,{onClose:()=>eD(!1),magicDomains:ej}),eM&&en&&(0,w.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-900 border-2 border-blue-600 p-6 z-[100] w-[600px] max-h-[90vh] flex flex-col shadow-2xl",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b border-gray-700 pb-2",children:[(0,w.jsx)("h3",{className:"text-blue-400 font-bold uppercase",children:"Architecte de Plans"}),(0,w.jsx)("button",{onClick:()=>{eR(!1),tu(null)},className:"text-white hover:text-red-500",children:"X"})]}),(0,w.jsxs)("form",{onSubmit:tO,className:"flex flex-col gap-3 overflow-y-auto custom-scrollbar pr-2 mb-4 bg-black/40 p-4 rounded",children:[td&&(0,w.jsxs)("div",{className:"text-[10px] text-yellow-500 uppercase font-bold text-center border border-yellow-800 bg-yellow-900/10 p-1 mb-2",children:["Mode dition : ",td.name]}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase block",children:"Description"}),(0,w.jsx)("input",{name:"description",defaultValue:td?.description,className:"w-full bg-black border border-gray-700 p-1 text-xs text-white"})]}),(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase block",children:"Nom du Plan / Srie (Optionnel)"}),(0,w.jsx)("input",{name:"series_name",defaultValue:td?.series_name,placeholder:"Ex: Mine de Doonium (utilis pour l'affichage gnral)",className:"w-full bg-black border border-gray-700 p-1 text-xs text-white text-yellow-500 font-bold"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase block mb-1",children:"Catgorie"}),(0,w.jsx)("select",{name:"category",defaultValue:td?.category||"economic",className:"w-full bg-black border border-blue-900 text-white text-xs p-2 rounded",children:hZ.map(e=>(0,w.jsxs)("option",{value:e.id,children:[e.icon," ",e.label]},e.id))})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase block mb-1",children:"Groupe / Limite"}),(0,w.jsx)("input",{name:"group",placeholder:"Ex: Mine (Empche 2 mines)",defaultValue:td?.group||"",className:"w-full bg-black border border-gray-700 p-2 text-xs text-white uppercase"})]}),(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase block mb-1",children:"Restrictions Plantaires"}),(0,w.jsx)("div",{className:"flex gap-2 flex-wrap bg-black/30 p-2 rounded border border-gray-800",children:["standard","industrial","capital","force_nexus"].map(e=>(0,w.jsxs)("label",{className:"flex items-center gap-1 text-[10px] text-gray-300 cursor-pointer",children:[(0,w.jsx)("input",{type:"checkbox",name:"allowed_types",value:e,defaultChecked:!td||td.allowed_types?.includes(e),className:"accent-blue-500"})," ",e]},e))})]}),(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase block mb-1",children:"Limite de Faction (Optionnel)"}),(0,w.jsxs)("div",{className:"bg-black/30 p-2 rounded border border-gray-800 h-24 overflow-y-auto custom-scrollbar",children:[(0,w.jsx)("label",{className:"flex items-center gap-2 mb-1 p-1 hover:bg-white/5 rounded cursor-pointer",children:(0,w.jsx)("span",{className:"text-[10px] text-gray-400 italic",children:"Si aucune case coche = Disponible pour tous"})}),p.map(e=>(0,w.jsxs)("label",{className:"flex items-center gap-2 mb-1 p-1 hover:bg-white/5 rounded cursor-pointer",children:[(0,w.jsx)("input",{type:"checkbox",name:"allowed_factions",value:e.id,defaultChecked:td?.allowed_factions?.includes(e.id),className:"accent-purple-500"}),(0,w.jsx)("span",{className:"text-xs font-bold",style:{color:e.color},children:e.name})]},e.id))]})]}),(0,w.jsxs)("div",{className:"col-span-2 flex items-center gap-2",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase",children:"Niveaux :"}),(0,w.jsx)("select",{value:e$,onChange:e=>eq(parseInt(e.target.value)),className:"bg-black border border-blue-800 text-blue-400 text-xs p-1 rounded",children:[1,2,3,4,5].map(e=>(0,w.jsx)("option",{value:e,children:e},e))})]})]}),(0,w.jsx)("div",{className:"flex gap-1 border-b border-gray-700 mb-2",children:Array.from({length:e$},(e,t)=>t+1).map(e=>(0,w.jsxs)("button",{type:"button",onClick:()=>eH(e),className:`px-3 py-1 text-[10px] font-bold uppercase rounded-t ${eB===e?"bg-blue-900 text-white":"bg-gray-800 text-gray-500 hover:bg-gray-700"}`,children:["Nv ",e]},e))}),Array.from({length:e$},(e,t)=>t+1).map(e=>{td?.upgrades?.find(t=>t.level===e);let t=1===e?td:td?.upgrades?.find(t=>t.level===e);return(0,w.jsxs)("div",{className:eB===e?"block space-y-3 p-2 border border-gray-800 rounded bg-black/20":"hidden",children:[(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-400 uppercase",children:"Nom"}),(0,w.jsx)("input",{name:`level_${e}_name`,defaultValue:t?.name,className:"w-full bg-black border border-gray-700 p-1 text-xs text-white",required:!0})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-400 uppercase",children:"Temps"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_turns`,defaultValue:t?.turns_required||1,className:"w-full bg-black border border-gray-700 p-1 text-xs text-white",required:!0})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-400 uppercase",children:"Cot (Cr)"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_cost_credits`,defaultValue:t?.cost||t?.cost_credits||100,className:"w-full bg-black border border-gray-700 p-1 text-xs text-white",required:!0})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-400 uppercase",children:"Cot (Mat)"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_cost_materials`,defaultValue:t?.cost_materials||0,className:"w-full bg-black border border-gray-700 p-1 text-xs text-white"})]})]}),(0,w.jsxs)("div",{className:"grid grid-cols-3 gap-2 border-t border-gray-800 pt-2",children:[(0,w.jsx)("div",{className:"col-span-3 text-[10px] text-green-500 font-bold uppercase",children:"Production"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_prod_credits`,defaultValue:t?.production?.credits,placeholder:"CR",className:"bg-black border border-green-900 p-1 text-[10px] text-white"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_prod_materials`,defaultValue:t?.production?.materials,placeholder:"MAT",className:"bg-black border border-green-900 p-1 text-[10px] text-white"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_prod_manpower`,defaultValue:t?.production?.manpower,placeholder:"HOM",className:"bg-black border border-green-900 p-1 text-[10px] text-white"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_prod_science`,defaultValue:t?.production?.science,placeholder:"SCI ()",className:"bg-black border border-purple-900 p-1 text-[10px] text-white"})]}),(0,w.jsxs)("div",{className:"grid grid-cols-3 gap-2 border-t border-gray-800 pt-2",children:[(0,w.jsx)("div",{className:"col-span-3 text-[10px] text-red-500 font-bold uppercase",children:"Maintenance"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_maint_credits`,defaultValue:t?.maintenance?.credits,placeholder:"CR",className:"bg-black border border-red-900 p-1 text-[10px] text-white"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_maint_materials`,defaultValue:t?.maintenance?.materials,placeholder:"MAT",className:"bg-black border border-red-900 p-1 text-[10px] text-white"}),(0,w.jsx)("input",{type:"number",name:`level_${e}_maint_manpower`,defaultValue:t?.maintenance?.manpower,placeholder:"HOM",className:"bg-black border border-red-900 p-1 text-[10px] text-white"})]}),(0,w.jsxs)("div",{className:"border-t border-gray-800 pt-2 mt-2",children:[(0,w.jsx)("div",{className:"text-[10px] text-orange-500 font-bold uppercase mb-1",children:"Units Dbloques"}),(0,w.jsx)("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(h4).map(([r,s])=>(0,w.jsxs)("label",{className:"flex items-center gap-1 text-[9px] text-gray-300 cursor-pointer hover:bg-white/5 rounded px-1",children:[(0,w.jsx)("input",{type:"checkbox",name:`level_${e}_unlocks`,value:r,defaultChecked:t?.unlocks_units?.includes(r),className:"accent-orange-500"}),s.label]},r))})]})]},e)}),(0,w.jsxs)("div",{className:"flex gap-2",children:[(0,w.jsx)("button",{type:"submit",className:"flex-grow bg-blue-900 hover:bg-blue-700 text-white text-xs font-bold py-2 uppercase tracking-widest border border-blue-700",children:td?"Modifier le Plan":"Crer le Plan"}),td&&(0,w.jsx)("button",{type:"button",onClick:()=>tu(null),className:"px-4 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold uppercase rounded",children:"Annuler"})]})]},td?td.id:"new"),(0,w.jsx)("div",{className:"overflow-y-auto space-y-1 h-32 border-t border-gray-700 pt-2",children:m.map(e=>(0,w.jsxs)("div",{className:`flex justify-between items-center p-2 border border-gray-800 text-[10px] group ${td?.id===e.id?"bg-blue-900/30 border-blue-500":"bg-black"}`,children:[(0,w.jsxs)("div",{className:"flex flex-col",children:[(0,w.jsx)("span",{className:"text-white font-bold",children:e.series_name||e.name}),e.series_name&&(0,w.jsxs)("span",{className:"text-gray-500 text-[9px]",children:[e.name," (Niv 1)"]})]}),(0,w.jsxs)("div",{className:"flex gap-2",children:[(0,w.jsx)("button",{onClick:()=>{tu(e),eq(e.max_levels||1)},className:"text-yellow-500 hover:text-yellow-300",children:""}),(0,w.jsx)("button",{onClick:async()=>await oX(aJ(dY,"buildings",e.id)),className:"text-red-500 opacity-0 group-hover:opacity-100 hover:text-red-400",children:""})]})]},e.id))})]}),tr&&(0,w.jsx)(hj,{onClose:()=>ts(!1),onSave:e=>{to(t=>{let r=t.findIndex(t=>t.id===e.id);if(r>=0){let s=[...t];return s[r]=e,s}return[...t,e]}),ts(!1)},existingMap:tn}),eS&&en&&(0,w.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-900 border-2 border-purple-500 p-6 z-[100] w-80 shadow-2xl",children:(0,w.jsxs)("form",{onSubmit:tL,className:"space-y-3",children:[(0,w.jsx)("h3",{className:"text-purple-400 font-bold uppercase text-center text-sm",children:"Nouvelle Province"}),(0,w.jsx)("input",{name:"name",placeholder:"Nom",className:"w-full bg-black border border-gray-700 p-2 text-white text-xs",required:!0}),(0,w.jsxs)("select",{name:"region",className:"w-full bg-black border border-gray-700 p-2 text-white text-xs",required:!0,children:[(0,w.jsx)("option",{value:"",children:"-- Choisir Rgion --"}),ez.map(e=>(0,w.jsx)("option",{value:e.name,children:e.name},e.id))]}),(0,w.jsxs)("select",{name:"owner",className:"w-full bg-black border border-gray-700 p-2 text-white text-xs",children:[(0,w.jsx)("option",{value:"neutral",children:"Neutre"}),p.map(e=>(0,w.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,w.jsxs)("select",{name:"type",className:"w-full bg-black border border-gray-700 p-2 text-white text-xs",children:[(0,w.jsx)("option",{value:"standard",children:"Standard"}),(0,w.jsx)("option",{value:"industrial",children:"Industriel"}),(0,w.jsx)("option",{value:"capital",children:"Capitale"}),(0,w.jsx)("option",{value:"force_nexus",children:"Nexus"})]}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t border-gray-800",children:[(0,w.jsx)("div",{className:"col-span-2 text-[10px] text-gray-500 uppercase",children:"Donnes Dmographiques"}),(0,w.jsx)("input",{name:"population",type:"number",placeholder:"Population",className:"w-full bg-black border border-gray-700 p-1 text-xs text-white"}),(0,w.jsx)("div",{className:"col-span-2 text-[10px] text-gray-500 uppercase mt-1",children:"Ressources Naturelles"}),(0,w.jsx)("input",{name:"prod_credits",type:"number",placeholder:"Crdits/Tour",className:"w-full bg-black border border-gray-700 p-1 text-xs text-white"}),(0,w.jsx)("input",{name:"prod_materials",type:"number",placeholder:"Matriaux/Tour",className:"w-full bg-black border border-gray-700 p-1 text-xs text-white"})]}),(0,w.jsx)("button",{type:"submit",className:"w-full bg-purple-600 py-2 font-bold uppercase text-xs mt-2",children:"Crer"}),(0,w.jsx)("button",{type:"button",onClick:()=>eC(!1),className:"w-full text-gray-500 text-[10px] uppercase",children:"Annuler"})]})}),eE&&en&&eG&&(0,w.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-900 border-2 border-yellow-500 p-6 z-[100] w-96 shadow-2xl",children:(0,w.jsxs)("form",{onSubmit:tF,className:"space-y-3",children:[(0,w.jsxs)("div",{className:"flex justify-between",children:[(0,w.jsx)("h3",{className:"text-yellow-500 font-bold uppercase text-sm",children:eG.name}),(0,w.jsx)("button",{type:"button",onClick:()=>eI(!1),className:"text-gray-500 text-xs",children:""})]}),(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500",children:"Nom"}),(0,w.jsx)("input",{name:"name",defaultValue:eG.name,className:"w-full bg-black border border-gray-700 p-1 text-white text-xs"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500",children:"Rgion"}),(0,w.jsxs)("select",{name:"region",defaultValue:eG.region,className:"w-full bg-black border border-gray-700 p-1 text-white text-xs",children:[(0,w.jsx)("option",{value:"",children:"-- Inconnue --"}),ez.map(e=>(0,w.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500",children:"Type"}),(0,w.jsxs)("select",{name:"planet_type",defaultValue:eG.planet_type,className:"w-full bg-black border border-gray-700 p-1 text-white text-xs",children:[(0,w.jsx)("option",{value:"standard",children:"Standard"}),(0,w.jsx)("option",{value:"industrial",children:"Industriel"}),(0,w.jsx)("option",{value:"capital",children:"Capitale"}),(0,w.jsx)("option",{value:"force_nexus",children:"Nexus"})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500",children:"Carte Tactique"}),(0,w.jsxs)("select",{name:"ground_map_id",defaultValue:eG.ground_map_id||"",className:"w-full bg-black border border-gray-700 p-1 text-white text-xs",children:[(0,w.jsx)("option",{value:"",children:"Alatoire (Dfaut)"}),ta.map(e=>(0,w.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500",children:"Propritaire"}),(0,w.jsxs)("select",{name:"owner",defaultValue:eG.owner,className:"w-full bg-black border border-gray-700 p-1 text-white text-xs",children:[(0,w.jsx)("option",{value:"neutral",children:"Neutre"}),p.map(e=>(0,w.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,w.jsxs)("div",{className:"col-span-2",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500",children:"Couleur"}),(0,w.jsx)("input",{name:"color",type:"color",defaultValue:eG.color,className:"w-full h-6 cursor-pointer"})]})]}),(0,w.jsxs)("div",{className:"grid grid-cols-3 gap-2 pt-2 border-t border-gray-800",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500",children:"Pop."}),(0,w.jsx)("input",{name:"population",type:"number",defaultValue:eG.population||0,className:"w-full bg-black border border-gray-700 p-1 text-xs text-white"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-yellow-600",children:"Prod. CR"}),(0,w.jsx)("input",{name:"prod_credits",type:"number",defaultValue:eG.base_production?.credits||0,className:"w-full bg-black border border-gray-700 p-1 text-xs text-white"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"text-[10px] text-blue-600",children:"Prod. MAT"}),(0,w.jsx)("input",{name:"prod_materials",type:"number",defaultValue:eG.base_production?.materials||0,className:"w-full bg-black border border-gray-700 p-1 text-xs text-white"})]})]}),(0,w.jsxs)("div",{className:"flex flex-col gap-2 pt-2 border-t border-gray-700",children:[(0,w.jsx)("label",{className:"text-[10px] text-gray-500 uppercase",children:"Routes Actuelles"}),(0,w.jsx)("div",{className:"flex flex-wrap gap-1",children:eG.connected_to?.map(e=>{let t=u.find(t=>t.id===e)?.name||"?";return(0,w.jsxs)("span",{className:"text-[9px] bg-gray-800 text-gray-300 px-2 py-1 rounded flex items-center gap-1",children:[t," ",(0,w.jsx)("button",{type:"button",onClick:()=>tz(e),className:"text-red-500 font-bold hover:text-white",children:"x"})]},e)})}),(0,w.jsx)("button",{type:"button",onClick:()=>{eQ(eG),eI(!1)},className:"w-full bg-blue-900/50 py-1 text-[10px] uppercase font-bold text-blue-300 border border-blue-800 border-dashed hover:bg-blue-900",children:"+ Ajouter Route"})]}),(0,w.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,w.jsx)("button",{type:"button",onClick:tU,className:"bg-red-900 hover:bg-red-800 text-white text-xs py-2 px-3 font-bold rounded",children:"Suppr."}),(0,w.jsx)("button",{type:"submit",className:"flex-1 bg-yellow-700 hover:bg-yellow-600 text-white py-2 font-bold uppercase text-xs rounded",children:"Sauvegarder"})]})]})})]})}function pu(e){return e.stopPropagation()}function ph(e){let[t,r]=e;return r>0&&(0,w.jsxs)("span",{className:`text-[8px] px-1 rounded flex items-center gap-0.5 border bg-black/50 ${"credits"===t?"text-yellow-400 border-yellow-900":"science"===t?"text-purple-400 border-purple-900":"text-blue-400 border-blue-900"}`,children:["+",r," ",t.substr(0,1).toUpperCase()]},t)}function pp(e){return(0,w.jsxs)("span",{className:"text-[9px] bg-orange-900/30 text-orange-400 border border-orange-700/50 px-1.5 py-0.5 rounded uppercase tracking-wider flex items-center gap-1",children:[(0,w.jsx)("span",{className:"text-[8px]",children:""})," ",h4[e]?.label||e]},e)}function pf(e){return"space"===e.category}function pm(e){return"ground"===e.category}function pg(e){return"turret"!==e}function px(e){return"turret"!==e}function pb(e){return"turret"!==e}function py({onSucces:e,onSwitchMode:t}){let[r,s]=(0,N.useState)(""),[n,i]=(0,N.useState)(""),[a,o]=(0,N.useState)(""),[l,c]=(0,N.useState)("dark"),[d,u]=(0,N.useState)("melee"),[h,p]=(0,N.useState)(""),[f,m]=(0,N.useState)(!1),g=async t=>{if(t.preventDefault(),p(""),m(!0),!a.trim()||a.length<3){p("Le pseudo doit faire au moins 3 caractres."),m(!1);return}try{let t=(await cG(dQ,r,n)).user;await cK(t,{displayName:a}),await oW(aJ(dY,"users",t.uid),{uid:t.uid,pseudo:a,email:r,faction_id:"neutral",role:"user",credits:1e3,magic_domain:l,combat_style:d,createdAt:new Date,is_general:!1,is_diplomat:!1,hero_data:{level:1,points:1,unlocked:["root"]}}),e&&e()}catch(e){console.error(e),"auth/email-already-in-use"===e.code?p("Email dj enregistr."):"auth/weak-password"===e.code?p("Mot de passe trop faible."):p("Erreur d'initialisation.")}finally{m(!1)}},x="relative group w-full",b="block text-[10px] font-mono uppercase tracking-[0.2em] text-gray-500 mb-2 group-focus-within:text-yellow-500 transition-colors",y="w-full bg-black/60 border border-gray-700 text-white p-4 rounded-sm focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500/50 outline-none transition-all duration-300 placeholder:text-gray-700 font-mono text-sm backdrop-blur-md",v="absolute w-3 h-3 border-yellow-600/60 pointer-events-none transition-all duration-500";return(0,w.jsxs)("div",{className:"min-h-screen w-full bg-black flex items-center justify-center p-4 md:p-8 font-sans select-none relative overflow-hidden",children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] bg-repeat opacity-20 pointer-events-none"}),(0,w.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_#1a1a1a_0%,_#000000_100%)] pointer-events-none"}),(0,w.jsxs)("div",{className:"w-full max-w-6xl bg-gray-950/80 border border-gray-800 rounded-xl shadow-2xl flex flex-col lg:flex-row overflow-hidden backdrop-blur-xl relative z-10 animate-in zoom-in-95 duration-500",children:[(0,w.jsxs)("div",{className:"hidden lg:flex w-[40%] bg-black/30 border-r border-gray-800 flex-col justify-between p-12 relative",children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5 pointer-events-none"}),(0,w.jsx)("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-600/50 to-transparent"}),(0,w.jsxs)("div",{className:"relative mt-4",children:[(0,w.jsx)("div",{className:"w-12 h-1 bg-yellow-600 mb-6"}),(0,w.jsx)("h1",{className:"text-4xl lg:text-5xl font-black uppercase tracking-tighter text-transparent bg-clip-text bg-gradient-to-br from-yellow-100 via-yellow-500 to-yellow-900 drop-shadow-lg font-serif leading-tight mb-6",children:"RECRUE"}),(0,w.jsxs)("p",{className:"text-gray-400 text-xs font-mono uppercase tracking-[0.2em] leading-relaxed max-w-xs border-l-2 border-yellow-600/30 pl-4 py-2",children:["Rejoignez le conflit galactique. ",(0,w.jsx)("br",{}),"Choisissez votre destin. ",(0,w.jsx)("br",{}),"Dominez les toiles."]})]}),(0,w.jsx)("div",{className:"space-y-4 opacity-50 mt-12",children:(0,w.jsxs)("div",{className:"text-[9px] font-mono text-gray-500 flex flex-col gap-1",children:[(0,w.jsx)("span",{children:":: PROTOCOL_V4.2 INITIALIZED"}),(0,w.jsx)("span",{children:":: CONNECTION_SECURE"}),(0,w.jsx)("span",{children:":: NODE_CORUSCANT_PRIME"})]})})]}),(0,w.jsx)("div",{className:"w-full lg:w-[60%] p-8 lg:p-16 flex flex-col justify-center bg-black/20",children:(0,w.jsxs)("div",{className:"w-full max-w-xl mx-auto relative group/panel",children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-gray-900/40 border border-yellow-900/30 rounded-lg shadow-[0_0_30px_rgba(0,0,0,0.5)] backdrop-blur-sm -z-10"}),(0,w.jsx)("div",{className:`${v} top-0 left-0 border-t-2 border-l-2 rounded-tl-sm`}),(0,w.jsx)("div",{className:`${v} top-0 right-0 border-t-2 border-r-2 rounded-tr-sm`}),(0,w.jsx)("div",{className:`${v} bottom-0 left-0 border-b-2 border-l-2 rounded-bl-sm`}),(0,w.jsx)("div",{className:`${v} bottom-0 right-0 border-b-2 border-r-2 rounded-br-sm`}),(0,w.jsxs)("div",{className:"p-8 lg:p-10",children:[(0,w.jsx)("div",{className:"lg:hidden mb-8 text-center",children:(0,w.jsx)("h1",{className:"text-4xl font-bold text-yellow-500 uppercase tracking-widest font-serif",children:"Recrutement"})}),(0,w.jsxs)("div",{className:"hidden lg:flex text-yellow-600 text-xs font-bold uppercase tracking-[0.3em] mb-8 items-center gap-2",children:[(0,w.jsx)("span",{className:"w-4 h-4 border border-yellow-600 rounded-full block animate-pulse"}),"Initialisation du dossier"]}),h&&(0,w.jsxs)("div",{className:"mb-8 p-4 bg-red-950/40 border-l-2 border-red-500 text-red-300 text-xs font-mono flex items-center gap-3 shadow-lg",children:[(0,w.jsx)("span",{className:"text-lg",children:""})," ",h]}),(0,w.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[(0,w.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,w.jsxs)("div",{className:x,children:[(0,w.jsx)("label",{className:b,children:"Identifiant"}),(0,w.jsx)("input",{type:"text",placeholder:"Nom de Guerre",value:a,onChange:e=>o(e.target.value),className:y,required:!0,minLength:3})]}),(0,w.jsxs)("div",{className:x,children:[(0,w.jsx)("label",{className:b,children:"Frquence (Email)"}),(0,w.jsx)("input",{type:"email",placeholder:"contact@holonet.com",value:r,onChange:e=>s(e.target.value),className:y,required:!0})]})]}),(0,w.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,w.jsxs)("div",{className:x,children:[(0,w.jsx)("label",{className:b,children:"Style de Combat"}),(0,w.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:`${y} appearance-none cursor-pointer`,children:[(0,w.jsx)("option",{value:"melee",children:" Mle (Force/Sabre)"}),(0,w.jsx)("option",{value:"shooter",children:" Tireur (Blaster/Tech)"})]})]}),(0,w.jsxs)("div",{className:x,children:[(0,w.jsx)("label",{className:b,children:"Domaine de Pouvoir"}),(0,w.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:`${y} appearance-none cursor-pointer`,children:[(0,w.jsx)("option",{value:"dark",children:" Obscurit (Corruption/Peur)"}),(0,w.jsx)("option",{value:"light",children:" Lumire (Soin/Protection)"}),(0,w.jsx)("option",{value:"mandalorian",children:" Mandalorien (Gadgets/Tech)"})]})]})]}),(0,w.jsxs)("div",{className:x,children:[(0,w.jsx)("label",{className:b,children:"Code d'Accs"}),(0,w.jsx)("input",{type:"password",placeholder:"",value:n,onChange:e=>i(e.target.value),className:`${y} tracking-widest`,required:!0,minLength:6})]}),(0,w.jsxs)("div",{className:"pt-8 flex flex-col md:flex-row items-center justify-between gap-6 border-t border-gray-800/50 mt-8",children:[(0,w.jsxs)("div",{className:"text-gray-500 text-[10px] font-mono uppercase tracking-wider order-2 md:order-1",children:["Dj enregistr ?"," ",(0,w.jsx)("button",{type:"button",onClick:t,className:"ml-2 text-yellow-600 hover:text-yellow-400 font-bold transition-colors underline decoration-yellow-800/50 hover:decoration-yellow-400 underline-offset-4",children:"Connexion"})]}),(0,w.jsx)("button",{type:"submit",disabled:f,className:`order-1 md:order-2 w-full md:w-auto px-10 py-4 bg-gradient-to-r from-yellow-700 to-yellow-600 hover:from-yellow-600 hover:to-yellow-500 text-white font-bold uppercase tracking-[0.25em] text-xs transition-all duration-300 shadow-[0_0_20px_rgba(202,138,4,0.1)] hover:shadow-[0_0_30px_rgba(202,138,4,0.3)] transform hover:-translate-y-1 ${f?"opacity-50 cursor-wait":""}`,style:{clipPath:"polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px)"},children:f?"TRAITEMENT...":"INITIALISER"})]})]})]})]})})]})]})}function pv(){let[e,t]=(0,N.useState)(!0),[r,s]=(0,N.useState)(""),[n,i]=(0,N.useState)(""),[a,o]=(0,N.useState)(""),[l,c]=(0,N.useState)(!1);if(!e)return(0,w.jsx)(py,{onSwitchMode:()=>t(!0)});let d=async e=>{e.preventDefault(),o(""),c(!0);try{await (eU(dQ.app)?Promise.reject(ls(dQ)):cV(ee(dQ),cS.credential(r,n)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&cH(dQ),e}))}catch(e){o("Email ou mot de passe incorrect.")}finally{c(!1)}};return(0,w.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-8 bg-black text-white relative overflow-hidden font-sans",children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-gray-900 via-black to-black opacity-80 pointer-events-none"}),(0,w.jsx)("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20 pointer-events-none"}),(0,w.jsxs)("header",{className:"mb-12 text-center z-10",children:[(0,w.jsx)("h1",{className:"text-6xl font-bold text-yellow-500 tracking-wider uppercase drop-shadow-[0_0_15px_rgba(234,179,8,0.5)] mb-2 font-serif",children:"SWTOR"}),(0,w.jsx)("div",{className:"text-sm text-gray-400 uppercase tracking-[0.8em] border-t border-gray-800 pt-2 mt-2",children:"Galactic Conquest"})]}),(0,w.jsxs)("div",{className:"z-10 w-full max-w-md bg-gray-900/60 p-8 rounded-lg border border-gray-700 shadow-2xl backdrop-blur-md",children:[(0,w.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-white uppercase tracking-widest border-b border-gray-700 pb-4",children:"Connexion"}),a&&(0,w.jsx)("div",{className:"mb-4 p-2 bg-red-900/50 border border-red-500 text-red-200 text-xs text-center rounded font-mono",children:a}),(0,w.jsxs)("form",{onSubmit:d,className:"space-y-4",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 font-mono",children:"Email"}),(0,w.jsx)("input",{type:"email",value:r,onChange:e=>s(e.target.value),className:"w-full bg-black/50 border border-gray-600 p-3 text-white focus:border-yellow-500 outline-none rounded-sm text-sm transition-colors",required:!0})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1 font-mono",children:"Mot de passe"}),(0,w.jsx)("input",{type:"password",value:n,onChange:e=>i(e.target.value),className:"w-full bg-black/50 border border-gray-600 p-3 text-white focus:border-yellow-500 outline-none rounded-sm text-sm transition-colors",required:!0})]}),(0,w.jsx)("button",{type:"submit",disabled:l,className:`w-full py-3 mt-4 font-bold uppercase tracking-widest text-xs transition-all border border-yellow-600/50 hover:border-yellow-500 ${l?"bg-gray-800 text-gray-500":"bg-yellow-900/40 hover:bg-yellow-800/60 text-yellow-100 shadow-[0_0_10px_rgba(234,179,8,0.2)]"}`,children:l?"AUTHENTIFICATION...":"ACCDER AU TERMINAL"})]}),(0,w.jsx)("div",{className:"mt-6 text-center border-t border-gray-800 pt-4",children:(0,w.jsxs)("p",{className:"text-gray-500 text-xs font-mono",children:["Nouvelle recrue ?"," ",(0,w.jsx)("button",{onClick:()=>t(!1),className:"text-yellow-500 hover:text-white font-bold underline cursor-pointer ml-1 transition-colors",children:"S'ENRLER"})]})})]})]})}let pw=[{id:"republic",name:"Rpublique Galactique",color:"blue",bgImage:"/images/republic_bg.jpg",icon:(0,w.jsx)("svg",{className:"w-12 h-12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 2L1 22h22L12 2zm0 3.5l8.5 15.5h-17L12 5.5zM12 8a1 1 0 100 2 1 1 0 000-2z"})}),desc:"Dfenseurs de la paix et de la dmocratie. Ordre, Justice et Lumire.",bg:"bg-blue-950/40",border:"border-blue-500",glow:"shadow-blue-500/50",text:"text-blue-400",hoverStyle:"hover:border-blue-500/60 hover:shadow-[0_0_20px_rgba(59,130,246,0.3)] hover:bg-blue-900/10",overlayColor:"from-blue-400/30 to-blue-950/60"},{id:"empire",name:"Empire Sith",color:"red",bgImage:"/images/empire_bg.jpg",icon:(0,w.jsx)("svg",{className:"w-12 h-12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 2l-5 9h10l-5-9zm0 2.5l2.5 4.5h-5L12 4.5zM7 13l-5 9h10l-5-9zm5 0l-5 9h10l-5-9zm5 0l-5 9h10l-5-9z"})}),desc:"La paix est un mensonge. Il n'y a que la passion. Force, Pouvoir et Conqute.",bg:"bg-red-950/40",border:"border-red-600",glow:"shadow-red-600/50",text:"text-red-500",hoverStyle:"hover:border-red-600/60 hover:shadow-[0_0_20px_rgba(220,38,38,0.3)] hover:bg-red-900/10",overlayColor:"from-red-400/30 to-red-950/60"},{id:"neutral",name:"Systmes Indpendants",color:"yellow",bgImage:"/images/neutral_bg.jpg",icon:(0,w.jsx)("svg",{className:"w-12 h-12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,w.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 7h2v6h-2zm0 8h2v2h-2z"})}),desc:"Syndicats, Guildes et Mercenaires. Le profit et la libert avant tout.",bg:"bg-yellow-950/40",border:"border-yellow-600",glow:"shadow-yellow-600/50",text:"text-yellow-500",hoverStyle:"hover:border-yellow-500/60 hover:shadow-[0_0_20px_rgba(234,179,8,0.3)] hover:bg-yellow-900/10",overlayColor:"from-yellow-400/30 to-yellow-950/60"}];function p_({userID:e,onFactionSelected:t}){let[r,s]=(0,N.useState)(null),[n,i]=(0,N.useState)(null),[a,o]=(0,N.useState)(!1),l=async()=>{if(r){o(!0);try{let s=aJ(dY,"factions",r);if(!(await oB(s)).exists()){console.warn(`Faction ${r} introuvable. Recreation automatique...`);let e=pw.find(e=>e.id===r);e&&await oW(s,{name:e.name,color:"blue"===e.color?"#3b82f6":"red"===e.color?"#ef4444":"#eab308",image:e.bgImage,description:e.desc,credits:2e3,materials:1e3,manpower:500,science:0,type:"major",diplomatic_phrases:{war:"La guerre est dclare.",alliance:"Une alliance est forme.",neutral_good:"Salutations.",neutral_bad:"Mfiance."}})}await oK(aJ(dY,"users",e),{faction_id:r}),t&&t()}catch(e){console.error("Erreur choix faction:",e),o(!1)}}},c=n?pw.find(e=>e.id===n):r?pw.find(e=>e.id===r):null;return(0,w.jsxs)("div",{className:"w-full flex flex-col items-center relative",children:[(0,w.jsxs)("div",{className:"fixed inset-0 z-0 bg-black transition-colors duration-700 pointer-events-none",children:[(0,w.jsx)("div",{className:`absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] transition-opacity duration-700 ${c?"opacity-10":"opacity-50"}`}),pw.map(e=>(0,w.jsx)("div",{className:`absolute inset-0 bg-cover bg-center transition-opacity duration-700 ease-in-out
                    ${c?.id===e.id?"opacity-40":"opacity-0"}
                `,style:{backgroundImage:`url(${e.bgImage})`},children:(0,w.jsx)("div",{className:`absolute inset-0 bg-gradient-to-t ${e.overlayColor} mix-blend-overlay`})},`bg-${e.id}`))]}),(0,w.jsxs)("div",{className:"relative z-10 w-full flex flex-col items-center",children:[(0,w.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 w-full mb-8",children:pw.map(e=>{let t=r===e.id;return(0,w.jsxs)("button",{onClick:()=>s(e.id),onMouseEnter:()=>i(e.id),onMouseLeave:()=>i(null),className:`relative group flex flex-col items-center text-center p-6 rounded-xl border-2 transition-all duration-300 transform backdrop-blur-sm
                    ${t?`${e.bg} ${e.border} scale-105 shadow-[0_0_30px_rgba(0,0,0,0.5)] ${e.glow}`:`bg-gray-950/50 border-gray-800 ${e.hoverStyle}`}
                  `,children:[(0,w.jsx)("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:100%_4px] pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity rounded-xl"}),(0,w.jsx)("div",{className:`mb-4 transition-colors duration-300 ${t?e.text:`text-gray-500 group-hover:${e.text}`}`,children:e.icon}),(0,w.jsx)("h3",{className:`text-lg font-bold uppercase tracking-widest mb-2 font-serif transition-colors duration-300 ${t?"text-white":"text-gray-400 group-hover:text-white"}`,children:e.name}),(0,w.jsx)("p",{className:"text-xs text-gray-500 font-mono leading-relaxed min-h-[60px] group-hover:text-gray-300 transition-colors",children:e.desc}),(0,w.jsx)("div",{className:`mt-4 w-6 h-6 rounded-full border flex items-center justify-center transition-all duration-300 
                    ${t?`border-${e.color}-500 bg-${e.color}-500 text-black scale-110`:`border-gray-700 group-hover:border-${e.color}-500/50`}`,children:t&&(0,w.jsx)("span",{children:""})})]},e.id)})}),(0,w.jsx)("div",{className:"h-16 flex items-center justify-center w-full",children:r?(0,w.jsx)("button",{onClick:l,disabled:a,className:`px-12 py-4 font-bold uppercase tracking-[0.2em] text-sm text-white transition-all duration-300 shadow-xl clip-path-polygon animate-in fade-in slide-in-from-bottom-4
                        ${a?"bg-gray-700 cursor-wait":"bg-gradient-to-r from-yellow-700 to-yellow-600 hover:from-yellow-600 hover:to-yellow-500 hover:scale-105 hover:shadow-yellow-500/20"}
                    `,style:{clipPath:"polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px)"},children:a?"INITIALISATION...":"CONFIRMER L'ALLGEANCE"}):(0,w.jsx)("span",{className:"text-gray-400 text-xs font-mono uppercase tracking-widest animate-pulse bg-black/60 px-4 py-2 rounded backdrop-blur-md",children:"Survolez pour analyser les factions"})})]})]})}function pN(){let e,t,r,s=(0,_.c)(13),[n,i]=(0,N.useState)(null),[a,o]=(0,N.useState)(null),[l,c]=(0,N.useState)(!0);if(s[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>{var e;let t=(e=async e=>{if(i(e),e)try{let t=aJ(dY,"users",e.uid),r=await oB(t);r.exists()?o(r.data()):o(null)}catch(e){console.error(e)}else o(null);c(!1)},ee(dQ).onAuthStateChanged(e,void 0,void 0));return()=>t()},t=[],s[0]=e,s[1]=t):(e=s[0],t=s[1]),(0,N.useEffect)(e,t),l){let e;return s[2]===Symbol.for("react.memo_cache_sentinel")?(e=(0,w.jsx)("main",{className:"flex h-screen w-screen items-center justify-center bg-black text-yellow-500 font-mono",children:(0,w.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,w.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-yellow-500"}),(0,w.jsx)("div",{className:"animate-pulse tracking-widest uppercase text-sm",children:"Connexion  l'Holonet..."})]})}),s[2]=e):e=s[2],e}if(n&&a&&a.faction_id&&"neutral"!==a.faction_id){let e,t=a.role||"joueur",r=a.pseudo||n.displayName||"Commandant";return s[3]!==t||s[4]!==r||s[5]!==n.uid||s[6]!==a.faction_id||s[7]!==a.hero_data?(e=(0,w.jsx)("main",{className:"h-screen w-screen bg-black overflow-hidden",children:(0,w.jsx)(pd,{userFaction:a.faction_id,userRole:t,userID:n.uid,userName:r,heroData:a.hero_data})}),s[3]=t,s[4]=r,s[5]=n.uid,s[6]=a.faction_id,s[7]=a.hero_data,s[8]=e):e=s[8],e}if(n&&(!a||!a.faction_id||"neutral"===a.faction_id)){let e,t;return s[9]===Symbol.for("react.memo_cache_sentinel")?(e=(0,w.jsx)("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-30"}),s[9]=e):e=s[9],s[10]!==n.uid?(t=(0,w.jsxs)("main",{className:"flex min-h-screen items-center justify-center bg-black relative",children:[e,(0,w.jsx)("div",{className:"z-10 w-full max-w-4xl p-4",children:(0,w.jsx)(p_,{userID:n.uid,onFactionSelected:pj})})]}),s[10]=n.uid,s[11]=t):t=s[11],t}return s[12]===Symbol.for("react.memo_cache_sentinel")?(r=(0,w.jsx)(pv,{}),s[12]=r):r=s[12],r}function pj(){window.location.reload()}e.s(["default",()=>pN],74647)}]);